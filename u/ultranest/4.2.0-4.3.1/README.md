# Comparing `tmp/ultranest-4.2.0.tar.gz` & `tmp/ultranest-4.3.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "ultranest-4.2.0.tar", last modified: Sat Mar 23 09:34:25 2024, max compression
+gzip compressed data, was "ultranest-4.3.1.tar", last modified: Sun May 26 17:56:55 2024, max compression
```

## Comparing `ultranest-4.2.0.tar` & `ultranest-4.3.1.tar`

### file list

```diff
@@ -1,94 +1,93 @@
-drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-03-23 09:34:25.137973 ultranest-4.2.0/
--rw-rw-r--   0 user      (1000) user      (1000)     3620 2024-02-15 22:20:46.000000 ultranest-4.2.0/CONTRIBUTING.rst
--rw-rw-r--   0 user      (1000) user      (1000)     2887 2024-03-22 19:15:44.000000 ultranest-4.2.0/HISTORY.rst
--rw-rw-r--   0 user      (1000) user      (1000)     1597 2024-02-15 22:20:46.000000 ultranest-4.2.0/LICENSE
--rw-rw-r--   0 user      (1000) user      (1000)      623 2024-02-15 22:20:46.000000 ultranest-4.2.0/MANIFEST.in
--rw-r--r--   0 user      (1000) user      (1000)    10320 2024-03-23 09:34:25.137973 ultranest-4.2.0/PKG-INFO
--rw-rw-r--   0 user      (1000) user      (1000)     6397 2024-02-15 22:20:46.000000 ultranest-4.2.0/README.rst
-drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-03-23 09:34:25.109973 ultranest-4.2.0/docs/
--rw-rw-r--   0 user      (1000) user      (1000)     1898 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/API.rst
--rw-rw-r--   0 user      (1000) user      (1000)      607 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/Makefile
--rwxrwxr-x   0 user      (1000) user      (1000)     5925 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/conf.py
--rw-rw-r--   0 user      (1000) user      (1000)       33 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/contributing.rst
--rw-rw-r--   0 user      (1000) user      (1000)       28 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/history.rst
--rw-rw-r--   0 user      (1000) user      (1000)      708 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/index.rst
--rw-rw-r--   0 user      (1000) user      (1000)     1459 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/installation.rst
--rw-rw-r--   0 user      (1000) user      (1000)    14453 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/issues.rst
--rw-rw-r--   0 user      (1000) user      (1000)      770 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/make.bat
--rw-rw-r--   0 user      (1000) user      (1000)     9802 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/method.rst
--rw-rw-r--   0 user      (1000) user      (1000)       52 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/modules.rst
--rw-rw-r--   0 user      (1000) user      (1000)    29211 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/performance.rst
--rw-rw-r--   0 user      (1000) user      (1000)       27 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/readme.rst
--rw-r--r--   0 user      (1000) user      (1000)       72 2020-11-28 09:32:43.000000 ultranest-4.2.0/docs/reference.rst
-drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-03-23 09:34:25.109973 ultranest-4.2.0/docs/static/
--rw-rw-r--   0 user      (1000) user      (1000)    74298 2024-02-15 22:20:46.000000 ultranest-4.2.0/docs/static/recursion.jpg
--rw-rw-r--   0 user      (1000) user      (1000)     3057 2024-02-15 14:33:45.000000 ultranest-4.2.0/docs/ultranest.rst
-drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-03-23 09:34:25.113973 ultranest-4.2.0/examples/
--rw-r--r--   0 user      (1000) user      (1000)     8098 2022-03-15 16:01:52.000000 ultranest-4.2.0/examples/populationstepsampler6.pyx
--rw-r--r--   0 user      (1000) user      (1000)     7186 2022-03-16 13:32:16.000000 ultranest-4.2.0/examples/populationstepsampler7.pyx
--rw-rw-r--   0 user      (1000) user      (1000)      158 2024-02-15 22:20:46.000000 ultranest-4.2.0/pip-requirements.txt
--rw-rw-r--   0 user      (1000) user      (1000)      121 2024-02-15 22:20:46.000000 ultranest-4.2.0/pyproject.toml
--rw-r--r--   0 user      (1000) user      (1000)      196 2022-09-06 11:15:12.000000 ultranest-4.2.0/requirements_dev.txt
--rw-rw-r--   0 user      (1000) user      (1000)      562 2024-03-23 09:34:25.137973 ultranest-4.2.0/setup.cfg
--rw-rw-r--   0 user      (1000) user      (1000)     2410 2024-03-22 20:39:02.000000 ultranest-4.2.0/setup.py
-drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-03-23 09:34:25.133973 ultranest-4.2.0/tests/
--rw-rw-r--   0 user      (1000) user      (1000)     3347 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/benchmark_maxradius.py
--rw-rw-r--   0 user      (1000) user      (1000)      500 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/clusters2.txt
--rw-rw-r--   0 user      (1000) user      (1000)       25 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/clusters2_radius.txt
--rw-rw-r--   0 user      (1000) user      (1000)  5083850 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/eggboxpoints.tsv
--rw-rw-r--   0 user      (1000) user      (1000)    20000 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/eggboxregion.txt
--rw-rw-r--   0 user      (1000) user      (1000)    62832 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_20.npz
--rw-rw-r--   0 user      (1000) user      (1000)    67952 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_23.npz
--rw-rw-r--   0 user      (1000) user      (1000)    58992 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_24.npz
--rw-rw-r--   0 user      (1000) user      (1000)    66672 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_27.npz
--rw-rw-r--   0 user      (1000) user      (1000)   106352 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_42.npz
--rw-rw-r--   0 user      (1000) user      (1000)    36000 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_u.txt
--rw-rw-r--   0 user      (1000) user      (1000)    60000 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_u_20.txt
--rw-rw-r--   0 user      (1000) user      (1000)    54000 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_u_23.txt
--rw-rw-r--   0 user      (1000) user      (1000)    50000 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_u_24.txt
--rw-rw-r--   0 user      (1000) user      (1000)    36000 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_u_27.txt
--rw-rw-r--   0 user      (1000) user      (1000)    40500 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/overclustered_u_49.txt
--rw-rw-r--   0 user      (1000) user      (1000)     9530 2024-03-20 00:35:54.000000 ultranest-4.2.0/tests/test_clustering.py
--rw-rw-r--   0 user      (1000) user      (1000)    14966 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_flatnuts.py
--rw-rw-r--   0 user      (1000) user      (1000)    10117 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_hotstart.py
--rw-rw-r--   0 user      (1000) user      (1000)    13039 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_netiterintegrate.py
--rw-rw-r--   0 user      (1000) user      (1000)     1330 2024-02-15 22:56:05.000000 ultranest-4.2.0/tests/test_ordertest.py
--rw-rw-r--   0 user      (1000) user      (1000)     3116 2024-03-19 23:29:12.000000 ultranest-4.2.0/tests/test_plot.py
--rw-rw-r--   0 user      (1000) user      (1000)     6112 2024-03-03 00:03:05.000000 ultranest-4.2.0/tests/test_popstepsampling.py
--rw-rw-r--   0 user      (1000) user      (1000)     8215 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_regionsampling.py
--rw-rw-r--   0 user      (1000) user      (1000)    32428 2024-03-20 00:38:47.000000 ultranest-4.2.0/tests/test_run.py
--rw-rw-r--   0 user      (1000) user      (1000)    17244 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_samplingpath.py
--rw-rw-r--   0 user      (1000) user      (1000)    21320 2024-03-03 23:18:19.000000 ultranest-4.2.0/tests/test_stepsampling.py
--rw-rw-r--   0 user      (1000) user      (1000)     7601 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_store.py
--rw-rw-r--   0 user      (1000) user      (1000)     4886 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_transforms.py
--rw-rw-r--   0 user      (1000) user      (1000)     3957 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_utils.py
--rw-rw-r--   0 user      (1000) user      (1000)     2151 2024-02-15 22:20:46.000000 ultranest-4.2.0/tests/test_viz.py
-drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-03-23 09:34:25.137973 ultranest-4.2.0/ultranest/
--rw-rw-r--   0 user      (1000) user      (1000)      475 2024-03-22 20:39:02.000000 ultranest-4.2.0/ultranest/__init__.py
--rw-rw-r--   0 user      (1000) user      (1000)     9918 2024-02-16 08:37:24.000000 ultranest-4.2.0/ultranest/calibrator.py
--rw-rw-r--   0 user      (1000) user      (1000)    25190 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/dychmc.py
--rw-rw-r--   0 user      (1000) user      (1000)    24076 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/dyhmc.py
--rw-rw-r--   0 user      (1000) user      (1000)    31708 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/flatnuts.py
--rw-rw-r--   0 user      (1000) user      (1000)    21413 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/hotstart.py
--rw-rw-r--   0 user      (1000) user      (1000)   135176 2024-03-21 08:45:23.000000 ultranest-4.2.0/ultranest/integrator.py
--rw-rw-r--   0 user      (1000) user      (1000)    55012 2024-03-20 00:33:09.000000 ultranest-4.2.0/ultranest/mlfriends.pyx
--rw-rw-r--   0 user      (1000) user      (1000)    40489 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/netiter.py
--rw-rw-r--   0 user      (1000) user      (1000)     5172 2024-01-02 10:27:02.000000 ultranest-4.2.0/ultranest/neuralbound.py
--rw-rw-r--   0 user      (1000) user      (1000)     2860 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/ordertest.py
--rw-rw-r--   0 user      (1000) user      (1000)    29581 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/pathsampler.py
--rw-rw-r--   0 user      (1000) user      (1000)    36585 2024-03-22 19:59:09.000000 ultranest-4.2.0/ultranest/plot.py
--rw-rw-r--   0 user      (1000) user      (1000)    26051 2024-03-21 14:38:01.000000 ultranest-4.2.0/ultranest/popstepsampler.py
--rw-rw-r--   0 user      (1000) user      (1000)    20765 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/samplingpath.py
--rw-rw-r--   0 user      (1000) user      (1000)     3121 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/solvecompat.py
--rw-rw-r--   0 user      (1000) user      (1000)    16215 2024-03-03 23:18:19.000000 ultranest-4.2.0/ultranest/stepfuncs.pyx
--rw-rw-r--   0 user      (1000) user      (1000)    54726 2024-03-07 23:59:44.000000 ultranest-4.2.0/ultranest/stepsampler.py
--rw-rw-r--   0 user      (1000) user      (1000)     7205 2024-02-15 22:20:46.000000 ultranest-4.2.0/ultranest/store.py
--rw-rw-r--   0 user      (1000) user      (1000)    14604 2024-03-19 22:19:23.000000 ultranest-4.2.0/ultranest/utils.py
--rw-rw-r--   0 user      (1000) user      (1000)    15874 2024-03-03 12:07:16.000000 ultranest-4.2.0/ultranest/viz.py
-drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-03-23 09:34:25.137973 ultranest-4.2.0/ultranest.egg-info/
--rw-r--r--   0 user      (1000) user      (1000)    10320 2024-03-23 09:34:24.000000 ultranest-4.2.0/ultranest.egg-info/PKG-INFO
--rw-rw-r--   0 user      (1000) user      (1000)     1942 2024-03-23 09:34:24.000000 ultranest-4.2.0/ultranest.egg-info/SOURCES.txt
--rw-rw-r--   0 user      (1000) user      (1000)        1 2024-03-23 09:34:24.000000 ultranest-4.2.0/ultranest.egg-info/dependency_links.txt
--rw-rw-r--   0 user      (1000) user      (1000)        1 2024-03-23 09:33:51.000000 ultranest-4.2.0/ultranest.egg-info/not-zip-safe
--rw-rw-r--   0 user      (1000) user      (1000)       31 2024-03-23 09:34:24.000000 ultranest-4.2.0/ultranest.egg-info/requires.txt
--rw-rw-r--   0 user      (1000) user      (1000)       10 2024-03-23 09:34:24.000000 ultranest-4.2.0/ultranest.egg-info/top_level.txt
+drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-05-26 17:56:55.965863 ultranest-4.3.1/
+-rw-rw-r--   0 user      (1000) user      (1000)     3620 2024-04-22 13:40:36.000000 ultranest-4.3.1/CONTRIBUTING.rst
+-rw-rw-r--   0 user      (1000) user      (1000)     2887 2024-04-22 13:40:36.000000 ultranest-4.3.1/HISTORY.rst
+-rw-rw-r--   0 user      (1000) user      (1000)     1597 2024-04-22 13:40:36.000000 ultranest-4.3.1/LICENSE
+-rw-rw-r--   0 user      (1000) user      (1000)      623 2024-04-22 13:40:36.000000 ultranest-4.3.1/MANIFEST.in
+-rw-rw-r--   0 user      (1000) user      (1000)    10229 2024-05-26 17:56:55.965863 ultranest-4.3.1/PKG-INFO
+-rw-rw-r--   0 user      (1000) user      (1000)     6397 2024-04-22 13:40:36.000000 ultranest-4.3.1/README.rst
+drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-05-26 17:56:55.959864 ultranest-4.3.1/docs/
+-rw-rw-r--   0 user      (1000) user      (1000)     1898 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/API.rst
+-rw-rw-r--   0 user      (1000) user      (1000)      607 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/Makefile
+-rwxrwxr-x   0 user      (1000) user      (1000)     5925 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/conf.py
+-rw-rw-r--   0 user      (1000) user      (1000)       33 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/contributing.rst
+-rw-rw-r--   0 user      (1000) user      (1000)       28 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/history.rst
+-rw-rw-r--   0 user      (1000) user      (1000)      708 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/index.rst
+-rw-rw-r--   0 user      (1000) user      (1000)     1459 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/installation.rst
+-rw-rw-r--   0 user      (1000) user      (1000)    14453 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/issues.rst
+-rw-rw-r--   0 user      (1000) user      (1000)      770 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/make.bat
+-rw-rw-r--   0 user      (1000) user      (1000)     9802 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/method.rst
+-rw-rw-r--   0 user      (1000) user      (1000)       52 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/modules.rst
+-rw-rw-r--   0 user      (1000) user      (1000)    29211 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/performance.rst
+-rw-rw-r--   0 user      (1000) user      (1000)       27 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/readme.rst
+-rw-r--r--   0 user      (1000) user      (1000)       72 2020-11-28 09:32:43.000000 ultranest-4.3.1/docs/reference.rst
+drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-05-26 17:56:55.959864 ultranest-4.3.1/docs/static/
+-rw-rw-r--   0 user      (1000) user      (1000)    74298 2024-04-22 13:40:36.000000 ultranest-4.3.1/docs/static/recursion.jpg
+-rw-rw-r--   0 user      (1000) user      (1000)     3057 2024-02-15 14:33:45.000000 ultranest-4.3.1/docs/ultranest.rst
+drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-05-26 17:56:55.959864 ultranest-4.3.1/examples/
+-rw-r--r--   0 user      (1000) user      (1000)     8098 2022-03-15 16:01:52.000000 ultranest-4.3.1/examples/populationstepsampler6.pyx
+-rw-r--r--   0 user      (1000) user      (1000)     7186 2022-03-16 13:32:16.000000 ultranest-4.3.1/examples/populationstepsampler7.pyx
+-rw-rw-r--   0 user      (1000) user      (1000)      158 2024-04-22 13:40:36.000000 ultranest-4.3.1/pip-requirements.txt
+-rw-rw-r--   0 user      (1000) user      (1000)      121 2024-04-22 13:40:36.000000 ultranest-4.3.1/pyproject.toml
+-rw-r--r--   0 user      (1000) user      (1000)      196 2022-09-06 11:15:12.000000 ultranest-4.3.1/requirements_dev.txt
+-rw-rw-r--   0 user      (1000) user      (1000)      343 2024-05-26 17:56:55.965863 ultranest-4.3.1/setup.cfg
+-rw-rw-r--   0 user      (1000) user      (1000)     2410 2024-05-26 15:28:25.000000 ultranest-4.3.1/setup.py
+drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-05-26 17:56:55.963863 ultranest-4.3.1/tests/
+-rw-rw-r--   0 user      (1000) user      (1000)     3347 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/benchmark_maxradius.py
+-rw-rw-r--   0 user      (1000) user      (1000)      500 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/clusters2.txt
+-rw-rw-r--   0 user      (1000) user      (1000)       25 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/clusters2_radius.txt
+-rw-rw-r--   0 user      (1000) user      (1000)  5083850 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/eggboxpoints.tsv
+-rw-rw-r--   0 user      (1000) user      (1000)    20000 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/eggboxregion.txt
+-rw-rw-r--   0 user      (1000) user      (1000)    62832 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_20.npz
+-rw-rw-r--   0 user      (1000) user      (1000)    67952 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_23.npz
+-rw-rw-r--   0 user      (1000) user      (1000)    58992 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_24.npz
+-rw-rw-r--   0 user      (1000) user      (1000)    66672 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_27.npz
+-rw-rw-r--   0 user      (1000) user      (1000)   106352 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_42.npz
+-rw-rw-r--   0 user      (1000) user      (1000)    36000 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_u.txt
+-rw-rw-r--   0 user      (1000) user      (1000)    60000 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_u_20.txt
+-rw-rw-r--   0 user      (1000) user      (1000)    54000 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_u_23.txt
+-rw-rw-r--   0 user      (1000) user      (1000)    50000 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_u_24.txt
+-rw-rw-r--   0 user      (1000) user      (1000)    36000 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_u_27.txt
+-rw-rw-r--   0 user      (1000) user      (1000)    40500 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/overclustered_u_49.txt
+-rw-rw-r--   0 user      (1000) user      (1000)     9530 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_clustering.py
+-rw-rw-r--   0 user      (1000) user      (1000)    14966 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_flatnuts.py
+-rw-rw-r--   0 user      (1000) user      (1000)    10117 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_hotstart.py
+-rw-rw-r--   0 user      (1000) user      (1000)    13039 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_netiterintegrate.py
+-rw-rw-r--   0 user      (1000) user      (1000)     1330 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_ordertest.py
+-rw-rw-r--   0 user      (1000) user      (1000)     3116 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_plot.py
+-rw-rw-r--   0 user      (1000) user      (1000)    12121 2024-05-26 15:22:17.000000 ultranest-4.3.1/tests/test_popstepsampling.py
+-rw-rw-r--   0 user      (1000) user      (1000)     8215 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_regionsampling.py
+-rw-rw-r--   0 user      (1000) user      (1000)    32428 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_run.py
+-rw-rw-r--   0 user      (1000) user      (1000)    17244 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_samplingpath.py
+-rw-rw-r--   0 user      (1000) user      (1000)    21320 2024-05-26 14:07:43.000000 ultranest-4.3.1/tests/test_stepsampling.py
+-rw-rw-r--   0 user      (1000) user      (1000)     7601 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_store.py
+-rw-rw-r--   0 user      (1000) user      (1000)     4886 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_transforms.py
+-rw-rw-r--   0 user      (1000) user      (1000)     3957 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_utils.py
+-rw-rw-r--   0 user      (1000) user      (1000)     2151 2024-04-22 13:40:36.000000 ultranest-4.3.1/tests/test_viz.py
+drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-05-26 17:56:55.964863 ultranest-4.3.1/ultranest/
+-rw-rw-r--   0 user      (1000) user      (1000)      666 2024-05-26 15:28:25.000000 ultranest-4.3.1/ultranest/__init__.py
+-rw-rw-r--   0 user      (1000) user      (1000)     9964 2024-05-26 09:44:42.000000 ultranest-4.3.1/ultranest/calibrator.py
+-rw-rw-r--   0 user      (1000) user      (1000)    25190 2024-04-22 13:40:36.000000 ultranest-4.3.1/ultranest/dychmc.py
+-rw-rw-r--   0 user      (1000) user      (1000)    24076 2024-04-22 13:40:36.000000 ultranest-4.3.1/ultranest/dyhmc.py
+-rw-rw-r--   0 user      (1000) user      (1000)    31708 2024-04-22 13:40:36.000000 ultranest-4.3.1/ultranest/flatnuts.py
+-rw-rw-r--   0 user      (1000) user      (1000)    21431 2024-05-26 09:44:18.000000 ultranest-4.3.1/ultranest/hotstart.py
+-rw-rw-r--   0 user      (1000) user      (1000)   135217 2024-05-26 14:39:20.000000 ultranest-4.3.1/ultranest/integrator.py
+-rw-rw-r--   0 user      (1000) user      (1000)    55012 2024-05-26 14:31:07.000000 ultranest-4.3.1/ultranest/mlfriends.pyx
+-rw-rw-r--   0 user      (1000) user      (1000)    40449 2024-05-26 09:45:04.000000 ultranest-4.3.1/ultranest/netiter.py
+-rw-rw-r--   0 user      (1000) user      (1000)     2878 2024-05-26 09:44:01.000000 ultranest-4.3.1/ultranest/ordertest.py
+-rw-rw-r--   0 user      (1000) user      (1000)    29581 2024-04-22 13:40:36.000000 ultranest-4.3.1/ultranest/pathsampler.py
+-rw-rw-r--   0 user      (1000) user      (1000)    36603 2024-05-26 09:44:00.000000 ultranest-4.3.1/ultranest/plot.py
+-rw-rw-r--   0 user      (1000) user      (1000)    39638 2024-05-26 14:39:27.000000 ultranest-4.3.1/ultranest/popstepsampler.py
+-rw-rw-r--   0 user      (1000) user      (1000)    20765 2024-04-22 13:40:36.000000 ultranest-4.3.1/ultranest/samplingpath.py
+-rw-rw-r--   0 user      (1000) user      (1000)     3139 2024-05-26 09:43:59.000000 ultranest-4.3.1/ultranest/solvecompat.py
+-rw-rw-r--   0 user      (1000) user      (1000)    19606 2024-05-26 14:31:24.000000 ultranest-4.3.1/ultranest/stepfuncs.pyx
+-rw-rw-r--   0 user      (1000) user      (1000)    56419 2024-05-26 14:41:01.000000 ultranest-4.3.1/ultranest/stepsampler.py
+-rw-rw-r--   0 user      (1000) user      (1000)     7223 2024-05-26 09:43:58.000000 ultranest-4.3.1/ultranest/store.py
+-rw-rw-r--   0 user      (1000) user      (1000)    14630 2024-05-26 10:35:07.000000 ultranest-4.3.1/ultranest/utils.py
+-rw-rw-r--   0 user      (1000) user      (1000)    15967 2024-05-26 16:09:04.000000 ultranest-4.3.1/ultranest/viz.py
+drwxrwxr-x   0 user      (1000) user      (1000)        0 2024-05-26 17:56:55.964863 ultranest-4.3.1/ultranest.egg-info/
+-rw-rw-r--   0 user      (1000) user      (1000)    10229 2024-05-26 17:56:55.000000 ultranest-4.3.1/ultranest.egg-info/PKG-INFO
+-rw-rw-r--   0 user      (1000) user      (1000)     1917 2024-05-26 17:56:55.000000 ultranest-4.3.1/ultranest.egg-info/SOURCES.txt
+-rw-rw-r--   0 user      (1000) user      (1000)        1 2024-05-26 17:56:55.000000 ultranest-4.3.1/ultranest.egg-info/dependency_links.txt
+-rw-rw-r--   0 user      (1000) user      (1000)        1 2024-05-26 17:56:23.000000 ultranest-4.3.1/ultranest.egg-info/not-zip-safe
+-rw-rw-r--   0 user      (1000) user      (1000)       31 2024-05-26 17:56:55.000000 ultranest-4.3.1/ultranest.egg-info/requires.txt
+-rw-rw-r--   0 user      (1000) user      (1000)       10 2024-05-26 17:56:55.000000 ultranest-4.3.1/ultranest.egg-info/top_level.txt
```

### Comparing `ultranest-4.2.0/CONTRIBUTING.rst` & `ultranest-4.3.1/CONTRIBUTING.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/HISTORY.rst` & `ultranest-4.3.1/HISTORY.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/LICENSE` & `ultranest-4.3.1/LICENSE`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/MANIFEST.in` & `ultranest-4.3.1/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/PKG-INFO` & `ultranest-4.3.1/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ultranest
-Version: 4.2.0
+Version: 4.3.1
 Summary: Fit and compare complex models reliably and rapidly. Advanced Nested Sampling.
 Home-page: https://github.com/JohannesBuchner/ultranest
 Author: Johannes Buchner
 Author-email: johannes.buchner.acad@gmx.com
 License: GNU General Public License v3
 Keywords: ultranest
 Classifier: Development Status :: 5 - Production/Stable
@@ -16,18 +16,14 @@
 Classifier: Programming Language :: Python :: 2.7
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.5
 Classifier: Programming Language :: Python :: 3.6
 Classifier: Programming Language :: Python :: 3.7
 Requires-Python: >=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*
 License-File: LICENSE
-Requires-Dist: numpy
-Requires-Dist: cython
-Requires-Dist: matplotlib
-Requires-Dist: corner
 
 =========
 UltraNest
 =========
 
 Fit and compare complex models reliably and rapidly with advanced sampling techniques.
```

### Comparing `ultranest-4.2.0/README.rst` & `ultranest-4.3.1/README.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/API.rst` & `ultranest-4.3.1/docs/API.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/Makefile` & `ultranest-4.3.1/docs/Makefile`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/conf.py` & `ultranest-4.3.1/docs/conf.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/index.rst` & `ultranest-4.3.1/docs/index.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/installation.rst` & `ultranest-4.3.1/docs/installation.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/issues.rst` & `ultranest-4.3.1/docs/issues.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/make.bat` & `ultranest-4.3.1/docs/make.bat`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/method.rst` & `ultranest-4.3.1/docs/method.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/performance.rst` & `ultranest-4.3.1/docs/performance.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/static/recursion.jpg` & `ultranest-4.3.1/docs/static/recursion.jpg`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/docs/ultranest.rst` & `ultranest-4.3.1/docs/ultranest.rst`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/examples/populationstepsampler6.pyx` & `ultranest-4.3.1/examples/populationstepsampler6.pyx`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/examples/populationstepsampler7.pyx` & `ultranest-4.3.1/examples/populationstepsampler7.pyx`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/setup.py` & `ultranest-4.3.1/setup.py`

 * *Files 1% similar despite different names*

```diff
@@ -70,11 +70,11 @@
     keywords='ultranest',
     name='ultranest',
     packages=['ultranest'],
     setup_requires=setup_requirements,
     test_suite='tests',
     tests_require=test_requirements,
     url='https://github.com/JohannesBuchner/ultranest',
-    version='4.2.0',
+    version='4.3.1',
     zip_safe=False,
     cmdclass={'build_ext': build_ext},
 )
```

### Comparing `ultranest-4.2.0/tests/benchmark_maxradius.py` & `ultranest-4.3.1/tests/benchmark_maxradius.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/eggboxpoints.tsv` & `ultranest-4.3.1/tests/eggboxpoints.tsv`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/eggboxregion.txt` & `ultranest-4.3.1/tests/eggboxregion.txt`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_20.npz` & `ultranest-4.3.1/tests/overclustered_20.npz`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_23.npz` & `ultranest-4.3.1/tests/overclustered_23.npz`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_24.npz` & `ultranest-4.3.1/tests/overclustered_24.npz`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_27.npz` & `ultranest-4.3.1/tests/overclustered_27.npz`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_42.npz` & `ultranest-4.3.1/tests/overclustered_42.npz`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_u.txt` & `ultranest-4.3.1/tests/overclustered_u.txt`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_u_20.txt` & `ultranest-4.3.1/tests/overclustered_u_20.txt`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_u_23.txt` & `ultranest-4.3.1/tests/overclustered_u_23.txt`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_u_24.txt` & `ultranest-4.3.1/tests/overclustered_u_24.txt`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_u_27.txt` & `ultranest-4.3.1/tests/overclustered_u_27.txt`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/overclustered_u_49.txt` & `ultranest-4.3.1/tests/overclustered_u_49.txt`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_clustering.py` & `ultranest-4.3.1/tests/test_clustering.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_flatnuts.py` & `ultranest-4.3.1/tests/test_flatnuts.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_hotstart.py` & `ultranest-4.3.1/tests/test_hotstart.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_netiterintegrate.py` & `ultranest-4.3.1/tests/test_netiterintegrate.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_ordertest.py` & `ultranest-4.3.1/tests/test_ordertest.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_plot.py` & `ultranest-4.3.1/tests/test_plot.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_regionsampling.py` & `ultranest-4.3.1/tests/test_regionsampling.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_run.py` & `ultranest-4.3.1/tests/test_run.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_samplingpath.py` & `ultranest-4.3.1/tests/test_samplingpath.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_stepsampling.py` & `ultranest-4.3.1/tests/test_stepsampling.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_store.py` & `ultranest-4.3.1/tests/test_store.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_transforms.py` & `ultranest-4.3.1/tests/test_transforms.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_utils.py` & `ultranest-4.3.1/tests/test_utils.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/tests/test_viz.py` & `ultranest-4.3.1/tests/test_viz.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/ultranest/calibrator.py` & `ultranest-4.3.1/ultranest/calibrator.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,11 @@
+# noqa: D400 D205
 """
 Calibration of step sampler
+---------------------------
 """
 
 import numpy as np
 from ultranest.integrator import ReactiveNestedSampler
 import os
```

### Comparing `ultranest-4.2.0/ultranest/dychmc.py` & `ultranest-4.3.1/ultranest/dychmc.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/ultranest/dyhmc.py` & `ultranest-4.3.1/ultranest/dyhmc.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/ultranest/flatnuts.py` & `ultranest-4.3.1/ultranest/flatnuts.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/ultranest/hotstart.py` & `ultranest-4.3.1/ultranest/hotstart.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+# noqa: D400 D205
 """
 Warm start
 ----------
 
 Helper functions for deforming the parameter space to enable
 a more efficient sampling.
```

### Comparing `ultranest-4.2.0/ultranest/integrator.py` & `ultranest-4.3.1/ultranest/integrator.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,8449 +1,8452 @@
-00000000: 2222 220a 4e65 7374 6564 2073 616d 706c  """.Nested sampl
-00000010: 696e 6720 696e 7465 6772 6174 6f72 730a  ing integrators.
-00000020: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-00000030: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 0a54 6869  -----------..Thi
-00000040: 7320 6d6f 6475 6c65 2070 726f 7669 6465  s module provide
-00000050: 7320 7468 6520 6869 6768 2d6c 6576 656c  s the high-level
-00000060: 2063 6c61 7373 203a 7079 3a63 6c61 7373   class :py:class
-00000070: 3a60 5265 6163 7469 7665 4e65 7374 6564  :`ReactiveNested
-00000080: 5361 6d70 6c65 7260 2c0a 666f 7220 6361  Sampler`,.for ca
-00000090: 6c63 756c 6174 696e 6720 7468 6520 4261  lculating the Ba
-000000a0: 7965 7369 616e 2065 7669 6465 6e63 6520  yesian evidence 
-000000b0: 616e 6420 706f 7374 6572 696f 7220 7361  and posterior sa
-000000c0: 6d70 6c65 7320 6f66 2061 7262 6974 7261  mples of arbitra
-000000d0: 7279 206d 6f64 656c 732e 0a0a 2222 220a  ry models...""".
-000000e0: 0a23 2053 6f6d 6520 7061 7274 7320 6172  .# Some parts ar
-000000f0: 6520 6672 6f6d 2074 6865 204e 6573 746c  e from the Nestl
-00000100: 6520 6c69 6272 6172 7920 6279 204b 796c  e library by Kyl
-00000110: 6520 4261 7262 6172 7920 2868 7474 7073  e Barbary (https
-00000120: 3a2f 2f67 6974 6875 622e 636f 6d2f 6b62  ://github.com/kb
-00000130: 6172 6261 7279 2f6e 6573 746c 6529 0a23  arbary/nestle).#
-00000140: 2053 6f6d 6520 7061 7274 7320 6172 6520   Some parts are 
-00000150: 6672 6f6d 2074 6865 206e 6e65 7374 206c  from the nnest l
-00000160: 6962 7261 7279 2062 7920 4164 616d 204d  ibrary by Adam M
-00000170: 6f73 7320 2868 7474 7073 3a2f 2f67 6974  oss (https://git
-00000180: 6875 622e 636f 6d2f 6164 616d 6d6f 7373  hub.com/adammoss
-00000190: 2f6e 6e65 7374 290a 0a66 726f 6d20 5f5f  /nnest)..from __
-000001a0: 6675 7475 7265 5f5f 2069 6d70 6f72 7420  future__ import 
-000001b0: 7072 696e 745f 6675 6e63 7469 6f6e 2c20  print_function, 
-000001c0: 6469 7669 7369 6f6e 0a0a 696d 706f 7274  division..import
-000001d0: 206f 730a 696d 706f 7274 2073 7973 0a69   os.import sys.i
-000001e0: 6d70 6f72 7420 6373 760a 696d 706f 7274  mport csv.import
-000001f0: 206a 736f 6e0a 696d 706f 7274 206f 7065   json.import ope
-00000200: 7261 746f 720a 696d 706f 7274 2074 696d  rator.import tim
-00000210: 650a 696d 706f 7274 2077 6172 6e69 6e67  e.import warning
-00000220: 730a 0a66 726f 6d20 6e75 6d70 7920 696d  s..from numpy im
-00000230: 706f 7274 206c 6f67 2c20 6578 702c 206c  port log, exp, l
-00000240: 6f67 6164 6465 7870 0a69 6d70 6f72 7420  ogaddexp.import 
-00000250: 6e75 6d70 7920 6173 206e 700a 0a66 726f  numpy as np..fro
-00000260: 6d20 2e75 7469 6c73 2069 6d70 6f72 7420  m .utils import 
-00000270: 6372 6561 7465 5f6c 6f67 6765 722c 206d  create_logger, m
-00000280: 616b 655f 7275 6e5f 6469 722c 2072 6573  ake_run_dir, res
-00000290: 616d 706c 655f 6571 7561 6c2c 2076 6f6c  ample_equal, vol
-000002a0: 5f70 7265 6661 6374 6f72 2c20 7665 6374  _prefactor, vect
-000002b0: 6f72 697a 652c 206c 6973 7469 6679 2061  orize, listify a
-000002c0: 7320 5f6c 6973 7469 6679 0a66 726f 6d20  s _listify.from 
-000002d0: 2e75 7469 6c73 2069 6d70 6f72 7420 6973  .utils import is
-000002e0: 5f61 6666 696e 655f 7472 616e 7366 6f72  _affine_transfor
-000002f0: 6d2c 206e 6f72 6d61 6c69 7365 645f 6b65  m, normalised_ke
-00000300: 6e64 616c 6c5f 7461 755f 6469 7374 616e  ndall_tau_distan
-00000310: 6365 2c20 6469 7374 7269 6275 7465 645f  ce, distributed_
-00000320: 776f 726b 5f63 6875 6e6b 5f73 697a 650a  work_chunk_size.
-00000330: 6672 6f6d 2075 6c74 7261 6e65 7374 2e6d  from ultranest.m
-00000340: 6c66 7269 656e 6473 2069 6d70 6f72 7420  lfriends import 
-00000350: 4d4c 4672 6965 6e64 732c 2041 6666 696e  MLFriends, Affin
-00000360: 654c 6179 6572 2c20 4c6f 6361 6c41 6666  eLayer, LocalAff
-00000370: 696e 654c 6179 6572 2c20 5363 616c 696e  ineLayer, Scalin
-00000380: 674c 6179 6572 2c20 6669 6e64 5f6e 6561  gLayer, find_nea
-00000390: 7262 792c 2057 7261 7070 696e 6745 6c6c  rby, WrappingEll
-000003a0: 6970 736f 6964 2c20 526f 6275 7374 456c  ipsoid, RobustEl
-000003b0: 6c69 7073 6f69 6452 6567 696f 6e0a 6672  lipsoidRegion.fr
-000003c0: 6f6d 202e 7374 6f72 6520 696d 706f 7274  om .store import
-000003d0: 2048 4446 3550 6f69 6e74 5374 6f72 652c   HDF5PointStore,
-000003e0: 2054 6578 7450 6f69 6e74 5374 6f72 652c   TextPointStore,
-000003f0: 204e 756c 6c50 6f69 6e74 5374 6f72 650a   NullPointStore.
-00000400: 6672 6f6d 202e 7669 7a20 696d 706f 7274  from .viz import
-00000410: 2067 6574 5f64 6566 6175 6c74 5f76 697a   get_default_viz
-00000420: 5f63 616c 6c62 6163 6b0a 6672 6f6d 202e  _callback.from .
-00000430: 6f72 6465 7274 6573 7420 696d 706f 7274  ordertest import
-00000440: 2055 6e69 666f 726d 4f72 6465 7241 6363   UniformOrderAcc
-00000450: 756d 756c 6174 6f72 0a66 726f 6d20 2e6e  umulator.from .n
-00000460: 6574 6974 6572 2069 6d70 6f72 7420 506f  etiter import Po
-00000470: 696e 7450 696c 652c 2053 696e 676c 6543  intPile, SingleC
-00000480: 6f75 6e74 6572 2c20 4d75 6c74 6943 6f75  ounter, MultiCou
-00000490: 6e74 6572 2c20 4272 6561 6474 6846 6972  nter, BreadthFir
-000004a0: 7374 4974 6572 6174 6f72 2c20 5472 6565  stIterator, Tree
-000004b0: 4e6f 6465 2c20 636f 756e 745f 7472 6565  Node, count_tree
-000004c0: 5f62 6574 7765 656e 2c20 6669 6e64 5f6e  _between, find_n
-000004d0: 6f64 6573 5f62 6566 6f72 652c 206c 6f67  odes_before, log
-000004e0: 7a5f 7365 7175 656e 6365 0a66 726f 6d20  z_sequence.from 
-000004f0: 2e6e 6574 6974 6572 2069 6d70 6f72 7420  .netiter import 
-00000500: 6475 6d70 5f74 7265 652c 2063 6f6d 6269  dump_tree, combi
-00000510: 6e65 5f72 6573 756c 7473 0a66 726f 6d20  ne_results.from 
-00000520: 2e68 6f74 7374 6172 7420 696d 706f 7274  .hotstart import
-00000530: 2067 6574 5f61 7578 696c 6961 7279 5f63   get_auxiliary_c
-00000540: 6f6e 7462 6f78 5f70 6172 616d 6574 6572  ontbox_parameter
-00000550: 697a 6174 696f 6e0a 0a0a 5f5f 616c 6c5f  ization...__all_
-00000560: 5f20 3d20 5b27 5265 6163 7469 7665 4e65  _ = ['ReactiveNe
-00000570: 7374 6564 5361 6d70 6c65 7227 2c20 274e  stedSampler', 'N
-00000580: 6573 7465 6453 616d 706c 6572 272c 2027  estedSampler', '
-00000590: 7265 6164 5f66 696c 6527 2c20 2777 6172  read_file', 'war
-000005a0: 6d73 7461 7274 5f66 726f 6d5f 7369 6d69  mstart_from_simi
-000005b0: 6c61 725f 6669 6c65 275d 0a0a 0a64 6566  lar_file']...def
-000005c0: 205f 6765 745f 6375 6d73 756d 5f72 616e   _get_cumsum_ran
-000005d0: 6765 2870 692c 2064 7029 3a0a 2020 2020  ge(pi, dp):.    
-000005e0: 2222 2243 6f6d 7075 7465 2071 7561 6e74  """Compute quant
-000005f0: 696c 6520 696e 6469 6365 7320 6672 6f6d  ile indices from
-00000600: 2070 726f 6261 6269 6c69 7469 6573 2e0a   probabilities..
-00000610: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00000620: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-00000630: 0a20 2020 2070 693a 2061 7272 6179 0a20  .    pi: array. 
-00000640: 2020 2020 2020 2070 726f 6261 6269 6c69         probabili
-00000650: 7479 206f 6620 6561 6368 2069 7465 6d2e  ty of each item.
-00000660: 0a20 2020 2064 703a 2066 6c6f 6174 0a20  .    dp: float. 
-00000670: 2020 2020 2020 2051 7561 6e74 696c 6520         Quantile 
-00000680: 2862 6574 7765 656e 2030 2061 6e64 2030  (between 0 and 0
-00000690: 2e35 292e 0a0a 2020 2020 5265 7475 726e  .5)...    Return
-000006a0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d0a  s.    ---------.
-000006b0: 2020 2020 696e 6465 785f 6c6f 3a20 696e      index_lo: in
-000006c0: 740a 2020 2020 2020 2020 496e 6465 7820  t.        Index 
-000006d0: 6f66 2074 6865 2069 7465 6d20 636f 7272  of the item corr
-000006e0: 6573 706f 6e64 696e 6720 746f 2071 7561  esponding to qua
-000006f0: 6e74 696c 6520 6060 6470 6060 2e0a 2020  ntile ``dp``..  
-00000700: 2020 696e 6465 785f 6869 3a20 696e 740a    index_hi: int.
-00000710: 2020 2020 2020 2020 496e 6465 7820 6f66          Index of
-00000720: 2074 6865 2069 7465 6d20 636f 7272 6573   the item corres
-00000730: 706f 6e64 696e 6720 746f 2071 7561 6e74  ponding to quant
-00000740: 696c 6520 6060 312d 6470 6060 2e0a 2020  ile ``1-dp``..  
-00000750: 2020 2222 220a 2020 2020 6369 203d 2070    """.    ci = p
-00000760: 692e 6375 6d73 756d 2829 0a20 2020 2023  i.cumsum().    #
-00000770: 2074 6869 7320 6275 696c 6473 2061 2063   this builds a c
-00000780: 6f6e 7365 7276 6174 6976 656c 7920 6e61  onservatively na
-00000790: 7272 6f77 2069 6e74 6572 7661 6c0a 2020  rrow interval.  
-000007a0: 2020 2320 6669 6e64 2066 6972 7374 2069    # find first i
-000007b0: 6e64 6578 2077 6865 7265 2074 6865 2063  ndex where the c
-000007c0: 756d 756c 6174 6976 6520 6973 2073 7572  umulative is sur
-000007d0: 656c 7920 6162 6f76 650a 2020 2020 696c  ely above.    il
-000007e0: 6f2c 203d 206e 702e 7768 6572 6528 6369  o, = np.where(ci
-000007f0: 203e 3d20 6470 290a 2020 2020 696c 6f20   >= dp).    ilo 
-00000800: 3d20 696c 6f5b 305d 2069 6620 6c65 6e28  = ilo[0] if len(
-00000810: 696c 6f29 203e 2030 2065 6c73 6520 300a  ilo) > 0 else 0.
-00000820: 2020 2020 2320 6669 6e64 206c 6173 7420      # find last 
-00000830: 696e 6465 7820 7768 6572 6520 7468 6520  index where the 
-00000840: 6375 6d75 6c61 7469 7665 2069 7320 7375  cumulative is su
-00000850: 7265 6c79 2062 656c 6f77 0a20 2020 2069  rely below.    i
-00000860: 6869 2c20 3d20 6e70 2e77 6865 7265 2863  hi, = np.where(c
-00000870: 6920 3c3d 2031 2e20 2d20 6470 290a 2020  i <= 1. - dp).  
-00000880: 2020 6968 6920 3d20 6968 695b 2d31 5d20    ihi = ihi[-1] 
-00000890: 6966 206c 656e 2869 6869 2920 3e20 3020  if len(ihi) > 0 
-000008a0: 656c 7365 202d 310a 2020 2020 7265 7475  else -1.    retu
-000008b0: 726e 2069 6c6f 2c20 6968 690a 0a0a 6465  rn ilo, ihi...de
-000008c0: 6620 5f73 6571 7565 6e74 6961 6c69 7a65  f _sequentialize
-000008d0: 5f77 6964 7468 5f73 6571 7565 6e63 6528  _width_sequence(
-000008e0: 6d69 6e69 6d61 6c5f 7769 6474 6873 2c20  minimal_widths, 
-000008f0: 6d69 6e5f 7769 6474 6829 3a0a 2020 2020  min_width):.    
-00000900: 2222 2254 7572 6e20 6120 6c69 7374 206f  """Turn a list o
-00000910: 6620 7265 7175 6972 6564 2074 7265 6520  f required tree 
-00000920: 7769 6474 6820 696e 746f 2061 6e20 6f72  width into an or
-00000930: 6465 7265 6420 7365 7175 656e 6365 2e0a  dered sequence..
-00000940: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-00000950: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d      ------------
-00000960: 0a20 2020 206d 696e 696d 616c 5f77 6964  .    minimal_wid
-00000970: 7468 733a 206c 6973 7420 6f66 2028 4c6c  ths: list of (Ll
-00000980: 6f2c 204c 6869 2c20 7769 6474 6829 0a20  o, Lhi, width). 
-00000990: 2020 2020 2020 2044 6566 696e 6573 2074         Defines t
-000009a0: 6865 2072 6571 7569 7265 6420 7769 6474  he required widt
-000009b0: 6820 6265 7477 6565 6e20 4c6c 6f20 616e  h between Llo an
-000009c0: 6420 4c68 692e 0a20 2020 206d 696e 5f77  d Lhi..    min_w
-000009d0: 6964 7468 3a20 696e 740a 2020 2020 2020  idth: int.      
-000009e0: 2020 4d69 6e69 6d75 6d20 7769 6474 6820    Minimum width 
-000009f0: 6576 6572 7977 6865 7265 2e0a 0a20 2020  everywhere...   
-00000a00: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-00000a10: 2d2d 2d2d 2d2d 0a20 2020 204c 7365 7175  ------.    Lsequ
-00000a20: 656e 6365 3a20 6c69 7374 206f 6620 284c  ence: list of (L
-00000a30: 2c20 7769 6474 6829 0a20 2020 2020 2020  , width).       
-00000a40: 2041 2073 6571 7565 6e63 6520 6f66 204c   A sequence of L
-00000a50: 2070 6f69 6e74 7320 616e 6420 7468 6520   points and the 
-00000a60: 6578 7065 6374 6564 2074 7265 6520 7769  expected tree wi
-00000a70: 6474 6820 6174 2061 6e64 2061 626f 7665  dth at and above
-00000a80: 2069 742e 0a0a 2020 2020 2222 220a 2020   it...    """.  
-00000a90: 2020 4c70 6f69 6e74 7320 3d20 6e70 2e75    Lpoints = np.u
-00000aa0: 6e69 7175 6528 5f6c 6973 7469 6679 280a  nique(_listify(.
-00000ab0: 2020 2020 2020 2020 5b2d 6e70 2e69 6e66          [-np.inf
-00000ac0: 5d2c 205b 4c20 666f 7220 4c2c 205f 2c20  ], [L for L, _, 
-00000ad0: 5f20 696e 206d 696e 696d 616c 5f77 6964  _ in minimal_wid
-00000ae0: 7468 735d 2c0a 2020 2020 2020 2020 5b4c  ths],.        [L
-00000af0: 2066 6f72 205f 2c20 4c2c 205f 2069 6e20   for _, L, _ in 
-00000b00: 6d69 6e69 6d61 6c5f 7769 6474 6873 5d2c  minimal_widths],
-00000b10: 205b 6e70 2e69 6e66 5d29 290a 2020 2020   [np.inf])).    
-00000b20: 7769 6474 6873 203d 206e 702e 6f6e 6573  widths = np.ones
-00000b30: 286c 656e 284c 706f 696e 7473 2929 202a  (len(Lpoints)) *
-00000b40: 206d 696e 5f77 6964 7468 0a0a 2020 2020   min_width..    
-00000b50: 666f 7220 4c6c 6f2c 204c 6869 2c20 7769  for Llo, Lhi, wi
-00000b60: 6474 6820 696e 206d 696e 696d 616c 5f77  dth in minimal_w
-00000b70: 6964 7468 733a 0a20 2020 2020 2020 2023  idths:.        #
-00000b80: 2061 6c6c 204c 706f 696e 7473 2077 6974   all Lpoints wit
-00000b90: 6869 6e20 7468 6174 2072 616e 6765 2073  hin that range s
-00000ba0: 686f 756c 6420 6265 206d 6178 696d 697a  hould be maximiz
-00000bb0: 6564 2074 6f20 7769 6474 680a 2020 2020  ed to width.    
-00000bc0: 2020 2020 2320 6d61 736b 203d 206e 702e      # mask = np.
-00000bd0: 6c6f 6769 6361 6c5f 616e 6428 4c70 6f69  logical_and(Lpoi
-00000be0: 6e74 7320 3e3d 204c 6c6f 2c20 4c70 6f69  nts >= Llo, Lpoi
-00000bf0: 6e74 7320 3c3d 204c 6869 290a 2020 2020  nts <= Lhi).    
-00000c00: 2020 2020 2320 7468 6520 666f 6c6c 6f77      # the follow
-00000c10: 696e 6720 616c 6c6f 7773 2073 6567 6d65  ing allows segme
-00000c20: 6e74 7320 746f 2073 7065 6369 6679 202d  nts to specify -
-00000c30: 696e 662e 2e4c 2072 616e 6765 730a 2020  inf..L ranges.  
-00000c40: 2020 2020 2020 6d61 736b 203d 207e 6e70        mask = ~np
-00000c50: 2e6c 6f67 6963 616c 5f6f 7228 4c70 6f69  .logical_or(Lpoi
-00000c60: 6e74 7320 3c20 4c6c 6f2c 204c 706f 696e  nts < Llo, Lpoin
-00000c70: 7473 203e 204c 6869 290a 2020 2020 2020  ts > Lhi).      
-00000c80: 2020 7769 6474 6873 5b6d 6173 6b5d 203d    widths[mask] =
-00000c90: 206e 702e 7768 6572 6528 7769 6474 6873   np.where(widths
-00000ca0: 5b6d 6173 6b5d 203c 2077 6964 7468 2c20  [mask] < width, 
-00000cb0: 7769 6474 682c 2077 6964 7468 735b 6d61  width, widths[ma
-00000cc0: 736b 5d29 0a0a 2020 2020 2320 7468 6520  sk])..    # the 
-00000cd0: 7769 6474 6820 6861 7320 746f 206d 6f6e  width has to mon
-00000ce0: 6f74 6f6e 6963 616c 6c79 2069 6e63 7265  otonically incre
-00000cf0: 6173 6520 746f 2074 6865 206d 6178 696d  ase to the maxim
-00000d00: 756d 2066 726f 6d20 626f 7468 2073 6964  um from both sid
-00000d10: 6573 0a20 2020 2023 2073 6f20 7765 2066  es.    # so we f
-00000d20: 696c 6c20 7570 2061 6e79 2069 6e74 6572  ill up any inter
-00000d30: 6d65 6469 6174 6520 6469 7073 0a20 2020  mediate dips.   
-00000d40: 206d 6178 5f77 6964 7468 203d 2077 6964   max_width = wid
-00000d50: 7468 732e 6d61 7828 290a 2020 2020 6d69  ths.max().    mi
-00000d60: 6420 3d20 6e70 2e77 6865 7265 2877 6964  d = np.where(wid
-00000d70: 7468 7320 3d3d 206d 6178 5f77 6964 7468  ths == max_width
-00000d80: 295b 305d 5b30 5d0a 2020 2020 7769 6465  )[0][0].    wide
-00000d90: 7374 203d 2030 0a20 2020 2066 6f72 2069  st = 0.    for i
-00000da0: 2069 6e20 7261 6e67 6528 6d69 6429 3a0a   in range(mid):.
-00000db0: 2020 2020 2020 2020 7769 6465 7374 203d          widest =
-00000dc0: 2077 6964 7468 735b 695d 203d 206d 6178   widths[i] = max
-00000dd0: 2877 6964 6573 742c 2077 6964 7468 735b  (widest, widths[
-00000de0: 695d 290a 2020 2020 7769 6465 7374 203d  i]).    widest =
-00000df0: 2030 0a20 2020 2066 6f72 2069 2069 6e20   0.    for i in 
-00000e00: 7261 6e67 6528 6c65 6e28 7769 6474 6873  range(len(widths
-00000e10: 2920 2d20 312c 206d 6964 2c20 2d31 293a  ) - 1, mid, -1):
-00000e20: 0a20 2020 2020 2020 2077 6964 6573 7420  .        widest 
-00000e30: 3d20 7769 6474 6873 5b69 5d20 3d20 6d61  = widths[i] = ma
-00000e40: 7828 7769 6465 7374 2c20 7769 6474 6873  x(widest, widths
-00000e50: 5b69 5d29 0a0a 2020 2020 7265 7475 726e  [i])..    return
-00000e60: 206c 6973 7428 7a69 7028 4c70 6f69 6e74   list(zip(Lpoint
-00000e70: 732c 2077 6964 7468 7329 290a 0a0a 6465  s, widths))...de
-00000e80: 6620 5f65 7870 6c6f 7265 5f69 7465 7261  f _explore_itera
-00000e90: 746f 725f 6261 7463 6828 6578 706c 6f72  tor_batch(explor
-00000ea0: 6572 2c20 706f 702c 2078 5f64 696d 2c20  er, pop, x_dim, 
-00000eb0: 6e75 6d5f 7061 7261 6d73 2c20 706f 696e  num_params, poin
-00000ec0: 7470 696c 652c 2062 6174 6368 7369 7a65  tpile, batchsize
-00000ed0: 3d31 293a 0a20 2020 2062 6174 6368 203d  =1):.    batch =
-00000ee0: 205b 5d0a 0a20 2020 2077 6869 6c65 2054   []..    while T
-00000ef0: 7275 653a 0a20 2020 2020 2020 206e 6578  rue:.        nex
-00000f00: 745f 6e6f 6465 203d 2065 7870 6c6f 7265  t_node = explore
-00000f10: 722e 6e65 7874 5f6e 6f64 6528 290a 2020  r.next_node().  
-00000f20: 2020 2020 2020 6966 206e 6578 745f 6e6f        if next_no
-00000f30: 6465 2069 7320 4e6f 6e65 3a0a 2020 2020  de is None:.    
-00000f40: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00000f50: 2020 2020 2020 726f 6f74 6964 2c20 6e6f        rootid, no
-00000f60: 6465 2c20 285f 2c20 6163 7469 7665 5f72  de, (_, active_r
-00000f70: 6f6f 7469 6473 2c20 6163 7469 7665 5f76  ootids, active_v
-00000f80: 616c 7565 732c 2061 6374 6976 655f 6e6f  alues, active_no
-00000f90: 6465 5f69 6473 2920 3d20 6e65 7874 5f6e  de_ids) = next_n
-00000fa0: 6f64 650a 2020 2020 2020 2020 4c6d 696e  ode.        Lmin
-00000fb0: 203d 206e 6f64 652e 7661 6c75 650a 2020   = node.value.  
-00000fc0: 2020 2020 2020 6368 696c 6472 656e 203d        children =
-00000fd0: 205b 5d0a 0a20 2020 2020 2020 205f 2c20   []..        _, 
-00000fe0: 726f 7720 3d20 706f 7028 4c6d 696e 290a  row = pop(Lmin).
-00000ff0: 2020 2020 2020 2020 6966 2072 6f77 2069          if row i
-00001000: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00001010: 2020 2020 2020 2020 6c6f 676c 203d 2072          logl = r
-00001020: 6f77 5b31 5d0a 2020 2020 2020 2020 2020  ow[1].          
-00001030: 2020 7520 3d20 726f 775b 333a 3320 2b20    u = row[3:3 + 
-00001040: 785f 6469 6d5d 0a20 2020 2020 2020 2020  x_dim].         
-00001050: 2020 2076 203d 2072 6f77 5b33 202b 2078     v = row[3 + x
-00001060: 5f64 696d 3a33 202b 2078 5f64 696d 202b  _dim:3 + x_dim +
-00001070: 206e 756d 5f70 6172 616d 735d 0a0a 2020   num_params]..  
-00001080: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00001090: 2075 2e73 6861 7065 203d 3d20 2878 5f64   u.shape == (x_d
-000010a0: 696d 2c29 0a20 2020 2020 2020 2020 2020  im,).           
-000010b0: 2061 7373 6572 7420 762e 7368 6170 6520   assert v.shape 
-000010c0: 3d3d 2028 6e75 6d5f 7061 7261 6d73 2c29  == (num_params,)
-000010d0: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-000010e0: 6572 7420 6c6f 676c 203e 204c 6d69 6e0a  ert logl > Lmin.
-000010f0: 2020 2020 2020 2020 2020 2020 6368 696c              chil
-00001100: 6472 656e 2e61 7070 656e 6428 2875 2c20  dren.append((u, 
-00001110: 762c 206c 6f67 6c29 290a 2020 2020 2020  v, logl)).      
-00001120: 2020 2020 2020 6368 696c 6420 3d20 706f        child = po
-00001130: 696e 7470 696c 652e 6d61 6b65 5f6e 6f64  intpile.make_nod
-00001140: 6528 6c6f 676c 2c20 752c 2076 290a 2020  e(logl, u, v).  
-00001150: 2020 2020 2020 2020 2020 6e6f 6465 2e63            node.c
-00001160: 6869 6c64 7265 6e2e 6170 7065 6e64 2863  hildren.append(c
-00001170: 6869 6c64 290a 0a20 2020 2020 2020 2062  hild)..        b
-00001180: 6174 6368 2e61 7070 656e 6428 284c 6d69  atch.append((Lmi
-00001190: 6e2c 2061 6374 6976 655f 7661 6c75 6573  n, active_values
-000011a0: 2e63 6f70 7928 292c 2063 6869 6c64 7265  .copy(), childre
-000011b0: 6e29 290a 2020 2020 2020 2020 6966 206c  n)).        if l
-000011c0: 656e 2862 6174 6368 2920 3e3d 2062 6174  en(batch) >= bat
-000011d0: 6368 7369 7a65 3a0a 2020 2020 2020 2020  chsize:.        
-000011e0: 2020 2020 7969 656c 6420 6261 7463 680a      yield batch.
-000011f0: 2020 2020 2020 2020 2020 2020 6261 7463              batc
-00001200: 6820 3d20 5b5d 0a20 2020 2020 2020 2065  h = [].        e
-00001210: 7870 6c6f 7265 722e 6578 7061 6e64 5f63  xplorer.expand_c
-00001220: 6869 6c64 7265 6e5f 6f66 2872 6f6f 7469  hildren_of(rooti
-00001230: 642c 206e 6f64 6529 0a20 2020 2069 6620  d, node).    if 
-00001240: 6c65 6e28 6261 7463 6829 203e 2030 3a0a  len(batch) > 0:.
-00001250: 2020 2020 2020 2020 7969 656c 6420 6261          yield ba
-00001260: 7463 680a 0a0a 6465 6620 7265 7375 6d65  tch...def resume
-00001270: 5f66 726f 6d5f 7369 6d69 6c61 725f 6669  _from_similar_fi
-00001280: 6c65 280a 2020 2020 6c6f 675f 6469 722c  le(.    log_dir,
-00001290: 2078 5f64 696d 2c20 6c6f 676c 696b 656c   x_dim, loglikel
-000012a0: 6968 6f6f 642c 2074 7261 6e73 666f 726d  ihood, transform
-000012b0: 2c0a 2020 2020 6d61 785f 7461 753d 302c  ,.    max_tau=0,
-000012c0: 2076 6572 626f 7365 3d46 616c 7365 2c20   verbose=False, 
-000012d0: 6e64 7261 773d 3430 300a 293a 0a20 2020  ndraw=400.):.   
-000012e0: 2022 2222 0a20 2020 2043 6861 6e67 6520   """.    Change 
-000012f0: 6120 7374 6f72 6564 2055 6c74 7261 4e65  a stored UltraNe
-00001300: 7374 2072 756e 2074 6f20 6120 6d6f 6469  st run to a modi
-00001310: 6669 6564 206c 6f67 6c69 6b65 6c69 686f  fied loglikeliho
-00001320: 6f64 2f74 7261 6e73 666f 726d 2e0a 0a20  od/transform... 
-00001330: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-00001340: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00001350: 206c 6f67 5f64 6972 3a20 7374 720a 2020   log_dir: str.  
-00001360: 2020 2020 2020 466f 6c64 6572 2063 6f6e        Folder con
-00001370: 7461 696e 696e 6720 7265 7375 6c74 730a  taining results.
-00001380: 2020 2020 785f 6469 6d3a 2069 6e74 0a20      x_dim: int. 
-00001390: 2020 2020 2020 206e 756d 6265 7220 6f66         number of
-000013a0: 2064 696d 656e 7369 6f6e 730a 2020 2020   dimensions.    
-000013b0: 6c6f 676c 696b 656c 6968 6f6f 643a 2066  loglikelihood: f
-000013c0: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
-000013d0: 6e65 7720 6c69 6b65 6c69 686f 6f64 2066  new likelihood f
-000013e0: 756e 6374 696f 6e0a 2020 2020 7472 616e  unction.    tran
-000013f0: 7366 6f72 6d3a 2066 756e 6374 696f 6e0a  sform: function.
-00001400: 2020 2020 2020 2020 6e65 7720 7472 616e          new tran
-00001410: 7366 6f72 6d20 6675 6e63 7469 6f6e 0a20  sform function. 
-00001420: 2020 2076 6572 626f 7365 3a20 626f 6f6c     verbose: bool
-00001430: 0a20 2020 2020 2020 2073 686f 7720 7072  .        show pr
-00001440: 6f67 7265 7373 0a20 2020 206e 6472 6177  ogress.    ndraw
-00001450: 3a20 696e 740a 2020 2020 2020 2020 7365  : int.        se
-00001460: 7420 746f 203e 3120 6966 2066 756e 6374  t to >1 if funct
-00001470: 696f 6e73 2063 616e 2074 616b 6520 6164  ions can take ad
-00001480: 7661 6e74 6167 6520 6f66 2076 6563 746f  vantage of vecto
-00001490: 7269 7a65 6420 636f 6d70 7574 6174 696f  rized computatio
-000014a0: 6e73 0a20 2020 206d 6178 5f74 6175 3a20  ns.    max_tau: 
-000014b0: 666c 6f61 740a 2020 2020 2020 2020 416c  float.        Al
-000014c0: 6c6f 7765 6420 6469 7373 696d 696c 6172  lowed dissimilar
-000014d0: 6974 7920 696e 2074 6865 206c 6976 6520  ity in the live 
-000014e0: 706f 696e 7420 6f72 6465 7269 6e67 2c20  point ordering, 
-000014f0: 7175 616e 7469 6669 6564 2061 730a 2020  quantified as.  
-00001500: 2020 2020 2020 6e6f 726d 616c 6973 6564        normalised
-00001510: 204b 656e 6461 6c6c 2074 6175 2064 6973   Kendall tau dis
-00001520: 7461 6e63 652e 0a0a 2020 2020 2020 2020  tance...        
-00001530: 6d61 785f 7461 753d 3020 6973 2074 6865  max_tau=0 is the
-00001540: 2076 6572 7920 636f 6e73 6572 7661 7469   very conservati
-00001550: 7665 2063 686f 6963 6520 6f66 2073 746f  ve choice of sto
-00001560: 7070 696e 6720 7468 6520 7761 726d 2073  pping the warm s
-00001570: 7461 7274 0a20 2020 2020 2020 2077 6865  tart.        whe
-00001580: 6e20 7468 6520 6c69 7665 2070 6f69 6e74  n the live point
-00001590: 206f 7264 6572 2064 6966 6665 7273 2e0a   order differs..
-000015a0: 2020 2020 2020 2020 4e65 6172 2031 2061          Near 1 a
-000015b0: 7265 2063 6f6d 706c 6574 656c 7920 6469  re completely di
-000015c0: 6666 6572 656e 7420 6c69 7665 2070 6f69  fferent live poi
-000015d0: 6e74 206f 7264 6572 696e 6773 2e0a 2020  nt orderings..  
-000015e0: 2020 2020 2020 5661 6c75 6573 2069 6e20        Values in 
-000015f0: 6265 7477 6565 6e20 7065 726d 6974 206d  between permit m
-00001600: 696c 6420 6469 736f 7264 6572 2e0a 0a20  ild disorder... 
-00001610: 2020 2052 6574 7572 6e73 0a20 2020 202d     Returns.    -
-00001620: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7365  ---------.    se
-00001630: 7175 656e 6365 3a20 6469 6374 0a20 2020  quence: dict.   
-00001640: 2020 2020 2063 6f6e 7461 696e 7320 6172       contains ar
-00001650: 7261 7973 2073 746f 7269 6e67 2066 6f72  rays storing for
-00001660: 2065 6163 6820 6974 6572 6174 696f 6e20   each iteration 
-00001670: 6573 7469 6d61 7465 7320 6f66 3a0a 0a20  estimates of:.. 
-00001680: 2020 2020 2020 2020 2020 202a 206c 6f67             * log
-00001690: 7a3a 206c 6f67 2065 7669 6465 6e63 6520  z: log evidence 
-000016a0: 6573 7469 6d61 7465 0a20 2020 2020 2020  estimate.       
-000016b0: 2020 2020 202a 206c 6f67 7a65 7272 3a20       * logzerr: 
-000016c0: 6c6f 6720 6576 6964 656e 6365 2075 6e63  log evidence unc
-000016d0: 6572 7461 696e 7479 2065 7374 696d 6174  ertainty estimat
-000016e0: 650a 2020 2020 2020 2020 2020 2020 2a20  e.            * 
-000016f0: 6c6f 6776 6f6c 3a20 6c6f 6720 766f 6c75  logvol: log volu
-00001700: 6d65 2065 7374 696d 6174 650a 2020 2020  me estimate.    
-00001710: 2020 2020 2020 2020 2a20 7361 6d70 6c65          * sample
-00001720: 735f 6e3a 206e 756d 6265 7220 6f66 206c  s_n: number of l
-00001730: 6976 6520 706f 696e 7473 0a20 2020 2020  ive points.     
-00001740: 2020 2020 2020 202a 206c 6f67 7774 3a20         * logwt: 
-00001750: 6c6f 6720 7765 6967 6874 0a20 2020 2020  log weight.     
-00001760: 2020 2020 2020 202a 206c 6f67 6c3a 206c         * logl: l
-00001770: 6f67 206c 696b 656c 6968 6f6f 640a 0a20  og likelihood.. 
-00001780: 2020 2066 696e 616c 3a20 6469 6374 0a20     final: dict. 
-00001790: 2020 2020 2020 2073 616d 6520 6173 2052         same as R
-000017a0: 6561 6374 6976 654e 6573 7465 6453 616d  eactiveNestedSam
-000017b0: 706c 6572 2e72 6573 756c 7473 2061 6e64  pler.results and
-000017c0: 0a20 2020 2020 2020 2052 6561 6374 6976  .        Reactiv
-000017d0: 654e 6573 7465 6453 616d 706c 6572 2e72  eNestedSampler.r
-000017e0: 756e 2072 6574 7572 6e20 7661 6c75 6573  un return values
-000017f0: 0a0a 2020 2020 2222 220a 2020 2020 696d  ..    """.    im
-00001800: 706f 7274 2068 3570 790a 2020 2020 6669  port h5py.    fi
-00001810: 6c65 7061 7468 203d 206f 732e 7061 7468  lepath = os.path
-00001820: 2e6a 6f69 6e28 6c6f 675f 6469 722c 2027  .join(log_dir, '
-00001830: 7265 7375 6c74 7327 2c20 2770 6f69 6e74  results', 'point
-00001840: 732e 6864 6635 2729 0a20 2020 2066 696c  s.hdf5').    fil
-00001850: 6570 6174 6832 203d 206f 732e 7061 7468  epath2 = os.path
-00001860: 2e6a 6f69 6e28 6c6f 675f 6469 722c 2027  .join(log_dir, '
-00001870: 7265 7375 6c74 7327 2c20 2770 6f69 6e74  results', 'point
-00001880: 732e 6864 6635 2e6e 6577 2729 0a20 2020  s.hdf5.new').   
-00001890: 2066 696c 656f 626a 203d 2068 3570 792e   fileobj = h5py.
-000018a0: 4669 6c65 2866 696c 6570 6174 682c 2027  File(filepath, '
-000018b0: 7227 290a 2020 2020 5f2c 206e 636f 6c73  r').    _, ncols
-000018c0: 203d 2066 696c 656f 626a 5b27 706f 696e   = fileobj['poin
-000018d0: 7473 275d 2e73 6861 7065 0a20 2020 206e  ts'].shape.    n
-000018e0: 756d 5f70 6172 616d 7320 3d20 6e63 6f6c  um_params = ncol
-000018f0: 7320 2d20 3320 2d20 785f 6469 6d0a 0a20  s - 3 - x_dim.. 
-00001900: 2020 2070 6f69 6e74 7320 3d20 6669 6c65     points = file
-00001910: 6f62 6a5b 2770 6f69 6e74 7327 5d5b 3a5d  obj['points'][:]
-00001920: 0a20 2020 2066 696c 656f 626a 2e63 6c6f  .    fileobj.clo
-00001930: 7365 2829 0a20 2020 2064 656c 2066 696c  se().    del fil
-00001940: 656f 626a 0a0a 2020 2020 706f 696e 7473  eobj..    points
-00001950: 746f 7265 3220 3d20 4844 4635 506f 696e  tore2 = HDF5Poin
-00001960: 7453 746f 7265 2866 696c 6570 6174 6832  tStore(filepath2
-00001970: 2c20 6e63 6f6c 732c 206d 6f64 653d 2777  , ncols, mode='w
-00001980: 2729 0a20 2020 2073 7461 636b 203d 206c  ').    stack = l
-00001990: 6973 7428 656e 756d 6572 6174 6528 706f  ist(enumerate(po
-000019a0: 696e 7473 2929 0a0a 2020 2020 706f 696e  ints))..    poin
-000019b0: 7470 696c 6520 3d20 506f 696e 7450 696c  tpile = PointPil
-000019c0: 6528 785f 6469 6d2c 206e 756d 5f70 6172  e(x_dim, num_par
-000019d0: 616d 7329 0a20 2020 2070 6f69 6e74 7069  ams).    pointpi
-000019e0: 6c65 3220 3d20 506f 696e 7450 696c 6528  le2 = PointPile(
-000019f0: 785f 6469 6d2c 206e 756d 5f70 6172 616d  x_dim, num_param
-00001a00: 7329 0a0a 2020 2020 6465 6620 706f 7028  s)..    def pop(
-00001a10: 4c6d 696e 293a 0a20 2020 2020 2020 2022  Lmin):.        "
-00001a20: 2222 4669 6e64 206d 6174 6368 696e 6720  ""Find matching 
-00001a30: 7361 6d70 6c65 2066 726f 6d20 706f 696e  sample from poin
-00001a40: 7473 2066 696c 652e 2222 220a 2020 2020  ts file.""".    
-00001a50: 2020 2020 2320 6c6f 6f6b 2066 6f72 7761      # look forwa
-00001a60: 7264 2074 6f20 7365 6520 6966 2074 6865  rd to see if the
-00001a70: 7265 2069 7320 616e 2065 7861 6374 206d  re is an exact m
-00001a80: 6174 6368 0a20 2020 2020 2020 2023 2069  atch.        # i
-00001a90: 6620 7765 2064 6f20 6e6f 7420 7573 6520  f we do not use 
-00001aa0: 7468 6520 6578 6163 7420 6d61 7463 6865  the exact matche
-00001ab0: 730a 2020 2020 2020 2020 2320 2020 7468  s.        #   th
-00001ac0: 6973 2063 6175 7365 7320 6120 7368 6966  is causes a shif
-00001ad0: 7420 696e 2074 6865 206c 6f67 6c69 6b65  t in the loglike
-00001ae0: 6c69 686f 6f64 730a 2020 2020 2020 2020  lihoods.        
-00001af0: 666f 7220 692c 2028 6964 782c 206e 6578  for i, (idx, nex
-00001b00: 745f 726f 7729 2069 6e20 656e 756d 6572  t_row) in enumer
-00001b10: 6174 6528 7374 6163 6b29 3a0a 2020 2020  ate(stack):.    
-00001b20: 2020 2020 2020 2020 726f 775f 4c6d 696e          row_Lmin
-00001b30: 203d 206e 6578 745f 726f 775b 305d 0a20   = next_row[0]. 
-00001b40: 2020 2020 2020 2020 2020 204c 203d 206e             L = n
-00001b50: 6578 745f 726f 775b 315d 0a20 2020 2020  ext_row[1].     
-00001b60: 2020 2020 2020 2069 6620 726f 775f 4c6d         if row_Lm
-00001b70: 696e 203c 3d20 4c6d 696e 2061 6e64 204c  in <= Lmin and L
-00001b80: 203e 204c 6d69 6e3a 0a20 2020 2020 2020   > Lmin:.       
-00001b90: 2020 2020 2020 2020 2069 6478 2c20 726f           idx, ro
-00001ba0: 7720 3d20 7374 6163 6b2e 706f 7028 6929  w = stack.pop(i)
-00001bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001bc0: 2072 6574 7572 6e20 6964 782c 2072 6f77   return idx, row
-00001bd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00001be0: 4e6f 6e65 2c20 4e6f 6e65 0a0a 2020 2020  None, None..    
-00001bf0: 726f 6f74 7320 3d20 5b5d 0a20 2020 2072  roots = [].    r
-00001c00: 6f6f 7473 3220 3d20 5b5d 0a20 2020 2069  oots2 = [].    i
-00001c10: 6e69 7469 616c 5f70 6f69 6e74 735f 7520  nitial_points_u 
-00001c20: 3d20 5b5d 0a20 2020 2069 6e69 7469 616c  = [].    initial
-00001c30: 5f70 6f69 6e74 735f 7620 3d20 5b5d 0a20  _points_v = []. 
-00001c40: 2020 2069 6e69 7469 616c 5f70 6f69 6e74     initial_point
-00001c50: 735f 6c6f 676c 203d 205b 5d0a 2020 2020  s_logl = [].    
-00001c60: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
-00001c70: 2020 2020 5f2c 2072 6f77 203d 2070 6f70      _, row = pop
-00001c80: 282d 6e70 2e69 6e66 290a 2020 2020 2020  (-np.inf).      
-00001c90: 2020 6966 2072 6f77 2069 7320 4e6f 6e65    if row is None
-00001ca0: 3a0a 2020 2020 2020 2020 2020 2020 6272  :.            br
-00001cb0: 6561 6b0a 2020 2020 2020 2020 6c6f 676c  eak.        logl
-00001cc0: 203d 2072 6f77 5b31 5d0a 2020 2020 2020   = row[1].      
-00001cd0: 2020 7520 3d20 726f 775b 333a 3320 2b20    u = row[3:3 + 
-00001ce0: 785f 6469 6d5d 0a20 2020 2020 2020 2076  x_dim].        v
-00001cf0: 203d 2072 6f77 5b33 202b 2078 5f64 696d   = row[3 + x_dim
-00001d00: 3a33 202b 2078 5f64 696d 202b 206e 756d  :3 + x_dim + num
-00001d10: 5f70 6172 616d 735d 0a20 2020 2020 2020  _params].       
-00001d20: 2069 6e69 7469 616c 5f70 6f69 6e74 735f   initial_points_
-00001d30: 752e 6170 7065 6e64 2875 290a 2020 2020  u.append(u).    
-00001d40: 2020 2020 696e 6974 6961 6c5f 706f 696e      initial_poin
-00001d50: 7473 5f76 2e61 7070 656e 6428 7629 0a20  ts_v.append(v). 
-00001d60: 2020 2020 2020 2069 6e69 7469 616c 5f70         initial_p
-00001d70: 6f69 6e74 735f 6c6f 676c 2e61 7070 656e  oints_logl.appen
-00001d80: 6428 6c6f 676c 290a 0a20 2020 2076 3220  d(logl)..    v2 
-00001d90: 3d20 7472 616e 7366 6f72 6d28 6e70 2e61  = transform(np.a
-00001da0: 7272 6179 2869 6e69 7469 616c 5f70 6f69  rray(initial_poi
-00001db0: 6e74 735f 752c 206e 646d 696e 3d32 2c20  nts_u, ndmin=2, 
-00001dc0: 6474 7970 653d 666c 6f61 7429 290a 2020  dtype=float)).  
-00001dd0: 2020 6173 7365 7274 206e 702e 616c 6c63    assert np.allc
-00001de0: 6c6f 7365 2876 322c 2069 6e69 7469 616c  lose(v2, initial
-00001df0: 5f70 6f69 6e74 735f 7629 2c20 2774 7261  _points_v), 'tra
-00001e00: 6e73 666f 726d 2069 6e63 6f6e 7369 7374  nsform inconsist
-00001e10: 656e 742c 2063 616e 6e6f 7420 7265 7375  ent, cannot resu
-00001e20: 6d65 270a 2020 2020 6c6f 676c 735f 6e65  me'.    logls_ne
-00001e30: 7720 3d20 6c6f 676c 696b 656c 6968 6f6f  w = loglikelihoo
-00001e40: 6428 7632 290a 0a20 2020 2066 6f72 2075  d(v2)..    for u
-00001e50: 2c20 762c 206c 6f67 6c2c 206c 6f67 6c5f  , v, logl, logl_
-00001e60: 6e65 7720 696e 207a 6970 2869 6e69 7469  new in zip(initi
-00001e70: 616c 5f70 6f69 6e74 735f 752c 2069 6e69  al_points_u, ini
-00001e80: 7469 616c 5f70 6f69 6e74 735f 762c 2069  tial_points_v, i
-00001e90: 6e69 7469 616c 5f70 6f69 6e74 735f 6c6f  nitial_points_lo
-00001ea0: 676c 2c20 6c6f 676c 735f 6e65 7729 3a0a  gl, logls_new):.
-00001eb0: 2020 2020 2020 2020 726f 6f74 732e 6170          roots.ap
-00001ec0: 7065 6e64 2870 6f69 6e74 7069 6c65 2e6d  pend(pointpile.m
-00001ed0: 616b 655f 6e6f 6465 286c 6f67 6c2c 2075  ake_node(logl, u
-00001ee0: 2c20 7629 290a 2020 2020 2020 2020 726f  , v)).        ro
-00001ef0: 6f74 7332 2e61 7070 656e 6428 706f 696e  ots2.append(poin
-00001f00: 7470 696c 6532 2e6d 616b 655f 6e6f 6465  tpile2.make_node
-00001f10: 286c 6f67 6c5f 6e65 772c 2075 2c20 7629  (logl_new, u, v)
-00001f20: 290a 2020 2020 2020 2020 706f 696e 7473  ).        points
-00001f30: 746f 7265 322e 6164 6428 5f6c 6973 7469  tore2.add(_listi
-00001f40: 6679 285b 2d6e 702e 696e 662c 206c 6f67  fy([-np.inf, log
-00001f50: 6c5f 6e65 772c 2030 2e30 5d2c 2075 2c20  l_new, 0.0], u, 
-00001f60: 7629 2c20 3129 0a0a 2020 2020 6261 7463  v), 1)..    batc
-00001f70: 6873 697a 6520 3d20 6e64 7261 770a 2020  hsize = ndraw.  
-00001f80: 2020 6578 706c 6f72 6572 203d 2042 7265    explorer = Bre
-00001f90: 6164 7468 4669 7273 7449 7465 7261 746f  adthFirstIterato
-00001fa0: 7228 726f 6f74 7329 0a20 2020 2065 7870  r(roots).    exp
-00001fb0: 6c6f 7265 7232 203d 2042 7265 6164 7468  lorer2 = Breadth
-00001fc0: 4669 7273 7449 7465 7261 746f 7228 726f  FirstIterator(ro
-00001fd0: 6f74 7332 290a 2020 2020 6d61 696e 5f69  ots2).    main_i
-00001fe0: 7465 7261 746f 7232 203d 2053 696e 676c  terator2 = Singl
-00001ff0: 6543 6f75 6e74 6572 2829 0a20 2020 206d  eCounter().    m
-00002000: 6169 6e5f 6974 6572 6174 6f72 322e 4c6d  ain_iterator2.Lm
-00002010: 6178 203d 206c 6f67 6c73 5f6e 6577 2e6d  ax = logls_new.m
-00002020: 6178 2829 0a20 2020 2067 6f6f 645f 7374  ax().    good_st
-00002030: 6174 6520 3d20 5472 7565 0a0a 2020 2020  ate = True..    
-00002040: 696e 6469 6365 7331 2c20 696e 6469 6365  indices1, indice
-00002050: 7332 203d 206e 702e 6d65 7368 6772 6964  s2 = np.meshgrid
-00002060: 286e 702e 6172 616e 6765 286c 656e 286c  (np.arange(len(l
-00002070: 6f67 6c73 5f6e 6577 2929 2c20 6e70 2e61  ogls_new)), np.a
-00002080: 7261 6e67 6528 6c65 6e28 6c6f 676c 735f  range(len(logls_
-00002090: 6e65 7729 2929 0a20 2020 206c 6173 745f  new))).    last_
-000020a0: 676f 6f64 5f6c 696b 6520 3d20 2d31 6533  good_like = -1e3
-000020b0: 3030 0a20 2020 206c 6173 745f 676f 6f64  00.    last_good
-000020c0: 5f73 7461 7465 203d 2030 0a20 2020 2065  _state = 0.    e
-000020d0: 7073 696c 6f6e 203d 2031 202b 2031 652d  psilon = 1 + 1e-
-000020e0: 360a 2020 2020 6e69 7465 7220 3d20 300a  6.    niter = 0.
-000020f0: 2020 2020 666f 7220 6261 7463 6820 696e      for batch in
-00002100: 205f 6578 706c 6f72 655f 6974 6572 6174   _explore_iterat
-00002110: 6f72 5f62 6174 6368 2865 7870 6c6f 7265  or_batch(explore
-00002120: 722c 2070 6f70 2c20 785f 6469 6d2c 206e  r, pop, x_dim, n
-00002130: 756d 5f70 6172 616d 732c 2070 6f69 6e74  um_params, point
-00002140: 7069 6c65 2c20 6261 7463 6873 697a 653d  pile, batchsize=
-00002150: 6261 7463 6873 697a 6529 3a0a 2020 2020  batchsize):.    
-00002160: 2020 2020 6173 7365 7274 206c 656e 2862      assert len(b
-00002170: 6174 6368 2920 3e20 300a 2020 2020 2020  atch) > 0.      
-00002180: 2020 6261 7463 685f 7520 3d20 6e70 2e61    batch_u = np.a
-00002190: 7272 6179 285b 7520 666f 7220 5f2c 205f  rray([u for _, _
-000021a0: 2c20 6368 696c 6472 656e 2069 6e20 6261  , children in ba
-000021b0: 7463 6820 666f 7220 752c 205f 2c20 5f20  tch for u, _, _ 
-000021c0: 696e 2063 6869 6c64 7265 6e5d 2c20 6e64  in children], nd
-000021d0: 6d69 6e3d 322c 2064 7479 7065 3d66 6c6f  min=2, dtype=flo
-000021e0: 6174 290a 2020 2020 2020 2020 6966 2062  at).        if b
-000021f0: 6174 6368 5f75 2e73 697a 6520 3e20 303a  atch_u.size > 0:
-00002200: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00002210: 6572 7420 6261 7463 685f 752e 7368 6170  ert batch_u.shap
-00002220: 655b 315d 203d 3d20 785f 6469 6d2c 2062  e[1] == x_dim, b
-00002230: 6174 6368 5f75 2e73 6861 7065 0a20 2020  atch_u.shape.   
-00002240: 2020 2020 2020 2020 2062 6174 6368 5f76           batch_v
-00002250: 203d 206e 702e 6172 7261 7928 5b76 2066   = np.array([v f
-00002260: 6f72 205f 2c20 5f2c 2063 6869 6c64 7265  or _, _, childre
-00002270: 6e20 696e 2062 6174 6368 2066 6f72 205f  n in batch for _
-00002280: 2c20 762c 205f 2069 6e20 6368 696c 6472  , v, _ in childr
-00002290: 656e 5d2c 206e 646d 696e 3d32 2c20 6474  en], ndmin=2, dt
-000022a0: 7970 653d 666c 6f61 7429 0a20 2020 2020  ype=float).     
-000022b0: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
-000022c0: 6361 6c6c 696e 6720 6c69 6b65 6c69 686f  calling likeliho
-000022d0: 6f64 2077 6974 6820 2564 2070 6f69 6e74  od with %d point
-000022e0: 7322 2025 206c 656e 2862 6174 6368 5f75  s" % len(batch_u
-000022f0: 2929 0a20 2020 2020 2020 2020 2020 2076  )).            v
-00002300: 3220 3d20 7472 616e 7366 6f72 6d28 6261  2 = transform(ba
-00002310: 7463 685f 7529 0a20 2020 2020 2020 2020  tch_u).         
-00002320: 2020 2061 7373 6572 7420 6261 7463 685f     assert batch_
-00002330: 762e 7368 6170 655b 315d 203d 3d20 6e75  v.shape[1] == nu
-00002340: 6d5f 7061 7261 6d73 2c20 6261 7463 685f  m_params, batch_
-00002350: 762e 7368 6170 650a 2020 2020 2020 2020  v.shape.        
-00002360: 2020 2020 6173 7365 7274 206e 702e 616c      assert np.al
-00002370: 6c63 6c6f 7365 2876 322c 2062 6174 6368  lclose(v2, batch
-00002380: 5f76 292c 2027 7472 616e 7366 6f72 6d20  _v), 'transform 
-00002390: 696e 636f 6e73 6973 7465 6e74 2c20 6361  inconsistent, ca
-000023a0: 6e6e 6f74 2072 6573 756d 6527 0a20 2020  nnot resume'.   
-000023b0: 2020 2020 2020 2020 206c 6f67 6c73 5f6e           logls_n
-000023c0: 6577 203d 206c 6f67 6c69 6b65 6c69 686f  ew = loglikeliho
-000023d0: 6f64 2862 6174 6368 5f76 290a 2020 2020  od(batch_v).    
-000023e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000023f0: 2020 2020 2020 2320 6e6f 206e 6577 2070        # no new p
-00002400: 6f69 6e74 730a 2020 2020 2020 2020 2020  oints.          
-00002410: 2020 6c6f 676c 735f 6e65 7720 3d20 5b5d    logls_new = []
-00002420: 0a0a 2020 2020 2020 2020 6a20 3d20 300a  ..        j = 0.
-00002430: 2020 2020 2020 2020 666f 7220 4c6d 696e          for Lmin
-00002440: 2c20 6163 7469 7665 5f76 616c 7565 732c  , active_values,
-00002450: 2063 6869 6c64 7265 6e20 696e 2062 6174   children in bat
-00002460: 6368 3a0a 0a20 2020 2020 2020 2020 2020  ch:..           
-00002470: 206e 6578 745f 6e6f 6465 3220 3d20 6578   next_node2 = ex
-00002480: 706c 6f72 6572 322e 6e65 7874 5f6e 6f64  plorer2.next_nod
-00002490: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-000024a0: 726f 6f74 6964 322c 206e 6f64 6532 2c20  rootid2, node2, 
-000024b0: 2861 6374 6976 655f 6e6f 6465 7332 2c20  (active_nodes2, 
-000024c0: 5f2c 2061 6374 6976 655f 7661 6c75 6573  _, active_values
-000024d0: 322c 205f 2920 3d20 6e65 7874 5f6e 6f64  2, _) = next_nod
-000024e0: 6532 0a20 2020 2020 2020 2020 2020 204c  e2.            L
-000024f0: 6d69 6e32 203d 2066 6c6f 6174 286e 6f64  min2 = float(nod
-00002500: 6532 2e76 616c 7565 290a 0a20 2020 2020  e2.value)..     
-00002510: 2020 2020 2020 2023 2069 6e20 7468 6520         # in the 
-00002520: 7461 696c 7320 6f66 2064 6973 7472 6962  tails of distrib
-00002530: 7574 696f 6e73 2069 7420 6361 6e20 6861  utions it can ha
-00002540: 7070 656e 2074 6861 7420 7477 6f20 706f  ppen that two po
-00002550: 696e 7473 2061 7265 206f 7574 206f 6620  ints are out of 
-00002560: 6f72 6465 720a 2020 2020 2020 2020 2020  order.          
-00002570: 2020 2320 6275 7420 7468 6174 206d 6179    # but that may
-00002580: 206e 6f74 2062 6520 7665 7279 2069 6d70   not be very imp
-00002590: 6f72 7461 6e74 0a20 2020 2020 2020 2020  ortant.         
-000025a0: 2020 2023 2069 6e20 7468 6520 696e 7465     # in the inte
-000025b0: 7265 7374 206f 6620 7072 6163 7469 6361  rest of practica
-000025c0: 6c69 7479 2c20 7765 2061 6c6c 6f77 2074  lity, we allow t
-000025d0: 6869 7320 616e 6420 6f6e 6c79 2073 746f  his and only sto
-000025e0: 7020 7468 650a 2020 2020 2020 2020 2020  p the.          
-000025f0: 2020 2320 7761 726d 7374 6172 7420 636f    # warmstart co
-00002600: 7079 696e 6720 7768 656e 2073 6f6d 6520  pying when some 
-00002610: 6275 6c6b 206f 6620 706f 696e 7473 2064  bulk of points d
-00002620: 6966 6665 722e 0a20 2020 2020 2020 2020  iffer..         
-00002630: 2020 2023 2069 6e20 616e 7920 6361 7365     # in any case
-00002640: 2c20 7761 726d 7374 6172 7420 7368 6f75  , warmstart shou
-00002650: 6c64 206e 6f74 2062 6520 636f 6e73 6964  ld not be consid
-00002660: 6572 6564 2073 6166 652c 2062 7574 2068  ered safe, but h
-00002670: 656c 7020 6974 6572 6174 696e 670a 2020  elp iterating.  
-00002680: 2020 2020 2020 2020 2020 2320 616e 6420            # and 
-00002690: 6120 6669 6e61 6c20 636c 6561 6e20 7275  a final clean ru
-000026a0: 6e20 6973 206e 6565 6465 6420 746f 2066  n is needed to f
-000026b0: 696e 616c 6973 6520 7468 6520 7265 7375  inalise the resu
-000026c0: 6c74 732e 0a20 2020 2020 2020 2020 2020  lts..           
-000026d0: 2069 6620 6c65 6e28 6163 7469 7665 5f76   if len(active_v
-000026e0: 616c 7565 7329 2021 3d20 6c65 6e28 6163  alues) != len(ac
-000026f0: 7469 7665 5f76 616c 7565 7332 293a 0a20  tive_values2):. 
-00002700: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002710: 6620 7665 7262 6f73 6520 3d3d 2032 3a0a  f verbose == 2:.
-00002720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002730: 2020 2020 7072 696e 7428 2273 746f 7070      print("stopp
-00002740: 696e 672c 206e 756d 6265 7220 6f66 206c  ing, number of l
-00002750: 6976 6520 706f 696e 7473 2064 6966 6665  ive points diffe
-00002760: 7220 2825 6420 7673 2025 6429 2220 2520  r (%d vs %d)" % 
-00002770: 286c 656e 2861 6374 6976 655f 7661 6c75  (len(active_valu
-00002780: 6573 292c 206c 656e 2861 6374 6976 655f  es), len(active_
-00002790: 7661 6c75 6573 3229 2929 0a20 2020 2020  values2))).     
-000027a0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
-000027b0: 6f6f 645f 7374 6174 6520 3d20 4661 6c73  ood_state = Fals
-000027c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000027d0: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
-000027e0: 2020 2020 2069 6620 6c65 6e28 6163 7469       if len(acti
-000027f0: 7665 5f76 616c 7565 7329 2021 3d20 6c65  ve_values) != le
-00002800: 6e28 696e 6469 6365 7331 293a 0a20 2020  n(indices1):.   
-00002810: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-00002820: 6963 6573 312c 2069 6e64 6963 6573 3220  ices1, indices2 
-00002830: 3d20 6e70 2e6d 6573 6867 7269 6428 6e70  = np.meshgrid(np
-00002840: 2e61 7261 6e67 6528 6c65 6e28 6163 7469  .arange(len(acti
-00002850: 7665 5f76 616c 7565 7329 292c 206e 702e  ve_values)), np.
+00000000: 2320 6e6f 7161 3a20 4434 3030 2044 3230  # noqa: D400 D20
+00000010: 350a 2222 220a 4e65 7374 6564 2073 616d  5.""".Nested sam
+00000020: 706c 696e 6720 696e 7465 6772 6174 6f72  pling integrator
+00000030: 730a 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  s.--------------
+00000040: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 0a54  -------------..T
+00000050: 6869 7320 6d6f 6475 6c65 2070 726f 7669  his module provi
+00000060: 6465 7320 7468 6520 6869 6768 2d6c 6576  des the high-lev
+00000070: 656c 2063 6c61 7373 203a 7079 3a63 6c61  el class :py:cla
+00000080: 7373 3a60 5265 6163 7469 7665 4e65 7374  ss:`ReactiveNest
+00000090: 6564 5361 6d70 6c65 7260 2c0a 666f 7220  edSampler`,.for 
+000000a0: 6361 6c63 756c 6174 696e 6720 7468 6520  calculating the 
+000000b0: 4261 7965 7369 616e 2065 7669 6465 6e63  Bayesian evidenc
+000000c0: 6520 616e 6420 706f 7374 6572 696f 7220  e and posterior 
+000000d0: 7361 6d70 6c65 7320 6f66 2061 7262 6974  samples of arbit
+000000e0: 7261 7279 206d 6f64 656c 732e 0a0a 2222  rary models...""
+000000f0: 220a 0a23 2053 6f6d 6520 7061 7274 7320  "..# Some parts 
+00000100: 6172 6520 6672 6f6d 2074 6865 204e 6573  are from the Nes
+00000110: 746c 6520 6c69 6272 6172 7920 6279 204b  tle library by K
+00000120: 796c 6520 4261 7262 6172 7920 2868 7474  yle Barbary (htt
+00000130: 7073 3a2f 2f67 6974 6875 622e 636f 6d2f  ps://github.com/
+00000140: 6b62 6172 6261 7279 2f6e 6573 746c 6529  kbarbary/nestle)
+00000150: 0a23 2053 6f6d 6520 7061 7274 7320 6172  .# Some parts ar
+00000160: 6520 6672 6f6d 2074 6865 206e 6e65 7374  e from the nnest
+00000170: 206c 6962 7261 7279 2062 7920 4164 616d   library by Adam
+00000180: 204d 6f73 7320 2868 7474 7073 3a2f 2f67   Moss (https://g
+00000190: 6974 6875 622e 636f 6d2f 6164 616d 6d6f  ithub.com/adammo
+000001a0: 7373 2f6e 6e65 7374 290a 0a66 726f 6d20  ss/nnest)..from 
+000001b0: 5f5f 6675 7475 7265 5f5f 2069 6d70 6f72  __future__ impor
+000001c0: 7420 7072 696e 745f 6675 6e63 7469 6f6e  t print_function
+000001d0: 2c20 6469 7669 7369 6f6e 0a0a 696d 706f  , division..impo
+000001e0: 7274 206f 730a 696d 706f 7274 2073 7973  rt os.import sys
+000001f0: 0a69 6d70 6f72 7420 6373 760a 696d 706f  .import csv.impo
+00000200: 7274 206a 736f 6e0a 696d 706f 7274 206f  rt json.import o
+00000210: 7065 7261 746f 720a 696d 706f 7274 2074  perator.import t
+00000220: 696d 650a 696d 706f 7274 2077 6172 6e69  ime.import warni
+00000230: 6e67 730a 0a66 726f 6d20 6e75 6d70 7920  ngs..from numpy 
+00000240: 696d 706f 7274 206c 6f67 2c20 6578 702c  import log, exp,
+00000250: 206c 6f67 6164 6465 7870 0a69 6d70 6f72   logaddexp.impor
+00000260: 7420 6e75 6d70 7920 6173 206e 700a 0a66  t numpy as np..f
+00000270: 726f 6d20 2e75 7469 6c73 2069 6d70 6f72  rom .utils impor
+00000280: 7420 6372 6561 7465 5f6c 6f67 6765 722c  t create_logger,
+00000290: 206d 616b 655f 7275 6e5f 6469 722c 2072   make_run_dir, r
+000002a0: 6573 616d 706c 655f 6571 7561 6c2c 2076  esample_equal, v
+000002b0: 6f6c 5f70 7265 6661 6374 6f72 2c20 7665  ol_prefactor, ve
+000002c0: 6374 6f72 697a 652c 206c 6973 7469 6679  ctorize, listify
+000002d0: 2061 7320 5f6c 6973 7469 6679 0a66 726f   as _listify.fro
+000002e0: 6d20 2e75 7469 6c73 2069 6d70 6f72 7420  m .utils import 
+000002f0: 6973 5f61 6666 696e 655f 7472 616e 7366  is_affine_transf
+00000300: 6f72 6d2c 206e 6f72 6d61 6c69 7365 645f  orm, normalised_
+00000310: 6b65 6e64 616c 6c5f 7461 755f 6469 7374  kendall_tau_dist
+00000320: 616e 6365 2c20 6469 7374 7269 6275 7465  ance, distribute
+00000330: 645f 776f 726b 5f63 6875 6e6b 5f73 697a  d_work_chunk_siz
+00000340: 650a 6672 6f6d 2075 6c74 7261 6e65 7374  e.from ultranest
+00000350: 2e6d 6c66 7269 656e 6473 2069 6d70 6f72  .mlfriends impor
+00000360: 7420 4d4c 4672 6965 6e64 732c 2041 6666  t MLFriends, Aff
+00000370: 696e 654c 6179 6572 2c20 4c6f 6361 6c41  ineLayer, LocalA
+00000380: 6666 696e 654c 6179 6572 2c20 5363 616c  ffineLayer, Scal
+00000390: 696e 674c 6179 6572 2c20 6669 6e64 5f6e  ingLayer, find_n
+000003a0: 6561 7262 792c 2057 7261 7070 696e 6745  earby, WrappingE
+000003b0: 6c6c 6970 736f 6964 2c20 526f 6275 7374  llipsoid, Robust
+000003c0: 456c 6c69 7073 6f69 6452 6567 696f 6e0a  EllipsoidRegion.
+000003d0: 6672 6f6d 202e 7374 6f72 6520 696d 706f  from .store impo
+000003e0: 7274 2048 4446 3550 6f69 6e74 5374 6f72  rt HDF5PointStor
+000003f0: 652c 2054 6578 7450 6f69 6e74 5374 6f72  e, TextPointStor
+00000400: 652c 204e 756c 6c50 6f69 6e74 5374 6f72  e, NullPointStor
+00000410: 650a 6672 6f6d 202e 7669 7a20 696d 706f  e.from .viz impo
+00000420: 7274 2067 6574 5f64 6566 6175 6c74 5f76  rt get_default_v
+00000430: 697a 5f63 616c 6c62 6163 6b0a 6672 6f6d  iz_callback.from
+00000440: 202e 6f72 6465 7274 6573 7420 696d 706f   .ordertest impo
+00000450: 7274 2055 6e69 666f 726d 4f72 6465 7241  rt UniformOrderA
+00000460: 6363 756d 756c 6174 6f72 0a66 726f 6d20  ccumulator.from 
+00000470: 2e6e 6574 6974 6572 2069 6d70 6f72 7420  .netiter import 
+00000480: 506f 696e 7450 696c 652c 2053 696e 676c  PointPile, Singl
+00000490: 6543 6f75 6e74 6572 2c20 4d75 6c74 6943  eCounter, MultiC
+000004a0: 6f75 6e74 6572 2c20 4272 6561 6474 6846  ounter, BreadthF
+000004b0: 6972 7374 4974 6572 6174 6f72 2c20 5472  irstIterator, Tr
+000004c0: 6565 4e6f 6465 2c20 636f 756e 745f 7472  eeNode, count_tr
+000004d0: 6565 5f62 6574 7765 656e 2c20 6669 6e64  ee_between, find
+000004e0: 5f6e 6f64 6573 5f62 6566 6f72 652c 206c  _nodes_before, l
+000004f0: 6f67 7a5f 7365 7175 656e 6365 0a66 726f  ogz_sequence.fro
+00000500: 6d20 2e6e 6574 6974 6572 2069 6d70 6f72  m .netiter impor
+00000510: 7420 6475 6d70 5f74 7265 652c 2063 6f6d  t dump_tree, com
+00000520: 6269 6e65 5f72 6573 756c 7473 0a66 726f  bine_results.fro
+00000530: 6d20 2e68 6f74 7374 6172 7420 696d 706f  m .hotstart impo
+00000540: 7274 2067 6574 5f61 7578 696c 6961 7279  rt get_auxiliary
+00000550: 5f63 6f6e 7462 6f78 5f70 6172 616d 6574  _contbox_paramet
+00000560: 6572 697a 6174 696f 6e0a 0a0a 5f5f 616c  erization...__al
+00000570: 6c5f 5f20 3d20 5b27 5265 6163 7469 7665  l__ = ['Reactive
+00000580: 4e65 7374 6564 5361 6d70 6c65 7227 2c20  NestedSampler', 
+00000590: 274e 6573 7465 6453 616d 706c 6572 272c  'NestedSampler',
+000005a0: 2027 7265 6164 5f66 696c 6527 2c20 2777   'read_file', 'w
+000005b0: 6172 6d73 7461 7274 5f66 726f 6d5f 7369  armstart_from_si
+000005c0: 6d69 6c61 725f 6669 6c65 275d 0a0a 696e  milar_file']..in
+000005d0: 745f 7420 3d20 696e 740a 0a0a 6465 6620  t_t = int...def 
+000005e0: 5f67 6574 5f63 756d 7375 6d5f 7261 6e67  _get_cumsum_rang
+000005f0: 6528 7069 2c20 6470 293a 0a20 2020 2022  e(pi, dp):.    "
+00000600: 2222 436f 6d70 7574 6520 7175 616e 7469  ""Compute quanti
+00000610: 6c65 2069 6e64 6963 6573 2066 726f 6d20  le indices from 
+00000620: 7072 6f62 6162 696c 6974 6965 732e 0a0a  probabilities...
+00000630: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00000640: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a     ------------.
+00000650: 2020 2020 7069 3a20 6172 7261 790a 2020      pi: array.  
+00000660: 2020 2020 2020 7072 6f62 6162 696c 6974        probabilit
+00000670: 7920 6f66 2065 6163 6820 6974 656d 2e0a  y of each item..
+00000680: 2020 2020 6470 3a20 666c 6f61 740a 2020      dp: float.  
+00000690: 2020 2020 2020 5175 616e 7469 6c65 2028        Quantile (
+000006a0: 6265 7477 6565 6e20 3020 616e 6420 302e  between 0 and 0.
+000006b0: 3529 2e0a 0a20 2020 2052 6574 7572 6e73  5)...    Returns
+000006c0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20  .    ---------. 
+000006d0: 2020 2069 6e64 6578 5f6c 6f3a 2069 6e74     index_lo: int
+000006e0: 0a20 2020 2020 2020 2049 6e64 6578 206f  .        Index o
+000006f0: 6620 7468 6520 6974 656d 2063 6f72 7265  f the item corre
+00000700: 7370 6f6e 6469 6e67 2074 6f20 7175 616e  sponding to quan
+00000710: 7469 6c65 2060 6064 7060 602e 0a20 2020  tile ``dp``..   
+00000720: 2069 6e64 6578 5f68 693a 2069 6e74 0a20   index_hi: int. 
+00000730: 2020 2020 2020 2049 6e64 6578 206f 6620         Index of 
+00000740: 7468 6520 6974 656d 2063 6f72 7265 7370  the item corresp
+00000750: 6f6e 6469 6e67 2074 6f20 7175 616e 7469  onding to quanti
+00000760: 6c65 2060 6031 2d64 7060 602e 0a20 2020  le ``1-dp``..   
+00000770: 2022 2222 0a20 2020 2063 6920 3d20 7069   """.    ci = pi
+00000780: 2e63 756d 7375 6d28 290a 2020 2020 2320  .cumsum().    # 
+00000790: 7468 6973 2062 7569 6c64 7320 6120 636f  this builds a co
+000007a0: 6e73 6572 7661 7469 7665 6c79 206e 6172  nservatively nar
+000007b0: 726f 7720 696e 7465 7276 616c 0a20 2020  row interval.   
+000007c0: 2023 2066 696e 6420 6669 7273 7420 696e   # find first in
+000007d0: 6465 7820 7768 6572 6520 7468 6520 6375  dex where the cu
+000007e0: 6d75 6c61 7469 7665 2069 7320 7375 7265  mulative is sure
+000007f0: 6c79 2061 626f 7665 0a20 2020 2069 6c6f  ly above.    ilo
+00000800: 2c20 3d20 6e70 2e77 6865 7265 2863 6920  , = np.where(ci 
+00000810: 3e3d 2064 7029 0a20 2020 2069 6c6f 203d  >= dp).    ilo =
+00000820: 2069 6c6f 5b30 5d20 6966 206c 656e 2869   ilo[0] if len(i
+00000830: 6c6f 2920 3e20 3020 656c 7365 2030 0a20  lo) > 0 else 0. 
+00000840: 2020 2023 2066 696e 6420 6c61 7374 2069     # find last i
+00000850: 6e64 6578 2077 6865 7265 2074 6865 2063  ndex where the c
+00000860: 756d 756c 6174 6976 6520 6973 2073 7572  umulative is sur
+00000870: 656c 7920 6265 6c6f 770a 2020 2020 6968  ely below.    ih
+00000880: 692c 203d 206e 702e 7768 6572 6528 6369  i, = np.where(ci
+00000890: 203c 3d20 312e 202d 2064 7029 0a20 2020   <= 1. - dp).   
+000008a0: 2069 6869 203d 2069 6869 5b2d 315d 2069   ihi = ihi[-1] i
+000008b0: 6620 6c65 6e28 6968 6929 203e 2030 2065  f len(ihi) > 0 e
+000008c0: 6c73 6520 2d31 0a20 2020 2072 6574 7572  lse -1.    retur
+000008d0: 6e20 696c 6f2c 2069 6869 0a0a 0a64 6566  n ilo, ihi...def
+000008e0: 205f 7365 7175 656e 7469 616c 697a 655f   _sequentialize_
+000008f0: 7769 6474 685f 7365 7175 656e 6365 286d  width_sequence(m
+00000900: 696e 696d 616c 5f77 6964 7468 732c 206d  inimal_widths, m
+00000910: 696e 5f77 6964 7468 293a 0a20 2020 2022  in_width):.    "
+00000920: 2222 5475 726e 2061 206c 6973 7420 6f66  ""Turn a list of
+00000930: 2072 6571 7569 7265 6420 7472 6565 2077   required tree w
+00000940: 6964 7468 2069 6e74 6f20 616e 206f 7264  idth into an ord
+00000950: 6572 6564 2073 6571 7565 6e63 652e 0a0a  ered sequence...
+00000960: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00000970: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a     ------------.
+00000980: 2020 2020 6d69 6e69 6d61 6c5f 7769 6474      minimal_widt
+00000990: 6873 3a20 6c69 7374 206f 6620 284c 6c6f  hs: list of (Llo
+000009a0: 2c20 4c68 692c 2077 6964 7468 290a 2020  , Lhi, width).  
+000009b0: 2020 2020 2020 4465 6669 6e65 7320 7468        Defines th
+000009c0: 6520 7265 7175 6972 6564 2077 6964 7468  e required width
+000009d0: 2062 6574 7765 656e 204c 6c6f 2061 6e64   between Llo and
+000009e0: 204c 6869 2e0a 2020 2020 6d69 6e5f 7769   Lhi..    min_wi
+000009f0: 6474 683a 2069 6e74 0a20 2020 2020 2020  dth: int.       
+00000a00: 204d 696e 696d 756d 2077 6964 7468 2065   Minimum width e
+00000a10: 7665 7279 7768 6572 652e 0a0a 2020 2020  verywhere...    
+00000a20: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
+00000a30: 2d2d 2d2d 2d0a 2020 2020 4c73 6571 7565  -----.    Lseque
+00000a40: 6e63 653a 206c 6973 7420 6f66 2028 4c2c  nce: list of (L,
+00000a50: 2077 6964 7468 290a 2020 2020 2020 2020   width).        
+00000a60: 4120 7365 7175 656e 6365 206f 6620 4c20  A sequence of L 
+00000a70: 706f 696e 7473 2061 6e64 2074 6865 2065  points and the e
+00000a80: 7870 6563 7465 6420 7472 6565 2077 6964  xpected tree wid
+00000a90: 7468 2061 7420 616e 6420 6162 6f76 6520  th at and above 
+00000aa0: 6974 2e0a 0a20 2020 2022 2222 0a20 2020  it...    """.   
+00000ab0: 204c 706f 696e 7473 203d 206e 702e 756e   Lpoints = np.un
+00000ac0: 6971 7565 285f 6c69 7374 6966 7928 0a20  ique(_listify(. 
+00000ad0: 2020 2020 2020 205b 2d6e 702e 696e 665d         [-np.inf]
+00000ae0: 2c20 5b4c 2066 6f72 204c 2c20 5f2c 205f  , [L for L, _, _
+00000af0: 2069 6e20 6d69 6e69 6d61 6c5f 7769 6474   in minimal_widt
+00000b00: 6873 5d2c 0a20 2020 2020 2020 205b 4c20  hs],.        [L 
+00000b10: 666f 7220 5f2c 204c 2c20 5f20 696e 206d  for _, L, _ in m
+00000b20: 696e 696d 616c 5f77 6964 7468 735d 2c20  inimal_widths], 
+00000b30: 5b6e 702e 696e 665d 2929 0a20 2020 2077  [np.inf])).    w
+00000b40: 6964 7468 7320 3d20 6e70 2e6f 6e65 7328  idths = np.ones(
+00000b50: 6c65 6e28 4c70 6f69 6e74 7329 2920 2a20  len(Lpoints)) * 
+00000b60: 6d69 6e5f 7769 6474 680a 0a20 2020 2066  min_width..    f
+00000b70: 6f72 204c 6c6f 2c20 4c68 692c 2077 6964  or Llo, Lhi, wid
+00000b80: 7468 2069 6e20 6d69 6e69 6d61 6c5f 7769  th in minimal_wi
+00000b90: 6474 6873 3a0a 2020 2020 2020 2020 2320  dths:.        # 
+00000ba0: 616c 6c20 4c70 6f69 6e74 7320 7769 7468  all Lpoints with
+00000bb0: 696e 2074 6861 7420 7261 6e67 6520 7368  in that range sh
+00000bc0: 6f75 6c64 2062 6520 6d61 7869 6d69 7a65  ould be maximize
+00000bd0: 6420 746f 2077 6964 7468 0a20 2020 2020  d to width.     
+00000be0: 2020 2023 206d 6173 6b20 3d20 6e70 2e6c     # mask = np.l
+00000bf0: 6f67 6963 616c 5f61 6e64 284c 706f 696e  ogical_and(Lpoin
+00000c00: 7473 203e 3d20 4c6c 6f2c 204c 706f 696e  ts >= Llo, Lpoin
+00000c10: 7473 203c 3d20 4c68 6929 0a20 2020 2020  ts <= Lhi).     
+00000c20: 2020 2023 2074 6865 2066 6f6c 6c6f 7769     # the followi
+00000c30: 6e67 2061 6c6c 6f77 7320 7365 676d 656e  ng allows segmen
+00000c40: 7473 2074 6f20 7370 6563 6966 7920 2d69  ts to specify -i
+00000c50: 6e66 2e2e 4c20 7261 6e67 6573 0a20 2020  nf..L ranges.   
+00000c60: 2020 2020 206d 6173 6b20 3d20 7e6e 702e       mask = ~np.
+00000c70: 6c6f 6769 6361 6c5f 6f72 284c 706f 696e  logical_or(Lpoin
+00000c80: 7473 203c 204c 6c6f 2c20 4c70 6f69 6e74  ts < Llo, Lpoint
+00000c90: 7320 3e20 4c68 6929 0a20 2020 2020 2020  s > Lhi).       
+00000ca0: 2077 6964 7468 735b 6d61 736b 5d20 3d20   widths[mask] = 
+00000cb0: 6e70 2e77 6865 7265 2877 6964 7468 735b  np.where(widths[
+00000cc0: 6d61 736b 5d20 3c20 7769 6474 682c 2077  mask] < width, w
+00000cd0: 6964 7468 2c20 7769 6474 6873 5b6d 6173  idth, widths[mas
+00000ce0: 6b5d 290a 0a20 2020 2023 2074 6865 2077  k])..    # the w
+00000cf0: 6964 7468 2068 6173 2074 6f20 6d6f 6e6f  idth has to mono
+00000d00: 746f 6e69 6361 6c6c 7920 696e 6372 6561  tonically increa
+00000d10: 7365 2074 6f20 7468 6520 6d61 7869 6d75  se to the maximu
+00000d20: 6d20 6672 6f6d 2062 6f74 6820 7369 6465  m from both side
+00000d30: 730a 2020 2020 2320 736f 2077 6520 6669  s.    # so we fi
+00000d40: 6c6c 2075 7020 616e 7920 696e 7465 726d  ll up any interm
+00000d50: 6564 6961 7465 2064 6970 730a 2020 2020  ediate dips.    
+00000d60: 6d61 785f 7769 6474 6820 3d20 7769 6474  max_width = widt
+00000d70: 6873 2e6d 6178 2829 0a20 2020 206d 6964  hs.max().    mid
+00000d80: 203d 206e 702e 7768 6572 6528 7769 6474   = np.where(widt
+00000d90: 6873 203d 3d20 6d61 785f 7769 6474 6829  hs == max_width)
+00000da0: 5b30 5d5b 305d 0a20 2020 2077 6964 6573  [0][0].    wides
+00000db0: 7420 3d20 300a 2020 2020 666f 7220 6920  t = 0.    for i 
+00000dc0: 696e 2072 616e 6765 286d 6964 293a 0a20  in range(mid):. 
+00000dd0: 2020 2020 2020 2077 6964 6573 7420 3d20         widest = 
+00000de0: 7769 6474 6873 5b69 5d20 3d20 6d61 7828  widths[i] = max(
+00000df0: 7769 6465 7374 2c20 7769 6474 6873 5b69  widest, widths[i
+00000e00: 5d29 0a20 2020 2077 6964 6573 7420 3d20  ]).    widest = 
+00000e10: 300a 2020 2020 666f 7220 6920 696e 2072  0.    for i in r
+00000e20: 616e 6765 286c 656e 2877 6964 7468 7329  ange(len(widths)
+00000e30: 202d 2031 2c20 6d69 642c 202d 3129 3a0a   - 1, mid, -1):.
+00000e40: 2020 2020 2020 2020 7769 6465 7374 203d          widest =
+00000e50: 2077 6964 7468 735b 695d 203d 206d 6178   widths[i] = max
+00000e60: 2877 6964 6573 742c 2077 6964 7468 735b  (widest, widths[
+00000e70: 695d 290a 0a20 2020 2072 6574 7572 6e20  i])..    return 
+00000e80: 6c69 7374 287a 6970 284c 706f 696e 7473  list(zip(Lpoints
+00000e90: 2c20 7769 6474 6873 2929 0a0a 0a64 6566  , widths))...def
+00000ea0: 205f 6578 706c 6f72 655f 6974 6572 6174   _explore_iterat
+00000eb0: 6f72 5f62 6174 6368 2865 7870 6c6f 7265  or_batch(explore
+00000ec0: 722c 2070 6f70 2c20 785f 6469 6d2c 206e  r, pop, x_dim, n
+00000ed0: 756d 5f70 6172 616d 732c 2070 6f69 6e74  um_params, point
+00000ee0: 7069 6c65 2c20 6261 7463 6873 697a 653d  pile, batchsize=
+00000ef0: 3129 3a0a 2020 2020 6261 7463 6820 3d20  1):.    batch = 
+00000f00: 5b5d 0a0a 2020 2020 7768 696c 6520 5472  []..    while Tr
+00000f10: 7565 3a0a 2020 2020 2020 2020 6e65 7874  ue:.        next
+00000f20: 5f6e 6f64 6520 3d20 6578 706c 6f72 6572  _node = explorer
+00000f30: 2e6e 6578 745f 6e6f 6465 2829 0a20 2020  .next_node().   
+00000f40: 2020 2020 2069 6620 6e65 7874 5f6e 6f64       if next_nod
+00000f50: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+00000f60: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00000f70: 2020 2020 2072 6f6f 7469 642c 206e 6f64       rootid, nod
+00000f80: 652c 2028 5f2c 2061 6374 6976 655f 726f  e, (_, active_ro
+00000f90: 6f74 6964 732c 2061 6374 6976 655f 7661  otids, active_va
+00000fa0: 6c75 6573 2c20 6163 7469 7665 5f6e 6f64  lues, active_nod
+00000fb0: 655f 6964 7329 203d 206e 6578 745f 6e6f  e_ids) = next_no
+00000fc0: 6465 0a20 2020 2020 2020 204c 6d69 6e20  de.        Lmin 
+00000fd0: 3d20 6e6f 6465 2e76 616c 7565 0a20 2020  = node.value.   
+00000fe0: 2020 2020 2063 6869 6c64 7265 6e20 3d20       children = 
+00000ff0: 5b5d 0a0a 2020 2020 2020 2020 5f2c 2072  []..        _, r
+00001000: 6f77 203d 2070 6f70 284c 6d69 6e29 0a20  ow = pop(Lmin). 
+00001010: 2020 2020 2020 2069 6620 726f 7720 6973         if row is
+00001020: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00001030: 2020 2020 2020 206c 6f67 6c20 3d20 726f         logl = ro
+00001040: 775b 315d 0a20 2020 2020 2020 2020 2020  w[1].           
+00001050: 2075 203d 2072 6f77 5b33 3a33 202b 2078   u = row[3:3 + x
+00001060: 5f64 696d 5d0a 2020 2020 2020 2020 2020  _dim].          
+00001070: 2020 7620 3d20 726f 775b 3320 2b20 785f    v = row[3 + x_
+00001080: 6469 6d3a 3320 2b20 785f 6469 6d20 2b20  dim:3 + x_dim + 
+00001090: 6e75 6d5f 7061 7261 6d73 5d0a 0a20 2020  num_params]..   
+000010a0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+000010b0: 752e 7368 6170 6520 3d3d 2028 785f 6469  u.shape == (x_di
+000010c0: 6d2c 290a 2020 2020 2020 2020 2020 2020  m,).            
+000010d0: 6173 7365 7274 2076 2e73 6861 7065 203d  assert v.shape =
+000010e0: 3d20 286e 756d 5f70 6172 616d 732c 290a  = (num_params,).
+000010f0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00001100: 7274 206c 6f67 6c20 3e20 4c6d 696e 0a20  rt logl > Lmin. 
+00001110: 2020 2020 2020 2020 2020 2063 6869 6c64             child
+00001120: 7265 6e2e 6170 7065 6e64 2828 752c 2076  ren.append((u, v
+00001130: 2c20 6c6f 676c 2929 0a20 2020 2020 2020  , logl)).       
+00001140: 2020 2020 2063 6869 6c64 203d 2070 6f69       child = poi
+00001150: 6e74 7069 6c65 2e6d 616b 655f 6e6f 6465  ntpile.make_node
+00001160: 286c 6f67 6c2c 2075 2c20 7629 0a20 2020  (logl, u, v).   
+00001170: 2020 2020 2020 2020 206e 6f64 652e 6368           node.ch
+00001180: 696c 6472 656e 2e61 7070 656e 6428 6368  ildren.append(ch
+00001190: 696c 6429 0a0a 2020 2020 2020 2020 6261  ild)..        ba
+000011a0: 7463 682e 6170 7065 6e64 2828 4c6d 696e  tch.append((Lmin
+000011b0: 2c20 6163 7469 7665 5f76 616c 7565 732e  , active_values.
+000011c0: 636f 7079 2829 2c20 6368 696c 6472 656e  copy(), children
+000011d0: 2929 0a20 2020 2020 2020 2069 6620 6c65  )).        if le
+000011e0: 6e28 6261 7463 6829 203e 3d20 6261 7463  n(batch) >= batc
+000011f0: 6873 697a 653a 0a20 2020 2020 2020 2020  hsize:.         
+00001200: 2020 2079 6965 6c64 2062 6174 6368 0a20     yield batch. 
+00001210: 2020 2020 2020 2020 2020 2062 6174 6368             batch
+00001220: 203d 205b 5d0a 2020 2020 2020 2020 6578   = [].        ex
+00001230: 706c 6f72 6572 2e65 7870 616e 645f 6368  plorer.expand_ch
+00001240: 696c 6472 656e 5f6f 6628 726f 6f74 6964  ildren_of(rootid
+00001250: 2c20 6e6f 6465 290a 2020 2020 6966 206c  , node).    if l
+00001260: 656e 2862 6174 6368 2920 3e20 303a 0a20  en(batch) > 0:. 
+00001270: 2020 2020 2020 2079 6965 6c64 2062 6174         yield bat
+00001280: 6368 0a0a 0a64 6566 2072 6573 756d 655f  ch...def resume_
+00001290: 6672 6f6d 5f73 696d 696c 6172 5f66 696c  from_similar_fil
+000012a0: 6528 0a20 2020 206c 6f67 5f64 6972 2c20  e(.    log_dir, 
+000012b0: 785f 6469 6d2c 206c 6f67 6c69 6b65 6c69  x_dim, loglikeli
+000012c0: 686f 6f64 2c20 7472 616e 7366 6f72 6d2c  hood, transform,
+000012d0: 0a20 2020 206d 6178 5f74 6175 3d30 2c20  .    max_tau=0, 
+000012e0: 7665 7262 6f73 653d 4661 6c73 652c 206e  verbose=False, n
+000012f0: 6472 6177 3d34 3030 0a29 3a0a 2020 2020  draw=400.):.    
+00001300: 2222 220a 2020 2020 4368 616e 6765 2061  """.    Change a
+00001310: 2073 746f 7265 6420 556c 7472 614e 6573   stored UltraNes
+00001320: 7420 7275 6e20 746f 2061 206d 6f64 6966  t run to a modif
+00001330: 6965 6420 6c6f 676c 696b 656c 6968 6f6f  ied loglikelihoo
+00001340: 642f 7472 616e 7366 6f72 6d2e 0a0a 2020  d/transform...  
+00001350: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00001360: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00001370: 6c6f 675f 6469 723a 2073 7472 0a20 2020  log_dir: str.   
+00001380: 2020 2020 2046 6f6c 6465 7220 636f 6e74       Folder cont
+00001390: 6169 6e69 6e67 2072 6573 756c 7473 0a20  aining results. 
+000013a0: 2020 2078 5f64 696d 3a20 696e 740a 2020     x_dim: int.  
+000013b0: 2020 2020 2020 6e75 6d62 6572 206f 6620        number of 
+000013c0: 6469 6d65 6e73 696f 6e73 0a20 2020 206c  dimensions.    l
+000013d0: 6f67 6c69 6b65 6c69 686f 6f64 3a20 6675  oglikelihood: fu
+000013e0: 6e63 7469 6f6e 0a20 2020 2020 2020 206e  nction.        n
+000013f0: 6577 206c 696b 656c 6968 6f6f 6420 6675  ew likelihood fu
+00001400: 6e63 7469 6f6e 0a20 2020 2074 7261 6e73  nction.    trans
+00001410: 666f 726d 3a20 6675 6e63 7469 6f6e 0a20  form: function. 
+00001420: 2020 2020 2020 206e 6577 2074 7261 6e73         new trans
+00001430: 666f 726d 2066 756e 6374 696f 6e0a 2020  form function.  
+00001440: 2020 7665 7262 6f73 653a 2062 6f6f 6c0a    verbose: bool.
+00001450: 2020 2020 2020 2020 7368 6f77 2070 726f          show pro
+00001460: 6772 6573 730a 2020 2020 6e64 7261 773a  gress.    ndraw:
+00001470: 2069 6e74 0a20 2020 2020 2020 2073 6574   int.        set
+00001480: 2074 6f20 3e31 2069 6620 6675 6e63 7469   to >1 if functi
+00001490: 6f6e 7320 6361 6e20 7461 6b65 2061 6476  ons can take adv
+000014a0: 616e 7461 6765 206f 6620 7665 6374 6f72  antage of vector
+000014b0: 697a 6564 2063 6f6d 7075 7461 7469 6f6e  ized computation
+000014c0: 730a 2020 2020 6d61 785f 7461 753a 2066  s.    max_tau: f
+000014d0: 6c6f 6174 0a20 2020 2020 2020 2041 6c6c  loat.        All
+000014e0: 6f77 6564 2064 6973 7369 6d69 6c61 7269  owed dissimilari
+000014f0: 7479 2069 6e20 7468 6520 6c69 7665 2070  ty in the live p
+00001500: 6f69 6e74 206f 7264 6572 696e 672c 2071  oint ordering, q
+00001510: 7561 6e74 6966 6965 6420 6173 0a20 2020  uantified as.   
+00001520: 2020 2020 206e 6f72 6d61 6c69 7365 6420       normalised 
+00001530: 4b65 6e64 616c 6c20 7461 7520 6469 7374  Kendall tau dist
+00001540: 616e 6365 2e0a 0a20 2020 2020 2020 206d  ance...        m
+00001550: 6178 5f74 6175 3d30 2069 7320 7468 6520  ax_tau=0 is the 
+00001560: 7665 7279 2063 6f6e 7365 7276 6174 6976  very conservativ
+00001570: 6520 6368 6f69 6365 206f 6620 7374 6f70  e choice of stop
+00001580: 7069 6e67 2074 6865 2077 6172 6d20 7374  ping the warm st
+00001590: 6172 740a 2020 2020 2020 2020 7768 656e  art.        when
+000015a0: 2074 6865 206c 6976 6520 706f 696e 7420   the live point 
+000015b0: 6f72 6465 7220 6469 6666 6572 732e 0a20  order differs.. 
+000015c0: 2020 2020 2020 204e 6561 7220 3120 6172         Near 1 ar
+000015d0: 6520 636f 6d70 6c65 7465 6c79 2064 6966  e completely dif
+000015e0: 6665 7265 6e74 206c 6976 6520 706f 696e  ferent live poin
+000015f0: 7420 6f72 6465 7269 6e67 732e 0a20 2020  t orderings..   
+00001600: 2020 2020 2056 616c 7565 7320 696e 2062       Values in b
+00001610: 6574 7765 656e 2070 6572 6d69 7420 6d69  etween permit mi
+00001620: 6c64 2064 6973 6f72 6465 722e 0a0a 2020  ld disorder...  
+00001630: 2020 5265 7475 726e 730a 2020 2020 2d2d    Returns.    --
+00001640: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073 6571  --------.    seq
+00001650: 7565 6e63 653a 2064 6963 740a 2020 2020  uence: dict.    
+00001660: 2020 2020 636f 6e74 6169 6e73 2061 7272      contains arr
+00001670: 6179 7320 7374 6f72 696e 6720 666f 7220  ays storing for 
+00001680: 6561 6368 2069 7465 7261 7469 6f6e 2065  each iteration e
+00001690: 7374 696d 6174 6573 206f 663a 0a0a 2020  stimates of:..  
+000016a0: 2020 2020 2020 2020 2020 2a20 6c6f 677a            * logz
+000016b0: 3a20 6c6f 6720 6576 6964 656e 6365 2065  : log evidence e
+000016c0: 7374 696d 6174 650a 2020 2020 2020 2020  stimate.        
+000016d0: 2020 2020 2a20 6c6f 677a 6572 723a 206c      * logzerr: l
+000016e0: 6f67 2065 7669 6465 6e63 6520 756e 6365  og evidence unce
+000016f0: 7274 6169 6e74 7920 6573 7469 6d61 7465  rtainty estimate
+00001700: 0a20 2020 2020 2020 2020 2020 202a 206c  .            * l
+00001710: 6f67 766f 6c3a 206c 6f67 2076 6f6c 756d  ogvol: log volum
+00001720: 6520 6573 7469 6d61 7465 0a20 2020 2020  e estimate.     
+00001730: 2020 2020 2020 202a 2073 616d 706c 6573         * samples
+00001740: 5f6e 3a20 6e75 6d62 6572 206f 6620 6c69  _n: number of li
+00001750: 7665 2070 6f69 6e74 730a 2020 2020 2020  ve points.      
+00001760: 2020 2020 2020 2a20 6c6f 6777 743a 206c        * logwt: l
+00001770: 6f67 2077 6569 6768 740a 2020 2020 2020  og weight.      
+00001780: 2020 2020 2020 2a20 6c6f 676c 3a20 6c6f        * logl: lo
+00001790: 6720 6c69 6b65 6c69 686f 6f64 0a0a 2020  g likelihood..  
+000017a0: 2020 6669 6e61 6c3a 2064 6963 740a 2020    final: dict.  
+000017b0: 2020 2020 2020 7361 6d65 2061 7320 5265        same as Re
+000017c0: 6163 7469 7665 4e65 7374 6564 5361 6d70  activeNestedSamp
+000017d0: 6c65 722e 7265 7375 6c74 7320 616e 640a  ler.results and.
+000017e0: 2020 2020 2020 2020 5265 6163 7469 7665          Reactive
+000017f0: 4e65 7374 6564 5361 6d70 6c65 722e 7275  NestedSampler.ru
+00001800: 6e20 7265 7475 726e 2076 616c 7565 730a  n return values.
+00001810: 0a20 2020 2022 2222 0a20 2020 2069 6d70  .    """.    imp
+00001820: 6f72 7420 6835 7079 0a20 2020 2066 696c  ort h5py.    fil
+00001830: 6570 6174 6820 3d20 6f73 2e70 6174 682e  epath = os.path.
+00001840: 6a6f 696e 286c 6f67 5f64 6972 2c20 2772  join(log_dir, 'r
+00001850: 6573 756c 7473 272c 2027 706f 696e 7473  esults', 'points
+00001860: 2e68 6466 3527 290a 2020 2020 6669 6c65  .hdf5').    file
+00001870: 7061 7468 3220 3d20 6f73 2e70 6174 682e  path2 = os.path.
+00001880: 6a6f 696e 286c 6f67 5f64 6972 2c20 2772  join(log_dir, 'r
+00001890: 6573 756c 7473 272c 2027 706f 696e 7473  esults', 'points
+000018a0: 2e68 6466 352e 6e65 7727 290a 2020 2020  .hdf5.new').    
+000018b0: 6669 6c65 6f62 6a20 3d20 6835 7079 2e46  fileobj = h5py.F
+000018c0: 696c 6528 6669 6c65 7061 7468 2c20 2772  ile(filepath, 'r
+000018d0: 2729 0a20 2020 205f 2c20 6e63 6f6c 7320  ').    _, ncols 
+000018e0: 3d20 6669 6c65 6f62 6a5b 2770 6f69 6e74  = fileobj['point
+000018f0: 7327 5d2e 7368 6170 650a 2020 2020 6e75  s'].shape.    nu
+00001900: 6d5f 7061 7261 6d73 203d 206e 636f 6c73  m_params = ncols
+00001910: 202d 2033 202d 2078 5f64 696d 0a0a 2020   - 3 - x_dim..  
+00001920: 2020 706f 696e 7473 203d 2066 696c 656f    points = fileo
+00001930: 626a 5b27 706f 696e 7473 275d 5b3a 5d0a  bj['points'][:].
+00001940: 2020 2020 6669 6c65 6f62 6a2e 636c 6f73      fileobj.clos
+00001950: 6528 290a 2020 2020 6465 6c20 6669 6c65  e().    del file
+00001960: 6f62 6a0a 0a20 2020 2070 6f69 6e74 7374  obj..    pointst
+00001970: 6f72 6532 203d 2048 4446 3550 6f69 6e74  ore2 = HDF5Point
+00001980: 5374 6f72 6528 6669 6c65 7061 7468 322c  Store(filepath2,
+00001990: 206e 636f 6c73 2c20 6d6f 6465 3d27 7727   ncols, mode='w'
+000019a0: 290a 2020 2020 7374 6163 6b20 3d20 6c69  ).    stack = li
+000019b0: 7374 2865 6e75 6d65 7261 7465 2870 6f69  st(enumerate(poi
+000019c0: 6e74 7329 290a 0a20 2020 2070 6f69 6e74  nts))..    point
+000019d0: 7069 6c65 203d 2050 6f69 6e74 5069 6c65  pile = PointPile
+000019e0: 2878 5f64 696d 2c20 6e75 6d5f 7061 7261  (x_dim, num_para
+000019f0: 6d73 290a 2020 2020 706f 696e 7470 696c  ms).    pointpil
+00001a00: 6532 203d 2050 6f69 6e74 5069 6c65 2878  e2 = PointPile(x
+00001a10: 5f64 696d 2c20 6e75 6d5f 7061 7261 6d73  _dim, num_params
+00001a20: 290a 0a20 2020 2064 6566 2070 6f70 284c  )..    def pop(L
+00001a30: 6d69 6e29 3a0a 2020 2020 2020 2020 2222  min):.        ""
+00001a40: 2246 696e 6420 6d61 7463 6869 6e67 2073  "Find matching s
+00001a50: 616d 706c 6520 6672 6f6d 2070 6f69 6e74  ample from point
+00001a60: 7320 6669 6c65 2e22 2222 0a20 2020 2020  s file.""".     
+00001a70: 2020 2023 206c 6f6f 6b20 666f 7277 6172     # look forwar
+00001a80: 6420 746f 2073 6565 2069 6620 7468 6572  d to see if ther
+00001a90: 6520 6973 2061 6e20 6578 6163 7420 6d61  e is an exact ma
+00001aa0: 7463 680a 2020 2020 2020 2020 2320 6966  tch.        # if
+00001ab0: 2077 6520 646f 206e 6f74 2075 7365 2074   we do not use t
+00001ac0: 6865 2065 7861 6374 206d 6174 6368 6573  he exact matches
+00001ad0: 0a20 2020 2020 2020 2023 2020 2074 6869  .        #   thi
+00001ae0: 7320 6361 7573 6573 2061 2073 6869 6674  s causes a shift
+00001af0: 2069 6e20 7468 6520 6c6f 676c 696b 656c   in the loglikel
+00001b00: 6968 6f6f 6473 0a20 2020 2020 2020 2066  ihoods.        f
+00001b10: 6f72 2069 2c20 2869 6478 2c20 6e65 7874  or i, (idx, next
+00001b20: 5f72 6f77 2920 696e 2065 6e75 6d65 7261  _row) in enumera
+00001b30: 7465 2873 7461 636b 293a 0a20 2020 2020  te(stack):.     
+00001b40: 2020 2020 2020 2072 6f77 5f4c 6d69 6e20         row_Lmin 
+00001b50: 3d20 6e65 7874 5f72 6f77 5b30 5d0a 2020  = next_row[0].  
+00001b60: 2020 2020 2020 2020 2020 4c20 3d20 6e65            L = ne
+00001b70: 7874 5f72 6f77 5b31 5d0a 2020 2020 2020  xt_row[1].      
+00001b80: 2020 2020 2020 6966 2072 6f77 5f4c 6d69        if row_Lmi
+00001b90: 6e20 3c3d 204c 6d69 6e20 616e 6420 4c20  n <= Lmin and L 
+00001ba0: 3e20 4c6d 696e 3a0a 2020 2020 2020 2020  > Lmin:.        
+00001bb0: 2020 2020 2020 2020 6964 782c 2072 6f77          idx, row
+00001bc0: 203d 2073 7461 636b 2e70 6f70 2869 290a   = stack.pop(i).
+00001bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001be0: 7265 7475 726e 2069 6478 2c20 726f 770a  return idx, row.
+00001bf0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00001c00: 6f6e 652c 204e 6f6e 650a 0a20 2020 2072  one, None..    r
+00001c10: 6f6f 7473 203d 205b 5d0a 2020 2020 726f  oots = [].    ro
+00001c20: 6f74 7332 203d 205b 5d0a 2020 2020 696e  ots2 = [].    in
+00001c30: 6974 6961 6c5f 706f 696e 7473 5f75 203d  itial_points_u =
+00001c40: 205b 5d0a 2020 2020 696e 6974 6961 6c5f   [].    initial_
+00001c50: 706f 696e 7473 5f76 203d 205b 5d0a 2020  points_v = [].  
+00001c60: 2020 696e 6974 6961 6c5f 706f 696e 7473    initial_points
+00001c70: 5f6c 6f67 6c20 3d20 5b5d 0a20 2020 2077  _logl = [].    w
+00001c80: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
+00001c90: 2020 205f 2c20 726f 7720 3d20 706f 7028     _, row = pop(
+00001ca0: 2d6e 702e 696e 6629 0a20 2020 2020 2020  -np.inf).       
+00001cb0: 2069 6620 726f 7720 6973 204e 6f6e 653a   if row is None:
+00001cc0: 0a20 2020 2020 2020 2020 2020 2062 7265  .            bre
+00001cd0: 616b 0a20 2020 2020 2020 206c 6f67 6c20  ak.        logl 
+00001ce0: 3d20 726f 775b 315d 0a20 2020 2020 2020  = row[1].       
+00001cf0: 2075 203d 2072 6f77 5b33 3a33 202b 2078   u = row[3:3 + x
+00001d00: 5f64 696d 5d0a 2020 2020 2020 2020 7620  _dim].        v 
+00001d10: 3d20 726f 775b 3320 2b20 785f 6469 6d3a  = row[3 + x_dim:
+00001d20: 3320 2b20 785f 6469 6d20 2b20 6e75 6d5f  3 + x_dim + num_
+00001d30: 7061 7261 6d73 5d0a 2020 2020 2020 2020  params].        
+00001d40: 696e 6974 6961 6c5f 706f 696e 7473 5f75  initial_points_u
+00001d50: 2e61 7070 656e 6428 7529 0a20 2020 2020  .append(u).     
+00001d60: 2020 2069 6e69 7469 616c 5f70 6f69 6e74     initial_point
+00001d70: 735f 762e 6170 7065 6e64 2876 290a 2020  s_v.append(v).  
+00001d80: 2020 2020 2020 696e 6974 6961 6c5f 706f        initial_po
+00001d90: 696e 7473 5f6c 6f67 6c2e 6170 7065 6e64  ints_logl.append
+00001da0: 286c 6f67 6c29 0a0a 2020 2020 7632 203d  (logl)..    v2 =
+00001db0: 2074 7261 6e73 666f 726d 286e 702e 6172   transform(np.ar
+00001dc0: 7261 7928 696e 6974 6961 6c5f 706f 696e  ray(initial_poin
+00001dd0: 7473 5f75 2c20 6e64 6d69 6e3d 322c 2064  ts_u, ndmin=2, d
+00001de0: 7479 7065 3d66 6c6f 6174 2929 0a20 2020  type=float)).   
+00001df0: 2061 7373 6572 7420 6e70 2e61 6c6c 636c   assert np.allcl
+00001e00: 6f73 6528 7632 2c20 696e 6974 6961 6c5f  ose(v2, initial_
+00001e10: 706f 696e 7473 5f76 292c 2027 7472 616e  points_v), 'tran
+00001e20: 7366 6f72 6d20 696e 636f 6e73 6973 7465  sform inconsiste
+00001e30: 6e74 2c20 6361 6e6e 6f74 2072 6573 756d  nt, cannot resum
+00001e40: 6527 0a20 2020 206c 6f67 6c73 5f6e 6577  e'.    logls_new
+00001e50: 203d 206c 6f67 6c69 6b65 6c69 686f 6f64   = loglikelihood
+00001e60: 2876 3229 0a0a 2020 2020 666f 7220 752c  (v2)..    for u,
+00001e70: 2076 2c20 6c6f 676c 2c20 6c6f 676c 5f6e   v, logl, logl_n
+00001e80: 6577 2069 6e20 7a69 7028 696e 6974 6961  ew in zip(initia
+00001e90: 6c5f 706f 696e 7473 5f75 2c20 696e 6974  l_points_u, init
+00001ea0: 6961 6c5f 706f 696e 7473 5f76 2c20 696e  ial_points_v, in
+00001eb0: 6974 6961 6c5f 706f 696e 7473 5f6c 6f67  itial_points_log
+00001ec0: 6c2c 206c 6f67 6c73 5f6e 6577 293a 0a20  l, logls_new):. 
+00001ed0: 2020 2020 2020 2072 6f6f 7473 2e61 7070         roots.app
+00001ee0: 656e 6428 706f 696e 7470 696c 652e 6d61  end(pointpile.ma
+00001ef0: 6b65 5f6e 6f64 6528 6c6f 676c 2c20 752c  ke_node(logl, u,
+00001f00: 2076 2929 0a20 2020 2020 2020 2072 6f6f   v)).        roo
+00001f10: 7473 322e 6170 7065 6e64 2870 6f69 6e74  ts2.append(point
+00001f20: 7069 6c65 322e 6d61 6b65 5f6e 6f64 6528  pile2.make_node(
+00001f30: 6c6f 676c 5f6e 6577 2c20 752c 2076 2929  logl_new, u, v))
+00001f40: 0a20 2020 2020 2020 2070 6f69 6e74 7374  .        pointst
+00001f50: 6f72 6532 2e61 6464 285f 6c69 7374 6966  ore2.add(_listif
+00001f60: 7928 5b2d 6e70 2e69 6e66 2c20 6c6f 676c  y([-np.inf, logl
+00001f70: 5f6e 6577 2c20 302e 305d 2c20 752c 2076  _new, 0.0], u, v
+00001f80: 292c 2031 290a 0a20 2020 2062 6174 6368  ), 1)..    batch
+00001f90: 7369 7a65 203d 206e 6472 6177 0a20 2020  size = ndraw.   
+00001fa0: 2065 7870 6c6f 7265 7220 3d20 4272 6561   explorer = Brea
+00001fb0: 6474 6846 6972 7374 4974 6572 6174 6f72  dthFirstIterator
+00001fc0: 2872 6f6f 7473 290a 2020 2020 6578 706c  (roots).    expl
+00001fd0: 6f72 6572 3220 3d20 4272 6561 6474 6846  orer2 = BreadthF
+00001fe0: 6972 7374 4974 6572 6174 6f72 2872 6f6f  irstIterator(roo
+00001ff0: 7473 3229 0a20 2020 206d 6169 6e5f 6974  ts2).    main_it
+00002000: 6572 6174 6f72 3220 3d20 5369 6e67 6c65  erator2 = Single
+00002010: 436f 756e 7465 7228 290a 2020 2020 6d61  Counter().    ma
+00002020: 696e 5f69 7465 7261 746f 7232 2e4c 6d61  in_iterator2.Lma
+00002030: 7820 3d20 6c6f 676c 735f 6e65 772e 6d61  x = logls_new.ma
+00002040: 7828 290a 2020 2020 676f 6f64 5f73 7461  x().    good_sta
+00002050: 7465 203d 2054 7275 650a 0a20 2020 2069  te = True..    i
+00002060: 6e64 6963 6573 312c 2069 6e64 6963 6573  ndices1, indices
+00002070: 3220 3d20 6e70 2e6d 6573 6867 7269 6428  2 = np.meshgrid(
+00002080: 6e70 2e61 7261 6e67 6528 6c65 6e28 6c6f  np.arange(len(lo
+00002090: 676c 735f 6e65 7729 292c 206e 702e 6172  gls_new)), np.ar
+000020a0: 616e 6765 286c 656e 286c 6f67 6c73 5f6e  ange(len(logls_n
+000020b0: 6577 2929 290a 2020 2020 6c61 7374 5f67  ew))).    last_g
+000020c0: 6f6f 645f 6c69 6b65 203d 202d 3165 3330  ood_like = -1e30
+000020d0: 300a 2020 2020 6c61 7374 5f67 6f6f 645f  0.    last_good_
+000020e0: 7374 6174 6520 3d20 300a 2020 2020 6570  state = 0.    ep
+000020f0: 7369 6c6f 6e20 3d20 3120 2b20 3165 2d36  silon = 1 + 1e-6
+00002100: 0a20 2020 206e 6974 6572 203d 2030 0a20  .    niter = 0. 
+00002110: 2020 2066 6f72 2062 6174 6368 2069 6e20     for batch in 
+00002120: 5f65 7870 6c6f 7265 5f69 7465 7261 746f  _explore_iterato
+00002130: 725f 6261 7463 6828 6578 706c 6f72 6572  r_batch(explorer
+00002140: 2c20 706f 702c 2078 5f64 696d 2c20 6e75  , pop, x_dim, nu
+00002150: 6d5f 7061 7261 6d73 2c20 706f 696e 7470  m_params, pointp
+00002160: 696c 652c 2062 6174 6368 7369 7a65 3d62  ile, batchsize=b
+00002170: 6174 6368 7369 7a65 293a 0a20 2020 2020  atchsize):.     
+00002180: 2020 2061 7373 6572 7420 6c65 6e28 6261     assert len(ba
+00002190: 7463 6829 203e 2030 0a20 2020 2020 2020  tch) > 0.       
+000021a0: 2062 6174 6368 5f75 203d 206e 702e 6172   batch_u = np.ar
+000021b0: 7261 7928 5b75 2066 6f72 205f 2c20 5f2c  ray([u for _, _,
+000021c0: 2063 6869 6c64 7265 6e20 696e 2062 6174   children in bat
+000021d0: 6368 2066 6f72 2075 2c20 5f2c 205f 2069  ch for u, _, _ i
+000021e0: 6e20 6368 696c 6472 656e 5d2c 206e 646d  n children], ndm
+000021f0: 696e 3d32 2c20 6474 7970 653d 666c 6f61  in=2, dtype=floa
+00002200: 7429 0a20 2020 2020 2020 2069 6620 6261  t).        if ba
+00002210: 7463 685f 752e 7369 7a65 203e 2030 3a0a  tch_u.size > 0:.
+00002220: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00002230: 7274 2062 6174 6368 5f75 2e73 6861 7065  rt batch_u.shape
+00002240: 5b31 5d20 3d3d 2078 5f64 696d 2c20 6261  [1] == x_dim, ba
+00002250: 7463 685f 752e 7368 6170 650a 2020 2020  tch_u.shape.    
+00002260: 2020 2020 2020 2020 6261 7463 685f 7620          batch_v 
+00002270: 3d20 6e70 2e61 7272 6179 285b 7620 666f  = np.array([v fo
+00002280: 7220 5f2c 205f 2c20 6368 696c 6472 656e  r _, _, children
+00002290: 2069 6e20 6261 7463 6820 666f 7220 5f2c   in batch for _,
+000022a0: 2076 2c20 5f20 696e 2063 6869 6c64 7265   v, _ in childre
+000022b0: 6e5d 2c20 6e64 6d69 6e3d 322c 2064 7479  n], ndmin=2, dty
+000022c0: 7065 3d66 6c6f 6174 290a 2020 2020 2020  pe=float).      
+000022d0: 2020 2020 2020 2320 7072 696e 7428 2263        # print("c
+000022e0: 616c 6c69 6e67 206c 696b 656c 6968 6f6f  alling likelihoo
+000022f0: 6420 7769 7468 2025 6420 706f 696e 7473  d with %d points
+00002300: 2220 2520 6c65 6e28 6261 7463 685f 7529  " % len(batch_u)
+00002310: 290a 2020 2020 2020 2020 2020 2020 7632  ).            v2
+00002320: 203d 2074 7261 6e73 666f 726d 2862 6174   = transform(bat
+00002330: 6368 5f75 290a 2020 2020 2020 2020 2020  ch_u).          
+00002340: 2020 6173 7365 7274 2062 6174 6368 5f76    assert batch_v
+00002350: 2e73 6861 7065 5b31 5d20 3d3d 206e 756d  .shape[1] == num
+00002360: 5f70 6172 616d 732c 2062 6174 6368 5f76  _params, batch_v
+00002370: 2e73 6861 7065 0a20 2020 2020 2020 2020  .shape.         
+00002380: 2020 2061 7373 6572 7420 6e70 2e61 6c6c     assert np.all
+00002390: 636c 6f73 6528 7632 2c20 6261 7463 685f  close(v2, batch_
+000023a0: 7629 2c20 2774 7261 6e73 666f 726d 2069  v), 'transform i
+000023b0: 6e63 6f6e 7369 7374 656e 742c 2063 616e  nconsistent, can
+000023c0: 6e6f 7420 7265 7375 6d65 270a 2020 2020  not resume'.    
+000023d0: 2020 2020 2020 2020 6c6f 676c 735f 6e65          logls_ne
+000023e0: 7720 3d20 6c6f 676c 696b 656c 6968 6f6f  w = loglikelihoo
+000023f0: 6428 6261 7463 685f 7629 0a20 2020 2020  d(batch_v).     
+00002400: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00002410: 2020 2020 2023 206e 6f20 6e65 7720 706f       # no new po
+00002420: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
+00002430: 206c 6f67 6c73 5f6e 6577 203d 205b 5d0a   logls_new = [].
+00002440: 0a20 2020 2020 2020 206a 203d 2030 0a20  .        j = 0. 
+00002450: 2020 2020 2020 2066 6f72 204c 6d69 6e2c         for Lmin,
+00002460: 2061 6374 6976 655f 7661 6c75 6573 2c20   active_values, 
+00002470: 6368 696c 6472 656e 2069 6e20 6261 7463  children in batc
+00002480: 683a 0a0a 2020 2020 2020 2020 2020 2020  h:..            
+00002490: 6e65 7874 5f6e 6f64 6532 203d 2065 7870  next_node2 = exp
+000024a0: 6c6f 7265 7232 2e6e 6578 745f 6e6f 6465  lorer2.next_node
+000024b0: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
+000024c0: 6f6f 7469 6432 2c20 6e6f 6465 322c 2028  ootid2, node2, (
+000024d0: 6163 7469 7665 5f6e 6f64 6573 322c 205f  active_nodes2, _
+000024e0: 2c20 6163 7469 7665 5f76 616c 7565 7332  , active_values2
+000024f0: 2c20 5f29 203d 206e 6578 745f 6e6f 6465  , _) = next_node
+00002500: 320a 2020 2020 2020 2020 2020 2020 4c6d  2.            Lm
+00002510: 696e 3220 3d20 666c 6f61 7428 6e6f 6465  in2 = float(node
+00002520: 322e 7661 6c75 6529 0a0a 2020 2020 2020  2.value)..      
+00002530: 2020 2020 2020 2320 696e 2074 6865 2074        # in the t
+00002540: 6169 6c73 206f 6620 6469 7374 7269 6275  ails of distribu
+00002550: 7469 6f6e 7320 6974 2063 616e 2068 6170  tions it can hap
+00002560: 7065 6e20 7468 6174 2074 776f 2070 6f69  pen that two poi
+00002570: 6e74 7320 6172 6520 6f75 7420 6f66 206f  nts are out of o
+00002580: 7264 6572 0a20 2020 2020 2020 2020 2020  rder.           
+00002590: 2023 2062 7574 2074 6861 7420 6d61 7920   # but that may 
+000025a0: 6e6f 7420 6265 2076 6572 7920 696d 706f  not be very impo
+000025b0: 7274 616e 740a 2020 2020 2020 2020 2020  rtant.          
+000025c0: 2020 2320 696e 2074 6865 2069 6e74 6572    # in the inter
+000025d0: 6573 7420 6f66 2070 7261 6374 6963 616c  est of practical
+000025e0: 6974 792c 2077 6520 616c 6c6f 7720 7468  ity, we allow th
+000025f0: 6973 2061 6e64 206f 6e6c 7920 7374 6f70  is and only stop
+00002600: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00002610: 2023 2077 6172 6d73 7461 7274 2063 6f70   # warmstart cop
+00002620: 7969 6e67 2077 6865 6e20 736f 6d65 2062  ying when some b
+00002630: 756c 6b20 6f66 2070 6f69 6e74 7320 6469  ulk of points di
+00002640: 6666 6572 2e0a 2020 2020 2020 2020 2020  ffer..          
+00002650: 2020 2320 696e 2061 6e79 2063 6173 652c    # in any case,
+00002660: 2077 6172 6d73 7461 7274 2073 686f 756c   warmstart shoul
+00002670: 6420 6e6f 7420 6265 2063 6f6e 7369 6465  d not be conside
+00002680: 7265 6420 7361 6665 2c20 6275 7420 6865  red safe, but he
+00002690: 6c70 2069 7465 7261 7469 6e67 0a20 2020  lp iterating.   
+000026a0: 2020 2020 2020 2020 2023 2061 6e64 2061           # and a
+000026b0: 2066 696e 616c 2063 6c65 616e 2072 756e   final clean run
+000026c0: 2069 7320 6e65 6564 6564 2074 6f20 6669   is needed to fi
+000026d0: 6e61 6c69 7365 2074 6865 2072 6573 756c  nalise the resul
+000026e0: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
+000026f0: 6966 206c 656e 2861 6374 6976 655f 7661  if len(active_va
+00002700: 6c75 6573 2920 213d 206c 656e 2861 6374  lues) != len(act
+00002710: 6976 655f 7661 6c75 6573 3229 3a0a 2020  ive_values2):.  
+00002720: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00002730: 2076 6572 626f 7365 203d 3d20 323a 0a20   verbose == 2:. 
+00002740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002750: 2020 2070 7269 6e74 2822 7374 6f70 7069     print("stoppi
+00002760: 6e67 2c20 6e75 6d62 6572 206f 6620 6c69  ng, number of li
+00002770: 7665 2070 6f69 6e74 7320 6469 6666 6572  ve points differ
+00002780: 2028 2564 2076 7320 2564 2922 2025 2028   (%d vs %d)" % (
+00002790: 6c65 6e28 6163 7469 7665 5f76 616c 7565  len(active_value
+000027a0: 7329 2c20 6c65 6e28 6163 7469 7665 5f76  s), len(active_v
+000027b0: 616c 7565 7332 2929 290a 2020 2020 2020  alues2))).      
+000027c0: 2020 2020 2020 2020 2020 2020 2020 676f                go
+000027d0: 6f64 5f73 7461 7465 203d 2046 616c 7365  od_state = False
+000027e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000027f0: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
+00002800: 2020 2020 6966 206c 656e 2861 6374 6976      if len(activ
+00002810: 655f 7661 6c75 6573 2920 213d 206c 656e  e_values) != len
+00002820: 2869 6e64 6963 6573 3129 3a0a 2020 2020  (indices1):.    
+00002830: 2020 2020 2020 2020 2020 2020 696e 6469              indi
+00002840: 6365 7331 2c20 696e 6469 6365 7332 203d  ces1, indices2 =
+00002850: 206e 702e 6d65 7368 6772 6964 286e 702e   np.meshgrid(np.
 00002860: 6172 616e 6765 286c 656e 2861 6374 6976  arange(len(activ
-00002870: 655f 7661 6c75 6573 3229 2929 0a20 2020  e_values2))).   
-00002880: 2020 2020 2020 2020 2074 6175 203d 206e           tau = n
-00002890: 6f72 6d61 6c69 7365 645f 6b65 6e64 616c  ormalised_kendal
-000028a0: 6c5f 7461 755f 6469 7374 616e 6365 2861  l_tau_distance(a
-000028b0: 6374 6976 655f 7661 6c75 6573 2c20 6163  ctive_values, ac
-000028c0: 7469 7665 5f76 616c 7565 7332 2c20 696e  tive_values2, in
-000028d0: 6469 6365 7331 2c20 696e 6469 6365 7332  dices1, indices2
-000028e0: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-000028f0: 6465 725f 636f 6e73 6973 7465 6e74 203d  der_consistent =
-00002900: 2074 6175 203c 3d20 6d61 785f 7461 750a   tau <= max_tau.
-00002910: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00002920: 7264 6572 5f63 6f6e 7369 7374 656e 7420  rder_consistent 
-00002930: 616e 6420 6c65 6e28 6163 7469 7665 5f76  and len(active_v
-00002940: 616c 7565 7329 203e 2031 3020 616e 6420  alues) > 10 and 
-00002950: 6c65 6e28 6163 7469 7665 5f76 616c 7565  len(active_value
-00002960: 7329 203e 2031 303a 0a20 2020 2020 2020  s) > 10:.       
-00002970: 2020 2020 2020 2020 2067 6f6f 645f 7374           good_st
-00002980: 6174 6520 3d20 5472 7565 0a20 2020 2020  ate = True.     
-00002990: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
-000029a0: 6f72 6465 725f 636f 6e73 6973 7465 6e74  order_consistent
-000029b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000029c0: 2020 676f 6f64 5f73 7461 7465 203d 2046    good_state = F
-000029d0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-000029e0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000029f0: 2020 2020 2020 2023 206d 6169 6e74 6169         # maintai
-00002a00: 6e20 7374 6174 650a 2020 2020 2020 2020  n state.        
-00002a10: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-00002a20: 2020 2020 2020 2020 2069 6620 7665 7262           if verb
-00002a30: 6f73 6520 3d3d 2032 3a0a 2020 2020 2020  ose == 2:.      
-00002a40: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00002a50: 6e69 7465 722c 2074 6175 290a 2020 2020  niter, tau).    
-00002a60: 2020 2020 2020 2020 6966 2067 6f6f 645f          if good_
-00002a70: 7374 6174 653a 0a20 2020 2020 2020 2020  state:.         
-00002a80: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
-00002a90: 2020 2020 2020 2020 2825 2e31 6529 2020          (%.1e)  
-00002aa0: 204c 3d25 2e31 6622 2025 2028 6c61 7374   L=%.1f" % (last
-00002ab0: 5f67 6f6f 645f 6c69 6b65 2c20 4c6d 696e  _good_like, Lmin
-00002ac0: 3229 290a 2020 2020 2020 2020 2020 2020  2)).            
-00002ad0: 2020 2020 2320 6173 7365 7274 206c 6173      # assert las
-00002ae0: 745f 676f 6f64 5f6c 696b 6520 3c20 4c6d  t_good_like < Lm
-00002af0: 696e 322c 2028 6c61 7374 5f67 6f6f 645f  in2, (last_good_
-00002b00: 6c69 6b65 2c20 4c6d 696e 3229 0a20 2020  like, Lmin2).   
-00002b10: 2020 2020 2020 2020 2020 2020 206c 6173               las
-00002b20: 745f 676f 6f64 5f6c 696b 6520 3d20 4c6d  t_good_like = Lm
-00002b30: 696e 320a 2020 2020 2020 2020 2020 2020  in2.            
-00002b40: 2020 2020 6c61 7374 5f67 6f6f 645f 7374      last_good_st
-00002b50: 6174 6520 3d20 6e69 7465 720a 2020 2020  ate = niter.    
-00002b60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00002b70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00002b80: 696e 7465 7270 6f6c 6174 6520 6120 696e  interpolate a in
-00002b90: 6372 6561 7369 6e67 206c 696b 656c 6968  creasing likelih
-00002ba0: 6f6f 640a 2020 2020 2020 2020 2020 2020  ood.            
-00002bb0: 2020 2020 2320 696e 2074 6865 2068 6f70      # in the hop
-00002bc0: 6520 7468 6174 2074 6865 2073 7465 7020  e that the step 
-00002bd0: 7369 7a65 2069 7320 736d 616c 6c65 7220  size is smaller 
-00002be0: 7468 616e 0a20 2020 2020 2020 2020 2020  than.           
-00002bf0: 2020 2020 2023 2074 6865 206c 696b 656c       # the likel
-00002c00: 6968 6f6f 6420 696e 6372 6561 7365 0a20  ihood increase. 
-00002c10: 2020 2020 2020 2020 2020 2020 2020 204c                 L
-00002c20: 6d69 6e32 203d 206c 6173 745f 676f 6f64  min2 = last_good
-00002c30: 5f6c 696b 650a 2020 2020 2020 2020 2020  _like.          
-00002c40: 2020 2020 2020 6e6f 6465 322e 7661 6c75        node2.valu
-00002c50: 6520 3d20 4c6d 696e 320a 2020 2020 2020  e = Lmin2.      
-00002c60: 2020 2020 2020 2020 2020 6c61 7374 5f67            last_g
-00002c70: 6f6f 645f 6c69 6b65 203d 206c 6173 745f  ood_like = last_
-00002c80: 676f 6f64 5f6c 696b 6520 2a20 6570 7369  good_like * epsi
-00002c90: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
-00002ca0: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
-00002cb0: 2020 2020 2020 2066 6f72 2075 2c20 762c         for u, v,
-00002cc0: 206c 6f67 6c5f 6f6c 6420 696e 2063 6869   logl_old in chi
-00002cd0: 6c64 7265 6e3a 0a20 2020 2020 2020 2020  ldren:.         
-00002ce0: 2020 2020 2020 206c 6f67 6c5f 6e65 7720         logl_new 
-00002cf0: 3d20 6c6f 676c 735f 6e65 775b 6a5d 0a20  = logls_new[j]. 
-00002d00: 2020 2020 2020 2020 2020 2020 2020 206a                 j
-00002d10: 202b 3d20 310a 0a20 2020 2020 2020 2020   += 1..         
-00002d20: 2020 2020 2020 2023 2070 7269 6e74 286a         # print(j
-00002d30: 2c20 4c6d 696e 322c 2027 2d3e 272c 206c  , Lmin2, '->', l
-00002d40: 6f67 6c5f 6e65 772c 2027 696e 7374 6561  ogl_new, 'instea
-00002d50: 6420 6f66 272c 204c 6d69 6e2c 2027 2d3e  d of', Lmin, '->
-00002d60: 272c 205b 632e 7661 6c75 6520 666f 7220  ', [c.value for 
-00002d70: 6320 696e 206e 6f64 6532 2e63 6869 6c64  c in node2.child
-00002d80: 7265 6e5d 290a 2020 2020 2020 2020 2020  ren]).          
-00002d90: 2020 2020 2020 6368 696c 6432 203d 2070        child2 = p
-00002da0: 6f69 6e74 7069 6c65 322e 6d61 6b65 5f6e  ointpile2.make_n
-00002db0: 6f64 6528 6c6f 676c 5f6e 6577 2c20 752c  ode(logl_new, u,
-00002dc0: 2076 290a 2020 2020 2020 2020 2020 2020   v).            
-00002dd0: 2020 2020 6e6f 6465 322e 6368 696c 6472      node2.childr
-00002de0: 656e 2e61 7070 656e 6428 6368 696c 6432  en.append(child2
-00002df0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00002e00: 2020 6966 206c 6f67 6c5f 6e65 7720 3e20    if logl_new > 
-00002e10: 4c6d 696e 323a 0a20 2020 2020 2020 2020  Lmin2:.         
-00002e20: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-00002e30: 7374 6f72 6532 2e61 6464 285f 6c69 7374  store2.add(_list
-00002e40: 6966 7928 5b4c 6d69 6e32 2c20 6c6f 676c  ify([Lmin2, logl
-00002e50: 5f6e 6577 2c20 302e 305d 2c20 752c 2076  _new, 0.0], u, v
-00002e60: 292c 2031 290a 2020 2020 2020 2020 2020  ), 1).          
-00002e70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00002e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e90: 6966 2076 6572 626f 7365 203d 3d20 323a  if verbose == 2:
-00002ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002eb0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
-00002ec0: 6361 6e6e 6f74 2075 7365 206e 6577 2070  cannot use new p
-00002ed0: 6f69 6e74 2062 6563 6175 7365 2069 7420  oint because it 
-00002ee0: 776f 756c 6420 6465 6372 6561 7365 206c  would decrease l
-00002ef0: 696b 656c 6968 6f6f 6420 2825 2e31 662d  ikelihood (%.1f-
-00002f00: 3e25 2e31 6629 2220 2520 284c 6d69 6e32  >%.1f)" % (Lmin2
-00002f10: 2c20 6c6f 676c 5f6e 6577 2929 0a20 2020  , logl_new)).   
-00002f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f30: 2023 2067 6f6f 645f 7374 6174 6520 3d20   # good_state = 
-00002f40: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00002f50: 2020 2020 2020 2020 2020 2320 6272 6561            # brea
-00002f60: 6b0a 0a20 2020 2020 2020 2020 2020 206d  k..            m
-00002f70: 6169 6e5f 6974 6572 6174 6f72 322e 7061  ain_iterator2.pa
-00002f80: 7373 696e 675f 6e6f 6465 286e 6f64 6532  ssing_node(node2
-00002f90: 2c20 6163 7469 7665 5f6e 6f64 6573 3229  , active_nodes2)
-00002fa0: 0a0a 2020 2020 2020 2020 2020 2020 6e69  ..            ni
-00002fb0: 7465 7220 2b3d 2031 0a20 2020 2020 2020  ter += 1.       
-00002fc0: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
-00002fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002fe0: 2073 7973 2e73 7464 6572 722e 7772 6974   sys.stderr.writ
-00002ff0: 6528 2225 642e 2e2e 5c72 2220 2520 6e69  e("%d...\r" % ni
-00003000: 7465 7229 0a0a 2020 2020 2020 2020 2020  ter)..          
-00003010: 2020 6578 706c 6f72 6572 322e 6578 7061    explorer2.expa
-00003020: 6e64 5f63 6869 6c64 7265 6e5f 6f66 2872  nd_children_of(r
-00003030: 6f6f 7469 6432 2c20 6e6f 6465 3229 0a0a  ootid2, node2)..
-00003040: 2020 2020 2020 2020 6966 206e 6f74 2067          if not g
-00003050: 6f6f 645f 7374 6174 653a 0a20 2020 2020  ood_state:.     
-00003060: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-00003070: 2020 2020 2069 6620 6d61 696e 5f69 7465       if main_ite
-00003080: 7261 746f 7232 2e6c 6f67 5a72 656d 6169  rator2.logZremai
-00003090: 6e20 3c20 6d61 696e 5f69 7465 7261 746f  n < main_iterato
-000030a0: 7232 2e6c 6f67 5a20 616e 6420 6e6f 7420  r2.logZ and not 
-000030b0: 676f 6f64 5f73 7461 7465 3a0a 2020 2020  good_state:.    
-000030c0: 2020 2020 2020 2020 2320 7374 6f70 2061          # stop a
-000030d0: 7320 7468 6520 7265 7375 6c74 7320 6469  s the results di
-000030e0: 7665 7267 6564 2061 6c72 6561 6479 0a20  verged already. 
-000030f0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00003100: 0a0a 2020 2020 6966 2076 6572 626f 7365  ..    if verbose
-00003110: 3a0a 2020 2020 2020 2020 7379 732e 7374  :.        sys.st
-00003120: 6465 7272 2e77 7269 7465 2822 2564 2f25  derr.write("%d/%
-00003130: 6420 6974 6572 6174 696f 6e73 2073 616c  d iterations sal
-00003140: 7661 6765 6420 2825 2e32 6625 2529 2e5c  vaged (%.2f%%).\
-00003150: 6e22 2025 2028 0a20 2020 2020 2020 2020  n" % (.         
-00003160: 2020 206c 6173 745f 676f 6f64 5f73 7461     last_good_sta
-00003170: 7465 202b 2031 2c20 6c65 6e28 706f 696e  te + 1, len(poin
-00003180: 7473 292c 2028 6c61 7374 5f67 6f6f 645f  ts), (last_good_
-00003190: 7374 6174 6520 2b20 3129 202a 2031 3030  state + 1) * 100
-000031a0: 2e20 2f20 6c65 6e28 706f 696e 7473 2929  . / len(points))
-000031b0: 290a 2020 2020 2320 6465 6c65 7465 2074  ).    # delete t
-000031c0: 6865 206f 6e65 7320 6174 2074 6865 2065  he ones at the e
-000031d0: 6e64 2066 726f 6d20 6c61 7374 5f67 6f6f  nd from last_goo
-000031e0: 645f 7374 6174 6520 6f6e 7761 7264 730a  d_state onwards.
-000031f0: 2020 2020 2320 6173 7365 7274 206c 656e      # assert len
-00003200: 2870 6f69 6e74 7374 6f72 6532 2e66 696c  (pointstore2.fil
-00003210: 656f 626a 5b27 706f 696e 7473 275d 2920  eobj['points']) 
-00003220: 3d3d 206e 6974 6572 2c20 286c 656e 2870  == niter, (len(p
-00003230: 6f69 6e74 7374 6f72 6532 2e66 696c 656f  ointstore2.fileo
-00003240: 626a 5b27 706f 696e 7473 275d 292c 206e  bj['points']), n
-00003250: 6974 6572 290a 2020 2020 6d61 736b 203d  iter).    mask =
-00003260: 2070 6f69 6e74 7374 6f72 6532 2e66 696c   pointstore2.fil
-00003270: 656f 626a 5b27 706f 696e 7473 275d 5b3a  eobj['points'][:
-00003280: 2c30 5d20 3c3d 206c 6173 745f 676f 6f64  ,0] <= last_good
-00003290: 5f6c 696b 650a 2020 2020 706f 696e 7473  _like.    points
-000032a0: 3220 3d20 706f 696e 7473 746f 7265 322e  2 = pointstore2.
-000032b0: 6669 6c65 6f62 6a5b 2770 6f69 6e74 7327  fileobj['points'
-000032c0: 5d5b 3a5d 5b6d 6173 6b2c 3a5d 0a20 2020  ][:][mask,:].   
-000032d0: 2064 656c 2070 6f69 6e74 7374 6f72 6532   del pointstore2
-000032e0: 2e66 696c 656f 626a 5b27 706f 696e 7473  .fileobj['points
-000032f0: 275d 0a20 2020 2070 6f69 6e74 7374 6f72  '].    pointstor
-00003300: 6532 2e66 696c 656f 626a 2e63 7265 6174  e2.fileobj.creat
-00003310: 655f 6461 7461 7365 7428 0a20 2020 2020  e_dataset(.     
-00003320: 2020 2027 706f 696e 7473 272c 2064 7479     'points', dty
-00003330: 7065 3d6e 702e 666c 6f61 7436 342c 0a20  pe=np.float64,. 
-00003340: 2020 2020 2020 2073 6861 7065 3d28 302c         shape=(0,
-00003350: 2070 6f69 6e74 7374 6f72 6532 2e6e 636f   pointstore2.nco
-00003360: 6c73 292c 206d 6178 7368 6170 653d 284e  ls), maxshape=(N
-00003370: 6f6e 652c 2070 6f69 6e74 7374 6f72 6532  one, pointstore2
-00003380: 2e6e 636f 6c73 2929 0a20 2020 2070 6f69  .ncols)).    poi
-00003390: 6e74 7374 6f72 6532 2e66 696c 656f 626a  ntstore2.fileobj
-000033a0: 5b27 706f 696e 7473 275d 2e72 6573 697a  ['points'].resiz
-000033b0: 6528 6c65 6e28 706f 696e 7473 3229 2c20  e(len(points2), 
-000033c0: 6178 6973 3d30 290a 2020 2020 706f 696e  axis=0).    poin
-000033d0: 7473 746f 7265 322e 6669 6c65 6f62 6a5b  tstore2.fileobj[
-000033e0: 2770 6f69 6e74 7327 5d5b 3a5d 203d 2070  'points'][:] = p
-000033f0: 6f69 6e74 7332 0a20 2020 2070 6f69 6e74  oints2.    point
-00003400: 7374 6f72 6532 2e63 6c6f 7365 2829 0a20  store2.close(). 
-00003410: 2020 2064 656c 2070 6f69 6e74 7374 6f72     del pointstor
-00003420: 6532 0a0a 2020 2020 6f73 2e72 6570 6c61  e2..    os.repla
-00003430: 6365 2866 696c 6570 6174 6832 2c20 6669  ce(filepath2, fi
-00003440: 6c65 7061 7468 290a 0a0a 6465 6620 5f75  lepath)...def _u
-00003450: 7064 6174 655f 7265 6769 6f6e 5f62 6f6f  pdate_region_boo
-00003460: 7473 7472 6170 2872 6567 696f 6e2c 206e  tstrap(region, n
-00003470: 626f 6f74 7374 7261 7073 2c20 6d69 6e76  bootstraps, minv
-00003480: 6f6c 3d30 2e2c 2063 6f6d 6d3d 4e6f 6e65  ol=0., comm=None
-00003490: 2c20 6d70 695f 7369 7a65 3d31 293a 0a20  , mpi_size=1):. 
-000034a0: 2020 2022 2222 0a20 2020 2055 7064 6174     """.    Updat
-000034b0: 6520 2a72 6567 696f 6e2a 2077 6974 6820  e *region* with 
-000034c0: 2a6e 626f 6f74 7374 7261 7073 2a20 726f  *nbootstraps* ro
-000034d0: 756e 6473 206f 6620 6578 636c 7564 696e  unds of excludin
-000034e0: 6720 706f 696e 7473 2072 616e 646f 6d6c  g points randoml
-000034f0: 792e 0a0a 2020 2020 5374 6966 6665 6e20  y...    Stiffen 
-00003500: 656c 6c69 7073 6f69 6420 7369 7a65 2075  ellipsoid size u
-00003510: 7369 6e67 2074 6865 206d 696e 696d 756d  sing the minimum
-00003520: 2076 6f6c 756d 6520 2a6d 696e 766f 6c2a   volume *minvol*
-00003530: 2e0a 0a20 2020 2049 6620 7468 6520 6d70  ...    If the mp
-00003540: 6920 636f 6d6d 756e 6963 6174 6f72 202a  i communicator *
-00003550: 636f 6d6d 2a20 6973 206e 6f74 204e 6f6e  comm* is not Non
-00003560: 652c 2075 7365 204d 5049 2074 6f20 6469  e, use MPI to di
-00003570: 7374 7269 6275 7465 0a20 2020 2074 6865  stribute.    the
-00003580: 2062 6f6f 7473 7472 6170 7320 6f76 6572   bootstraps over
-00003590: 2074 6865 202a 6d70 695f 7369 7a65 2a20   the *mpi_size* 
-000035a0: 7072 6f63 6573 7365 732e 0a20 2020 2022  processes..    "
-000035b0: 2222 0a20 2020 2061 7373 6572 7420 6e62  "".    assert nb
-000035c0: 6f6f 7473 7472 6170 7320 3e20 302c 206e  ootstraps > 0, n
-000035d0: 626f 6f74 7374 7261 7073 0a20 2020 2023  bootstraps.    #
-000035e0: 2063 6174 6368 2070 6f74 656e 7469 616c   catch potential
-000035f0: 2065 7272 6f72 7320 736f 204d 5049 2073   errors so MPI s
-00003600: 796e 6369 6e67 2073 7469 6c6c 2077 6f72  yncing still wor
-00003610: 6b73 0a20 2020 2065 203d 204e 6f6e 650a  ks.    e = None.
-00003620: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00003630: 2072 2c20 6620 3d20 7265 6769 6f6e 2e63   r, f = region.c
-00003640: 6f6d 7075 7465 5f65 6e6c 6172 6765 6d65  ompute_enlargeme
-00003650: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00003660: 6d69 6e76 6f6c 3d6d 696e 766f 6c2c 0a20  minvol=minvol,. 
-00003670: 2020 2020 2020 2020 2020 206e 626f 6f74             nboot
-00003680: 7374 7261 7073 3d6d 6178 2831 2c20 6e62  straps=max(1, nb
-00003690: 6f6f 7473 7472 6170 7320 2f2f 206d 7069  ootstraps // mpi
-000036a0: 5f73 697a 6529 290a 2020 2020 6578 6365  _size)).    exce
-000036b0: 7074 206e 702e 6c69 6e61 6c67 2e4c 696e  pt np.linalg.Lin
-000036c0: 416c 6745 7272 6f72 2061 7320 6531 3a0a  AlgError as e1:.
-000036d0: 2020 2020 2020 2020 6520 3d20 6531 0a20          e = e1. 
-000036e0: 2020 2020 2020 2072 2c20 6620 3d20 6e70         r, f = np
-000036f0: 2e6e 616e 2c20 6e70 2e6e 616e 0a0a 2020  .nan, np.nan..  
-00003700: 2020 6966 2063 6f6d 6d20 6973 206e 6f74    if comm is not
-00003710: 204e 6f6e 653a 0a20 2020 2020 2020 2072   None:.        r
-00003720: 6563 765f 6d61 7872 6164 6969 203d 2063  ecv_maxradii = c
-00003730: 6f6d 6d2e 6761 7468 6572 2872 2c20 726f  omm.gather(r, ro
-00003740: 6f74 3d30 290a 2020 2020 2020 2020 7265  ot=0).        re
-00003750: 6376 5f6d 6178 7261 6469 6920 3d20 636f  cv_maxradii = co
-00003760: 6d6d 2e62 6361 7374 2872 6563 765f 6d61  mm.bcast(recv_ma
-00003770: 7872 6164 6969 2c20 726f 6f74 3d30 290a  xradii, root=0).
-00003780: 2020 2020 2020 2020 2320 6966 2074 6865          # if the
-00003790: 7265 2061 7265 2076 6572 7920 6d61 6e79  re are very many
-000037a0: 2070 726f 6365 7373 6f72 732c 2077 6520   processors, we 
-000037b0: 6d61 7920 6861 7665 206d 6f72 650a 2020  may have more.  
-000037c0: 2020 2020 2020 2320 726f 756e 6473 2074        # rounds t
-000037d0: 6861 6e20 7265 7175 6573 7465 642c 206c  han requested, l
-000037e0: 6561 6469 6e67 2074 6f20 736c 6f77 646f  eading to slowdo
-000037f0: 776e 0a20 2020 2020 2020 2023 2074 6875  wn.        # thu
-00003800: 7320 7765 2074 6872 6f77 2061 7761 7920  s we throw away 
-00003810: 7468 6520 6578 7472 6120 6f6e 6573 0a20  the extra ones. 
-00003820: 2020 2020 2020 2072 203d 206e 702e 6d61         r = np.ma
-00003830: 7828 7265 6376 5f6d 6178 7261 6469 695b  x(recv_maxradii[
-00003840: 3a6e 626f 6f74 7374 7261 7073 5d29 0a20  :nbootstraps]). 
-00003850: 2020 2020 2020 2072 6563 765f 656e 6c61         recv_enla
-00003860: 7267 6520 3d20 636f 6d6d 2e67 6174 6865  rge = comm.gathe
-00003870: 7228 662c 2072 6f6f 743d 3029 0a20 2020  r(f, root=0).   
-00003880: 2020 2020 2072 6563 765f 656e 6c61 7267       recv_enlarg
-00003890: 6520 3d20 636f 6d6d 2e62 6361 7374 2872  e = comm.bcast(r
-000038a0: 6563 765f 656e 6c61 7267 652c 2072 6f6f  ecv_enlarge, roo
-000038b0: 743d 3029 0a20 2020 2020 2020 2066 203d  t=0).        f =
-000038c0: 206e 702e 6d61 7828 7265 6376 5f65 6e6c   np.max(recv_enl
-000038d0: 6172 6765 5b3a 6e62 6f6f 7473 7472 6170  arge[:nbootstrap
-000038e0: 735d 290a 0a20 2020 2069 6620 6e6f 7420  s])..    if not 
-000038f0: 6e70 2e69 7366 696e 6974 6528 7229 2061  np.isfinite(r) a
-00003900: 6e64 206e 6f74 206e 702e 6973 6669 6e69  nd not np.isfini
-00003910: 7465 2872 293a 0a20 2020 2020 2020 2023  te(r):.        #
-00003920: 2072 6572 6169 7365 2065 7272 6f72 2069   reraise error i
-00003930: 6620 6e65 6564 6564 0a20 2020 2020 2020  f needed.       
-00003940: 2069 6620 6520 6973 204e 6f6e 653a 0a20   if e is None:. 
-00003950: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00003960: 206e 702e 6c69 6e61 6c67 2e4c 696e 416c   np.linalg.LinAl
-00003970: 6745 7272 6f72 2822 636f 6d70 7574 655f  gError("compute_
-00003980: 656e 6c61 7267 656d 656e 7420 6661 696c  enlargement fail
-00003990: 6564 2229 0a20 2020 2020 2020 2065 6c73  ed").        els
-000039a0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000039b0: 6169 7365 2065 0a0a 2020 2020 7265 6769  aise e..    regi
-000039c0: 6f6e 2e6d 6178 7261 6469 7573 7371 203d  on.maxradiussq =
-000039d0: 2072 0a20 2020 2072 6567 696f 6e2e 656e   r.    region.en
-000039e0: 6c61 7267 6520 3d20 660a 2020 2020 7265  large = f.    re
-000039f0: 7475 726e 2072 2c20 660a 0a0a 636c 6173  turn r, f...clas
-00003a00: 7320 4e65 7374 6564 5361 6d70 6c65 7228  s NestedSampler(
-00003a10: 6f62 6a65 6374 293a 0a20 2020 2022 2222  object):.    """
-00003a20: 5369 6d70 6c65 204e 6573 7465 6420 7361  Simple Nested sa
-00003a30: 6d70 6c65 7220 666f 7220 7265 6665 7265  mpler for refere
-00003a40: 6e63 652e 2222 220a 0a20 2020 2064 6566  nce."""..    def
-00003a50: 205f 5f69 6e69 745f 5f28 7365 6c66 2c0a   __init__(self,.
-00003a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a70: 2070 6172 616d 5f6e 616d 6573 2c0a 2020   param_names,.  
-00003a80: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00003a90: 6f67 6c69 6b65 2c0a 2020 2020 2020 2020  oglike,.        
-00003aa0: 2020 2020 2020 2020 2074 7261 6e73 666f           transfo
-00003ab0: 726d 3d4e 6f6e 652c 0a20 2020 2020 2020  rm=None,.       
-00003ac0: 2020 2020 2020 2020 2020 6465 7269 7665            derive
-00003ad0: 645f 7061 7261 6d5f 6e61 6d65 733d 5b5d  d_param_names=[]
-00003ae0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00003af0: 2020 2072 6573 756d 653d 2773 7562 666f     resume='subfo
-00003b00: 6c64 6572 272c 0a20 2020 2020 2020 2020  lder',.         
-00003b10: 2020 2020 2020 2020 7275 6e5f 6e75 6d3d          run_num=
-00003b20: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00003b30: 2020 2020 2020 206c 6f67 5f64 6972 3d27         log_dir='
-00003b40: 6c6f 6773 2f74 6573 7427 2c0a 2020 2020  logs/test',.    
-00003b50: 2020 2020 2020 2020 2020 2020 206e 756d               num
-00003b60: 5f6c 6976 655f 706f 696e 7473 3d31 3030  _live_points=100
-00003b70: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-00003b80: 2020 2020 7665 6374 6f72 697a 6564 3d46      vectorized=F
-00003b90: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00003ba0: 2020 2020 2020 2077 7261 7070 6564 5f70         wrapped_p
-00003bb0: 6172 616d 733d 5b5d 2c0a 2020 2020 2020  arams=[],.      
-00003bc0: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-00003bd0: 2020 2020 2020 2222 2253 6574 2075 7020        """Set up 
-00003be0: 6e65 7374 6564 2073 616d 706c 6572 2e0a  nested sampler..
-00003bf0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
-00003c00: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
-00003c10: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00003c20: 7061 7261 6d5f 6e61 6d65 733a 206c 6973  param_names: lis
-00003c30: 7420 6f66 2073 7472 2c20 6e61 6d65 7320  t of str, names 
-00003c40: 6f66 2074 6865 2070 6172 616d 6574 6572  of the parameter
-00003c50: 732e 0a20 2020 2020 2020 2020 2020 204c  s..            L
-00003c60: 656e 6774 6820 6769 7665 7320 6469 6d65  ength gives dime
-00003c70: 6e73 696f 6e61 6c69 7479 206f 6620 7468  nsionality of th
-00003c80: 6520 7361 6d70 6c69 6e67 2070 726f 626c  e sampling probl
-00003c90: 656d 2e0a 2020 2020 2020 2020 6c6f 676c  em..        logl
-00003ca0: 696b 653a 2066 756e 6374 696f 6e0a 2020  ike: function.  
-00003cb0: 2020 2020 2020 2020 2020 6c6f 672d 6c69            log-li
-00003cc0: 6b65 6c69 686f 6f64 2066 756e 6374 696f  kelihood functio
-00003cd0: 6e2e 0a20 2020 2020 2020 2020 2020 2052  n..            R
-00003ce0: 6563 6569 7665 7320 6d75 6c74 6970 6c65  eceives multiple
-00003cf0: 2070 6172 616d 6574 6572 2076 6563 746f   parameter vecto
-00003d00: 7273 2c20 7265 7475 726e 7320 7665 6374  rs, returns vect
-00003d10: 6f72 206f 6620 6c69 6b65 6c69 686f 6f64  or of likelihood
-00003d20: 2e0a 2020 2020 2020 2020 7472 616e 7366  ..        transf
-00003d30: 6f72 6d3a 2066 756e 6374 696f 6e0a 2020  orm: function.  
-00003d40: 2020 2020 2020 2020 2020 7061 7261 6d65            parame
-00003d50: 7465 7220 7472 616e 7366 6f72 6d20 6672  ter transform fr
-00003d60: 6f6d 2075 6e69 7420 6375 6265 2074 6f20  om unit cube to 
-00003d70: 7068 7973 6963 616c 2070 6172 616d 6574  physical paramet
-00003d80: 6572 732e 0a20 2020 2020 2020 2020 2020  ers..           
-00003d90: 2052 6563 6569 7665 7320 6d75 6c74 6970   Receives multip
-00003da0: 6c65 2063 7562 6520 7665 6374 6f72 732c  le cube vectors,
-00003db0: 2072 6574 7572 6e73 206d 756c 7469 706c   returns multipl
-00003dc0: 6520 7061 7261 6d65 7465 7220 7665 6374  e parameter vect
-00003dd0: 6f72 732e 0a20 2020 2020 2020 2064 6572  ors..        der
-00003de0: 6976 6564 5f70 6172 616d 5f6e 616d 6573  ived_param_names
-00003df0: 3a20 6c69 7374 206f 6620 7374 720a 2020  : list of str.  
-00003e00: 2020 2020 2020 2020 2020 4164 6469 7469            Additi
-00003e10: 6f6e 616c 2064 6572 6976 6564 2070 6172  onal derived par
-00003e20: 616d 6574 6572 7320 6372 6561 7465 6420  ameters created 
-00003e30: 6279 2074 7261 6e73 666f 726d 2e20 2865  by transform. (e
-00003e40: 6d70 7479 2062 7920 6465 6661 756c 7429  mpty by default)
-00003e50: 0a20 2020 2020 2020 206c 6f67 5f64 6972  .        log_dir
-00003e60: 3a20 7374 720a 2020 2020 2020 2020 2020  : str.          
-00003e70: 2020 7768 6572 6520 746f 2073 746f 7265    where to store
-00003e80: 206f 7574 7075 7420 6669 6c65 730a 2020   output files.  
-00003e90: 2020 2020 2020 7265 7375 6d65 3a20 2772        resume: 'r
-00003ea0: 6573 756d 6527 2c20 276f 7665 7277 7269  esume', 'overwri
-00003eb0: 7465 2720 6f72 2027 7375 6266 6f6c 6465  te' or 'subfolde
-00003ec0: 7227 0a20 2020 2020 2020 2020 2020 2069  r'.            i
-00003ed0: 6620 276f 7665 7277 7269 7465 272c 206f  f 'overwrite', o
-00003ee0: 7665 7277 7269 7465 2070 7265 7669 6f75  verwrite previou
-00003ef0: 7320 6461 7461 2e0a 2020 2020 2020 2020  s data..        
-00003f00: 2020 2020 6966 2027 7375 6266 6f6c 6465      if 'subfolde
-00003f10: 7227 2c20 6372 6561 7465 2061 2066 7265  r', create a fre
-00003f20: 7368 2073 7562 6469 7265 6374 6f72 7920  sh subdirectory 
-00003f30: 696e 206c 6f67 5f64 6972 2e0a 2020 2020  in log_dir..    
-00003f40: 2020 2020 2020 2020 6966 2027 7265 7375          if 'resu
-00003f50: 6d65 2720 6f72 2054 7275 652c 2063 6f6e  me' or True, con
-00003f60: 7469 6e75 6520 7072 6576 696f 7573 2072  tinue previous r
-00003f70: 756e 2069 6620 6176 6169 6c61 626c 652e  un if available.
-00003f80: 0a20 2020 2020 2020 2077 7261 7070 6564  .        wrapped
-00003f90: 5f70 6172 616d 733a 206c 6973 7420 6f66  _params: list of
-00003fa0: 2062 6f6f 6c73 0a20 2020 2020 2020 2020   bools.         
-00003fb0: 2020 2069 6e64 6963 6174 696e 6720 7768     indicating wh
-00003fc0: 6574 6865 7220 7468 6973 2070 6172 616d  ether this param
-00003fd0: 6574 6572 2077 7261 7073 2061 726f 756e  eter wraps aroun
-00003fe0: 6420 2863 6972 6375 6c61 7220 7061 7261  d (circular para
-00003ff0: 6d65 7465 7229 2e0a 2020 2020 2020 2020  meter)..        
-00004000: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 733a  num_live_points:
-00004010: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-00004020: 204e 756d 6265 7220 6f66 206c 6976 6520   Number of live 
-00004030: 706f 696e 7473 0a20 2020 2020 2020 2076  points.        v
-00004040: 6563 746f 7269 7a65 643a 2062 6f6f 6c0a  ectorized: bool.
-00004050: 2020 2020 2020 2020 2020 2020 4966 2074              If t
-00004060: 7275 652c 206c 6f67 6c69 6b65 2061 6e64  rue, loglike and
-00004070: 2074 7261 6e73 666f 726d 2066 756e 6374   transform funct
-00004080: 696f 6e20 6361 6e20 7265 6365 6976 6520  ion can receive 
-00004090: 6172 7261 7973 0a20 2020 2020 2020 2020  arrays.         
-000040a0: 2020 206f 6620 706f 696e 7473 2e0a 2020     of points..  
-000040b0: 2020 2020 2020 7275 6e5f 6e75 6d3a 2069        run_num: i
-000040c0: 6e74 0a20 2020 2020 2020 2020 2020 2075  nt.            u
-000040d0: 6e69 7175 6520 7275 6e20 6e75 6d62 6572  nique run number
-000040e0: 2e20 4966 204e 6f6e 652c 2077 696c 6c20  . If None, will 
-000040f0: 6265 2061 7574 6f6d 6174 6963 616c 6c79  be automatically
-00004100: 2069 6e63 7265 6d65 6e74 6564 2e0a 0a20   incremented... 
-00004110: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00004120: 2020 2073 656c 662e 7061 7261 6d6e 616d     self.paramnam
-00004130: 6573 203d 2070 6172 616d 5f6e 616d 6573  es = param_names
-00004140: 0a20 2020 2020 2020 2078 5f64 696d 203d  .        x_dim =
-00004150: 206c 656e 2873 656c 662e 7061 7261 6d6e   len(self.paramn
-00004160: 616d 6573 290a 2020 2020 2020 2020 7365  ames).        se
-00004170: 6c66 2e6e 756d 5f6c 6976 655f 706f 696e  lf.num_live_poin
-00004180: 7473 203d 206e 756d 5f6c 6976 655f 706f  ts = num_live_po
-00004190: 696e 7473 0a20 2020 2020 2020 2073 656c  ints.        sel
-000041a0: 662e 7361 6d70 6c65 7220 3d20 276e 6573  f.sampler = 'nes
-000041b0: 7465 6427 0a20 2020 2020 2020 2073 656c  ted'.        sel
-000041c0: 662e 785f 6469 6d20 3d20 785f 6469 6d0a  f.x_dim = x_dim.
-000041d0: 2020 2020 2020 2020 7365 6c66 2e64 6572          self.der
-000041e0: 6976 6564 7061 7261 6d6e 616d 6573 203d  ivedparamnames =
-000041f0: 2064 6572 6976 6564 5f70 6172 616d 5f6e   derived_param_n
-00004200: 616d 6573 0a20 2020 2020 2020 206e 756d  ames.        num
-00004210: 5f64 6572 6976 6564 203d 206c 656e 2873  _derived = len(s
-00004220: 656c 662e 6465 7269 7665 6470 6172 616d  elf.derivedparam
-00004230: 6e61 6d65 7329 0a20 2020 2020 2020 2073  names).        s
-00004240: 656c 662e 6e75 6d5f 7061 7261 6d73 203d  elf.num_params =
-00004250: 2078 5f64 696d 202b 206e 756d 5f64 6572   x_dim + num_der
-00004260: 6976 6564 0a20 2020 2020 2020 2073 656c  ived.        sel
-00004270: 662e 766f 6c66 6163 746f 7220 3d20 766f  f.volfactor = vo
-00004280: 6c5f 7072 6566 6163 746f 7228 7365 6c66  l_prefactor(self
-00004290: 2e78 5f64 696d 290a 2020 2020 2020 2020  .x_dim).        
-000042a0: 6966 2077 7261 7070 6564 5f70 6172 616d  if wrapped_param
-000042b0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-000042c0: 2020 2020 2020 2073 656c 662e 7772 6170         self.wrap
-000042d0: 7065 645f 6178 6573 203d 205b 5d0a 2020  ped_axes = [].  
-000042e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000042f0: 2020 2020 2020 2020 7365 6c66 2e77 7261          self.wra
-00004300: 7070 6564 5f61 7865 7320 3d20 6e70 2e77  pped_axes = np.w
-00004310: 6865 7265 2877 7261 7070 6564 5f70 6172  here(wrapped_par
-00004320: 616d 7329 5b30 5d0a 0a20 2020 2020 2020  ams)[0]..       
-00004330: 2061 7373 6572 7420 7265 7375 6d65 206f   assert resume o
-00004340: 7220 7265 7375 6d65 2069 6e20 2827 6f76  r resume in ('ov
-00004350: 6572 7772 6974 6527 2c20 2773 7562 666f  erwrite', 'subfo
-00004360: 6c64 6572 272c 2027 7265 7375 6d65 2729  lder', 'resume')
-00004370: 2c20 2272 6573 756d 6520 7368 6f75 6c64  , "resume should
-00004380: 2062 6520 6f6e 6520 6f66 2027 6f76 6572   be one of 'over
-00004390: 7772 6974 6527 2027 7375 6266 6f6c 6465  write' 'subfolde
-000043a0: 7227 206f 7220 2772 6573 756d 6527 220a  r' or 'resume'".
-000043b0: 2020 2020 2020 2020 6170 7065 6e64 5f72          append_r
-000043c0: 756e 5f6e 756d 203d 2072 6573 756d 6520  un_num = resume 
-000043d0: 3d3d 2027 7375 6266 6f6c 6465 7227 0a20  == 'subfolder'. 
-000043e0: 2020 2020 2020 2072 6573 756d 6520 3d20         resume = 
-000043f0: 7265 7375 6d65 203d 3d20 2772 6573 756d  resume == 'resum
-00004400: 6527 206f 7220 7265 7375 6d65 0a0a 2020  e' or resume..  
-00004410: 2020 2020 2020 6966 206e 6f74 2076 6563        if not vec
-00004420: 746f 7269 7a65 643a 0a20 2020 2020 2020  torized:.       
-00004430: 2020 2020 2074 7261 6e73 666f 726d 203d       transform =
-00004440: 2076 6563 746f 7269 7a65 2874 7261 6e73   vectorize(trans
-00004450: 666f 726d 290a 2020 2020 2020 2020 2020  form).          
-00004460: 2020 6c6f 676c 696b 6520 3d20 7665 6374    loglike = vect
-00004470: 6f72 697a 6528 6c6f 676c 696b 6529 0a0a  orize(loglike)..
-00004480: 2020 2020 2020 2020 6966 2074 7261 6e73          if trans
-00004490: 666f 726d 2069 7320 4e6f 6e65 3a0a 2020  form is None:.  
-000044a0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-000044b0: 7261 6e73 666f 726d 203d 206c 616d 6264  ransform = lambd
-000044c0: 6120 783a 2078 0a20 2020 2020 2020 2065  a x: x.        e
-000044d0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000044e0: 2073 656c 662e 7472 616e 7366 6f72 6d20   self.transform 
-000044f0: 3d20 7472 616e 7366 6f72 6d0a 0a20 2020  = transform..   
-00004500: 2020 2020 2075 203d 206e 702e 7261 6e64       u = np.rand
-00004510: 6f6d 2e75 6e69 666f 726d 2873 697a 653d  om.uniform(size=
-00004520: 2832 2c20 7365 6c66 2e78 5f64 696d 2929  (2, self.x_dim))
-00004530: 0a20 2020 2020 2020 2070 203d 2073 656c  .        p = sel
-00004540: 662e 7472 616e 7366 6f72 6d28 7529 0a20  f.transform(u). 
-00004550: 2020 2020 2020 2061 7373 6572 7420 702e         assert p.
-00004560: 7368 6170 6520 3d3d 2028 322c 2073 656c  shape == (2, sel
-00004570: 662e 6e75 6d5f 7061 7261 6d73 292c 2028  f.num_params), (
-00004580: 2245 7272 6f72 2069 6e20 7472 616e 7366  "Error in transf
-00004590: 6f72 6d20 6675 6e63 7469 6f6e 3a20 7265  orm function: re
-000045a0: 7475 726e 6564 2073 6861 7065 2069 7320  turned shape is 
-000045b0: 2573 2c20 6578 7065 6374 6564 2025 7322  %s, expected %s"
-000045c0: 2025 2028 702e 7368 6170 652c 2028 322c   % (p.shape, (2,
-000045d0: 2073 656c 662e 6e75 6d5f 7061 7261 6d73   self.num_params
-000045e0: 2929 290a 2020 2020 2020 2020 6c6f 676c  ))).        logl
-000045f0: 203d 206c 6f67 6c69 6b65 2870 290a 2020   = loglike(p).  
-00004600: 2020 2020 2020 6173 7365 7274 206e 702e        assert np.
-00004610: 6c6f 6769 6361 6c5f 616e 6428 7520 3e20  logical_and(u > 
-00004620: 302c 2075 203c 2031 292e 616c 6c28 292c  0, u < 1).all(),
-00004630: 2028 2245 7272 6f72 2069 6e20 7472 616e   ("Error in tran
-00004640: 7366 6f72 6d20 6675 6e63 7469 6f6e 3a20  sform function: 
-00004650: 7520 7761 7320 6d6f 6469 6669 6564 2122  u was modified!"
-00004660: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-00004670: 206e 702e 7368 6170 6528 6c6f 676c 2920   np.shape(logl) 
-00004680: 3d3d 2028 322c 292c 2028 2245 7272 6f72  == (2,), ("Error
-00004690: 2069 6e20 6c6f 676c 696b 656c 6968 6f6f   in loglikelihoo
-000046a0: 6420 6675 6e63 7469 6f6e 3a20 7265 7475  d function: retu
-000046b0: 726e 6564 2073 6861 7065 2069 7320 2573  rned shape is %s
-000046c0: 2c20 6578 7065 6374 6564 2025 7322 2025  , expected %s" %
-000046d0: 2028 702e 7368 6170 652c 2028 322c 2073   (p.shape, (2, s
-000046e0: 656c 662e 6e75 6d5f 7061 7261 6d73 2929  elf.num_params))
-000046f0: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
-00004700: 206e 702e 6973 6669 6e69 7465 286c 6f67   np.isfinite(log
-00004710: 6c29 2e61 6c6c 2829 2c20 2822 4572 726f  l).all(), ("Erro
-00004720: 7220 696e 206c 6f67 6c69 6b65 6c69 686f  r in loglikeliho
-00004730: 6f64 2066 756e 6374 696f 6e3a 2072 6574  od function: ret
-00004740: 7572 6e65 6420 6e6f 6e2d 6669 6e69 7465  urned non-finite
-00004750: 206e 756d 6265 723a 2025 7320 666f 7220   number: %s for 
-00004760: 696e 7075 7420 753d 2573 2070 3d25 7322  input u=%s p=%s"
-00004770: 2025 2028 6c6f 676c 2c20 752c 2070 2929   % (logl, u, p))
-00004780: 0a0a 2020 2020 2020 2020 6465 6620 7361  ..        def sa
-00004790: 6665 5f6c 6f67 6c69 6b65 2878 293a 0a20  fe_loglike(x):. 
-000047a0: 2020 2020 2020 2020 2020 2022 2222 4361             """Ca
-000047b0: 6c6c 206c 696b 656c 6968 6f6f 6420 6675  ll likelihood fu
-000047c0: 6e63 7469 6f6e 2073 6166 656c 7920 7772  nction safely wr
-000047d0: 6170 7065 6420 746f 2061 766f 6964 206e  apped to avoid n
-000047e0: 6f6e 2d66 696e 6974 6520 7661 6c75 6573  on-finite values
-000047f0: 2e22 2222 0a20 2020 2020 2020 2020 2020  .""".           
-00004800: 2078 203d 206e 702e 6173 6172 7261 7928   x = np.asarray(
-00004810: 7829 0a20 2020 2020 2020 2020 2020 206c  x).            l
-00004820: 6f67 6c20 3d20 6c6f 676c 696b 6528 7829  ogl = loglike(x)
-00004830: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-00004840: 6572 7420 6e70 2e69 7366 696e 6974 6528  ert np.isfinite(
-00004850: 6c6f 676c 292e 616c 6c28 292c 2028 0a20  logl).all(), (. 
-00004860: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00004870: 5573 6572 2d70 726f 7669 6465 6420 6c6f  User-provided lo
-00004880: 676c 696b 656c 6968 6f6f 6420 7265 7475  glikelihood retu
-00004890: 726e 6564 206e 6f6e 2d66 696e 6974 6520  rned non-finite 
-000048a0: 7661 6c75 653a 272c 0a20 2020 2020 2020  value:',.       
-000048b0: 2020 2020 2020 2020 206c 6f67 6c5b 7e6e           logl[~n
-000048c0: 702e 6973 6669 6e69 7465 286c 6f67 6c29  p.isfinite(logl)
-000048d0: 5d5b 305d 2c0a 2020 2020 2020 2020 2020  ][0],.          
-000048e0: 2020 2020 2020 2266 6f72 2069 6e70 7574        "for input
-000048f0: 2076 616c 7565 3a22 2c0a 2020 2020 2020   value:",.      
-00004900: 2020 2020 2020 2020 2020 785b 7e6e 702e            x[~np.
-00004910: 6973 6669 6e69 7465 286c 6f67 6c29 2c3a  isfinite(logl),:
-00004920: 5d5b 302c 3a5d 290a 2020 2020 2020 2020  ][0,:]).        
-00004930: 2020 2020 7265 7475 726e 206c 6f67 6c0a      return logl.
-00004940: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-00004950: 676c 696b 6520 3d20 7361 6665 5f6c 6f67  glike = safe_log
-00004960: 6c69 6b65 0a0a 2020 2020 2020 2020 7365  like..        se
-00004970: 6c66 2e75 7365 5f6d 7069 203d 2046 616c  lf.use_mpi = Fal
-00004980: 7365 0a20 2020 2020 2020 2074 7279 3a0a  se.        try:.
-00004990: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-000049a0: 206d 7069 3470 7920 696d 706f 7274 204d   mpi4py import M
-000049b0: 5049 0a20 2020 2020 2020 2020 2020 2073  PI.            s
-000049c0: 656c 662e 636f 6d6d 203d 204d 5049 2e43  elf.comm = MPI.C
-000049d0: 4f4d 4d5f 574f 524c 440a 2020 2020 2020  OMM_WORLD.      
-000049e0: 2020 2020 2020 7365 6c66 2e6d 7069 5f73        self.mpi_s
-000049f0: 697a 6520 3d20 7365 6c66 2e63 6f6d 6d2e  ize = self.comm.
-00004a00: 4765 745f 7369 7a65 2829 0a20 2020 2020  Get_size().     
-00004a10: 2020 2020 2020 2073 656c 662e 6d70 695f         self.mpi_
-00004a20: 7261 6e6b 203d 2073 656c 662e 636f 6d6d  rank = self.comm
-00004a30: 2e47 6574 5f72 616e 6b28 290a 2020 2020  .Get_rank().    
-00004a40: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00004a50: 6d70 695f 7369 7a65 203e 2031 3a0a 2020  mpi_size > 1:.  
-00004a60: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00004a70: 6c66 2e75 7365 5f6d 7069 203d 2054 7275  lf.use_mpi = Tru
-00004a80: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00004a90: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00004aa0: 2020 2020 2020 2020 7365 6c66 2e6d 7069          self.mpi
-00004ab0: 5f73 697a 6520 3d20 310a 2020 2020 2020  _size = 1.      
-00004ac0: 2020 2020 2020 7365 6c66 2e6d 7069 5f72        self.mpi_r
-00004ad0: 616e 6b20 3d20 300a 0a20 2020 2020 2020  ank = 0..       
-00004ae0: 2073 656c 662e 6c6f 6720 3d20 7365 6c66   self.log = self
-00004af0: 2e6d 7069 5f72 616e 6b20 3d3d 2030 0a20  .mpi_rank == 0. 
-00004b00: 2020 2020 2020 2073 656c 662e 6c6f 675f         self.log_
-00004b10: 746f 5f64 6973 6b20 3d20 7365 6c66 2e6c  to_disk = self.l
-00004b20: 6f67 2061 6e64 206c 6f67 5f64 6972 2069  og and log_dir i
-00004b30: 7320 6e6f 7420 4e6f 6e65 0a0a 2020 2020  s not None..    
-00004b40: 2020 2020 6966 2073 656c 662e 6c6f 6720      if self.log 
-00004b50: 616e 6420 6c6f 675f 6469 7220 6973 206e  and log_dir is n
-00004b60: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00004b70: 2020 2020 2073 656c 662e 6c6f 6773 203d       self.logs =
-00004b80: 206d 616b 655f 7275 6e5f 6469 7228 6c6f   make_run_dir(lo
-00004b90: 675f 6469 722c 2072 756e 5f6e 756d 2c20  g_dir, run_num, 
-00004ba0: 6170 7065 6e64 5f72 756e 5f6e 756d 3d61  append_run_num=a
-00004bb0: 7070 656e 645f 7275 6e5f 6e75 6d29 0a20  ppend_run_num). 
-00004bc0: 2020 2020 2020 2020 2020 206c 6f67 5f64             log_d
-00004bd0: 6972 203d 2073 656c 662e 6c6f 6773 5b27  ir = self.logs['
-00004be0: 7275 6e5f 6469 7227 5d0a 2020 2020 2020  run_dir'].      
-00004bf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00004c00: 2020 2020 6c6f 675f 6469 7220 3d20 4e6f      log_dir = No
-00004c10: 6e65 0a0a 2020 2020 2020 2020 7365 6c66  ne..        self
-00004c20: 2e6c 6f67 6765 7220 3d20 6372 6561 7465  .logger = create
-00004c30: 5f6c 6f67 6765 7228 5f5f 6e61 6d65 5f5f  _logger(__name__
-00004c40: 202b 2027 2e27 202b 2074 7970 6528 7365   + '.' + type(se
-00004c50: 6c66 292e 5f5f 6e61 6d65 5f5f 2c20 6c6f  lf).__name__, lo
-00004c60: 675f 6469 723d 6c6f 675f 6469 7229 0a0a  g_dir=log_dir)..
-00004c70: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00004c80: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
-00004c90: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
-00004ca0: 6f28 274e 756d 206c 6976 6520 706f 696e  o('Num live poin
-00004cb0: 7473 205b 2564 5d27 2c20 7365 6c66 2e6e  ts [%d]', self.n
-00004cc0: 756d 5f6c 6976 655f 706f 696e 7473 290a  um_live_points).
-00004cd0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00004ce0: 2e6c 6f67 5f74 6f5f 6469 736b 3a0a 2020  .log_to_disk:.  
-00004cf0: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
-00004d00: 2e70 6f69 6e74 7374 6f72 6520 3d20 5465  .pointstore = Te
-00004d10: 7874 506f 696e 7453 746f 7265 286f 732e  xtPointStore(os.
-00004d20: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e6c  path.join(self.l
-00004d30: 6f67 735b 2772 6573 756c 7473 275d 2c20  ogs['results'], 
-00004d40: 2770 6f69 6e74 732e 7473 7627 292c 2032  'points.tsv'), 2
-00004d50: 202b 2073 656c 662e 785f 6469 6d20 2b20   + self.x_dim + 
-00004d60: 7365 6c66 2e6e 756d 5f70 6172 616d 7329  self.num_params)
-00004d70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00004d80: 662e 706f 696e 7473 746f 7265 203d 2048  f.pointstore = H
-00004d90: 4446 3550 6f69 6e74 5374 6f72 6528 0a20  DF5PointStore(. 
-00004da0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00004db0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-00004dc0: 2e6c 6f67 735b 2772 6573 756c 7473 275d  .logs['results']
-00004dd0: 2c20 2770 6f69 6e74 732e 6864 6635 2729  , 'points.hdf5')
-00004de0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004df0: 2020 3320 2b20 7365 6c66 2e78 5f64 696d    3 + self.x_dim
-00004e00: 202b 2073 656c 662e 6e75 6d5f 7061 7261   + self.num_para
-00004e10: 6d73 2c20 6d6f 6465 3d27 6127 2069 6620  ms, mode='a' if 
-00004e20: 7265 7375 6d65 2065 6c73 6520 2777 2729  resume else 'w')
-00004e30: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00004e40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004e50: 706f 696e 7473 746f 7265 203d 204e 756c  pointstore = Nul
-00004e60: 6c50 6f69 6e74 5374 6f72 6528 3320 2b20  lPointStore(3 + 
-00004e70: 7365 6c66 2e78 5f64 696d 202b 2073 656c  self.x_dim + sel
-00004e80: 662e 6e75 6d5f 7061 7261 6d73 290a 0a20  f.num_params).. 
-00004e90: 2020 2064 6566 2072 756e 280a 2020 2020     def run(.    
-00004ea0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00004eb0: 2020 2020 2020 2020 2020 7570 6461 7465            update
-00004ec0: 5f69 6e74 6572 7661 6c5f 6974 6572 3d4e  _interval_iter=N
-00004ed0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00004ee0: 2075 7064 6174 655f 696e 7465 7276 616c   update_interval
-00004ef0: 5f6e 6361 6c6c 3d4e 6f6e 652c 0a20 2020  _ncall=None,.   
-00004f00: 2020 2020 2020 2020 206c 6f67 5f69 6e74           log_int
-00004f10: 6572 7661 6c3d 4e6f 6e65 2c0a 2020 2020  erval=None,.    
-00004f20: 2020 2020 2020 2020 646c 6f67 7a3d 302e          dlogz=0.
-00004f30: 3030 312c 0a20 2020 2020 2020 2020 2020  001,.           
-00004f40: 206d 6178 5f69 7465 7273 3d4e 6f6e 6529   max_iters=None)
-00004f50: 3a0a 2020 2020 2020 2020 2222 2245 7870  :.        """Exp
-00004f60: 6c6f 7265 2070 6172 616d 6574 6572 2073  lore parameter s
-00004f70: 7061 6365 2e0a 0a20 2020 2020 2020 2050  pace...        P
-00004f80: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00004f90: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00004fa0: 2020 2020 2075 7064 6174 655f 696e 7465       update_inte
-00004fb0: 7276 616c 5f69 7465 723a 0a20 2020 2020  rval_iter:.     
-00004fc0: 2020 2020 2020 2055 7064 6174 6520 7265         Update re
-00004fd0: 6769 6f6e 2061 6674 6572 2074 6869 7320  gion after this 
-00004fe0: 6d61 6e79 2069 7465 7261 7469 6f6e 732e  many iterations.
-00004ff0: 0a20 2020 2020 2020 2075 7064 6174 655f  .        update_
-00005000: 696e 7465 7276 616c 5f6e 6361 6c6c 3a0a  interval_ncall:.
-00005010: 2020 2020 2020 2020 2020 2020 5570 6461              Upda
-00005020: 7465 2072 6567 696f 6e20 6166 7465 7220  te region after 
-00005030: 7570 6461 7465 5f69 6e74 6572 7661 6c5f  update_interval_
-00005040: 6e63 616c 6c20 6c69 6b65 6c69 686f 6f64  ncall likelihood
-00005050: 2063 616c 6c73 2e0a 2020 2020 2020 2020   calls..        
-00005060: 6c6f 675f 696e 7465 7276 616c 3a0a 2020  log_interval:.  
-00005070: 2020 2020 2020 2020 2020 5570 6461 7465            Update
-00005080: 2073 7464 6f75 7420 7374 6174 7573 206c   stdout status l
-00005090: 696e 6520 6576 6572 7920 6c6f 675f 696e  ine every log_in
-000050a0: 7465 7276 616c 2069 7465 7261 7469 6f6e  terval iteration
-000050b0: 730a 2020 2020 2020 2020 646c 6f67 7a3a  s.        dlogz:
-000050c0: 0a20 2020 2020 2020 2020 2020 2054 6172  .            Tar
-000050d0: 6765 7420 6576 6964 656e 6365 2075 6e63  get evidence unc
-000050e0: 6572 7461 696e 7479 2e0a 2020 2020 2020  ertainty..      
-000050f0: 2020 6d61 785f 6974 6572 733a 0a20 2020    max_iters:.   
-00005100: 2020 2020 2020 2020 206d 6178 696d 756d           maximum
-00005110: 206e 756d 6265 7220 6f66 2069 6e74 6567   number of integ
-00005120: 7261 7469 6f6e 2069 7465 7261 7469 6f6e  ration iteration
-00005130: 732e 0a0a 2020 2020 2020 2020 2222 220a  s...        """.
-00005140: 2020 2020 2020 2020 6966 2075 7064 6174          if updat
-00005150: 655f 696e 7465 7276 616c 5f6e 6361 6c6c  e_interval_ncall
-00005160: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00005170: 2020 2020 2020 7570 6461 7465 5f69 6e74        update_int
-00005180: 6572 7661 6c5f 6e63 616c 6c20 3d20 6d61  erval_ncall = ma
-00005190: 7828 312c 2072 6f75 6e64 2873 656c 662e  x(1, round(self.
-000051a0: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7329  num_live_points)
-000051b0: 290a 0a20 2020 2020 2020 2069 6620 7570  )..        if up
-000051c0: 6461 7465 5f69 6e74 6572 7661 6c5f 6974  date_interval_it
-000051d0: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-000051e0: 2020 2020 2020 2020 6966 2075 7064 6174          if updat
-000051f0: 655f 696e 7465 7276 616c 5f6e 6361 6c6c  e_interval_ncall
-00005200: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00005210: 2020 2020 2020 2075 7064 6174 655f 696e         update_in
-00005220: 7465 7276 616c 5f69 7465 7220 3d20 6d61  terval_iter = ma
-00005230: 7828 312c 2072 6f75 6e64 2873 656c 662e  x(1, round(self.
-00005240: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7329  num_live_points)
-00005250: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00005260: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00005270: 2020 2020 7570 6461 7465 5f69 6e74 6572      update_inter
-00005280: 7661 6c5f 6974 6572 203d 206d 6178 2831  val_iter = max(1
-00005290: 2c20 726f 756e 6428 302e 3220 2a20 7365  , round(0.2 * se
-000052a0: 6c66 2e6e 756d 5f6c 6976 655f 706f 696e  lf.num_live_poin
-000052b0: 7473 2929 0a0a 2020 2020 2020 2020 6966  ts))..        if
-000052c0: 206c 6f67 5f69 6e74 6572 7661 6c20 6973   log_interval is
-000052d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000052e0: 2020 206c 6f67 5f69 6e74 6572 7661 6c20     log_interval 
-000052f0: 3d20 6d61 7828 312c 2072 6f75 6e64 2830  = max(1, round(0
-00005300: 2e32 202a 2073 656c 662e 6e75 6d5f 6c69  .2 * self.num_li
-00005310: 7665 5f70 6f69 6e74 7329 290a 2020 2020  ve_points)).    
-00005320: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00005330: 2020 2020 2020 6c6f 675f 696e 7465 7276        log_interv
-00005340: 616c 203d 2072 6f75 6e64 286c 6f67 5f69  al = round(log_i
-00005350: 6e74 6572 7661 6c29 0a20 2020 2020 2020  nterval).       
-00005360: 2020 2020 2069 6620 6c6f 675f 696e 7465       if log_inte
-00005370: 7276 616c 203c 2031 3a0a 2020 2020 2020  rval < 1:.      
-00005380: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00005390: 5661 6c75 6545 7272 6f72 2822 6c6f 675f  ValueError("log_
-000053a0: 696e 7465 7276 616c 206d 7573 7420 6265  interval must be
-000053b0: 203e 3d20 3122 290a 0a20 2020 2020 2020   >= 1")..       
-000053c0: 2076 697a 5f63 616c 6c62 6163 6b20 3d20   viz_callback = 
-000053d0: 6765 745f 6465 6661 756c 745f 7669 7a5f  get_default_viz_
-000053e0: 6361 6c6c 6261 636b 2829 0a0a 2020 2020  callback()..    
-000053f0: 2020 2020 7072 6576 5f75 203d 205b 5d0a      prev_u = [].
-00005400: 2020 2020 2020 2020 7072 6576 5f76 203d          prev_v =
-00005410: 205b 5d0a 2020 2020 2020 2020 7072 6576   [].        prev
-00005420: 5f6c 6f67 6c20 3d20 5b5d 0a20 2020 2020  _logl = [].     
-00005430: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
-00005440: 2020 2020 2020 2020 2020 2020 2320 7472              # tr
-00005450: 7920 746f 2072 6573 756d 653a 0a20 2020  y to resume:.   
-00005460: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-00005470: 6767 6572 2e69 6e66 6f28 2752 6573 756d  gger.info('Resum
-00005480: 696e 672e 2e2e 2729 0a20 2020 2020 2020  ing...').       
-00005490: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-000054a0: 6e67 6528 7365 6c66 2e6e 756d 5f6c 6976  nge(self.num_liv
-000054b0: 655f 706f 696e 7473 293a 0a20 2020 2020  e_points):.     
-000054c0: 2020 2020 2020 2020 2020 205f 2c20 726f             _, ro
-000054d0: 7720 3d20 7365 6c66 2e70 6f69 6e74 7374  w = self.pointst
-000054e0: 6f72 652e 706f 7028 2d6e 702e 696e 6629  ore.pop(-np.inf)
-000054f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005500: 2069 6620 726f 7720 6973 206e 6f74 204e   if row is not N
-00005510: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00005520: 2020 2020 2020 2020 2070 7265 765f 6c6f           prev_lo
-00005530: 676c 2e61 7070 656e 6428 726f 775b 315d  gl.append(row[1]
-00005540: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005550: 2020 2020 2020 7072 6576 5f75 2e61 7070        prev_u.app
-00005560: 656e 6428 726f 775b 333a 3320 2b20 7365  end(row[3:3 + se
-00005570: 6c66 2e78 5f64 696d 5d29 0a20 2020 2020  lf.x_dim]).     
-00005580: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00005590: 7265 765f 762e 6170 7065 6e64 2872 6f77  rev_v.append(row
-000055a0: 5b33 202b 2073 656c 662e 785f 6469 6d3a  [3 + self.x_dim:
-000055b0: 3320 2b20 7365 6c66 2e78 5f64 696d 202b  3 + self.x_dim +
-000055c0: 2073 656c 662e 6e75 6d5f 7061 7261 6d73   self.num_params
-000055d0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-000055e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000055f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-00005600: 616b 0a0a 2020 2020 2020 2020 2020 2020  ak..            
-00005610: 7072 6576 5f75 203d 206e 702e 6172 7261  prev_u = np.arra
-00005620: 7928 7072 6576 5f75 290a 2020 2020 2020  y(prev_u).      
-00005630: 2020 2020 2020 7072 6576 5f76 203d 206e        prev_v = n
-00005640: 702e 6172 7261 7928 7072 6576 5f76 290a  p.array(prev_v).
-00005650: 2020 2020 2020 2020 2020 2020 7072 6576              prev
-00005660: 5f6c 6f67 6c20 3d20 6e70 2e61 7272 6179  _logl = np.array
-00005670: 2870 7265 765f 6c6f 676c 290a 0a20 2020  (prev_logl)..   
-00005680: 2020 2020 2020 2020 206e 756d 5f6c 6976           num_liv
-00005690: 655f 706f 696e 7473 5f6d 6973 7369 6e67  e_points_missing
-000056a0: 203d 2073 656c 662e 6e75 6d5f 6c69 7665   = self.num_live
-000056b0: 5f70 6f69 6e74 7320 2d20 6c65 6e28 7072  _points - len(pr
-000056c0: 6576 5f6c 6f67 6c29 0a20 2020 2020 2020  ev_logl).       
-000056d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000056e0: 2020 206e 756d 5f6c 6976 655f 706f 696e     num_live_poin
-000056f0: 7473 5f6d 6973 7369 6e67 203d 202d 310a  ts_missing = -1.
-00005700: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00005710: 2e75 7365 5f6d 7069 3a0a 2020 2020 2020  .use_mpi:.      
-00005720: 2020 2020 2020 6e75 6d5f 6c69 7665 5f70        num_live_p
-00005730: 6f69 6e74 735f 6d69 7373 696e 6720 3d20  oints_missing = 
-00005740: 7365 6c66 2e63 6f6d 6d2e 6263 6173 7428  self.comm.bcast(
-00005750: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 735f  num_live_points_
-00005760: 6d69 7373 696e 672c 2072 6f6f 743d 3029  missing, root=0)
-00005770: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00005780: 765f 7520 3d20 7365 6c66 2e63 6f6d 6d2e  v_u = self.comm.
-00005790: 6263 6173 7428 7072 6576 5f75 2c20 726f  bcast(prev_u, ro
-000057a0: 6f74 3d30 290a 2020 2020 2020 2020 2020  ot=0).          
-000057b0: 2020 7072 6576 5f76 203d 2073 656c 662e    prev_v = self.
-000057c0: 636f 6d6d 2e62 6361 7374 2870 7265 765f  comm.bcast(prev_
-000057d0: 762c 2072 6f6f 743d 3029 0a20 2020 2020  v, root=0).     
-000057e0: 2020 2020 2020 2070 7265 765f 6c6f 676c         prev_logl
-000057f0: 203d 2073 656c 662e 636f 6d6d 2e62 6361   = self.comm.bca
-00005800: 7374 2870 7265 765f 6c6f 676c 2c20 726f  st(prev_logl, ro
-00005810: 6f74 3d30 290a 0a20 2020 2020 2020 2075  ot=0)..        u
-00005820: 7365 5f70 6f69 6e74 5f73 7461 636b 203d  se_point_stack =
-00005830: 2054 7275 650a 0a20 2020 2020 2020 2061   True..        a
-00005840: 7373 6572 7420 6e75 6d5f 6c69 7665 5f70  ssert num_live_p
-00005850: 6f69 6e74 735f 6d69 7373 696e 6720 3e3d  oints_missing >=
-00005860: 2030 0a20 2020 2020 2020 2069 6620 6e75   0.        if nu
-00005870: 6d5f 6c69 7665 5f70 6f69 6e74 735f 6d69  m_live_points_mi
-00005880: 7373 696e 6720 3e20 303a 0a20 2020 2020  ssing > 0:.     
-00005890: 2020 2020 2020 2069 6620 7365 6c66 2e75         if self.u
-000058a0: 7365 5f6d 7069 3a0a 2020 2020 2020 2020  se_mpi:.        
-000058b0: 2020 2020 2020 2020 2320 7365 6c66 2e6c          # self.l
-000058c0: 6f67 6765 722e 696e 666f 2827 5573 696e  ogger.info('Usin
-000058d0: 6720 4d50 4920 7769 7468 2072 616e 6b20  g MPI with rank 
-000058e0: 5b25 645d 272c 2073 656c 662e 6d70 695f  [%d]', self.mpi_
-000058f0: 7261 6e6b 290a 2020 2020 2020 2020 2020  rank).          
-00005900: 2020 2020 2020 6966 2073 656c 662e 6d70        if self.mp
-00005910: 695f 7261 6e6b 203d 3d20 303a 0a20 2020  i_rank == 0:.   
-00005920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005930: 2061 6374 6976 655f 7520 3d20 6e70 2e72   active_u = np.r
-00005940: 616e 646f 6d2e 756e 6966 6f72 6d28 7369  andom.uniform(si
-00005950: 7a65 3d28 6e75 6d5f 6c69 7665 5f70 6f69  ze=(num_live_poi
-00005960: 6e74 735f 6d69 7373 696e 672c 2073 656c  nts_missing, sel
-00005970: 662e 785f 6469 6d29 290a 2020 2020 2020  f.x_dim)).      
-00005980: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00005990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059a0: 2020 2020 6163 7469 7665 5f75 203d 206e      active_u = n
-000059b0: 702e 656d 7074 7928 286e 756d 5f6c 6976  p.empty((num_liv
-000059c0: 655f 706f 696e 7473 5f6d 6973 7369 6e67  e_points_missing
-000059d0: 2c20 7365 6c66 2e78 5f64 696d 292c 2064  , self.x_dim), d
-000059e0: 7479 7065 3d6e 702e 666c 6f61 7436 3429  type=np.float64)
-000059f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005a00: 2061 6374 6976 655f 7520 3d20 7365 6c66   active_u = self
-00005a10: 2e63 6f6d 6d2e 6263 6173 7428 6163 7469  .comm.bcast(acti
-00005a20: 7665 5f75 2c20 726f 6f74 3d30 290a 2020  ve_u, root=0).  
-00005a30: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00005a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005a50: 6163 7469 7665 5f75 203d 206e 702e 7261  active_u = np.ra
-00005a60: 6e64 6f6d 2e75 6e69 666f 726d 2873 697a  ndom.uniform(siz
-00005a70: 653d 286e 756d 5f6c 6976 655f 706f 696e  e=(num_live_poin
-00005a80: 7473 5f6d 6973 7369 6e67 2c20 7365 6c66  ts_missing, self
-00005a90: 2e78 5f64 696d 2929 0a20 2020 2020 2020  .x_dim)).       
-00005aa0: 2020 2020 2061 6374 6976 655f 7620 3d20       active_v = 
-00005ab0: 7365 6c66 2e74 7261 6e73 666f 726d 2861  self.transform(a
-00005ac0: 6374 6976 655f 7529 0a0a 2020 2020 2020  ctive_u)..      
-00005ad0: 2020 2020 2020 6966 2073 656c 662e 7573        if self.us
-00005ae0: 655f 6d70 693a 0a20 2020 2020 2020 2020  e_mpi:.         
-00005af0: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
-00005b00: 7069 5f72 616e 6b20 3d3d 2030 3a0a 2020  pi_rank == 0:.  
-00005b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b20: 2020 6368 756e 6b73 203d 205b 5b5d 2066    chunks = [[] f
-00005b30: 6f72 205f 2069 6e20 7261 6e67 6528 7365  or _ in range(se
-00005b40: 6c66 2e6d 7069 5f73 697a 6529 5d0a 2020  lf.mpi_size)].  
-00005b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b60: 2020 666f 7220 692c 2063 6875 6e6b 2069    for i, chunk i
-00005b70: 6e20 656e 756d 6572 6174 6528 6163 7469  n enumerate(acti
-00005b80: 7665 5f76 293a 0a20 2020 2020 2020 2020  ve_v):.         
-00005b90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00005ba0: 6875 6e6b 735b 6920 2520 7365 6c66 2e6d  hunks[i % self.m
-00005bb0: 7069 5f73 697a 655d 2e61 7070 656e 6428  pi_size].append(
-00005bc0: 6368 756e 6b29 0a20 2020 2020 2020 2020  chunk).         
-00005bd0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00005be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005bf0: 2063 6875 6e6b 7320 3d20 4e6f 6e65 0a20   chunks = None. 
-00005c00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00005c10: 6174 6120 3d20 7365 6c66 2e63 6f6d 6d2e  ata = self.comm.
-00005c20: 7363 6174 7465 7228 6368 756e 6b73 2c20  scatter(chunks, 
-00005c30: 726f 6f74 3d30 290a 2020 2020 2020 2020  root=0).        
-00005c40: 2020 2020 2020 2020 6163 7469 7665 5f6c          active_l
-00005c50: 6f67 6c20 3d20 7365 6c66 2e6c 6f67 6c69  ogl = self.logli
-00005c60: 6b65 2864 6174 6129 0a20 2020 2020 2020  ke(data).       
-00005c70: 2020 2020 2020 2020 2072 6563 765f 6163           recv_ac
-00005c80: 7469 7665 5f6c 6f67 6c20 3d20 7365 6c66  tive_logl = self
-00005c90: 2e63 6f6d 6d2e 6761 7468 6572 2861 6374  .comm.gather(act
-00005ca0: 6976 655f 6c6f 676c 2c20 726f 6f74 3d30  ive_logl, root=0
-00005cb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00005cc0: 2020 7265 6376 5f61 6374 6976 655f 6c6f    recv_active_lo
-00005cd0: 676c 203d 2073 656c 662e 636f 6d6d 2e62  gl = self.comm.b
-00005ce0: 6361 7374 2872 6563 765f 6163 7469 7665  cast(recv_active
-00005cf0: 5f6c 6f67 6c2c 2072 6f6f 743d 3029 0a20  _logl, root=0). 
-00005d00: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00005d10: 6374 6976 655f 6c6f 676c 203d 206e 702e  ctive_logl = np.
-00005d20: 636f 6e63 6174 656e 6174 6528 7265 6376  concatenate(recv
-00005d30: 5f61 6374 6976 655f 6c6f 676c 2c20 6178  _active_logl, ax
-00005d40: 6973 3d30 290a 2020 2020 2020 2020 2020  is=0).          
-00005d50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00005d60: 2020 2020 2020 2020 6163 7469 7665 5f6c          active_l
-00005d70: 6f67 6c20 3d20 7365 6c66 2e6c 6f67 6c69  ogl = self.logli
-00005d80: 6b65 2861 6374 6976 655f 7629 0a0a 2020  ke(active_v)..  
-00005d90: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00005da0: 662e 6c6f 675f 746f 5f64 6973 6b3a 0a20  f.log_to_disk:. 
-00005db0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00005dc0: 6f72 2069 2069 6e20 7261 6e67 6528 6e75  or i in range(nu
-00005dd0: 6d5f 6c69 7665 5f70 6f69 6e74 735f 6d69  m_live_points_mi
-00005de0: 7373 696e 6729 3a0a 2020 2020 2020 2020  ssing):.        
-00005df0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00005e00: 2e70 6f69 6e74 7374 6f72 652e 6164 6428  .pointstore.add(
-00005e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005e20: 2020 2020 2020 2020 205f 6c69 7374 6966           _listif
-00005e30: 7928 5b2d 6e70 2e69 6e66 2c20 6163 7469  y([-np.inf, acti
-00005e40: 7665 5f6c 6f67 6c5b 695d 2c20 302e 5d2c  ve_logl[i], 0.],
-00005e50: 2061 6374 6976 655f 755b 692c 3a5d 2c20   active_u[i,:], 
-00005e60: 6163 7469 7665 5f76 5b69 2c3a 5d29 2c0a  active_v[i,:]),.
-00005e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e80: 2020 2020 2020 2020 6e75 6d5f 6c69 7665          num_live
-00005e90: 5f70 6f69 6e74 735f 6d69 7373 696e 6729  _points_missing)
-00005ea0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00005eb0: 206c 656e 2870 7265 765f 7529 203e 2030   len(prev_u) > 0
-00005ec0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005ed0: 2020 6163 7469 7665 5f75 203d 206e 702e    active_u = np.
-00005ee0: 636f 6e63 6174 656e 6174 6528 2870 7265  concatenate((pre
-00005ef0: 765f 752c 2061 6374 6976 655f 7529 290a  v_u, active_u)).
-00005f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005f10: 6163 7469 7665 5f76 203d 206e 702e 636f  active_v = np.co
-00005f20: 6e63 6174 656e 6174 6528 2870 7265 765f  ncatenate((prev_
-00005f30: 762c 2061 6374 6976 655f 7629 290a 2020  v, active_v)).  
-00005f40: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-00005f50: 7469 7665 5f6c 6f67 6c20 3d20 6e70 2e63  tive_logl = np.c
-00005f60: 6f6e 6361 7465 6e61 7465 2828 7072 6576  oncatenate((prev
-00005f70: 5f6c 6f67 6c2c 2061 6374 6976 655f 6c6f  _logl, active_lo
-00005f80: 676c 2929 0a20 2020 2020 2020 2020 2020  gl)).           
-00005f90: 2061 7373 6572 7420 6163 7469 7665 5f75   assert active_u
-00005fa0: 2e73 6861 7065 203d 3d20 2873 656c 662e  .shape == (self.
-00005fb0: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 732c  num_live_points,
-00005fc0: 2073 656c 662e 785f 6469 6d29 0a20 2020   self.x_dim).   
-00005fd0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
-00005fe0: 6163 7469 7665 5f76 2e73 6861 7065 203d  active_v.shape =
-00005ff0: 3d20 2873 656c 662e 6e75 6d5f 6c69 7665  = (self.num_live
-00006000: 5f70 6f69 6e74 732c 2073 656c 662e 6e75  _points, self.nu
-00006010: 6d5f 7061 7261 6d73 290a 2020 2020 2020  m_params).      
-00006020: 2020 2020 2020 6173 7365 7274 2061 6374        assert act
-00006030: 6976 655f 6c6f 676c 2e73 6861 7065 203d  ive_logl.shape =
-00006040: 3d20 2873 656c 662e 6e75 6d5f 6c69 7665  = (self.num_live
-00006050: 5f70 6f69 6e74 732c 290a 2020 2020 2020  _points,).      
-00006060: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00006070: 2020 2020 6163 7469 7665 5f75 203d 2070      active_u = p
-00006080: 7265 765f 750a 2020 2020 2020 2020 2020  rev_u.          
-00006090: 2020 6163 7469 7665 5f76 203d 2070 7265    active_v = pre
-000060a0: 765f 760a 2020 2020 2020 2020 2020 2020  v_v.            
-000060b0: 6163 7469 7665 5f6c 6f67 6c20 3d20 7072  active_logl = pr
-000060c0: 6576 5f6c 6f67 6c0a 0a20 2020 2020 2020  ev_logl..       
-000060d0: 2073 6176 6564 5f75 203d 205b 5d0a 2020   saved_u = [].  
-000060e0: 2020 2020 2020 7361 7665 645f 7620 3d20        saved_v = 
-000060f0: 5b5d 2020 2320 5374 6f72 6564 2070 6f69  []  # Stored poi
-00006100: 6e74 7320 666f 7220 706f 7374 6572 696f  nts for posterio
-00006110: 7220 7265 7375 6c74 730a 2020 2020 2020  r results.      
-00006120: 2020 7361 7665 645f 6c6f 676c 203d 205b    saved_logl = [
-00006130: 5d0a 2020 2020 2020 2020 7361 7665 645f  ].        saved_
-00006140: 6c6f 6777 7420 3d20 5b5d 0a20 2020 2020  logwt = [].     
-00006150: 2020 2068 203d 2030 2e30 2020 2320 496e     h = 0.0  # In
-00006160: 666f 726d 6174 696f 6e2c 2069 6e69 7469  formation, initi
-00006170: 616c 6c79 2030 2e0a 2020 2020 2020 2020  ally 0..        
-00006180: 6c6f 677a 203d 202d 3165 3330 3020 2023  logz = -1e300  #
-00006190: 206c 6e28 4576 6964 656e 6365 205a 292c   ln(Evidence Z),
-000061a0: 2069 6e69 7469 616c 6c79 205a 3d30 0a20   initially Z=0. 
-000061b0: 2020 2020 2020 206c 6f67 766f 6c20 3d20         logvol = 
-000061c0: 6c6f 6728 312e 3020 2d20 6578 7028 2d31  log(1.0 - exp(-1
-000061d0: 2e30 202f 2073 656c 662e 6e75 6d5f 6c69  .0 / self.num_li
-000061e0: 7665 5f70 6f69 6e74 7329 290a 2020 2020  ve_points)).    
-000061f0: 2020 2020 6c6f 677a 5f72 656d 6169 6e20      logz_remain 
-00006200: 3d20 6e70 2e6d 6178 2861 6374 6976 655f  = np.max(active_
-00006210: 6c6f 676c 290a 2020 2020 2020 2020 6672  logl).        fr
-00006220: 6163 7469 6f6e 5f72 656d 6169 6e20 3d20  action_remain = 
-00006230: 312e 300a 2020 2020 2020 2020 6e63 616c  1.0.        ncal
-00006240: 6c20 3d20 6e75 6d5f 6c69 7665 5f70 6f69  l = num_live_poi
-00006250: 6e74 735f 6d69 7373 696e 6720 2023 206e  nts_missing  # n
-00006260: 756d 6265 7220 6f66 2063 616c 6c73 2077  umber of calls w
-00006270: 6520 616c 7265 6164 7920 6d61 6465 0a20  e already made. 
-00006280: 2020 2020 2020 2066 6972 7374 5f74 696d         first_tim
-00006290: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-000062a0: 2069 6620 7365 6c66 2e78 5f64 696d 203e   if self.x_dim >
-000062b0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-000062c0: 7472 616e 7366 6f72 6d4c 6179 6572 203d  transformLayer =
-000062d0: 2041 6666 696e 654c 6179 6572 2877 7261   AffineLayer(wra
-000062e0: 7070 6564 5f64 696d 733d 7365 6c66 2e77  pped_dims=self.w
-000062f0: 7261 7070 6564 5f61 7865 7329 0a20 2020  rapped_axes).   
-00006300: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00006310: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-00006320: 4c61 7965 7220 3d20 5363 616c 696e 674c  Layer = ScalingL
-00006330: 6179 6572 2877 7261 7070 6564 5f64 696d  ayer(wrapped_dim
-00006340: 733d 7365 6c66 2e77 7261 7070 6564 5f61  s=self.wrapped_a
-00006350: 7865 7329 0a20 2020 2020 2020 2074 7261  xes).        tra
-00006360: 6e73 666f 726d 4c61 7965 722e 6f70 7469  nsformLayer.opti
-00006370: 6d69 7a65 2861 6374 6976 655f 752c 2061  mize(active_u, a
-00006380: 6374 6976 655f 7529 0a20 2020 2020 2020  ctive_u).       
-00006390: 2072 6567 696f 6e20 3d20 4d4c 4672 6965   region = MLFrie
-000063a0: 6e64 7328 6163 7469 7665 5f75 2c20 7472  nds(active_u, tr
-000063b0: 616e 7366 6f72 6d4c 6179 6572 290a 0a20  ansformLayer).. 
-000063c0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-000063d0: 6f67 3a0a 2020 2020 2020 2020 2020 2020  og:.            
-000063e0: 7365 6c66 2e6c 6f67 6765 722e 696e 666f  self.logger.info
-000063f0: 2827 5374 6172 7469 6e67 2073 616d 706c  ('Starting sampl
-00006400: 696e 6720 2e2e 2e27 290a 2020 2020 2020  ing ...').      
-00006410: 2020 6962 203d 2030 0a20 2020 2020 2020    ib = 0.       
-00006420: 2073 616d 706c 6573 203d 205b 5d0a 2020   samples = [].  
-00006430: 2020 2020 2020 6e64 7261 7720 3d20 3130        ndraw = 10
-00006440: 300a 2020 2020 2020 2020 6974 203d 2030  0.        it = 0
-00006450: 0a20 2020 2020 2020 206e 6578 745f 7570  .        next_up
-00006460: 6461 7465 5f69 6e74 6572 7661 6c5f 6e63  date_interval_nc
-00006470: 616c 6c20 3d20 2d31 0a20 2020 2020 2020  all = -1.       
-00006480: 206e 6578 745f 7570 6461 7465 5f69 6e74   next_update_int
-00006490: 6572 7661 6c5f 6974 6572 203d 202d 310a  erval_iter = -1.
-000064a0: 0a20 2020 2020 2020 2077 6869 6c65 206d  .        while m
-000064b0: 6178 5f69 7465 7273 2069 7320 4e6f 6e65  ax_iters is None
-000064c0: 206f 7220 6974 203c 206d 6178 5f69 7465   or it < max_ite
-000064d0: 7273 3a0a 0a20 2020 2020 2020 2020 2020  rs:..           
-000064e0: 2023 2057 6f72 7374 206f 626a 6563 7420   # Worst object 
-000064f0: 696e 2063 6f6c 6c65 6374 696f 6e20 616e  in collection an
-00006500: 6420 6974 7320 7765 6967 6874 2028 3d20  d its weight (= 
-00006510: 766f 6c75 6d65 202a 206c 696b 656c 6968  volume * likelih
-00006520: 6f6f 6429 0a20 2020 2020 2020 2020 2020  ood).           
-00006530: 2077 6f72 7374 203d 206e 702e 6172 676d   worst = np.argm
-00006540: 696e 2861 6374 6976 655f 6c6f 676c 290a  in(active_logl).
-00006550: 2020 2020 2020 2020 2020 2020 6c6f 6777              logw
-00006560: 7420 3d20 6c6f 6776 6f6c 202b 2061 6374  t = logvol + act
-00006570: 6976 655f 6c6f 676c 5b77 6f72 7374 5d0a  ive_logl[worst].
-00006580: 0a20 2020 2020 2020 2020 2020 2023 2055  .            # U
-00006590: 7064 6174 6520 6576 6964 656e 6365 205a  pdate evidence Z
-000065a0: 2061 6e64 2069 6e66 6f72 6d61 7469 6f6e   and information
-000065b0: 2068 2e0a 2020 2020 2020 2020 2020 2020   h..            
-000065c0: 6c6f 677a 5f6e 6577 203d 206e 702e 6c6f  logz_new = np.lo
-000065d0: 6761 6464 6578 7028 6c6f 677a 2c20 6c6f  gaddexp(logz, lo
-000065e0: 6777 7429 0a20 2020 2020 2020 2020 2020  gwt).           
-000065f0: 2068 203d 2028 6578 7028 6c6f 6777 7420   h = (exp(logwt 
-00006600: 2d20 6c6f 677a 5f6e 6577 2920 2a20 6163  - logz_new) * ac
-00006610: 7469 7665 5f6c 6f67 6c5b 776f 7273 745d  tive_logl[worst]
-00006620: 202b 2065 7870 286c 6f67 7a20 2d20 6c6f   + exp(logz - lo
-00006630: 677a 5f6e 6577 2920 2a20 2868 202b 206c  gz_new) * (h + l
-00006640: 6f67 7a29 202d 206c 6f67 7a5f 6e65 7729  ogz) - logz_new)
-00006650: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00006660: 7a20 3d20 6c6f 677a 5f6e 6577 0a0a 2020  z = logz_new..  
-00006670: 2020 2020 2020 2020 2020 2320 4164 6420            # Add 
-00006680: 776f 7273 7420 6f62 6a65 6374 2074 6f20  worst object to 
-00006690: 7361 6d70 6c65 732e 0a20 2020 2020 2020  samples..       
-000066a0: 2020 2020 2073 6176 6564 5f75 2e61 7070       saved_u.app
-000066b0: 656e 6428 6e70 2e61 7272 6179 2861 6374  end(np.array(act
-000066c0: 6976 655f 755b 776f 7273 745d 2929 0a20  ive_u[worst])). 
-000066d0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
-000066e0: 5f76 2e61 7070 656e 6428 6e70 2e61 7272  _v.append(np.arr
-000066f0: 6179 2861 6374 6976 655f 765b 776f 7273  ay(active_v[wors
-00006700: 745d 2929 0a20 2020 2020 2020 2020 2020  t])).           
-00006710: 2073 6176 6564 5f6c 6f67 7774 2e61 7070   saved_logwt.app
-00006720: 656e 6428 6c6f 6777 7429 0a20 2020 2020  end(logwt).     
-00006730: 2020 2020 2020 2073 6176 6564 5f6c 6f67         saved_log
-00006740: 6c2e 6170 7065 6e64 2861 6374 6976 655f  l.append(active_
-00006750: 6c6f 676c 5b77 6f72 7374 5d29 0a0a 2020  logl[worst])..  
-00006760: 2020 2020 2020 2020 2020 2320 6578 7065            # expe
-00006770: 6374 6564 5f76 6f6c 203d 206e 702e 6578  cted_vol = np.ex
-00006780: 7028 2d69 7420 2f20 7365 6c66 2e6e 756d  p(-it / self.num
-00006790: 5f6c 6976 655f 706f 696e 7473 290a 0a20  _live_points).. 
-000067a0: 2020 2020 2020 2020 2020 2023 2054 6865             # The
-000067b0: 206e 6577 206c 696b 656c 6968 6f6f 6420   new likelihood 
-000067c0: 636f 6e73 7472 6169 6e74 2069 7320 7468  constraint is th
-000067d0: 6174 206f 6620 7468 6520 776f 7273 7420  at of the worst 
-000067e0: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
-000067f0: 2020 2020 6c6f 676c 7374 6172 203d 2061      loglstar = a
-00006800: 6374 6976 655f 6c6f 676c 5b77 6f72 7374  ctive_logl[worst
-00006810: 5d0a 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-00006820: 6620 6e63 616c 6c20 3e20 6e65 7874 5f75  f ncall > next_u
-00006830: 7064 6174 655f 696e 7465 7276 616c 5f6e  pdate_interval_n
-00006840: 6361 6c6c 2061 6e64 2069 7420 3e20 6e65  call and it > ne
-00006850: 7874 5f75 7064 6174 655f 696e 7465 7276  xt_update_interv
-00006860: 616c 5f69 7465 723a 0a0a 2020 2020 2020  al_iter:..      
-00006870: 2020 2020 2020 2020 2020 6966 2066 6972            if fir
-00006880: 7374 5f74 696d 653a 0a20 2020 2020 2020  st_time:.       
-00006890: 2020 2020 2020 2020 2020 2020 206e 6578               nex
-000068a0: 7472 6567 696f 6e20 3d20 7265 6769 6f6e  tregion = region
-000068b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000068c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000068d0: 2020 2020 2020 2020 2020 2023 2072 6562             # reb
-000068e0: 7569 6c64 2073 7061 6365 0a20 2020 2020  uild space.     
-000068f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00006900: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
-00006910: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-00006920: 7269 6e74 2822 7265 6275 696c 6469 6e67  rint("rebuilding
-00006930: 2073 7061 6365 2e2e 2e22 2c20 6163 7469   space...", acti
-00006940: 7665 5f75 2e73 6861 7065 2c20 6163 7469  ve_u.shape, acti
-00006950: 7665 5f75 290a 2020 2020 2020 2020 2020  ve_u).          
-00006960: 2020 2020 2020 2020 2020 6e65 7874 5472            nextTr
-00006970: 616e 7366 6f72 6d4c 6179 6572 203d 2074  ansformLayer = t
-00006980: 7261 6e73 666f 726d 4c61 7965 722e 6372  ransformLayer.cr
-00006990: 6561 7465 5f6e 6577 2861 6374 6976 655f  eate_new(active_
-000069a0: 752c 2072 6567 696f 6e2e 6d61 7872 6164  u, region.maxrad
-000069b0: 6975 7373 7129 0a20 2020 2020 2020 2020  iussq).         
-000069c0: 2020 2020 2020 2020 2020 206e 6578 7472             nextr
-000069d0: 6567 696f 6e20 3d20 4d4c 4672 6965 6e64  egion = MLFriend
-000069e0: 7328 6163 7469 7665 5f75 2c20 6e65 7874  s(active_u, next
-000069f0: 5472 616e 7366 6f72 6d4c 6179 6572 290a  TransformLayer).
-00006a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006a10: 2023 2070 7269 6e74 2822 636f 6d70 7574   # print("comput
-00006a20: 696e 6720 6d61 7872 6164 6975 732e 2e2e  ing maxradius...
-00006a30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00006a40: 2020 2072 2c20 6620 3d20 5f75 7064 6174     r, f = _updat
-00006a50: 655f 7265 6769 6f6e 5f62 6f6f 7473 7472  e_region_bootstr
-00006a60: 6170 286e 6578 7472 6567 696f 6e2c 2033  ap(nextregion, 3
-00006a70: 302c 2030 2e2c 2073 656c 662e 636f 6d6d  0, 0., self.comm
-00006a80: 2069 6620 7365 6c66 2e75 7365 5f6d 7069   if self.use_mpi
-00006a90: 2065 6c73 6520 4e6f 6e65 2c20 7365 6c66   else None, self
-00006aa0: 2e6d 7069 5f73 697a 6529 0a0a 2020 2020  .mpi_size)..    
-00006ab0: 2020 2020 2020 2020 2020 2020 6e65 7874              next
-00006ac0: 7265 6769 6f6e 2e6d 6178 7261 6469 7573  region.maxradius
-00006ad0: 7371 203d 2072 0a20 2020 2020 2020 2020  sq = r.         
-00006ae0: 2020 2020 2020 206e 6578 7472 6567 696f         nextregio
-00006af0: 6e2e 656e 6c61 7267 6520 3d20 660a 2020  n.enlarge = f.  
-00006b00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00006b10: 666f 7263 6520 7368 7269 6e6b 6167 6520  force shrinkage 
-00006b20: 6f66 2076 6f6c 756d 650a 2020 2020 2020  of volume.      
-00006b30: 2020 2020 2020 2020 2020 2320 7468 6973            # this
-00006b40: 2069 7320 746f 2061 766f 6964 2072 652d   is to avoid re-
-00006b50: 636f 6e6e 6563 7469 6f6e 206f 6620 6479  connection of dy
-00006b60: 696e 6720 6f75 7420 6e6f 6465 730a 2020  ing out nodes.  
-00006b70: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00006b80: 206e 6578 7472 6567 696f 6e2e 6573 7469   nextregion.esti
-00006b90: 6d61 7465 5f76 6f6c 756d 6528 2920 3c20  mate_volume() < 
-00006ba0: 7265 6769 6f6e 2e65 7374 696d 6174 655f  region.estimate_
-00006bb0: 766f 6c75 6d65 2829 3a0a 2020 2020 2020  volume():.      
-00006bc0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00006bd0: 6769 6f6e 203d 206e 6578 7472 6567 696f  gion = nextregio
-00006be0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00006bf0: 2020 2020 2020 7472 616e 7366 6f72 6d4c        transformL
-00006c00: 6179 6572 203d 2072 6567 696f 6e2e 7472  ayer = region.tr
-00006c10: 616e 7366 6f72 6d4c 6179 6572 0a20 2020  ansformLayer.   
-00006c20: 2020 2020 2020 2020 2020 2020 2072 6567               reg
-00006c30: 696f 6e2e 6372 6561 7465 5f65 6c6c 6970  ion.create_ellip
-00006c40: 736f 6964 286d 696e 766f 6c3d 6578 7028  soid(minvol=exp(
-00006c50: 2d69 7420 2f20 7365 6c66 2e6e 756d 5f6c  -it / self.num_l
-00006c60: 6976 655f 706f 696e 7473 2920 2a20 7365  ive_points) * se
-00006c70: 6c66 2e76 6f6c 6661 6374 6f72 290a 0a20  lf.volfactor).. 
-00006c80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00006c90: 6620 7365 6c66 2e6c 6f67 3a0a 2020 2020  f self.log:.    
-00006ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cb0: 7669 7a5f 6361 6c6c 6261 636b 280a 2020  viz_callback(.  
-00006cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cd0: 2020 2020 2020 706f 696e 7473 3d64 6963        points=dic
-00006ce0: 7428 753d 6163 7469 7665 5f75 2c20 703d  t(u=active_u, p=
-00006cf0: 6163 7469 7665 5f76 2c20 6c6f 676c 3d61  active_v, logl=a
-00006d00: 6374 6976 655f 6c6f 676c 292c 0a20 2020  ctive_logl),.   
-00006d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d20: 2020 2020 2069 6e66 6f3d 6469 6374 280a       info=dict(.
-00006d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d40: 2020 2020 2020 2020 2020 2020 6974 3d69              it=i
-00006d50: 742c 206e 6361 6c6c 3d6e 6361 6c6c 2c20  t, ncall=ncall, 
-00006d60: 6c6f 677a 3d6c 6f67 7a2c 206c 6f67 7a5f  logz=logz, logz_
-00006d70: 7265 6d61 696e 3d6c 6f67 7a5f 7265 6d61  remain=logz_rema
-00006d80: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
-00006d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006da0: 7061 7261 6d6e 616d 6573 3d73 656c 662e  paramnames=self.
-00006db0: 7061 7261 6d6e 616d 6573 202b 2073 656c  paramnames + sel
-00006dc0: 662e 6465 7269 7665 6470 6172 616d 6e61  f.derivedparamna
-00006dd0: 6d65 732c 0a20 2020 2020 2020 2020 2020  mes,.           
-00006de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006df0: 206c 6f67 766f 6c3d 6c6f 6776 6f6c 292c   logvol=logvol),
-00006e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006e10: 2020 2020 2020 2020 2072 6567 696f 6e3d           region=
-00006e20: 7265 6769 6f6e 2c20 7472 616e 7366 6f72  region, transfor
-00006e30: 6d4c 6179 6572 3d74 7261 6e73 666f 726d  mLayer=transform
-00006e40: 4c61 7965 7229 0a20 2020 2020 2020 2020  Layer).         
-00006e50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006e60: 706f 696e 7473 746f 7265 2e66 6c75 7368  pointstore.flush
-00006e70: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00006e80: 2020 2020 6e65 7874 5f75 7064 6174 655f      next_update_
-00006e90: 696e 7465 7276 616c 5f6e 6361 6c6c 203d  interval_ncall =
-00006ea0: 206e 6361 6c6c 202b 2075 7064 6174 655f   ncall + update_
-00006eb0: 696e 7465 7276 616c 5f6e 6361 6c6c 0a20  interval_ncall. 
-00006ec0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00006ed0: 6578 745f 7570 6461 7465 5f69 6e74 6572  ext_update_inter
-00006ee0: 7661 6c5f 6974 6572 203d 2069 7420 2b20  val_iter = it + 
-00006ef0: 7570 6461 7465 5f69 6e74 6572 7661 6c5f  update_interval_
-00006f00: 6974 6572 0a20 2020 2020 2020 2020 2020  iter.           
-00006f10: 2020 2020 2066 6972 7374 5f74 696d 6520       first_time 
-00006f20: 3d20 4661 6c73 650a 0a20 2020 2020 2020  = False..       
-00006f30: 2020 2020 2077 6869 6c65 2054 7275 653a       while True:
-00006f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006f50: 2069 6620 6962 203e 3d20 6c65 6e28 7361   if ib >= len(sa
-00006f60: 6d70 6c65 7329 2061 6e64 2075 7365 5f70  mples) and use_p
-00006f70: 6f69 6e74 5f73 7461 636b 3a0a 2020 2020  oint_stack:.    
-00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f90: 2320 726f 6f74 2063 6865 636b 7320 7468  # root checks th
-00006fa0: 6520 706f 696e 7420 7374 6f72 650a 2020  e point store.  
-00006fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fc0: 2020 6e65 7874 5f70 6f69 6e74 203d 206e    next_point = n
-00006fd0: 702e 7a65 726f 7328 2831 2c20 3320 2b20  p.zeros((1, 3 + 
-00006fe0: 7365 6c66 2e78 5f64 696d 202b 2073 656c  self.x_dim + sel
-00006ff0: 662e 6e75 6d5f 7061 7261 6d73 2929 0a0a  f.num_params))..
-00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007010: 2020 2020 6966 2073 656c 662e 6c6f 675f      if self.log_
-00007020: 746f 5f64 6973 6b3a 0a20 2020 2020 2020  to_disk:.       
-00007030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007040: 205f 2c20 7374 6f72 6564 5f70 6f69 6e74   _, stored_point
-00007050: 203d 2073 656c 662e 706f 696e 7473 746f   = self.pointsto
-00007060: 7265 2e70 6f70 286c 6f67 6c73 7461 7229  re.pop(loglstar)
-00007070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007080: 2020 2020 2020 2020 2069 6620 7374 6f72           if stor
-00007090: 6564 5f70 6f69 6e74 2069 7320 6e6f 7420  ed_point is not 
-000070a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000070b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070c0: 2020 6e65 7874 5f70 6f69 6e74 5b30 2c3a    next_point[0,:
-000070d0: 5d20 3d20 7374 6f72 6564 5f70 6f69 6e74  ] = stored_point
-000070e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000070f0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00007100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007110: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-00007120: 706f 696e 745b 302c 3a5d 203d 202d 6e70  point[0,:] = -np
-00007130: 2e69 6e66 0a20 2020 2020 2020 2020 2020  .inf.           
-00007140: 2020 2020 2020 2020 2020 2020 2075 7365               use
-00007150: 5f70 6f69 6e74 5f73 7461 636b 203d 206e  _point_stack = n
-00007160: 6f74 2073 656c 662e 706f 696e 7473 746f  ot self.pointsto
-00007170: 7265 2e73 7461 636b 5f65 6d70 7479 0a0a  re.stack_empty..
-00007180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007190: 2020 2020 6966 2073 656c 662e 7573 655f      if self.use_
-000071a0: 6d70 693a 2020 2320 616e 6420 696e 666f  mpi:  # and info
-000071b0: 726d 7320 6576 6572 796f 6e65 0a20 2020  rms everyone.   
-000071c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000071d0: 2020 2020 2075 7365 5f70 6f69 6e74 5f73       use_point_s
-000071e0: 7461 636b 203d 2073 656c 662e 636f 6d6d  tack = self.comm
-000071f0: 2e62 6361 7374 2875 7365 5f70 6f69 6e74  .bcast(use_point
-00007200: 5f73 7461 636b 2c20 726f 6f74 3d30 290a  _stack, root=0).
-00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007220: 2020 2020 2020 2020 6e65 7874 5f70 6f69          next_poi
-00007230: 6e74 203d 2073 656c 662e 636f 6d6d 2e62  nt = self.comm.b
-00007240: 6361 7374 286e 6578 745f 706f 696e 742c  cast(next_point,
-00007250: 2072 6f6f 743d 3029 0a0a 2020 2020 2020   root=0)..      
-00007260: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00007270: 6173 7365 7274 206e 6f74 2075 7365 5f70  assert not use_p
-00007280: 6f69 6e74 5f73 7461 636b 0a0a 2020 2020  oint_stack..    
-00007290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000072a0: 2320 756e 7061 636b 0a20 2020 2020 2020  # unpack.       
-000072b0: 2020 2020 2020 2020 2020 2020 206c 696b               lik
-000072c0: 6573 203d 206e 6578 745f 706f 696e 745b  es = next_point[
-000072d0: 3a2c 315d 0a20 2020 2020 2020 2020 2020  :,1].           
-000072e0: 2020 2020 2020 2020 2073 616d 706c 6573           samples
-000072f0: 203d 206e 6578 745f 706f 696e 745b 3a2c   = next_point[:,
-00007300: 333a 3320 2b20 7365 6c66 2e78 5f64 696d  3:3 + self.x_dim
-00007310: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00007320: 2020 2020 2020 7361 6d70 6c65 7376 203d        samplesv =
-00007330: 206e 6578 745f 706f 696e 745b 3a2c 3320   next_point[:,3 
-00007340: 2b20 7365 6c66 2e78 5f64 696d 3a33 202b  + self.x_dim:3 +
-00007350: 2073 656c 662e 785f 6469 6d20 2b20 7365   self.x_dim + se
-00007360: 6c66 2e6e 756d 5f70 6172 616d 735d 0a20  lf.num_params]. 
-00007370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007380: 2020 2023 2073 6b69 7020 6966 2077 6520     # skip if we 
-00007390: 616c 7265 6164 7920 6b6e 6f77 2069 7420  already know it 
-000073a0: 6973 206e 6f74 2075 7365 6675 6c0a 2020  is not useful.  
-000073b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073c0: 2020 6962 203d 2030 2069 6620 6e70 2e69    ib = 0 if np.i
-000073d0: 7366 696e 6974 6528 6c69 6b65 735b 305d  sfinite(likes[0]
-000073e0: 2920 656c 7365 2031 0a0a 2020 2020 2020  ) else 1..      
-000073f0: 2020 2020 2020 2020 2020 7768 696c 6520            while 
-00007400: 6962 203e 3d20 6c65 6e28 7361 6d70 6c65  ib >= len(sample
-00007410: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00007420: 2020 2020 2020 2020 2320 6765 7420 6e65          # get ne
-00007430: 7720 7361 6d70 6c65 730a 2020 2020 2020  w samples.      
-00007440: 2020 2020 2020 2020 2020 2020 2020 6962                ib
-00007450: 203d 2030 0a0a 2020 2020 2020 2020 2020   = 0..          
-00007460: 2020 2020 2020 2020 2020 6e63 203d 2030            nc = 0
-00007470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007480: 2020 2020 2075 203d 2072 6567 696f 6e2e       u = region.
-00007490: 7361 6d70 6c65 286e 7361 6d70 6c65 733d  sample(nsamples=
-000074a0: 6e64 7261 7729 0a20 2020 2020 2020 2020  ndraw).         
-000074b0: 2020 2020 2020 2020 2020 206e 7520 3d20             nu = 
-000074c0: 752e 7368 6170 655b 305d 0a20 2020 2020  u.shape[0].     
-000074d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000074e0: 6620 6e75 203d 3d20 303a 0a20 2020 2020  f nu == 0:.     
+00002870: 655f 7661 6c75 6573 2929 2c20 6e70 2e61  e_values)), np.a
+00002880: 7261 6e67 6528 6c65 6e28 6163 7469 7665  range(len(active
+00002890: 5f76 616c 7565 7332 2929 290a 2020 2020  _values2))).    
+000028a0: 2020 2020 2020 2020 7461 7520 3d20 6e6f          tau = no
+000028b0: 726d 616c 6973 6564 5f6b 656e 6461 6c6c  rmalised_kendall
+000028c0: 5f74 6175 5f64 6973 7461 6e63 6528 6163  _tau_distance(ac
+000028d0: 7469 7665 5f76 616c 7565 732c 2061 6374  tive_values, act
+000028e0: 6976 655f 7661 6c75 6573 322c 2069 6e64  ive_values2, ind
+000028f0: 6963 6573 312c 2069 6e64 6963 6573 3229  ices1, indices2)
+00002900: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+00002910: 6572 5f63 6f6e 7369 7374 656e 7420 3d20  er_consistent = 
+00002920: 7461 7520 3c3d 206d 6178 5f74 6175 0a20  tau <= max_tau. 
+00002930: 2020 2020 2020 2020 2020 2069 6620 6f72             if or
+00002940: 6465 725f 636f 6e73 6973 7465 6e74 2061  der_consistent a
+00002950: 6e64 206c 656e 2861 6374 6976 655f 7661  nd len(active_va
+00002960: 6c75 6573 2920 3e20 3130 2061 6e64 206c  lues) > 10 and l
+00002970: 656e 2861 6374 6976 655f 7661 6c75 6573  en(active_values
+00002980: 2920 3e20 3130 3a0a 2020 2020 2020 2020  ) > 10:.        
+00002990: 2020 2020 2020 2020 676f 6f64 5f73 7461          good_sta
+000029a0: 7465 203d 2054 7275 650a 2020 2020 2020  te = True.      
+000029b0: 2020 2020 2020 656c 6966 206e 6f74 206f        elif not o
+000029c0: 7264 6572 5f63 6f6e 7369 7374 656e 743a  rder_consistent:
+000029d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000029e0: 2067 6f6f 645f 7374 6174 6520 3d20 4661   good_state = Fa
+000029f0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00002a00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00002a10: 2020 2020 2020 2320 6d61 696e 7461 696e        # maintain
+00002a20: 2073 7461 7465 0a20 2020 2020 2020 2020   state.         
+00002a30: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+00002a40: 2020 2020 2020 2020 6966 2076 6572 626f          if verbo
+00002a50: 7365 203d 3d20 323a 0a20 2020 2020 2020  se == 2:.       
+00002a60: 2020 2020 2020 2020 2070 7269 6e74 286e           print(n
+00002a70: 6974 6572 2c20 7461 7529 0a20 2020 2020  iter, tau).     
+00002a80: 2020 2020 2020 2069 6620 676f 6f64 5f73         if good_s
+00002a90: 7461 7465 3a0a 2020 2020 2020 2020 2020  tate:.          
+00002aa0: 2020 2020 2020 2320 7072 696e 7428 2220        # print(" 
+00002ab0: 2020 2020 2020 2028 252e 3165 2920 2020         (%.1e)   
+00002ac0: 4c3d 252e 3166 2220 2520 286c 6173 745f  L=%.1f" % (last_
+00002ad0: 676f 6f64 5f6c 696b 652c 204c 6d69 6e32  good_like, Lmin2
+00002ae0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00002af0: 2020 2023 2061 7373 6572 7420 6c61 7374     # assert last
+00002b00: 5f67 6f6f 645f 6c69 6b65 203c 204c 6d69  _good_like < Lmi
+00002b10: 6e32 2c20 286c 6173 745f 676f 6f64 5f6c  n2, (last_good_l
+00002b20: 696b 652c 204c 6d69 6e32 290a 2020 2020  ike, Lmin2).    
+00002b30: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+00002b40: 5f67 6f6f 645f 6c69 6b65 203d 204c 6d69  _good_like = Lmi
+00002b50: 6e32 0a20 2020 2020 2020 2020 2020 2020  n2.             
+00002b60: 2020 206c 6173 745f 676f 6f64 5f73 7461     last_good_sta
+00002b70: 7465 203d 206e 6974 6572 0a20 2020 2020  te = niter.     
+00002b80: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00002b90: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00002ba0: 6e74 6572 706f 6c61 7465 2061 2069 6e63  nterpolate a inc
+00002bb0: 7265 6173 696e 6720 6c69 6b65 6c69 686f  reasing likeliho
+00002bc0: 6f64 0a20 2020 2020 2020 2020 2020 2020  od.             
+00002bd0: 2020 2023 2069 6e20 7468 6520 686f 7065     # in the hope
+00002be0: 2074 6861 7420 7468 6520 7374 6570 2073   that the step s
+00002bf0: 697a 6520 6973 2073 6d61 6c6c 6572 2074  ize is smaller t
+00002c00: 6861 6e0a 2020 2020 2020 2020 2020 2020  han.            
+00002c10: 2020 2020 2320 7468 6520 6c69 6b65 6c69      # the likeli
+00002c20: 686f 6f64 2069 6e63 7265 6173 650a 2020  hood increase.  
+00002c30: 2020 2020 2020 2020 2020 2020 2020 4c6d                Lm
+00002c40: 696e 3220 3d20 6c61 7374 5f67 6f6f 645f  in2 = last_good_
+00002c50: 6c69 6b65 0a20 2020 2020 2020 2020 2020  like.           
+00002c60: 2020 2020 206e 6f64 6532 2e76 616c 7565       node2.value
+00002c70: 203d 204c 6d69 6e32 0a20 2020 2020 2020   = Lmin2.       
+00002c80: 2020 2020 2020 2020 206c 6173 745f 676f           last_go
+00002c90: 6f64 5f6c 696b 6520 3d20 6c61 7374 5f67  od_like = last_g
+00002ca0: 6f6f 645f 6c69 6b65 202a 2065 7073 696c  ood_like * epsil
+00002cb0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00002cc0: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
+00002cd0: 2020 2020 2020 666f 7220 752c 2076 2c20        for u, v, 
+00002ce0: 6c6f 676c 5f6f 6c64 2069 6e20 6368 696c  logl_old in chil
+00002cf0: 6472 656e 3a0a 2020 2020 2020 2020 2020  dren:.          
+00002d00: 2020 2020 2020 6c6f 676c 5f6e 6577 203d        logl_new =
+00002d10: 206c 6f67 6c73 5f6e 6577 5b6a 5d0a 2020   logls_new[j].  
+00002d20: 2020 2020 2020 2020 2020 2020 2020 6a20                j 
+00002d30: 2b3d 2031 0a0a 2020 2020 2020 2020 2020  += 1..          
+00002d40: 2020 2020 2020 2320 7072 696e 7428 6a2c        # print(j,
+00002d50: 204c 6d69 6e32 2c20 272d 3e27 2c20 6c6f   Lmin2, '->', lo
+00002d60: 676c 5f6e 6577 2c20 2769 6e73 7465 6164  gl_new, 'instead
+00002d70: 206f 6627 2c20 4c6d 696e 2c20 272d 3e27   of', Lmin, '->'
+00002d80: 2c20 5b63 2e76 616c 7565 2066 6f72 2063  , [c.value for c
+00002d90: 2069 6e20 6e6f 6465 322e 6368 696c 6472   in node2.childr
+00002da0: 656e 5d29 0a20 2020 2020 2020 2020 2020  en]).           
+00002db0: 2020 2020 2063 6869 6c64 3220 3d20 706f       child2 = po
+00002dc0: 696e 7470 696c 6532 2e6d 616b 655f 6e6f  intpile2.make_no
+00002dd0: 6465 286c 6f67 6c5f 6e65 772c 2075 2c20  de(logl_new, u, 
+00002de0: 7629 0a20 2020 2020 2020 2020 2020 2020  v).             
+00002df0: 2020 206e 6f64 6532 2e63 6869 6c64 7265     node2.childre
+00002e00: 6e2e 6170 7065 6e64 2863 6869 6c64 3229  n.append(child2)
+00002e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002e20: 2069 6620 6c6f 676c 5f6e 6577 203e 204c   if logl_new > L
+00002e30: 6d69 6e32 3a0a 2020 2020 2020 2020 2020  min2:.          
+00002e40: 2020 2020 2020 2020 2020 706f 696e 7473            points
+00002e50: 746f 7265 322e 6164 6428 5f6c 6973 7469  tore2.add(_listi
+00002e60: 6679 285b 4c6d 696e 322c 206c 6f67 6c5f  fy([Lmin2, logl_
+00002e70: 6e65 772c 2030 2e30 5d2c 2075 2c20 7629  new, 0.0], u, v)
+00002e80: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
+00002e90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00002ea0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00002eb0: 6620 7665 7262 6f73 6520 3d3d 2032 3a0a  f verbose == 2:.
+00002ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ed0: 2020 2020 2020 2020 7072 696e 7428 2263          print("c
+00002ee0: 616e 6e6f 7420 7573 6520 6e65 7720 706f  annot use new po
+00002ef0: 696e 7420 6265 6361 7573 6520 6974 2077  int because it w
+00002f00: 6f75 6c64 2064 6563 7265 6173 6520 6c69  ould decrease li
+00002f10: 6b65 6c69 686f 6f64 2028 252e 3166 2d3e  kelihood (%.1f->
+00002f20: 252e 3166 2922 2025 2028 4c6d 696e 322c  %.1f)" % (Lmin2,
+00002f30: 206c 6f67 6c5f 6e65 7729 290a 2020 2020   logl_new)).    
+00002f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f50: 2320 676f 6f64 5f73 7461 7465 203d 2046  # good_state = F
+00002f60: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00002f70: 2020 2020 2020 2020 2023 2062 7265 616b           # break
+00002f80: 0a0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
+00002f90: 696e 5f69 7465 7261 746f 7232 2e70 6173  in_iterator2.pas
+00002fa0: 7369 6e67 5f6e 6f64 6528 6e6f 6465 322c  sing_node(node2,
+00002fb0: 2061 6374 6976 655f 6e6f 6465 7332 290a   active_nodes2).
+00002fc0: 0a20 2020 2020 2020 2020 2020 206e 6974  .            nit
+00002fd0: 6572 202b 3d20 310a 2020 2020 2020 2020  er += 1.        
+00002fe0: 2020 2020 6966 2076 6572 626f 7365 3a0a      if verbose:.
+00002ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003000: 7379 732e 7374 6465 7272 2e77 7269 7465  sys.stderr.write
+00003010: 2822 2564 2e2e 2e5c 7222 2025 206e 6974  ("%d...\r" % nit
+00003020: 6572 290a 0a20 2020 2020 2020 2020 2020  er)..           
+00003030: 2065 7870 6c6f 7265 7232 2e65 7870 616e   explorer2.expan
+00003040: 645f 6368 696c 6472 656e 5f6f 6628 726f  d_children_of(ro
+00003050: 6f74 6964 322c 206e 6f64 6532 290a 0a20  otid2, node2).. 
+00003060: 2020 2020 2020 2069 6620 6e6f 7420 676f         if not go
+00003070: 6f64 5f73 7461 7465 3a0a 2020 2020 2020  od_state:.      
+00003080: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00003090: 2020 2020 6966 206d 6169 6e5f 6974 6572      if main_iter
+000030a0: 6174 6f72 322e 6c6f 675a 7265 6d61 696e  ator2.logZremain
+000030b0: 203c 206d 6169 6e5f 6974 6572 6174 6f72   < main_iterator
+000030c0: 322e 6c6f 675a 2061 6e64 206e 6f74 2067  2.logZ and not g
+000030d0: 6f6f 645f 7374 6174 653a 0a20 2020 2020  ood_state:.     
+000030e0: 2020 2020 2020 2023 2073 746f 7020 6173         # stop as
+000030f0: 2074 6865 2072 6573 756c 7473 2064 6976   the results div
+00003100: 6572 6765 6420 616c 7265 6164 790a 2020  erged already.  
+00003110: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+00003120: 0a20 2020 2069 6620 7665 7262 6f73 653a  .    if verbose:
+00003130: 0a20 2020 2020 2020 2073 7973 2e73 7464  .        sys.std
+00003140: 6572 722e 7772 6974 6528 2225 642f 2564  err.write("%d/%d
+00003150: 2069 7465 7261 7469 6f6e 7320 7361 6c76   iterations salv
+00003160: 6167 6564 2028 252e 3266 2525 292e 5c6e  aged (%.2f%%).\n
+00003170: 2220 2520 280a 2020 2020 2020 2020 2020  " % (.          
+00003180: 2020 6c61 7374 5f67 6f6f 645f 7374 6174    last_good_stat
+00003190: 6520 2b20 312c 206c 656e 2870 6f69 6e74  e + 1, len(point
+000031a0: 7329 2c20 286c 6173 745f 676f 6f64 5f73  s), (last_good_s
+000031b0: 7461 7465 202b 2031 2920 2a20 3130 302e  tate + 1) * 100.
+000031c0: 202f 206c 656e 2870 6f69 6e74 7329 2929   / len(points)))
+000031d0: 0a20 2020 2023 2064 656c 6574 6520 7468  .    # delete th
+000031e0: 6520 6f6e 6573 2061 7420 7468 6520 656e  e ones at the en
+000031f0: 6420 6672 6f6d 206c 6173 745f 676f 6f64  d from last_good
+00003200: 5f73 7461 7465 206f 6e77 6172 6473 0a20  _state onwards. 
+00003210: 2020 2023 2061 7373 6572 7420 6c65 6e28     # assert len(
+00003220: 706f 696e 7473 746f 7265 322e 6669 6c65  pointstore2.file
+00003230: 6f62 6a5b 2770 6f69 6e74 7327 5d29 203d  obj['points']) =
+00003240: 3d20 6e69 7465 722c 2028 6c65 6e28 706f  = niter, (len(po
+00003250: 696e 7473 746f 7265 322e 6669 6c65 6f62  intstore2.fileob
+00003260: 6a5b 2770 6f69 6e74 7327 5d29 2c20 6e69  j['points']), ni
+00003270: 7465 7229 0a20 2020 206d 6173 6b20 3d20  ter).    mask = 
+00003280: 706f 696e 7473 746f 7265 322e 6669 6c65  pointstore2.file
+00003290: 6f62 6a5b 2770 6f69 6e74 7327 5d5b 3a2c  obj['points'][:,
+000032a0: 305d 203c 3d20 6c61 7374 5f67 6f6f 645f  0] <= last_good_
+000032b0: 6c69 6b65 0a20 2020 2070 6f69 6e74 7332  like.    points2
+000032c0: 203d 2070 6f69 6e74 7374 6f72 6532 2e66   = pointstore2.f
+000032d0: 696c 656f 626a 5b27 706f 696e 7473 275d  ileobj['points']
+000032e0: 5b3a 5d5b 6d61 736b 2c3a 5d0a 2020 2020  [:][mask,:].    
+000032f0: 6465 6c20 706f 696e 7473 746f 7265 322e  del pointstore2.
+00003300: 6669 6c65 6f62 6a5b 2770 6f69 6e74 7327  fileobj['points'
+00003310: 5d0a 2020 2020 706f 696e 7473 746f 7265  ].    pointstore
+00003320: 322e 6669 6c65 6f62 6a2e 6372 6561 7465  2.fileobj.create
+00003330: 5f64 6174 6173 6574 280a 2020 2020 2020  _dataset(.      
+00003340: 2020 2770 6f69 6e74 7327 2c20 6474 7970    'points', dtyp
+00003350: 653d 6e70 2e66 6c6f 6174 3634 2c0a 2020  e=np.float64,.  
+00003360: 2020 2020 2020 7368 6170 653d 2830 2c20        shape=(0, 
+00003370: 706f 696e 7473 746f 7265 322e 6e63 6f6c  pointstore2.ncol
+00003380: 7329 2c20 6d61 7873 6861 7065 3d28 4e6f  s), maxshape=(No
+00003390: 6e65 2c20 706f 696e 7473 746f 7265 322e  ne, pointstore2.
+000033a0: 6e63 6f6c 7329 290a 2020 2020 706f 696e  ncols)).    poin
+000033b0: 7473 746f 7265 322e 6669 6c65 6f62 6a5b  tstore2.fileobj[
+000033c0: 2770 6f69 6e74 7327 5d2e 7265 7369 7a65  'points'].resize
+000033d0: 286c 656e 2870 6f69 6e74 7332 292c 2061  (len(points2), a
+000033e0: 7869 733d 3029 0a20 2020 2070 6f69 6e74  xis=0).    point
+000033f0: 7374 6f72 6532 2e66 696c 656f 626a 5b27  store2.fileobj['
+00003400: 706f 696e 7473 275d 5b3a 5d20 3d20 706f  points'][:] = po
+00003410: 696e 7473 320a 2020 2020 706f 696e 7473  ints2.    points
+00003420: 746f 7265 322e 636c 6f73 6528 290a 2020  tore2.close().  
+00003430: 2020 6465 6c20 706f 696e 7473 746f 7265    del pointstore
+00003440: 320a 0a20 2020 206f 732e 7265 706c 6163  2..    os.replac
+00003450: 6528 6669 6c65 7061 7468 322c 2066 696c  e(filepath2, fil
+00003460: 6570 6174 6829 0a0a 0a64 6566 205f 7570  epath)...def _up
+00003470: 6461 7465 5f72 6567 696f 6e5f 626f 6f74  date_region_boot
+00003480: 7374 7261 7028 7265 6769 6f6e 2c20 6e62  strap(region, nb
+00003490: 6f6f 7473 7472 6170 732c 206d 696e 766f  ootstraps, minvo
+000034a0: 6c3d 302e 2c20 636f 6d6d 3d4e 6f6e 652c  l=0., comm=None,
+000034b0: 206d 7069 5f73 697a 653d 3129 3a0a 2020   mpi_size=1):.  
+000034c0: 2020 2222 220a 2020 2020 5570 6461 7465    """.    Update
+000034d0: 202a 7265 6769 6f6e 2a20 7769 7468 202a   *region* with *
+000034e0: 6e62 6f6f 7473 7472 6170 732a 2072 6f75  nbootstraps* rou
+000034f0: 6e64 7320 6f66 2065 7863 6c75 6469 6e67  nds of excluding
+00003500: 2070 6f69 6e74 7320 7261 6e64 6f6d 6c79   points randomly
+00003510: 2e0a 0a20 2020 2053 7469 6666 656e 2065  ...    Stiffen e
+00003520: 6c6c 6970 736f 6964 2073 697a 6520 7573  llipsoid size us
+00003530: 696e 6720 7468 6520 6d69 6e69 6d75 6d20  ing the minimum 
+00003540: 766f 6c75 6d65 202a 6d69 6e76 6f6c 2a2e  volume *minvol*.
+00003550: 0a0a 2020 2020 4966 2074 6865 206d 7069  ..    If the mpi
+00003560: 2063 6f6d 6d75 6e69 6361 746f 7220 2a63   communicator *c
+00003570: 6f6d 6d2a 2069 7320 6e6f 7420 4e6f 6e65  omm* is not None
+00003580: 2c20 7573 6520 4d50 4920 746f 2064 6973  , use MPI to dis
+00003590: 7472 6962 7574 650a 2020 2020 7468 6520  tribute.    the 
+000035a0: 626f 6f74 7374 7261 7073 206f 7665 7220  bootstraps over 
+000035b0: 7468 6520 2a6d 7069 5f73 697a 652a 2070  the *mpi_size* p
+000035c0: 726f 6365 7373 6573 2e0a 2020 2020 2222  rocesses..    ""
+000035d0: 220a 2020 2020 6173 7365 7274 206e 626f  ".    assert nbo
+000035e0: 6f74 7374 7261 7073 203e 2030 2c20 6e62  otstraps > 0, nb
+000035f0: 6f6f 7473 7472 6170 730a 2020 2020 2320  ootstraps.    # 
+00003600: 6361 7463 6820 706f 7465 6e74 6961 6c20  catch potential 
+00003610: 6572 726f 7273 2073 6f20 4d50 4920 7379  errors so MPI sy
+00003620: 6e63 696e 6720 7374 696c 6c20 776f 726b  ncing still work
+00003630: 730a 2020 2020 6520 3d20 4e6f 6e65 0a20  s.    e = None. 
+00003640: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00003650: 722c 2066 203d 2072 6567 696f 6e2e 636f  r, f = region.co
+00003660: 6d70 7574 655f 656e 6c61 7267 656d 656e  mpute_enlargemen
+00003670: 7428 0a20 2020 2020 2020 2020 2020 206d  t(.            m
+00003680: 696e 766f 6c3d 6d69 6e76 6f6c 2c0a 2020  invol=minvol,.  
+00003690: 2020 2020 2020 2020 2020 6e62 6f6f 7473            nboots
+000036a0: 7472 6170 733d 6d61 7828 312c 206e 626f  traps=max(1, nbo
+000036b0: 6f74 7374 7261 7073 202f 2f20 6d70 695f  otstraps // mpi_
+000036c0: 7369 7a65 2929 0a20 2020 2065 7863 6570  size)).    excep
+000036d0: 7420 6e70 2e6c 696e 616c 672e 4c69 6e41  t np.linalg.LinA
+000036e0: 6c67 4572 726f 7220 6173 2065 313a 0a20  lgError as e1:. 
+000036f0: 2020 2020 2020 2065 203d 2065 310a 2020         e = e1.  
+00003700: 2020 2020 2020 722c 2066 203d 206e 702e        r, f = np.
+00003710: 6e61 6e2c 206e 702e 6e61 6e0a 0a20 2020  nan, np.nan..   
+00003720: 2069 6620 636f 6d6d 2069 7320 6e6f 7420   if comm is not 
+00003730: 4e6f 6e65 3a0a 2020 2020 2020 2020 7265  None:.        re
+00003740: 6376 5f6d 6178 7261 6469 6920 3d20 636f  cv_maxradii = co
+00003750: 6d6d 2e67 6174 6865 7228 722c 2072 6f6f  mm.gather(r, roo
+00003760: 743d 3029 0a20 2020 2020 2020 2072 6563  t=0).        rec
+00003770: 765f 6d61 7872 6164 6969 203d 2063 6f6d  v_maxradii = com
+00003780: 6d2e 6263 6173 7428 7265 6376 5f6d 6178  m.bcast(recv_max
+00003790: 7261 6469 692c 2072 6f6f 743d 3029 0a20  radii, root=0). 
+000037a0: 2020 2020 2020 2023 2069 6620 7468 6572         # if ther
+000037b0: 6520 6172 6520 7665 7279 206d 616e 7920  e are very many 
+000037c0: 7072 6f63 6573 736f 7273 2c20 7765 206d  processors, we m
+000037d0: 6179 2068 6176 6520 6d6f 7265 0a20 2020  ay have more.   
+000037e0: 2020 2020 2023 2072 6f75 6e64 7320 7468       # rounds th
+000037f0: 616e 2072 6571 7565 7374 6564 2c20 6c65  an requested, le
+00003800: 6164 696e 6720 746f 2073 6c6f 7764 6f77  ading to slowdow
+00003810: 6e0a 2020 2020 2020 2020 2320 7468 7573  n.        # thus
+00003820: 2077 6520 7468 726f 7720 6177 6179 2074   we throw away t
+00003830: 6865 2065 7874 7261 206f 6e65 730a 2020  he extra ones.  
+00003840: 2020 2020 2020 7220 3d20 6e70 2e6d 6178        r = np.max
+00003850: 2872 6563 765f 6d61 7872 6164 6969 5b3a  (recv_maxradii[:
+00003860: 6e62 6f6f 7473 7472 6170 735d 290a 2020  nbootstraps]).  
+00003870: 2020 2020 2020 7265 6376 5f65 6e6c 6172        recv_enlar
+00003880: 6765 203d 2063 6f6d 6d2e 6761 7468 6572  ge = comm.gather
+00003890: 2866 2c20 726f 6f74 3d30 290a 2020 2020  (f, root=0).    
+000038a0: 2020 2020 7265 6376 5f65 6e6c 6172 6765      recv_enlarge
+000038b0: 203d 2063 6f6d 6d2e 6263 6173 7428 7265   = comm.bcast(re
+000038c0: 6376 5f65 6e6c 6172 6765 2c20 726f 6f74  cv_enlarge, root
+000038d0: 3d30 290a 2020 2020 2020 2020 6620 3d20  =0).        f = 
+000038e0: 6e70 2e6d 6178 2872 6563 765f 656e 6c61  np.max(recv_enla
+000038f0: 7267 655b 3a6e 626f 6f74 7374 7261 7073  rge[:nbootstraps
+00003900: 5d29 0a0a 2020 2020 6966 206e 6f74 206e  ])..    if not n
+00003910: 702e 6973 6669 6e69 7465 2872 2920 616e  p.isfinite(r) an
+00003920: 6420 6e6f 7420 6e70 2e69 7366 696e 6974  d not np.isfinit
+00003930: 6528 7229 3a0a 2020 2020 2020 2020 2320  e(r):.        # 
+00003940: 7265 7261 6973 6520 6572 726f 7220 6966  reraise error if
+00003950: 206e 6565 6465 640a 2020 2020 2020 2020   needed.        
+00003960: 6966 2065 2069 7320 4e6f 6e65 3a0a 2020  if e is None:.  
+00003970: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00003980: 6e70 2e6c 696e 616c 672e 4c69 6e41 6c67  np.linalg.LinAlg
+00003990: 4572 726f 7228 2263 6f6d 7075 7465 5f65  Error("compute_e
+000039a0: 6e6c 6172 6765 6d65 6e74 2066 6169 6c65  nlargement faile
+000039b0: 6422 290a 2020 2020 2020 2020 656c 7365  d").        else
+000039c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000039d0: 6973 6520 650a 0a20 2020 2072 6567 696f  ise e..    regio
+000039e0: 6e2e 6d61 7872 6164 6975 7373 7120 3d20  n.maxradiussq = 
+000039f0: 720a 2020 2020 7265 6769 6f6e 2e65 6e6c  r.    region.enl
+00003a00: 6172 6765 203d 2066 0a20 2020 2072 6574  arge = f.    ret
+00003a10: 7572 6e20 722c 2066 0a0a 0a63 6c61 7373  urn r, f...class
+00003a20: 204e 6573 7465 6453 616d 706c 6572 286f   NestedSampler(o
+00003a30: 626a 6563 7429 3a0a 2020 2020 2222 2253  bject):.    """S
+00003a40: 696d 706c 6520 4e65 7374 6564 2073 616d  imple Nested sam
+00003a50: 706c 6572 2066 6f72 2072 6566 6572 656e  pler for referen
+00003a60: 6365 2e22 2222 0a0a 2020 2020 6465 6620  ce."""..    def 
+00003a70: 5f5f 696e 6974 5f5f 2873 656c 662c 0a20  __init__(self,. 
+00003a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a90: 7061 7261 6d5f 6e61 6d65 732c 0a20 2020  param_names,.   
+00003aa0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00003ab0: 676c 696b 652c 0a20 2020 2020 2020 2020  glike,.         
+00003ac0: 2020 2020 2020 2020 7472 616e 7366 6f72          transfor
+00003ad0: 6d3d 4e6f 6e65 2c0a 2020 2020 2020 2020  m=None,.        
+00003ae0: 2020 2020 2020 2020 2064 6572 6976 6564           derived
+00003af0: 5f70 6172 616d 5f6e 616d 6573 3d5b 5d2c  _param_names=[],
+00003b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003b10: 2020 7265 7375 6d65 3d27 7375 6266 6f6c    resume='subfol
+00003b20: 6465 7227 2c0a 2020 2020 2020 2020 2020  der',.          
+00003b30: 2020 2020 2020 2072 756e 5f6e 756d 3d4e         run_num=N
+00003b40: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00003b50: 2020 2020 2020 6c6f 675f 6469 723d 276c        log_dir='l
+00003b60: 6f67 732f 7465 7374 272c 0a20 2020 2020  ogs/test',.     
+00003b70: 2020 2020 2020 2020 2020 2020 6e75 6d5f              num_
+00003b80: 6c69 7665 5f70 6f69 6e74 733d 3130 3030  live_points=1000
+00003b90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003ba0: 2020 2076 6563 746f 7269 7a65 643d 4661     vectorized=Fa
+00003bb0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00003bc0: 2020 2020 2020 7772 6170 7065 645f 7061        wrapped_pa
+00003bd0: 7261 6d73 3d5b 5d2c 0a20 2020 2020 2020  rams=[],.       
+00003be0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00003bf0: 2020 2020 2022 2222 5365 7420 7570 206e       """Set up n
+00003c00: 6573 7465 6420 7361 6d70 6c65 722e 0a0a  ested sampler...
+00003c10: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+00003c20: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+00003c30: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2070  ------.        p
+00003c40: 6172 616d 5f6e 616d 6573 3a20 6c69 7374  aram_names: list
+00003c50: 206f 6620 7374 722c 206e 616d 6573 206f   of str, names o
+00003c60: 6620 7468 6520 7061 7261 6d65 7465 7273  f the parameters
+00003c70: 2e0a 2020 2020 2020 2020 2020 2020 4c65  ..            Le
+00003c80: 6e67 7468 2067 6976 6573 2064 696d 656e  ngth gives dimen
+00003c90: 7369 6f6e 616c 6974 7920 6f66 2074 6865  sionality of the
+00003ca0: 2073 616d 706c 696e 6720 7072 6f62 6c65   sampling proble
+00003cb0: 6d2e 0a20 2020 2020 2020 206c 6f67 6c69  m..        logli
+00003cc0: 6b65 3a20 6675 6e63 7469 6f6e 0a20 2020  ke: function.   
+00003cd0: 2020 2020 2020 2020 206c 6f67 2d6c 696b           log-lik
+00003ce0: 656c 6968 6f6f 6420 6675 6e63 7469 6f6e  elihood function
+00003cf0: 2e0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
+00003d00: 6365 6976 6573 206d 756c 7469 706c 6520  ceives multiple 
+00003d10: 7061 7261 6d65 7465 7220 7665 6374 6f72  parameter vector
+00003d20: 732c 2072 6574 7572 6e73 2076 6563 746f  s, returns vecto
+00003d30: 7220 6f66 206c 696b 656c 6968 6f6f 642e  r of likelihood.
+00003d40: 0a20 2020 2020 2020 2074 7261 6e73 666f  .        transfo
+00003d50: 726d 3a20 6675 6e63 7469 6f6e 0a20 2020  rm: function.   
+00003d60: 2020 2020 2020 2020 2070 6172 616d 6574           paramet
+00003d70: 6572 2074 7261 6e73 666f 726d 2066 726f  er transform fro
+00003d80: 6d20 756e 6974 2063 7562 6520 746f 2070  m unit cube to p
+00003d90: 6879 7369 6361 6c20 7061 7261 6d65 7465  hysical paramete
+00003da0: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
+00003db0: 5265 6365 6976 6573 206d 756c 7469 706c  Receives multipl
+00003dc0: 6520 6375 6265 2076 6563 746f 7273 2c20  e cube vectors, 
+00003dd0: 7265 7475 726e 7320 6d75 6c74 6970 6c65  returns multiple
+00003de0: 2070 6172 616d 6574 6572 2076 6563 746f   parameter vecto
+00003df0: 7273 2e0a 2020 2020 2020 2020 6465 7269  rs..        deri
+00003e00: 7665 645f 7061 7261 6d5f 6e61 6d65 733a  ved_param_names:
+00003e10: 206c 6973 7420 6f66 2073 7472 0a20 2020   list of str.   
+00003e20: 2020 2020 2020 2020 2041 6464 6974 696f           Additio
+00003e30: 6e61 6c20 6465 7269 7665 6420 7061 7261  nal derived para
+00003e40: 6d65 7465 7273 2063 7265 6174 6564 2062  meters created b
+00003e50: 7920 7472 616e 7366 6f72 6d2e 2028 656d  y transform. (em
+00003e60: 7074 7920 6279 2064 6566 6175 6c74 290a  pty by default).
+00003e70: 2020 2020 2020 2020 6c6f 675f 6469 723a          log_dir:
+00003e80: 2073 7472 0a20 2020 2020 2020 2020 2020   str.           
+00003e90: 2077 6865 7265 2074 6f20 7374 6f72 6520   where to store 
+00003ea0: 6f75 7470 7574 2066 696c 6573 0a20 2020  output files.   
+00003eb0: 2020 2020 2072 6573 756d 653a 2027 7265       resume: 're
+00003ec0: 7375 6d65 272c 2027 6f76 6572 7772 6974  sume', 'overwrit
+00003ed0: 6527 206f 7220 2773 7562 666f 6c64 6572  e' or 'subfolder
+00003ee0: 270a 2020 2020 2020 2020 2020 2020 6966  '.            if
+00003ef0: 2027 6f76 6572 7772 6974 6527 2c20 6f76   'overwrite', ov
+00003f00: 6572 7772 6974 6520 7072 6576 696f 7573  erwrite previous
+00003f10: 2064 6174 612e 0a20 2020 2020 2020 2020   data..         
+00003f20: 2020 2069 6620 2773 7562 666f 6c64 6572     if 'subfolder
+00003f30: 272c 2063 7265 6174 6520 6120 6672 6573  ', create a fres
+00003f40: 6820 7375 6264 6972 6563 746f 7279 2069  h subdirectory i
+00003f50: 6e20 6c6f 675f 6469 722e 0a20 2020 2020  n log_dir..     
+00003f60: 2020 2020 2020 2069 6620 2772 6573 756d         if 'resum
+00003f70: 6527 206f 7220 5472 7565 2c20 636f 6e74  e' or True, cont
+00003f80: 696e 7565 2070 7265 7669 6f75 7320 7275  inue previous ru
+00003f90: 6e20 6966 2061 7661 696c 6162 6c65 2e0a  n if available..
+00003fa0: 2020 2020 2020 2020 7772 6170 7065 645f          wrapped_
+00003fb0: 7061 7261 6d73 3a20 6c69 7374 206f 6620  params: list of 
+00003fc0: 626f 6f6c 730a 2020 2020 2020 2020 2020  bools.          
+00003fd0: 2020 696e 6469 6361 7469 6e67 2077 6865    indicating whe
+00003fe0: 7468 6572 2074 6869 7320 7061 7261 6d65  ther this parame
+00003ff0: 7465 7220 7772 6170 7320 6172 6f75 6e64  ter wraps around
+00004000: 2028 6369 7263 756c 6172 2070 6172 616d   (circular param
+00004010: 6574 6572 292e 0a20 2020 2020 2020 206e  eter)..        n
+00004020: 756d 5f6c 6976 655f 706f 696e 7473 3a20  um_live_points: 
+00004030: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
+00004040: 4e75 6d62 6572 206f 6620 6c69 7665 2070  Number of live p
+00004050: 6f69 6e74 730a 2020 2020 2020 2020 7665  oints.        ve
+00004060: 6374 6f72 697a 6564 3a20 626f 6f6c 0a20  ctorized: bool. 
+00004070: 2020 2020 2020 2020 2020 2049 6620 7472             If tr
+00004080: 7565 2c20 6c6f 676c 696b 6520 616e 6420  ue, loglike and 
+00004090: 7472 616e 7366 6f72 6d20 6675 6e63 7469  transform functi
+000040a0: 6f6e 2063 616e 2072 6563 6569 7665 2061  on can receive a
+000040b0: 7272 6179 730a 2020 2020 2020 2020 2020  rrays.          
+000040c0: 2020 6f66 2070 6f69 6e74 732e 0a20 2020    of points..   
+000040d0: 2020 2020 2072 756e 5f6e 756d 3a20 696e       run_num: in
+000040e0: 740a 2020 2020 2020 2020 2020 2020 756e  t.            un
+000040f0: 6971 7565 2072 756e 206e 756d 6265 722e  ique run number.
+00004100: 2049 6620 4e6f 6e65 2c20 7769 6c6c 2062   If None, will b
+00004110: 6520 6175 746f 6d61 7469 6361 6c6c 7920  e automatically 
+00004120: 696e 6372 656d 656e 7465 642e 0a0a 2020  incremented...  
+00004130: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00004140: 2020 7365 6c66 2e70 6172 616d 6e61 6d65    self.paramname
+00004150: 7320 3d20 6c69 7374 2870 6172 616d 5f6e  s = list(param_n
+00004160: 616d 6573 290a 2020 2020 2020 2020 785f  ames).        x_
+00004170: 6469 6d20 3d20 6c65 6e28 7365 6c66 2e70  dim = len(self.p
+00004180: 6172 616d 6e61 6d65 7329 0a20 2020 2020  aramnames).     
+00004190: 2020 2073 656c 662e 6e75 6d5f 6c69 7665     self.num_live
+000041a0: 5f70 6f69 6e74 7320 3d20 6e75 6d5f 6c69  _points = num_li
+000041b0: 7665 5f70 6f69 6e74 730a 2020 2020 2020  ve_points.      
+000041c0: 2020 7365 6c66 2e73 616d 706c 6572 203d    self.sampler =
+000041d0: 2027 6e65 7374 6564 270a 2020 2020 2020   'nested'.      
+000041e0: 2020 7365 6c66 2e78 5f64 696d 203d 2078    self.x_dim = x
+000041f0: 5f64 696d 0a20 2020 2020 2020 2073 656c  _dim.        sel
+00004200: 662e 6465 7269 7665 6470 6172 616d 6e61  f.derivedparamna
+00004210: 6d65 7320 3d20 6465 7269 7665 645f 7061  mes = derived_pa
+00004220: 7261 6d5f 6e61 6d65 730a 2020 2020 2020  ram_names.      
+00004230: 2020 6e75 6d5f 6465 7269 7665 6420 3d20    num_derived = 
+00004240: 6c65 6e28 7365 6c66 2e64 6572 6976 6564  len(self.derived
+00004250: 7061 7261 6d6e 616d 6573 290a 2020 2020  paramnames).    
+00004260: 2020 2020 7365 6c66 2e6e 756d 5f70 6172      self.num_par
+00004270: 616d 7320 3d20 785f 6469 6d20 2b20 6e75  ams = x_dim + nu
+00004280: 6d5f 6465 7269 7665 640a 2020 2020 2020  m_derived.      
+00004290: 2020 7365 6c66 2e76 6f6c 6661 6374 6f72    self.volfactor
+000042a0: 203d 2076 6f6c 5f70 7265 6661 6374 6f72   = vol_prefactor
+000042b0: 2873 656c 662e 785f 6469 6d29 0a20 2020  (self.x_dim).   
+000042c0: 2020 2020 2069 6620 7772 6170 7065 645f       if wrapped_
+000042d0: 7061 7261 6d73 2069 7320 4e6f 6e65 3a0a  params is None:.
+000042e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000042f0: 2e77 7261 7070 6564 5f61 7865 7320 3d20  .wrapped_axes = 
+00004300: 5b5d 0a20 2020 2020 2020 2065 6c73 653a  [].        else:
+00004310: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004320: 662e 7772 6170 7065 645f 6178 6573 203d  f.wrapped_axes =
+00004330: 206e 702e 7768 6572 6528 7772 6170 7065   np.where(wrappe
+00004340: 645f 7061 7261 6d73 295b 305d 0a0a 2020  d_params)[0]..  
+00004350: 2020 2020 2020 6173 7365 7274 2072 6573        assert res
+00004360: 756d 6520 6f72 2072 6573 756d 6520 696e  ume or resume in
+00004370: 2028 276f 7665 7277 7269 7465 272c 2027   ('overwrite', '
+00004380: 7375 6266 6f6c 6465 7227 2c20 2772 6573  subfolder', 'res
+00004390: 756d 6527 292c 2022 7265 7375 6d65 2073  ume'), "resume s
+000043a0: 686f 756c 6420 6265 206f 6e65 206f 6620  hould be one of 
+000043b0: 276f 7665 7277 7269 7465 2720 2773 7562  'overwrite' 'sub
+000043c0: 666f 6c64 6572 2720 6f72 2027 7265 7375  folder' or 'resu
+000043d0: 6d65 2722 0a20 2020 2020 2020 2061 7070  me'".        app
+000043e0: 656e 645f 7275 6e5f 6e75 6d20 3d20 7265  end_run_num = re
+000043f0: 7375 6d65 203d 3d20 2773 7562 666f 6c64  sume == 'subfold
+00004400: 6572 270a 2020 2020 2020 2020 7265 7375  er'.        resu
+00004410: 6d65 203d 2072 6573 756d 6520 3d3d 2027  me = resume == '
+00004420: 7265 7375 6d65 2720 6f72 2072 6573 756d  resume' or resum
+00004430: 650a 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
+00004440: 7420 7665 6374 6f72 697a 6564 3a0a 2020  t vectorized:.  
+00004450: 2020 2020 2020 2020 2020 7472 616e 7366            transf
+00004460: 6f72 6d20 3d20 7665 6374 6f72 697a 6528  orm = vectorize(
+00004470: 7472 616e 7366 6f72 6d29 0a20 2020 2020  transform).     
+00004480: 2020 2020 2020 206c 6f67 6c69 6b65 203d         loglike =
+00004490: 2076 6563 746f 7269 7a65 286c 6f67 6c69   vectorize(logli
+000044a0: 6b65 290a 0a20 2020 2020 2020 2069 6620  ke)..        if 
+000044b0: 7472 616e 7366 6f72 6d20 6973 204e 6f6e  transform is Non
+000044c0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000044d0: 656c 662e 7472 616e 7366 6f72 6d20 3d20  elf.transform = 
+000044e0: 6c61 6d62 6461 2078 3a20 780a 2020 2020  lambda x: x.    
+000044f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00004500: 2020 2020 2020 7365 6c66 2e74 7261 6e73        self.trans
+00004510: 666f 726d 203d 2074 7261 6e73 666f 726d  form = transform
+00004520: 0a0a 2020 2020 2020 2020 7520 3d20 6e70  ..        u = np
+00004530: 2e72 616e 646f 6d2e 756e 6966 6f72 6d28  .random.uniform(
+00004540: 7369 7a65 3d28 322c 2073 656c 662e 785f  size=(2, self.x_
+00004550: 6469 6d29 290a 2020 2020 2020 2020 7020  dim)).        p 
+00004560: 3d20 7365 6c66 2e74 7261 6e73 666f 726d  = self.transform
+00004570: 2875 290a 2020 2020 2020 2020 6173 7365  (u).        asse
+00004580: 7274 2070 2e73 6861 7065 203d 3d20 2832  rt p.shape == (2
+00004590: 2c20 7365 6c66 2e6e 756d 5f70 6172 616d  , self.num_param
+000045a0: 7329 2c20 2822 4572 726f 7220 696e 2074  s), ("Error in t
+000045b0: 7261 6e73 666f 726d 2066 756e 6374 696f  ransform functio
+000045c0: 6e3a 2072 6574 7572 6e65 6420 7368 6170  n: returned shap
+000045d0: 6520 6973 2025 732c 2065 7870 6563 7465  e is %s, expecte
+000045e0: 6420 2573 2220 2520 2870 2e73 6861 7065  d %s" % (p.shape
+000045f0: 2c20 2832 2c20 7365 6c66 2e6e 756d 5f70  , (2, self.num_p
+00004600: 6172 616d 7329 2929 0a20 2020 2020 2020  arams))).       
+00004610: 206c 6f67 6c20 3d20 6c6f 676c 696b 6528   logl = loglike(
+00004620: 7029 0a20 2020 2020 2020 2061 7373 6572  p).        asser
+00004630: 7420 6e70 2e6c 6f67 6963 616c 5f61 6e64  t np.logical_and
+00004640: 2875 203e 2030 2c20 7520 3c20 3129 2e61  (u > 0, u < 1).a
+00004650: 6c6c 2829 2c20 2822 4572 726f 7220 696e  ll(), ("Error in
+00004660: 2074 7261 6e73 666f 726d 2066 756e 6374   transform funct
+00004670: 696f 6e3a 2075 2077 6173 206d 6f64 6966  ion: u was modif
+00004680: 6965 6421 2229 0a20 2020 2020 2020 2061  ied!").        a
+00004690: 7373 6572 7420 6e70 2e73 6861 7065 286c  ssert np.shape(l
+000046a0: 6f67 6c29 203d 3d20 2832 2c29 2c20 2822  ogl) == (2,), ("
+000046b0: 4572 726f 7220 696e 206c 6f67 6c69 6b65  Error in loglike
+000046c0: 6c69 686f 6f64 2066 756e 6374 696f 6e3a  lihood function:
+000046d0: 2072 6574 7572 6e65 6420 7368 6170 6520   returned shape 
+000046e0: 6973 2025 732c 2065 7870 6563 7465 6420  is %s, expected 
+000046f0: 2573 2220 2520 2870 2e73 6861 7065 2c20  %s" % (p.shape, 
+00004700: 2832 2c20 7365 6c66 2e6e 756d 5f70 6172  (2, self.num_par
+00004710: 616d 7329 2929 0a20 2020 2020 2020 2061  ams))).        a
+00004720: 7373 6572 7420 6e70 2e69 7366 696e 6974  ssert np.isfinit
+00004730: 6528 6c6f 676c 292e 616c 6c28 292c 2028  e(logl).all(), (
+00004740: 2245 7272 6f72 2069 6e20 6c6f 676c 696b  "Error in loglik
+00004750: 656c 6968 6f6f 6420 6675 6e63 7469 6f6e  elihood function
+00004760: 3a20 7265 7475 726e 6564 206e 6f6e 2d66  : returned non-f
+00004770: 696e 6974 6520 6e75 6d62 6572 3a20 2573  inite number: %s
+00004780: 2066 6f72 2069 6e70 7574 2075 3d25 7320   for input u=%s 
+00004790: 703d 2573 2220 2520 286c 6f67 6c2c 2075  p=%s" % (logl, u
+000047a0: 2c20 7029 290a 0a20 2020 2020 2020 2064  , p))..        d
+000047b0: 6566 2073 6166 655f 6c6f 676c 696b 6528  ef safe_loglike(
+000047c0: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
+000047d0: 2222 2243 616c 6c20 6c69 6b65 6c69 686f  """Call likeliho
+000047e0: 6f64 2066 756e 6374 696f 6e20 7361 6665  od function safe
+000047f0: 6c79 2077 7261 7070 6564 2074 6f20 6176  ly wrapped to av
+00004800: 6f69 6420 6e6f 6e2d 6669 6e69 7465 2076  oid non-finite v
+00004810: 616c 7565 732e 2222 220a 2020 2020 2020  alues.""".      
+00004820: 2020 2020 2020 7820 3d20 6e70 2e61 7361        x = np.asa
+00004830: 7272 6179 2878 290a 2020 2020 2020 2020  rray(x).        
+00004840: 2020 2020 6c6f 676c 203d 206c 6f67 6c69      logl = logli
+00004850: 6b65 2878 290a 2020 2020 2020 2020 2020  ke(x).          
+00004860: 2020 6173 7365 7274 206e 702e 6973 6669    assert np.isfi
+00004870: 6e69 7465 286c 6f67 6c29 2e61 6c6c 2829  nite(logl).all()
+00004880: 2c20 280a 2020 2020 2020 2020 2020 2020  , (.            
+00004890: 2020 2020 2755 7365 722d 7072 6f76 6964      'User-provid
+000048a0: 6564 206c 6f67 6c69 6b65 6c69 686f 6f64  ed loglikelihood
+000048b0: 2072 6574 7572 6e65 6420 6e6f 6e2d 6669   returned non-fi
+000048c0: 6e69 7465 2076 616c 7565 3a27 2c0a 2020  nite value:',.  
+000048d0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+000048e0: 676c 5b7e 6e70 2e69 7366 696e 6974 6528  gl[~np.isfinite(
+000048f0: 6c6f 676c 295d 5b30 5d2c 0a20 2020 2020  logl)][0],.     
+00004900: 2020 2020 2020 2020 2020 2022 666f 7220             "for 
+00004910: 696e 7075 7420 7661 6c75 653a 222c 0a20  input value:",. 
+00004920: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00004930: 5b7e 6e70 2e69 7366 696e 6974 6528 6c6f  [~np.isfinite(lo
+00004940: 676c 292c 3a5d 5b30 2c3a 5d29 0a20 2020  gl),:][0,:]).   
+00004950: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00004960: 6c6f 676c 0a0a 2020 2020 2020 2020 7365  logl..        se
+00004970: 6c66 2e6c 6f67 6c69 6b65 203d 2073 6166  lf.loglike = saf
+00004980: 655f 6c6f 676c 696b 650a 0a20 2020 2020  e_loglike..     
+00004990: 2020 2073 656c 662e 7573 655f 6d70 6920     self.use_mpi 
+000049a0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+000049b0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000049c0: 2066 726f 6d20 6d70 6934 7079 2069 6d70   from mpi4py imp
+000049d0: 6f72 7420 4d50 490a 2020 2020 2020 2020  ort MPI.        
+000049e0: 2020 2020 7365 6c66 2e63 6f6d 6d20 3d20      self.comm = 
+000049f0: 4d50 492e 434f 4d4d 5f57 4f52 4c44 0a20  MPI.COMM_WORLD. 
+00004a00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004a10: 6d70 695f 7369 7a65 203d 2073 656c 662e  mpi_size = self.
+00004a20: 636f 6d6d 2e47 6574 5f73 697a 6528 290a  comm.Get_size().
+00004a30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00004a40: 2e6d 7069 5f72 616e 6b20 3d20 7365 6c66  .mpi_rank = self
+00004a50: 2e63 6f6d 6d2e 4765 745f 7261 6e6b 2829  .comm.Get_rank()
+00004a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004a70: 7365 6c66 2e6d 7069 5f73 697a 6520 3e20  self.mpi_size > 
+00004a80: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00004a90: 2020 2073 656c 662e 7573 655f 6d70 6920     self.use_mpi 
+00004aa0: 3d20 5472 7565 0a20 2020 2020 2020 2065  = True.        e
+00004ab0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+00004ac0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004ad0: 662e 6d70 695f 7369 7a65 203d 2031 0a20  f.mpi_size = 1. 
+00004ae0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004af0: 6d70 695f 7261 6e6b 203d 2030 0a0a 2020  mpi_rank = 0..  
+00004b00: 2020 2020 2020 7365 6c66 2e6c 6f67 203d        self.log =
+00004b10: 2073 656c 662e 6d70 695f 7261 6e6b 203d   self.mpi_rank =
+00004b20: 3d20 300a 2020 2020 2020 2020 7365 6c66  = 0.        self
+00004b30: 2e6c 6f67 5f74 6f5f 6469 736b 203d 2073  .log_to_disk = s
+00004b40: 656c 662e 6c6f 6720 616e 6420 6c6f 675f  elf.log and log_
+00004b50: 6469 7220 6973 206e 6f74 204e 6f6e 650a  dir is not None.
+00004b60: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00004b70: 2e6c 6f67 2061 6e64 206c 6f67 5f64 6972  .log and log_dir
+00004b80: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00004b90: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00004ba0: 6f67 7320 3d20 6d61 6b65 5f72 756e 5f64  ogs = make_run_d
+00004bb0: 6972 286c 6f67 5f64 6972 2c20 7275 6e5f  ir(log_dir, run_
+00004bc0: 6e75 6d2c 2061 7070 656e 645f 7275 6e5f  num, append_run_
+00004bd0: 6e75 6d3d 6170 7065 6e64 5f72 756e 5f6e  num=append_run_n
+00004be0: 756d 290a 2020 2020 2020 2020 2020 2020  um).            
+00004bf0: 6c6f 675f 6469 7220 3d20 7365 6c66 2e6c  log_dir = self.l
+00004c00: 6f67 735b 2772 756e 5f64 6972 275d 0a20  ogs['run_dir']. 
+00004c10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00004c20: 2020 2020 2020 2020 206c 6f67 5f64 6972           log_dir
+00004c30: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+00004c40: 2073 656c 662e 6c6f 6767 6572 203d 2063   self.logger = c
+00004c50: 7265 6174 655f 6c6f 6767 6572 285f 5f6e  reate_logger(__n
+00004c60: 616d 655f 5f20 2b20 272e 2720 2b20 7479  ame__ + '.' + ty
+00004c70: 7065 2873 656c 6629 2e5f 5f6e 616d 655f  pe(self).__name_
+00004c80: 5f2c 206c 6f67 5f64 6972 3d6c 6f67 5f64  _, log_dir=log_d
+00004c90: 6972 290a 0a20 2020 2020 2020 2069 6620  ir)..        if 
+00004ca0: 7365 6c66 2e6c 6f67 3a0a 2020 2020 2020  self.log:.      
+00004cb0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+00004cc0: 722e 696e 666f 2827 4e75 6d20 6c69 7665  r.info('Num live
+00004cd0: 2070 6f69 6e74 7320 5b25 645d 272c 2073   points [%d]', s
+00004ce0: 656c 662e 6e75 6d5f 6c69 7665 5f70 6f69  elf.num_live_poi
+00004cf0: 6e74 7329 0a0a 2020 2020 2020 2020 6966  nts)..        if
+00004d00: 2073 656c 662e 6c6f 675f 746f 5f64 6973   self.log_to_dis
+00004d10: 6b3a 0a20 2020 2020 2020 2020 2020 2023  k:.            #
+00004d20: 2073 656c 662e 706f 696e 7473 746f 7265   self.pointstore
+00004d30: 203d 2054 6578 7450 6f69 6e74 5374 6f72   = TextPointStor
+00004d40: 6528 6f73 2e70 6174 682e 6a6f 696e 2873  e(os.path.join(s
+00004d50: 656c 662e 6c6f 6773 5b27 7265 7375 6c74  elf.logs['result
+00004d60: 7327 5d2c 2027 706f 696e 7473 2e74 7376  s'], 'points.tsv
+00004d70: 2729 2c20 3220 2b20 7365 6c66 2e78 5f64  '), 2 + self.x_d
+00004d80: 696d 202b 2073 656c 662e 6e75 6d5f 7061  im + self.num_pa
+00004d90: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
+00004da0: 2020 7365 6c66 2e70 6f69 6e74 7374 6f72    self.pointstor
+00004db0: 6520 3d20 4844 4635 506f 696e 7453 746f  e = HDF5PointSto
+00004dc0: 7265 280a 2020 2020 2020 2020 2020 2020  re(.            
+00004dd0: 2020 2020 6f73 2e70 6174 682e 6a6f 696e      os.path.join
+00004de0: 2873 656c 662e 6c6f 6773 5b27 7265 7375  (self.logs['resu
+00004df0: 6c74 7327 5d2c 2027 706f 696e 7473 2e68  lts'], 'points.h
+00004e00: 6466 3527 292c 0a20 2020 2020 2020 2020  df5'),.         
+00004e10: 2020 2020 2020 2033 202b 2073 656c 662e         3 + self.
+00004e20: 785f 6469 6d20 2b20 7365 6c66 2e6e 756d  x_dim + self.num
+00004e30: 5f70 6172 616d 732c 206d 6f64 653d 2761  _params, mode='a
+00004e40: 2720 6966 2072 6573 756d 6520 656c 7365  ' if resume else
+00004e50: 2027 7727 290a 2020 2020 2020 2020 656c   'w').        el
+00004e60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00004e70: 7365 6c66 2e70 6f69 6e74 7374 6f72 6520  self.pointstore 
+00004e80: 3d20 4e75 6c6c 506f 696e 7453 746f 7265  = NullPointStore
+00004e90: 2833 202b 2073 656c 662e 785f 6469 6d20  (3 + self.x_dim 
+00004ea0: 2b20 7365 6c66 2e6e 756d 5f70 6172 616d  + self.num_param
+00004eb0: 7329 0a0a 2020 2020 6465 6620 7275 6e28  s)..    def run(
+00004ec0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004ed0: 662c 0a20 2020 2020 2020 2020 2020 2075  f,.            u
+00004ee0: 7064 6174 655f 696e 7465 7276 616c 5f69  pdate_interval_i
+00004ef0: 7465 723d 4e6f 6e65 2c0a 2020 2020 2020  ter=None,.      
+00004f00: 2020 2020 2020 7570 6461 7465 5f69 6e74        update_int
+00004f10: 6572 7661 6c5f 6e63 616c 6c3d 4e6f 6e65  erval_ncall=None
+00004f20: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+00004f30: 675f 696e 7465 7276 616c 3d4e 6f6e 652c  g_interval=None,
+00004f40: 0a20 2020 2020 2020 2020 2020 2064 6c6f  .            dlo
+00004f50: 677a 3d30 2e30 3031 2c0a 2020 2020 2020  gz=0.001,.      
+00004f60: 2020 2020 2020 6d61 785f 6974 6572 733d        max_iters=
+00004f70: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+00004f80: 2222 4578 706c 6f72 6520 7061 7261 6d65  ""Explore parame
+00004f90: 7465 7220 7370 6163 652e 0a0a 2020 2020  ter space...    
+00004fa0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00004fb0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00004fc0: 2d0a 2020 2020 2020 2020 7570 6461 7465  -.        update
+00004fd0: 5f69 6e74 6572 7661 6c5f 6974 6572 3a0a  _interval_iter:.
+00004fe0: 2020 2020 2020 2020 2020 2020 5570 6461              Upda
+00004ff0: 7465 2072 6567 696f 6e20 6166 7465 7220  te region after 
+00005000: 7468 6973 206d 616e 7920 6974 6572 6174  this many iterat
+00005010: 696f 6e73 2e0a 2020 2020 2020 2020 7570  ions..        up
+00005020: 6461 7465 5f69 6e74 6572 7661 6c5f 6e63  date_interval_nc
+00005030: 616c 6c3a 0a20 2020 2020 2020 2020 2020  all:.           
+00005040: 2055 7064 6174 6520 7265 6769 6f6e 2061   Update region a
+00005050: 6674 6572 2075 7064 6174 655f 696e 7465  fter update_inte
+00005060: 7276 616c 5f6e 6361 6c6c 206c 696b 656c  rval_ncall likel
+00005070: 6968 6f6f 6420 6361 6c6c 732e 0a20 2020  ihood calls..   
+00005080: 2020 2020 206c 6f67 5f69 6e74 6572 7661       log_interva
+00005090: 6c3a 0a20 2020 2020 2020 2020 2020 2055  l:.            U
+000050a0: 7064 6174 6520 7374 646f 7574 2073 7461  pdate stdout sta
+000050b0: 7475 7320 6c69 6e65 2065 7665 7279 206c  tus line every l
+000050c0: 6f67 5f69 6e74 6572 7661 6c20 6974 6572  og_interval iter
+000050d0: 6174 696f 6e73 0a20 2020 2020 2020 2064  ations.        d
+000050e0: 6c6f 677a 3a0a 2020 2020 2020 2020 2020  logz:.          
+000050f0: 2020 5461 7267 6574 2065 7669 6465 6e63    Target evidenc
+00005100: 6520 756e 6365 7274 6169 6e74 792e 0a20  e uncertainty.. 
+00005110: 2020 2020 2020 206d 6178 5f69 7465 7273         max_iters
+00005120: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+00005130: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
+00005140: 696e 7465 6772 6174 696f 6e20 6974 6572  integration iter
+00005150: 6174 696f 6e73 2e0a 0a20 2020 2020 2020  ations...       
+00005160: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00005170: 7570 6461 7465 5f69 6e74 6572 7661 6c5f  update_interval_
+00005180: 6e63 616c 6c20 6973 204e 6f6e 653a 0a20  ncall is None:. 
+00005190: 2020 2020 2020 2020 2020 2075 7064 6174             updat
+000051a0: 655f 696e 7465 7276 616c 5f6e 6361 6c6c  e_interval_ncall
+000051b0: 203d 206d 6178 2831 2c20 726f 756e 6428   = max(1, round(
+000051c0: 7365 6c66 2e6e 756d 5f6c 6976 655f 706f  self.num_live_po
+000051d0: 696e 7473 2929 0a0a 2020 2020 2020 2020  ints))..        
+000051e0: 6966 2075 7064 6174 655f 696e 7465 7276  if update_interv
+000051f0: 616c 5f69 7465 7220 6973 204e 6f6e 653a  al_iter is None:
+00005200: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005210: 7570 6461 7465 5f69 6e74 6572 7661 6c5f  update_interval_
+00005220: 6e63 616c 6c20 3d3d 2030 3a0a 2020 2020  ncall == 0:.    
+00005230: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+00005240: 7465 5f69 6e74 6572 7661 6c5f 6974 6572  te_interval_iter
+00005250: 203d 206d 6178 2831 2c20 726f 756e 6428   = max(1, round(
+00005260: 7365 6c66 2e6e 756d 5f6c 6976 655f 706f  self.num_live_po
+00005270: 696e 7473 2929 0a20 2020 2020 2020 2020  ints)).         
+00005280: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00005290: 2020 2020 2020 2020 2075 7064 6174 655f           update_
+000052a0: 696e 7465 7276 616c 5f69 7465 7220 3d20  interval_iter = 
+000052b0: 6d61 7828 312c 2072 6f75 6e64 2830 2e32  max(1, round(0.2
+000052c0: 202a 2073 656c 662e 6e75 6d5f 6c69 7665   * self.num_live
+000052d0: 5f70 6f69 6e74 7329 290a 0a20 2020 2020  _points))..     
+000052e0: 2020 2069 6620 6c6f 675f 696e 7465 7276     if log_interv
+000052f0: 616c 2069 7320 4e6f 6e65 3a0a 2020 2020  al is None:.    
+00005300: 2020 2020 2020 2020 6c6f 675f 696e 7465          log_inte
+00005310: 7276 616c 203d 206d 6178 2831 2c20 726f  rval = max(1, ro
+00005320: 756e 6428 302e 3220 2a20 7365 6c66 2e6e  und(0.2 * self.n
+00005330: 756d 5f6c 6976 655f 706f 696e 7473 2929  um_live_points))
+00005340: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00005350: 2020 2020 2020 2020 2020 206c 6f67 5f69             log_i
+00005360: 6e74 6572 7661 6c20 3d20 726f 756e 6428  nterval = round(
+00005370: 6c6f 675f 696e 7465 7276 616c 290a 2020  log_interval).  
+00005380: 2020 2020 2020 2020 2020 6966 206c 6f67            if log
+00005390: 5f69 6e74 6572 7661 6c20 3c20 313a 0a20  _interval < 1:. 
+000053a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000053b0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000053c0: 226c 6f67 5f69 6e74 6572 7661 6c20 6d75  "log_interval mu
+000053d0: 7374 2062 6520 3e3d 2031 2229 0a0a 2020  st be >= 1")..  
+000053e0: 2020 2020 2020 7669 7a5f 6361 6c6c 6261        viz_callba
+000053f0: 636b 203d 2067 6574 5f64 6566 6175 6c74  ck = get_default
+00005400: 5f76 697a 5f63 616c 6c62 6163 6b28 290a  _viz_callback().
+00005410: 0a20 2020 2020 2020 2070 7265 765f 7520  .        prev_u 
+00005420: 3d20 5b5d 0a20 2020 2020 2020 2070 7265  = [].        pre
+00005430: 765f 7620 3d20 5b5d 0a20 2020 2020 2020  v_v = [].       
+00005440: 2070 7265 765f 6c6f 676c 203d 205b 5d0a   prev_logl = [].
+00005450: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00005460: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
+00005470: 2023 2074 7279 2074 6f20 7265 7375 6d65   # try to resume
+00005480: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00005490: 6c66 2e6c 6f67 6765 722e 696e 666f 2827  lf.logger.info('
+000054a0: 5265 7375 6d69 6e67 2e2e 2e27 290a 2020  Resuming...').  
+000054b0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+000054c0: 696e 2072 616e 6765 2873 656c 662e 6e75  in range(self.nu
+000054d0: 6d5f 6c69 7665 5f70 6f69 6e74 7329 3a0a  m_live_points):.
+000054e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054f0: 5f2c 2072 6f77 203d 2073 656c 662e 706f  _, row = self.po
+00005500: 696e 7473 746f 7265 2e70 6f70 282d 6e70  intstore.pop(-np
+00005510: 2e69 6e66 290a 2020 2020 2020 2020 2020  .inf).          
+00005520: 2020 2020 2020 6966 2072 6f77 2069 7320        if row is 
+00005530: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00005540: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00005550: 6576 5f6c 6f67 6c2e 6170 7065 6e64 2872  ev_logl.append(r
+00005560: 6f77 5b31 5d29 0a20 2020 2020 2020 2020  ow[1]).         
+00005570: 2020 2020 2020 2020 2020 2070 7265 765f             prev_
+00005580: 752e 6170 7065 6e64 2872 6f77 5b33 3a33  u.append(row[3:3
+00005590: 202b 2073 656c 662e 785f 6469 6d5d 290a   + self.x_dim]).
+000055a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055b0: 2020 2020 7072 6576 5f76 2e61 7070 656e      prev_v.appen
+000055c0: 6428 726f 775b 3320 2b20 7365 6c66 2e78  d(row[3 + self.x
+000055d0: 5f64 696d 3a33 202b 2073 656c 662e 785f  _dim:3 + self.x_
+000055e0: 6469 6d20 2b20 7365 6c66 2e6e 756d 5f70  dim + self.num_p
+000055f0: 6172 616d 735d 290a 2020 2020 2020 2020  arams]).        
+00005600: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00005610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005620: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
+00005630: 2020 2020 2070 7265 765f 7520 3d20 6e70       prev_u = np
+00005640: 2e61 7272 6179 2870 7265 765f 7529 0a20  .array(prev_u). 
+00005650: 2020 2020 2020 2020 2020 2070 7265 765f             prev_
+00005660: 7620 3d20 6e70 2e61 7272 6179 2870 7265  v = np.array(pre
+00005670: 765f 7629 0a20 2020 2020 2020 2020 2020  v_v).           
+00005680: 2070 7265 765f 6c6f 676c 203d 206e 702e   prev_logl = np.
+00005690: 6172 7261 7928 7072 6576 5f6c 6f67 6c29  array(prev_logl)
+000056a0: 0a0a 2020 2020 2020 2020 2020 2020 6e75  ..            nu
+000056b0: 6d5f 6c69 7665 5f70 6f69 6e74 735f 6d69  m_live_points_mi
+000056c0: 7373 696e 6720 3d20 7365 6c66 2e6e 756d  ssing = self.num
+000056d0: 5f6c 6976 655f 706f 696e 7473 202d 206c  _live_points - l
+000056e0: 656e 2870 7265 765f 6c6f 676c 290a 2020  en(prev_logl).  
+000056f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00005700: 2020 2020 2020 2020 6e75 6d5f 6c69 7665          num_live
+00005710: 5f70 6f69 6e74 735f 6d69 7373 696e 6720  _points_missing 
+00005720: 3d20 2d31 0a0a 2020 2020 2020 2020 6966  = -1..        if
+00005730: 2073 656c 662e 7573 655f 6d70 693a 0a20   self.use_mpi:. 
+00005740: 2020 2020 2020 2020 2020 206e 756d 5f6c             num_l
+00005750: 6976 655f 706f 696e 7473 5f6d 6973 7369  ive_points_missi
+00005760: 6e67 203d 2073 656c 662e 636f 6d6d 2e62  ng = self.comm.b
+00005770: 6361 7374 286e 756d 5f6c 6976 655f 706f  cast(num_live_po
+00005780: 696e 7473 5f6d 6973 7369 6e67 2c20 726f  ints_missing, ro
+00005790: 6f74 3d30 290a 2020 2020 2020 2020 2020  ot=0).          
+000057a0: 2020 7072 6576 5f75 203d 2073 656c 662e    prev_u = self.
+000057b0: 636f 6d6d 2e62 6361 7374 2870 7265 765f  comm.bcast(prev_
+000057c0: 752c 2072 6f6f 743d 3029 0a20 2020 2020  u, root=0).     
+000057d0: 2020 2020 2020 2070 7265 765f 7620 3d20         prev_v = 
+000057e0: 7365 6c66 2e63 6f6d 6d2e 6263 6173 7428  self.comm.bcast(
+000057f0: 7072 6576 5f76 2c20 726f 6f74 3d30 290a  prev_v, root=0).
+00005800: 2020 2020 2020 2020 2020 2020 7072 6576              prev
+00005810: 5f6c 6f67 6c20 3d20 7365 6c66 2e63 6f6d  _logl = self.com
+00005820: 6d2e 6263 6173 7428 7072 6576 5f6c 6f67  m.bcast(prev_log
+00005830: 6c2c 2072 6f6f 743d 3029 0a0a 2020 2020  l, root=0)..    
+00005840: 2020 2020 7573 655f 706f 696e 745f 7374      use_point_st
+00005850: 6163 6b20 3d20 5472 7565 0a0a 2020 2020  ack = True..    
+00005860: 2020 2020 6173 7365 7274 206e 756d 5f6c      assert num_l
+00005870: 6976 655f 706f 696e 7473 5f6d 6973 7369  ive_points_missi
+00005880: 6e67 203e 3d20 300a 2020 2020 2020 2020  ng >= 0.        
+00005890: 6966 206e 756d 5f6c 6976 655f 706f 696e  if num_live_poin
+000058a0: 7473 5f6d 6973 7369 6e67 203e 2030 3a0a  ts_missing > 0:.
+000058b0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000058c0: 656c 662e 7573 655f 6d70 693a 0a20 2020  elf.use_mpi:.   
+000058d0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+000058e0: 656c 662e 6c6f 6767 6572 2e69 6e66 6f28  elf.logger.info(
+000058f0: 2755 7369 6e67 204d 5049 2077 6974 6820  'Using MPI with 
+00005900: 7261 6e6b 205b 2564 5d27 2c20 7365 6c66  rank [%d]', self
+00005910: 2e6d 7069 5f72 616e 6b29 0a20 2020 2020  .mpi_rank).     
+00005920: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00005930: 6c66 2e6d 7069 5f72 616e 6b20 3d3d 2030  lf.mpi_rank == 0
+00005940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005950: 2020 2020 2020 6163 7469 7665 5f75 203d        active_u =
+00005960: 206e 702e 7261 6e64 6f6d 2e75 6e69 666f   np.random.unifo
+00005970: 726d 2873 697a 653d 286e 756d 5f6c 6976  rm(size=(num_liv
+00005980: 655f 706f 696e 7473 5f6d 6973 7369 6e67  e_points_missing
+00005990: 2c20 7365 6c66 2e78 5f64 696d 2929 0a20  , self.x_dim)). 
+000059a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000059b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000059c0: 2020 2020 2020 2020 2061 6374 6976 655f           active_
+000059d0: 7520 3d20 6e70 2e65 6d70 7479 2828 6e75  u = np.empty((nu
+000059e0: 6d5f 6c69 7665 5f70 6f69 6e74 735f 6d69  m_live_points_mi
+000059f0: 7373 696e 672c 2073 656c 662e 785f 6469  ssing, self.x_di
+00005a00: 6d29 2c20 6474 7970 653d 6e70 2e66 6c6f  m), dtype=np.flo
+00005a10: 6174 3634 290a 2020 2020 2020 2020 2020  at64).          
+00005a20: 2020 2020 2020 6163 7469 7665 5f75 203d        active_u =
+00005a30: 2073 656c 662e 636f 6d6d 2e62 6361 7374   self.comm.bcast
+00005a40: 2861 6374 6976 655f 752c 2072 6f6f 743d  (active_u, root=
+00005a50: 3029 0a20 2020 2020 2020 2020 2020 2065  0).            e
+00005a60: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00005a70: 2020 2020 2061 6374 6976 655f 7520 3d20       active_u = 
+00005a80: 6e70 2e72 616e 646f 6d2e 756e 6966 6f72  np.random.unifor
+00005a90: 6d28 7369 7a65 3d28 6e75 6d5f 6c69 7665  m(size=(num_live
+00005aa0: 5f70 6f69 6e74 735f 6d69 7373 696e 672c  _points_missing,
+00005ab0: 2073 656c 662e 785f 6469 6d29 290a 2020   self.x_dim)).  
+00005ac0: 2020 2020 2020 2020 2020 6163 7469 7665            active
+00005ad0: 5f76 203d 2073 656c 662e 7472 616e 7366  _v = self.transf
+00005ae0: 6f72 6d28 6163 7469 7665 5f75 290a 0a20  orm(active_u).. 
+00005af0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00005b00: 6c66 2e75 7365 5f6d 7069 3a0a 2020 2020  lf.use_mpi:.    
+00005b10: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00005b20: 656c 662e 6d70 695f 7261 6e6b 203d 3d20  elf.mpi_rank == 
+00005b30: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00005b40: 2020 2020 2020 2063 6875 6e6b 7320 3d20         chunks = 
+00005b50: 5b5b 5d20 666f 7220 5f20 696e 2072 616e  [[] for _ in ran
+00005b60: 6765 2873 656c 662e 6d70 695f 7369 7a65  ge(self.mpi_size
+00005b70: 295d 0a20 2020 2020 2020 2020 2020 2020  )].             
+00005b80: 2020 2020 2020 2066 6f72 2069 2c20 6368         for i, ch
+00005b90: 756e 6b20 696e 2065 6e75 6d65 7261 7465  unk in enumerate
+00005ba0: 2861 6374 6976 655f 7629 3a0a 2020 2020  (active_v):.    
+00005bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005bc0: 2020 2020 6368 756e 6b73 5b69 2025 2073      chunks[i % s
+00005bd0: 656c 662e 6d70 695f 7369 7a65 5d2e 6170  elf.mpi_size].ap
+00005be0: 7065 6e64 2863 6875 6e6b 290a 2020 2020  pend(chunk).    
+00005bf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00005c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005c10: 2020 2020 2020 6368 756e 6b73 203d 204e        chunks = N
+00005c20: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00005c30: 2020 2020 6461 7461 203d 2073 656c 662e      data = self.
+00005c40: 636f 6d6d 2e73 6361 7474 6572 2863 6875  comm.scatter(chu
+00005c50: 6e6b 732c 2072 6f6f 743d 3029 0a20 2020  nks, root=0).   
+00005c60: 2020 2020 2020 2020 2020 2020 2061 6374               act
+00005c70: 6976 655f 6c6f 676c 203d 2073 656c 662e  ive_logl = self.
+00005c80: 6c6f 676c 696b 6528 6461 7461 290a 2020  loglike(data).  
+00005c90: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00005ca0: 6376 5f61 6374 6976 655f 6c6f 676c 203d  cv_active_logl =
+00005cb0: 2073 656c 662e 636f 6d6d 2e67 6174 6865   self.comm.gathe
+00005cc0: 7228 6163 7469 7665 5f6c 6f67 6c2c 2072  r(active_logl, r
+00005cd0: 6f6f 743d 3029 0a20 2020 2020 2020 2020  oot=0).         
+00005ce0: 2020 2020 2020 2072 6563 765f 6163 7469         recv_acti
+00005cf0: 7665 5f6c 6f67 6c20 3d20 7365 6c66 2e63  ve_logl = self.c
+00005d00: 6f6d 6d2e 6263 6173 7428 7265 6376 5f61  omm.bcast(recv_a
+00005d10: 6374 6976 655f 6c6f 676c 2c20 726f 6f74  ctive_logl, root
+00005d20: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
+00005d30: 2020 2020 6163 7469 7665 5f6c 6f67 6c20      active_logl 
+00005d40: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+00005d50: 2872 6563 765f 6163 7469 7665 5f6c 6f67  (recv_active_log
+00005d60: 6c2c 2061 7869 733d 3029 0a20 2020 2020  l, axis=0).     
+00005d70: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00005d80: 2020 2020 2020 2020 2020 2020 2061 6374               act
+00005d90: 6976 655f 6c6f 676c 203d 2073 656c 662e  ive_logl = self.
+00005da0: 6c6f 676c 696b 6528 6163 7469 7665 5f76  loglike(active_v
+00005db0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00005dc0: 6620 7365 6c66 2e6c 6f67 5f74 6f5f 6469  f self.log_to_di
+00005dd0: 736b 3a0a 2020 2020 2020 2020 2020 2020  sk:.            
+00005de0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00005df0: 6765 286e 756d 5f6c 6976 655f 706f 696e  ge(num_live_poin
+00005e00: 7473 5f6d 6973 7369 6e67 293a 0a20 2020  ts_missing):.   
+00005e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e20: 2073 656c 662e 706f 696e 7473 746f 7265   self.pointstore
+00005e30: 2e61 6464 280a 2020 2020 2020 2020 2020  .add(.          
+00005e40: 2020 2020 2020 2020 2020 2020 2020 5f6c                _l
+00005e50: 6973 7469 6679 285b 2d6e 702e 696e 662c  istify([-np.inf,
+00005e60: 2061 6374 6976 655f 6c6f 676c 5b69 5d2c   active_logl[i],
+00005e70: 2030 2e5d 2c20 6163 7469 7665 5f75 5b69   0.], active_u[i
+00005e80: 2c3a 5d2c 2061 6374 6976 655f 765b 692c  ,:], active_v[i,
+00005e90: 3a5d 292c 0a20 2020 2020 2020 2020 2020  :]),.           
+00005ea0: 2020 2020 2020 2020 2020 2020 206e 756d               num
+00005eb0: 5f6c 6976 655f 706f 696e 7473 5f6d 6973  _live_points_mis
+00005ec0: 7369 6e67 290a 0a20 2020 2020 2020 2020  sing)..         
+00005ed0: 2020 2069 6620 6c65 6e28 7072 6576 5f75     if len(prev_u
+00005ee0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+00005ef0: 2020 2020 2020 2061 6374 6976 655f 7520         active_u 
+00005f00: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+00005f10: 2828 7072 6576 5f75 2c20 6163 7469 7665  ((prev_u, active
+00005f20: 5f75 2929 0a20 2020 2020 2020 2020 2020  _u)).           
+00005f30: 2020 2020 2061 6374 6976 655f 7620 3d20       active_v = 
+00005f40: 6e70 2e63 6f6e 6361 7465 6e61 7465 2828  np.concatenate((
+00005f50: 7072 6576 5f76 2c20 6163 7469 7665 5f76  prev_v, active_v
+00005f60: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00005f70: 2020 2061 6374 6976 655f 6c6f 676c 203d     active_logl =
+00005f80: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
+00005f90: 2870 7265 765f 6c6f 676c 2c20 6163 7469  (prev_logl, acti
+00005fa0: 7665 5f6c 6f67 6c29 290a 2020 2020 2020  ve_logl)).      
+00005fb0: 2020 2020 2020 6173 7365 7274 2061 6374        assert act
+00005fc0: 6976 655f 752e 7368 6170 6520 3d3d 2028  ive_u.shape == (
+00005fd0: 7365 6c66 2e6e 756d 5f6c 6976 655f 706f  self.num_live_po
+00005fe0: 696e 7473 2c20 7365 6c66 2e78 5f64 696d  ints, self.x_dim
+00005ff0: 290a 2020 2020 2020 2020 2020 2020 6173  ).            as
+00006000: 7365 7274 2061 6374 6976 655f 762e 7368  sert active_v.sh
+00006010: 6170 6520 3d3d 2028 7365 6c66 2e6e 756d  ape == (self.num
+00006020: 5f6c 6976 655f 706f 696e 7473 2c20 7365  _live_points, se
+00006030: 6c66 2e6e 756d 5f70 6172 616d 7329 0a20  lf.num_params). 
+00006040: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00006050: 7420 6163 7469 7665 5f6c 6f67 6c2e 7368  t active_logl.sh
+00006060: 6170 6520 3d3d 2028 7365 6c66 2e6e 756d  ape == (self.num
+00006070: 5f6c 6976 655f 706f 696e 7473 2c29 0a20  _live_points,). 
+00006080: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00006090: 2020 2020 2020 2020 2061 6374 6976 655f           active_
+000060a0: 7520 3d20 7072 6576 5f75 0a20 2020 2020  u = prev_u.     
+000060b0: 2020 2020 2020 2061 6374 6976 655f 7620         active_v 
+000060c0: 3d20 7072 6576 5f76 0a20 2020 2020 2020  = prev_v.       
+000060d0: 2020 2020 2061 6374 6976 655f 6c6f 676c       active_logl
+000060e0: 203d 2070 7265 765f 6c6f 676c 0a0a 2020   = prev_logl..  
+000060f0: 2020 2020 2020 7361 7665 645f 7520 3d20        saved_u = 
+00006100: 5b5d 0a20 2020 2020 2020 2073 6176 6564  [].        saved
+00006110: 5f76 203d 205b 5d20 2023 2053 746f 7265  _v = []  # Store
+00006120: 6420 706f 696e 7473 2066 6f72 2070 6f73  d points for pos
+00006130: 7465 7269 6f72 2072 6573 756c 7473 0a20  terior results. 
+00006140: 2020 2020 2020 2073 6176 6564 5f6c 6f67         saved_log
+00006150: 6c20 3d20 5b5d 0a20 2020 2020 2020 2073  l = [].        s
+00006160: 6176 6564 5f6c 6f67 7774 203d 205b 5d0a  aved_logwt = [].
+00006170: 2020 2020 2020 2020 6820 3d20 302e 3020          h = 0.0 
+00006180: 2023 2049 6e66 6f72 6d61 7469 6f6e 2c20   # Information, 
+00006190: 696e 6974 6961 6c6c 7920 302e 0a20 2020  initially 0..   
+000061a0: 2020 2020 206c 6f67 7a20 3d20 2d31 6533       logz = -1e3
+000061b0: 3030 2020 2320 6c6e 2845 7669 6465 6e63  00  # ln(Evidenc
+000061c0: 6520 5a29 2c20 696e 6974 6961 6c6c 7920  e Z), initially 
+000061d0: 5a3d 300a 2020 2020 2020 2020 6c6f 6776  Z=0.        logv
+000061e0: 6f6c 203d 206c 6f67 2831 2e30 202d 2065  ol = log(1.0 - e
+000061f0: 7870 282d 312e 3020 2f20 7365 6c66 2e6e  xp(-1.0 / self.n
+00006200: 756d 5f6c 6976 655f 706f 696e 7473 2929  um_live_points))
+00006210: 0a20 2020 2020 2020 206c 6f67 7a5f 7265  .        logz_re
+00006220: 6d61 696e 203d 206e 702e 6d61 7828 6163  main = np.max(ac
+00006230: 7469 7665 5f6c 6f67 6c29 0a20 2020 2020  tive_logl).     
+00006240: 2020 2066 7261 6374 696f 6e5f 7265 6d61     fraction_rema
+00006250: 696e 203d 2031 2e30 0a20 2020 2020 2020  in = 1.0.       
+00006260: 206e 6361 6c6c 203d 206e 756d 5f6c 6976   ncall = num_liv
+00006270: 655f 706f 696e 7473 5f6d 6973 7369 6e67  e_points_missing
+00006280: 2020 2320 6e75 6d62 6572 206f 6620 6361    # number of ca
+00006290: 6c6c 7320 7765 2061 6c72 6561 6479 206d  lls we already m
+000062a0: 6164 650a 2020 2020 2020 2020 6669 7273  ade.        firs
+000062b0: 745f 7469 6d65 203d 2054 7275 650a 2020  t_time = True.  
+000062c0: 2020 2020 2020 6966 2073 656c 662e 785f        if self.x_
+000062d0: 6469 6d20 3e20 313a 0a20 2020 2020 2020  dim > 1:.       
+000062e0: 2020 2020 2074 7261 6e73 666f 726d 4c61       transformLa
+000062f0: 7965 7220 3d20 4166 6669 6e65 4c61 7965  yer = AffineLaye
+00006300: 7228 7772 6170 7065 645f 6469 6d73 3d73  r(wrapped_dims=s
+00006310: 656c 662e 7772 6170 7065 645f 6178 6573  elf.wrapped_axes
+00006320: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00006330: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+00006340: 7366 6f72 6d4c 6179 6572 203d 2053 6361  sformLayer = Sca
+00006350: 6c69 6e67 4c61 7965 7228 7772 6170 7065  lingLayer(wrappe
+00006360: 645f 6469 6d73 3d73 656c 662e 7772 6170  d_dims=self.wrap
+00006370: 7065 645f 6178 6573 290a 2020 2020 2020  ped_axes).      
+00006380: 2020 7472 616e 7366 6f72 6d4c 6179 6572    transformLayer
+00006390: 2e6f 7074 696d 697a 6528 6163 7469 7665  .optimize(active
+000063a0: 5f75 2c20 6163 7469 7665 5f75 290a 2020  _u, active_u).  
+000063b0: 2020 2020 2020 7265 6769 6f6e 203d 204d        region = M
+000063c0: 4c46 7269 656e 6473 2861 6374 6976 655f  LFriends(active_
+000063d0: 752c 2074 7261 6e73 666f 726d 4c61 7965  u, transformLaye
+000063e0: 7229 0a0a 2020 2020 2020 2020 6966 2073  r)..        if s
+000063f0: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
+00006400: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+00006410: 2e69 6e66 6f28 2753 7461 7274 696e 6720  .info('Starting 
+00006420: 7361 6d70 6c69 6e67 202e 2e2e 2729 0a20  sampling ...'). 
+00006430: 2020 2020 2020 2069 6220 3d20 300a 2020         ib = 0.  
+00006440: 2020 2020 2020 7361 6d70 6c65 7320 3d20        samples = 
+00006450: 5b5d 0a20 2020 2020 2020 206e 6472 6177  [].        ndraw
+00006460: 203d 2031 3030 0a20 2020 2020 2020 2069   = 100.        i
+00006470: 7420 3d20 300a 2020 2020 2020 2020 6e65  t = 0.        ne
+00006480: 7874 5f75 7064 6174 655f 696e 7465 7276  xt_update_interv
+00006490: 616c 5f6e 6361 6c6c 203d 202d 310a 2020  al_ncall = -1.  
+000064a0: 2020 2020 2020 6e65 7874 5f75 7064 6174        next_updat
+000064b0: 655f 696e 7465 7276 616c 5f69 7465 7220  e_interval_iter 
+000064c0: 3d20 2d31 0a0a 2020 2020 2020 2020 7768  = -1..        wh
+000064d0: 696c 6520 6d61 785f 6974 6572 7320 6973  ile max_iters is
+000064e0: 204e 6f6e 6520 6f72 2069 7420 3c20 6d61   None or it < ma
+000064f0: 785f 6974 6572 733a 0a0a 2020 2020 2020  x_iters:..      
+00006500: 2020 2020 2020 2320 576f 7273 7420 6f62        # Worst ob
+00006510: 6a65 6374 2069 6e20 636f 6c6c 6563 7469  ject in collecti
+00006520: 6f6e 2061 6e64 2069 7473 2077 6569 6768  on and its weigh
+00006530: 7420 283d 2076 6f6c 756d 6520 2a20 6c69  t (= volume * li
+00006540: 6b65 6c69 686f 6f64 290a 2020 2020 2020  kelihood).      
+00006550: 2020 2020 2020 776f 7273 7420 3d20 6e70        worst = np
+00006560: 2e61 7267 6d69 6e28 6163 7469 7665 5f6c  .argmin(active_l
+00006570: 6f67 6c29 0a20 2020 2020 2020 2020 2020  ogl).           
+00006580: 206c 6f67 7774 203d 206c 6f67 766f 6c20   logwt = logvol 
+00006590: 2b20 6163 7469 7665 5f6c 6f67 6c5b 776f  + active_logl[wo
+000065a0: 7273 745d 0a0a 2020 2020 2020 2020 2020  rst]..          
+000065b0: 2020 2320 5570 6461 7465 2065 7669 6465    # Update evide
+000065c0: 6e63 6520 5a20 616e 6420 696e 666f 726d  nce Z and inform
+000065d0: 6174 696f 6e20 682e 0a20 2020 2020 2020  ation h..       
+000065e0: 2020 2020 206c 6f67 7a5f 6e65 7720 3d20       logz_new = 
+000065f0: 6e70 2e6c 6f67 6164 6465 7870 286c 6f67  np.logaddexp(log
+00006600: 7a2c 206c 6f67 7774 290a 2020 2020 2020  z, logwt).      
+00006610: 2020 2020 2020 6820 3d20 2865 7870 286c        h = (exp(l
+00006620: 6f67 7774 202d 206c 6f67 7a5f 6e65 7729  ogwt - logz_new)
+00006630: 202a 2061 6374 6976 655f 6c6f 676c 5b77   * active_logl[w
+00006640: 6f72 7374 5d20 2b20 6578 7028 6c6f 677a  orst] + exp(logz
+00006650: 202d 206c 6f67 7a5f 6e65 7729 202a 2028   - logz_new) * (
+00006660: 6820 2b20 6c6f 677a 2920 2d20 6c6f 677a  h + logz) - logz
+00006670: 5f6e 6577 290a 2020 2020 2020 2020 2020  _new).          
+00006680: 2020 6c6f 677a 203d 206c 6f67 7a5f 6e65    logz = logz_ne
+00006690: 770a 0a20 2020 2020 2020 2020 2020 2023  w..            #
+000066a0: 2041 6464 2077 6f72 7374 206f 626a 6563   Add worst objec
+000066b0: 7420 746f 2073 616d 706c 6573 2e0a 2020  t to samples..  
+000066c0: 2020 2020 2020 2020 2020 7361 7665 645f            saved_
+000066d0: 752e 6170 7065 6e64 286e 702e 6172 7261  u.append(np.arra
+000066e0: 7928 6163 7469 7665 5f75 5b77 6f72 7374  y(active_u[worst
+000066f0: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+00006700: 7361 7665 645f 762e 6170 7065 6e64 286e  saved_v.append(n
+00006710: 702e 6172 7261 7928 6163 7469 7665 5f76  p.array(active_v
+00006720: 5b77 6f72 7374 5d29 290a 2020 2020 2020  [worst])).      
+00006730: 2020 2020 2020 7361 7665 645f 6c6f 6777        saved_logw
+00006740: 742e 6170 7065 6e64 286c 6f67 7774 290a  t.append(logwt).
+00006750: 2020 2020 2020 2020 2020 2020 7361 7665              save
+00006760: 645f 6c6f 676c 2e61 7070 656e 6428 6163  d_logl.append(ac
+00006770: 7469 7665 5f6c 6f67 6c5b 776f 7273 745d  tive_logl[worst]
+00006780: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00006790: 2065 7870 6563 7465 645f 766f 6c20 3d20   expected_vol = 
+000067a0: 6e70 2e65 7870 282d 6974 202f 2073 656c  np.exp(-it / sel
+000067b0: 662e 6e75 6d5f 6c69 7665 5f70 6f69 6e74  f.num_live_point
+000067c0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+000067d0: 2320 5468 6520 6e65 7720 6c69 6b65 6c69  # The new likeli
+000067e0: 686f 6f64 2063 6f6e 7374 7261 696e 7420  hood constraint 
+000067f0: 6973 2074 6861 7420 6f66 2074 6865 2077  is that of the w
+00006800: 6f72 7374 206f 626a 6563 742e 0a20 2020  orst object..   
+00006810: 2020 2020 2020 2020 206c 6f67 6c73 7461           loglsta
+00006820: 7220 3d20 6163 7469 7665 5f6c 6f67 6c5b  r = active_logl[
+00006830: 776f 7273 745d 0a0a 2020 2020 2020 2020  worst]..        
+00006840: 2020 2020 6966 206e 6361 6c6c 203e 206e      if ncall > n
+00006850: 6578 745f 7570 6461 7465 5f69 6e74 6572  ext_update_inter
+00006860: 7661 6c5f 6e63 616c 6c20 616e 6420 6974  val_ncall and it
+00006870: 203e 206e 6578 745f 7570 6461 7465 5f69   > next_update_i
+00006880: 6e74 6572 7661 6c5f 6974 6572 3a0a 0a20  nterval_iter:.. 
+00006890: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000068a0: 6620 6669 7273 745f 7469 6d65 3a0a 2020  f first_time:.  
+000068b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068c0: 2020 6e65 7874 7265 6769 6f6e 203d 2072    nextregion = r
+000068d0: 6567 696f 6e0a 2020 2020 2020 2020 2020  egion.          
+000068e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000068f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006900: 2320 7265 6275 696c 6420 7370 6163 650a  # rebuild space.
+00006910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006920: 2020 2020 2320 7072 696e 7428 290a 2020      # print().  
+00006930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006940: 2020 2320 7072 696e 7428 2272 6562 7569    # print("rebui
+00006950: 6c64 696e 6720 7370 6163 652e 2e2e 222c  lding space...",
+00006960: 2061 6374 6976 655f 752e 7368 6170 652c   active_u.shape,
+00006970: 2061 6374 6976 655f 7529 0a20 2020 2020   active_u).     
+00006980: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00006990: 6578 7454 7261 6e73 666f 726d 4c61 7965  extTransformLaye
+000069a0: 7220 3d20 7472 616e 7366 6f72 6d4c 6179  r = transformLay
+000069b0: 6572 2e63 7265 6174 655f 6e65 7728 6163  er.create_new(ac
+000069c0: 7469 7665 5f75 2c20 7265 6769 6f6e 2e6d  tive_u, region.m
+000069d0: 6178 7261 6469 7573 7371 290a 2020 2020  axradiussq).    
+000069e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069f0: 6e65 7874 7265 6769 6f6e 203d 204d 4c46  nextregion = MLF
+00006a00: 7269 656e 6473 2861 6374 6976 655f 752c  riends(active_u,
+00006a10: 206e 6578 7454 7261 6e73 666f 726d 4c61   nextTransformLa
+00006a20: 7965 7229 0a0a 2020 2020 2020 2020 2020  yer)..          
+00006a30: 2020 2020 2020 2320 7072 696e 7428 2263        # print("c
+00006a40: 6f6d 7075 7469 6e67 206d 6178 7261 6469  omputing maxradi
+00006a50: 7573 2e2e 2e22 290a 2020 2020 2020 2020  us...").        
+00006a60: 2020 2020 2020 2020 722c 2066 203d 205f          r, f = _
+00006a70: 7570 6461 7465 5f72 6567 696f 6e5f 626f  update_region_bo
+00006a80: 6f74 7374 7261 7028 6e65 7874 7265 6769  otstrap(nextregi
+00006a90: 6f6e 2c20 3330 2c20 302e 2c20 7365 6c66  on, 30, 0., self
+00006aa0: 2e63 6f6d 6d20 6966 2073 656c 662e 7573  .comm if self.us
+00006ab0: 655f 6d70 6920 656c 7365 204e 6f6e 652c  e_mpi else None,
+00006ac0: 2073 656c 662e 6d70 695f 7369 7a65 290a   self.mpi_size).
+00006ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006ae0: 206e 6578 7472 6567 696f 6e2e 6d61 7872   nextregion.maxr
+00006af0: 6164 6975 7373 7120 3d20 720a 2020 2020  adiussq = r.    
+00006b00: 2020 2020 2020 2020 2020 2020 6e65 7874              next
+00006b10: 7265 6769 6f6e 2e65 6e6c 6172 6765 203d  region.enlarge =
+00006b20: 2066 0a20 2020 2020 2020 2020 2020 2020   f.             
+00006b30: 2020 2023 2066 6f72 6365 2073 6872 696e     # force shrin
+00006b40: 6b61 6765 206f 6620 766f 6c75 6d65 0a20  kage of volume. 
+00006b50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00006b60: 2074 6869 7320 6973 2074 6f20 6176 6f69   this is to avoi
+00006b70: 6420 7265 2d63 6f6e 6e65 6374 696f 6e20  d re-connection 
+00006b80: 6f66 2064 7969 6e67 206f 7574 206e 6f64  of dying out nod
+00006b90: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00006ba0: 2020 2069 6620 6e65 7874 7265 6769 6f6e     if nextregion
+00006bb0: 2e65 7374 696d 6174 655f 766f 6c75 6d65  .estimate_volume
+00006bc0: 2829 203c 2072 6567 696f 6e2e 6573 7469  () < region.esti
+00006bd0: 6d61 7465 5f76 6f6c 756d 6528 293a 0a20  mate_volume():. 
+00006be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bf0: 2020 2072 6567 696f 6e20 3d20 6e65 7874     region = next
+00006c00: 7265 6769 6f6e 0a20 2020 2020 2020 2020  region.         
+00006c10: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+00006c20: 666f 726d 4c61 7965 7220 3d20 7265 6769  formLayer = regi
+00006c30: 6f6e 2e74 7261 6e73 666f 726d 4c61 7965  on.transformLaye
+00006c40: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+00006c50: 2020 7265 6769 6f6e 2e63 7265 6174 655f    region.create_
+00006c60: 656c 6c69 7073 6f69 6428 6d69 6e76 6f6c  ellipsoid(minvol
+00006c70: 3d65 7870 282d 6974 202f 2073 656c 662e  =exp(-it / self.
+00006c80: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7329  num_live_points)
+00006c90: 202a 2073 656c 662e 766f 6c66 6163 746f   * self.volfacto
+00006ca0: 7229 0a0a 2020 2020 2020 2020 2020 2020  r)..            
+00006cb0: 2020 2020 6966 2073 656c 662e 6c6f 673a      if self.log:
+00006cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006cd0: 2020 2020 2076 697a 5f63 616c 6c62 6163       viz_callbac
+00006ce0: 6b28 0a20 2020 2020 2020 2020 2020 2020  k(.             
+00006cf0: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+00006d00: 733d 6469 6374 2875 3d61 6374 6976 655f  s=dict(u=active_
+00006d10: 752c 2070 3d61 6374 6976 655f 762c 206c  u, p=active_v, l
+00006d20: 6f67 6c3d 6163 7469 7665 5f6c 6f67 6c29  ogl=active_logl)
+00006d30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006d40: 2020 2020 2020 2020 2020 696e 666f 3d64            info=d
+00006d50: 6963 7428 0a20 2020 2020 2020 2020 2020  ict(.           
+00006d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d70: 2069 743d 6974 2c20 6e63 616c 6c3d 6e63   it=it, ncall=nc
+00006d80: 616c 6c2c 206c 6f67 7a3d 6c6f 677a 2c20  all, logz=logz, 
+00006d90: 6c6f 677a 5f72 656d 6169 6e3d 6c6f 677a  logz_remain=logz
+00006da0: 5f72 656d 6169 6e2c 0a20 2020 2020 2020  _remain,.       
+00006db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006dc0: 2020 2020 2070 6172 616d 6e61 6d65 733d       paramnames=
+00006dd0: 7365 6c66 2e70 6172 616d 6e61 6d65 7320  self.paramnames 
+00006de0: 2b20 7365 6c66 2e64 6572 6976 6564 7061  + self.derivedpa
+00006df0: 7261 6d6e 616d 6573 2c0a 2020 2020 2020  ramnames,.      
+00006e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e10: 2020 2020 2020 6c6f 6776 6f6c 3d6c 6f67        logvol=log
+00006e20: 766f 6c29 2c0a 2020 2020 2020 2020 2020  vol),.          
+00006e30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00006e40: 6769 6f6e 3d72 6567 696f 6e2c 2074 7261  gion=region, tra
+00006e50: 6e73 666f 726d 4c61 7965 723d 7472 616e  nsformLayer=tran
+00006e60: 7366 6f72 6d4c 6179 6572 290a 2020 2020  sformLayer).    
+00006e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006e80: 7365 6c66 2e70 6f69 6e74 7374 6f72 652e  self.pointstore.
+00006e90: 666c 7573 6828 290a 0a20 2020 2020 2020  flush()..       
+00006ea0: 2020 2020 2020 2020 206e 6578 745f 7570           next_up
+00006eb0: 6461 7465 5f69 6e74 6572 7661 6c5f 6e63  date_interval_nc
+00006ec0: 616c 6c20 3d20 6e63 616c 6c20 2b20 7570  all = ncall + up
+00006ed0: 6461 7465 5f69 6e74 6572 7661 6c5f 6e63  date_interval_nc
+00006ee0: 616c 6c0a 2020 2020 2020 2020 2020 2020  all.            
+00006ef0: 2020 2020 6e65 7874 5f75 7064 6174 655f      next_update_
+00006f00: 696e 7465 7276 616c 5f69 7465 7220 3d20  interval_iter = 
+00006f10: 6974 202b 2075 7064 6174 655f 696e 7465  it + update_inte
+00006f20: 7276 616c 5f69 7465 720a 2020 2020 2020  rval_iter.      
+00006f30: 2020 2020 2020 2020 2020 6669 7273 745f            first_
+00006f40: 7469 6d65 203d 2046 616c 7365 0a0a 2020  time = False..  
+00006f50: 2020 2020 2020 2020 2020 7768 696c 6520            while 
+00006f60: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
+00006f70: 2020 2020 2020 6966 2069 6220 3e3d 206c        if ib >= l
+00006f80: 656e 2873 616d 706c 6573 2920 616e 6420  en(samples) and 
+00006f90: 7573 655f 706f 696e 745f 7374 6163 6b3a  use_point_stack:
+00006fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006fb0: 2020 2020 2023 2072 6f6f 7420 6368 6563       # root chec
+00006fc0: 6b73 2074 6865 2070 6f69 6e74 2073 746f  ks the point sto
+00006fd0: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
+00006fe0: 2020 2020 2020 206e 6578 745f 706f 696e         next_poin
+00006ff0: 7420 3d20 6e70 2e7a 6572 6f73 2828 312c  t = np.zeros((1,
+00007000: 2033 202b 2073 656c 662e 785f 6469 6d20   3 + self.x_dim 
+00007010: 2b20 7365 6c66 2e6e 756d 5f70 6172 616d  + self.num_param
+00007020: 7329 290a 0a20 2020 2020 2020 2020 2020  s))..           
+00007030: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00007040: 2e6c 6f67 5f74 6f5f 6469 736b 3a0a 2020  .log_to_disk:.  
+00007050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007060: 2020 2020 2020 5f2c 2073 746f 7265 645f        _, stored_
+00007070: 706f 696e 7420 3d20 7365 6c66 2e70 6f69  point = self.poi
+00007080: 6e74 7374 6f72 652e 706f 7028 6c6f 676c  ntstore.pop(logl
+00007090: 7374 6172 290a 2020 2020 2020 2020 2020  star).          
+000070a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000070b0: 2073 746f 7265 645f 706f 696e 7420 6973   stored_point is
+000070c0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000070d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000070e0: 2020 2020 2020 206e 6578 745f 706f 696e         next_poin
+000070f0: 745b 302c 3a5d 203d 2073 746f 7265 645f  t[0,:] = stored_
+00007100: 706f 696e 740a 2020 2020 2020 2020 2020  point.          
+00007110: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00007120: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00007130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007140: 6e65 7874 5f70 6f69 6e74 5b30 2c3a 5d20  next_point[0,:] 
+00007150: 3d20 2d6e 702e 696e 660a 2020 2020 2020  = -np.inf.      
+00007160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007170: 2020 7573 655f 706f 696e 745f 7374 6163    use_point_stac
+00007180: 6b20 3d20 6e6f 7420 7365 6c66 2e70 6f69  k = not self.poi
+00007190: 6e74 7374 6f72 652e 7374 6163 6b5f 656d  ntstore.stack_em
+000071a0: 7074 790a 0a20 2020 2020 2020 2020 2020  pty..           
+000071b0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+000071c0: 2e75 7365 5f6d 7069 3a20 2023 2061 6e64  .use_mpi:  # and
+000071d0: 2069 6e66 6f72 6d73 2065 7665 7279 6f6e   informs everyon
+000071e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+000071f0: 2020 2020 2020 2020 2020 7573 655f 706f            use_po
+00007200: 696e 745f 7374 6163 6b20 3d20 7365 6c66  int_stack = self
+00007210: 2e63 6f6d 6d2e 6263 6173 7428 7573 655f  .comm.bcast(use_
+00007220: 706f 696e 745f 7374 6163 6b2c 2072 6f6f  point_stack, roo
+00007230: 743d 3029 0a20 2020 2020 2020 2020 2020  t=0).           
+00007240: 2020 2020 2020 2020 2020 2020 206e 6578               nex
+00007250: 745f 706f 696e 7420 3d20 7365 6c66 2e63  t_point = self.c
+00007260: 6f6d 6d2e 6263 6173 7428 6e65 7874 5f70  omm.bcast(next_p
+00007270: 6f69 6e74 2c20 726f 6f74 3d30 290a 0a20  oint, root=0).. 
+00007280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007290: 2020 2023 2061 7373 6572 7420 6e6f 7420     # assert not 
+000072a0: 7573 655f 706f 696e 745f 7374 6163 6b0a  use_point_stack.
+000072b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000072c0: 2020 2020 2023 2075 6e70 6163 6b0a 2020       # unpack.  
+000072d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000072e0: 2020 6c69 6b65 7320 3d20 6e65 7874 5f70    likes = next_p
+000072f0: 6f69 6e74 5b3a 2c31 5d0a 2020 2020 2020  oint[:,1].      
+00007300: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00007310: 6d70 6c65 7320 3d20 6e65 7874 5f70 6f69  mples = next_poi
+00007320: 6e74 5b3a 2c33 3a33 202b 2073 656c 662e  nt[:,3:3 + self.
+00007330: 785f 6469 6d5d 0a20 2020 2020 2020 2020  x_dim].         
+00007340: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00007350: 6573 7620 3d20 6e65 7874 5f70 6f69 6e74  esv = next_point
+00007360: 5b3a 2c33 202b 2073 656c 662e 785f 6469  [:,3 + self.x_di
+00007370: 6d3a 3320 2b20 7365 6c66 2e78 5f64 696d  m:3 + self.x_dim
+00007380: 202b 2073 656c 662e 6e75 6d5f 7061 7261   + self.num_para
+00007390: 6d73 5d0a 2020 2020 2020 2020 2020 2020  ms].            
+000073a0: 2020 2020 2020 2020 2320 736b 6970 2069          # skip i
+000073b0: 6620 7765 2061 6c72 6561 6479 206b 6e6f  f we already kno
+000073c0: 7720 6974 2069 7320 6e6f 7420 7573 6566  w it is not usef
+000073d0: 756c 0a20 2020 2020 2020 2020 2020 2020  ul.             
+000073e0: 2020 2020 2020 2069 6220 3d20 3020 6966         ib = 0 if
+000073f0: 206e 702e 6973 6669 6e69 7465 286c 696b   np.isfinite(lik
+00007400: 6573 5b30 5d29 2065 6c73 6520 310a 0a20  es[0]) else 1.. 
+00007410: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00007420: 6869 6c65 2069 6220 3e3d 206c 656e 2873  hile ib >= len(s
+00007430: 616d 706c 6573 293a 0a20 2020 2020 2020  amples):.       
+00007440: 2020 2020 2020 2020 2020 2020 2023 2067               # g
+00007450: 6574 206e 6577 2073 616d 706c 6573 0a20  et new samples. 
+00007460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007470: 2020 2069 6220 3d20 300a 0a20 2020 2020     ib = 0..     
+00007480: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00007490: 6320 3d20 300a 2020 2020 2020 2020 2020  c = 0.          
+000074a0: 2020 2020 2020 2020 2020 7520 3d20 7265            u = re
+000074b0: 6769 6f6e 2e73 616d 706c 6528 6e73 616d  gion.sample(nsam
+000074c0: 706c 6573 3d6e 6472 6177 290a 2020 2020  ples=ndraw).    
+000074d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000074e0: 6e75 203d 2075 2e73 6861 7065 5b30 5d0a  nu = u.shape[0].
 000074f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007500: 2020 2076 203d 206e 702e 656d 7074 7928     v = np.empty(
-00007510: 2830 2c20 7365 6c66 2e78 5f64 696d 2929  (0, self.x_dim))
-00007520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007530: 2020 2020 2020 2020 206c 6f67 6c20 3d20           logl = 
-00007540: 6e70 2e65 6d70 7479 2828 302c 2929 0a20  np.empty((0,)). 
-00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007560: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007580: 2076 203d 2073 656c 662e 7472 616e 7366   v = self.transf
-00007590: 6f72 6d28 7529 0a20 2020 2020 2020 2020  orm(u).         
-000075a0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000075b0: 6f67 6c20 3d20 7365 6c66 2e6c 6f67 6c69  ogl = self.logli
-000075c0: 6b65 2876 290a 2020 2020 2020 2020 2020  ke(v).          
-000075d0: 2020 2020 2020 2020 2020 2020 2020 6e63                nc
-000075e0: 202b 3d20 6e75 0a20 2020 2020 2020 2020   += nu.         
-000075f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00007600: 6363 6570 7465 6420 3d20 6c6f 676c 203e  ccepted = logl >
-00007610: 206c 6f67 6c73 7461 720a 2020 2020 2020   loglstar.      
-00007620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007630: 2020 7520 3d20 755b 6163 6365 7074 6564    u = u[accepted
-00007640: 2c3a 5d0a 2020 2020 2020 2020 2020 2020  ,:].            
-00007650: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
-00007660: 765b 6163 6365 7074 6564 2c3a 5d0a 2020  v[accepted,:].  
+00007500: 2020 2020 6966 206e 7520 3d3d 2030 3a0a      if nu == 0:.
+00007510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007520: 2020 2020 2020 2020 7620 3d20 6e70 2e65          v = np.e
+00007530: 6d70 7479 2828 302c 2073 656c 662e 785f  mpty((0, self.x_
+00007540: 6469 6d29 290a 2020 2020 2020 2020 2020  dim)).          
+00007550: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00007560: 676c 203d 206e 702e 656d 7074 7928 2830  gl = np.empty((0
+00007570: 2c29 290a 2020 2020 2020 2020 2020 2020  ,)).            
+00007580: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075a0: 2020 2020 2020 7620 3d20 7365 6c66 2e74        v = self.t
+000075b0: 7261 6e73 666f 726d 2875 290a 2020 2020  ransform(u).    
+000075c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075d0: 2020 2020 6c6f 676c 203d 2073 656c 662e      logl = self.
+000075e0: 6c6f 676c 696b 6528 7629 0a20 2020 2020  loglike(v).     
+000075f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007600: 2020 206e 6320 2b3d 206e 750a 2020 2020     nc += nu.    
+00007610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007620: 2020 2020 6163 6365 7074 6564 203d 206c      accepted = l
+00007630: 6f67 6c20 3e20 6c6f 676c 7374 6172 0a20  ogl > loglstar. 
+00007640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007650: 2020 2020 2020 2075 203d 2075 5b61 6363         u = u[acc
+00007660: 6570 7465 642c 3a5d 0a20 2020 2020 2020  epted,:].       
 00007670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007680: 2020 2020 2020 6c6f 676c 203d 206c 6f67        logl = log
-00007690: 6c5b 6163 6365 7074 6564 5d0a 2020 2020  l[accepted].    
-000076a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000076b0: 2020 2020 2320 6661 7468 6572 203d 2066      # father = f
-000076c0: 6174 6865 725b 6163 6365 7074 6564 5d0a  ather[accepted].
-000076d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000076e0: 2020 2020 2023 2063 6f6c 6c65 6374 2072       # collect r
-000076f0: 6573 756c 7473 2066 726f 6d20 616c 6c20  esults from all 
-00007700: 4d50 4920 6d65 6d62 6572 730a 2020 2020  MPI members.    
-00007710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007720: 6966 2073 656c 662e 7573 655f 6d70 693a  if self.use_mpi:
+00007680: 2076 203d 2076 5b61 6363 6570 7465 642c   v = v[accepted,
+00007690: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+000076a0: 2020 2020 2020 2020 2020 206c 6f67 6c20             logl 
+000076b0: 3d20 6c6f 676c 5b61 6363 6570 7465 645d  = logl[accepted]
+000076c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000076d0: 2020 2020 2020 2020 2023 2066 6174 6865           # fathe
+000076e0: 7220 3d20 6661 7468 6572 5b61 6363 6570  r = father[accep
+000076f0: 7465 645d 0a0a 2020 2020 2020 2020 2020  ted]..          
+00007700: 2020 2020 2020 2020 2020 2320 636f 6c6c            # coll
+00007710: 6563 7420 7265 7375 6c74 7320 6672 6f6d  ect results from
+00007720: 2061 6c6c 204d 5049 206d 656d 6265 7273   all MPI members
 00007730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007740: 2020 2020 2020 2020 2072 6563 765f 7361           recv_sa
-00007750: 6d70 6c65 7320 3d20 7365 6c66 2e63 6f6d  mples = self.com
-00007760: 6d2e 6761 7468 6572 2875 2c20 726f 6f74  m.gather(u, root
-00007770: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
-00007780: 2020 2020 2020 2020 2020 2020 7265 6376              recv
-00007790: 5f73 616d 706c 6573 7620 3d20 7365 6c66  _samplesv = self
-000077a0: 2e63 6f6d 6d2e 6761 7468 6572 2876 2c20  .comm.gather(v, 
-000077b0: 726f 6f74 3d30 290a 2020 2020 2020 2020  root=0).        
-000077c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077d0: 7265 6376 5f6c 696b 6573 203d 2073 656c  recv_likes = sel
-000077e0: 662e 636f 6d6d 2e67 6174 6865 7228 6c6f  f.comm.gather(lo
-000077f0: 676c 2c20 726f 6f74 3d30 290a 2020 2020  gl, root=0).    
-00007800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007810: 2020 2020 7265 6376 5f6e 6320 3d20 7365      recv_nc = se
-00007820: 6c66 2e63 6f6d 6d2e 6761 7468 6572 286e  lf.comm.gather(n
-00007830: 632c 2072 6f6f 743d 3029 0a20 2020 2020  c, root=0).     
-00007840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007850: 2020 2072 6563 765f 7361 6d70 6c65 7320     recv_samples 
-00007860: 3d20 7365 6c66 2e63 6f6d 6d2e 6263 6173  = self.comm.bcas
-00007870: 7428 7265 6376 5f73 616d 706c 6573 2c20  t(recv_samples, 
-00007880: 726f 6f74 3d30 290a 2020 2020 2020 2020  root=0).        
-00007890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078a0: 7265 6376 5f73 616d 706c 6573 7620 3d20  recv_samplesv = 
-000078b0: 7365 6c66 2e63 6f6d 6d2e 6263 6173 7428  self.comm.bcast(
-000078c0: 7265 6376 5f73 616d 706c 6573 762c 2072  recv_samplesv, r
-000078d0: 6f6f 743d 3029 0a20 2020 2020 2020 2020  oot=0).         
-000078e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000078f0: 6563 765f 6c69 6b65 7320 3d20 7365 6c66  ecv_likes = self
-00007900: 2e63 6f6d 6d2e 6263 6173 7428 7265 6376  .comm.bcast(recv
-00007910: 5f6c 696b 6573 2c20 726f 6f74 3d30 290a  _likes, root=0).
-00007920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007930: 2020 2020 2020 2020 7265 6376 5f6e 6320          recv_nc 
-00007940: 3d20 7365 6c66 2e63 6f6d 6d2e 6263 6173  = self.comm.bcas
-00007950: 7428 7265 6376 5f6e 632c 2072 6f6f 743d  t(recv_nc, root=
-00007960: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00007970: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-00007980: 6573 203d 206e 702e 636f 6e63 6174 656e  es = np.concaten
-00007990: 6174 6528 7265 6376 5f73 616d 706c 6573  ate(recv_samples
-000079a0: 2c20 6178 6973 3d30 290a 2020 2020 2020  , axis=0).      
-000079b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079c0: 2020 7361 6d70 6c65 7376 203d 206e 702e    samplesv = np.
-000079d0: 636f 6e63 6174 656e 6174 6528 7265 6376  concatenate(recv
-000079e0: 5f73 616d 706c 6573 762c 2061 7869 733d  _samplesv, axis=
-000079f0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
-00007a00: 2020 2020 2020 2020 2020 206c 696b 6573             likes
-00007a10: 203d 206e 702e 636f 6e63 6174 656e 6174   = np.concatenat
-00007a20: 6528 7265 6376 5f6c 696b 6573 2c20 6178  e(recv_likes, ax
-00007a30: 6973 3d30 290a 2020 2020 2020 2020 2020  is=0).          
-00007a40: 2020 2020 2020 2020 2020 2020 2020 6e63                nc
-00007a50: 616c 6c20 2b3d 2073 756d 2872 6563 765f  all += sum(recv_
-00007a60: 6e63 290a 2020 2020 2020 2020 2020 2020  nc).            
-00007a70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00007a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a90: 2020 2020 2020 7361 6d70 6c65 7320 3d20        samples = 
-00007aa0: 6e70 2e61 7272 6179 2875 290a 2020 2020  np.array(u).    
-00007ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ac0: 2020 2020 7361 6d70 6c65 7376 203d 206e      samplesv = n
-00007ad0: 702e 6172 7261 7928 7629 0a20 2020 2020  p.array(v).     
-00007ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007af0: 2020 206c 696b 6573 203d 206e 702e 6172     likes = np.ar
-00007b00: 7261 7928 6c6f 676c 290a 2020 2020 2020  ray(logl).      
-00007b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b20: 2020 6e63 616c 6c20 2b3d 206e 630a 0a20    ncall += nc.. 
+00007740: 2020 2020 2069 6620 7365 6c66 2e75 7365       if self.use
+00007750: 5f6d 7069 3a0a 2020 2020 2020 2020 2020  _mpi:.          
+00007760: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00007770: 6376 5f73 616d 706c 6573 203d 2073 656c  cv_samples = sel
+00007780: 662e 636f 6d6d 2e67 6174 6865 7228 752c  f.comm.gather(u,
+00007790: 2072 6f6f 743d 3029 0a20 2020 2020 2020   root=0).       
+000077a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000077b0: 2072 6563 765f 7361 6d70 6c65 7376 203d   recv_samplesv =
+000077c0: 2073 656c 662e 636f 6d6d 2e67 6174 6865   self.comm.gathe
+000077d0: 7228 762c 2072 6f6f 743d 3029 0a20 2020  r(v, root=0).   
+000077e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000077f0: 2020 2020 2072 6563 765f 6c69 6b65 7320       recv_likes 
+00007800: 3d20 7365 6c66 2e63 6f6d 6d2e 6761 7468  = self.comm.gath
+00007810: 6572 286c 6f67 6c2c 2072 6f6f 743d 3029  er(logl, root=0)
+00007820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007830: 2020 2020 2020 2020 2072 6563 765f 6e63           recv_nc
+00007840: 203d 2073 656c 662e 636f 6d6d 2e67 6174   = self.comm.gat
+00007850: 6865 7228 6e63 2c20 726f 6f74 3d30 290a  her(nc, root=0).
+00007860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007870: 2020 2020 2020 2020 7265 6376 5f73 616d          recv_sam
+00007880: 706c 6573 203d 2073 656c 662e 636f 6d6d  ples = self.comm
+00007890: 2e62 6361 7374 2872 6563 765f 7361 6d70  .bcast(recv_samp
+000078a0: 6c65 732c 2072 6f6f 743d 3029 0a20 2020  les, root=0).   
+000078b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078c0: 2020 2020 2072 6563 765f 7361 6d70 6c65       recv_sample
+000078d0: 7376 203d 2073 656c 662e 636f 6d6d 2e62  sv = self.comm.b
+000078e0: 6361 7374 2872 6563 765f 7361 6d70 6c65  cast(recv_sample
+000078f0: 7376 2c20 726f 6f74 3d30 290a 2020 2020  sv, root=0).    
+00007900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007910: 2020 2020 7265 6376 5f6c 696b 6573 203d      recv_likes =
+00007920: 2073 656c 662e 636f 6d6d 2e62 6361 7374   self.comm.bcast
+00007930: 2872 6563 765f 6c69 6b65 732c 2072 6f6f  (recv_likes, roo
+00007940: 743d 3029 0a20 2020 2020 2020 2020 2020  t=0).           
+00007950: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+00007960: 765f 6e63 203d 2073 656c 662e 636f 6d6d  v_nc = self.comm
+00007970: 2e62 6361 7374 2872 6563 765f 6e63 2c20  .bcast(recv_nc, 
+00007980: 726f 6f74 3d30 290a 2020 2020 2020 2020  root=0).        
+00007990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079a0: 7361 6d70 6c65 7320 3d20 6e70 2e63 6f6e  samples = np.con
+000079b0: 6361 7465 6e61 7465 2872 6563 765f 7361  catenate(recv_sa
+000079c0: 6d70 6c65 732c 2061 7869 733d 3029 0a20  mples, axis=0). 
+000079d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079e0: 2020 2020 2020 2073 616d 706c 6573 7620         samplesv 
+000079f0: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+00007a00: 2872 6563 765f 7361 6d70 6c65 7376 2c20  (recv_samplesv, 
+00007a10: 6178 6973 3d30 290a 2020 2020 2020 2020  axis=0).        
+00007a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a30: 6c69 6b65 7320 3d20 6e70 2e63 6f6e 6361  likes = np.conca
+00007a40: 7465 6e61 7465 2872 6563 765f 6c69 6b65  tenate(recv_like
+00007a50: 732c 2061 7869 733d 3029 0a20 2020 2020  s, axis=0).     
+00007a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a70: 2020 206e 6361 6c6c 202b 3d20 7375 6d28     ncall += sum(
+00007a80: 7265 6376 5f6e 6329 0a20 2020 2020 2020  recv_nc).       
+00007a90: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00007aa0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00007ab0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00007ac0: 6573 203d 206e 702e 6172 7261 7928 7529  es = np.array(u)
+00007ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007ae0: 2020 2020 2020 2020 2073 616d 706c 6573           samples
+00007af0: 7620 3d20 6e70 2e61 7272 6179 2876 290a  v = np.array(v).
+00007b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b10: 2020 2020 2020 2020 6c69 6b65 7320 3d20          likes = 
+00007b20: 6e70 2e61 7272 6179 286c 6f67 6c29 0a20  np.array(logl). 
 00007b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b40: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
-00007b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b60: 2020 2020 2020 2020 666f 7220 7569 2c20          for ui, 
-00007b70: 7669 2c20 6c6f 676c 6920 696e 207a 6970  vi, logli in zip
-00007b80: 2873 616d 706c 6573 2c20 7361 6d70 6c65  (samples, sample
-00007b90: 7376 2c20 6c69 6b65 7329 3a0a 2020 2020  sv, likes):.    
-00007ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007bb0: 2020 2020 2020 2020 7365 6c66 2e70 6f69          self.poi
-00007bc0: 6e74 7374 6f72 652e 6164 6428 0a20 2020  ntstore.add(.   
-00007bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007be0: 2020 2020 2020 2020 2020 2020 205f 6c69               _li
-00007bf0: 7374 6966 7928 5b6c 6f67 6c73 7461 722c  stify([loglstar,
-00007c00: 206c 6f67 6c69 2c20 302e 305d 2c20 7569   logli, 0.0], ui
-00007c10: 2c20 7669 292c 0a20 2020 2020 2020 2020  , vi),.         
-00007c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c30: 2020 2020 2020 206e 6361 6c6c 290a 0a20         ncall).. 
-00007c40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00007c50: 6620 6c69 6b65 735b 6962 5d20 3e20 6c6f  f likes[ib] > lo
-00007c60: 676c 7374 6172 3a0a 2020 2020 2020 2020  glstar:.        
-00007c70: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-00007c80: 7665 5f75 5b77 6f72 7374 5d20 3d20 7361  ve_u[worst] = sa
-00007c90: 6d70 6c65 735b 6962 2c20 3a5d 0a20 2020  mples[ib, :].   
-00007ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007cb0: 2061 6374 6976 655f 765b 776f 7273 745d   active_v[worst]
-00007cc0: 203d 2073 616d 706c 6573 765b 6962 2c3a   = samplesv[ib,:
-00007cd0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00007ce0: 2020 2020 2020 6163 7469 7665 5f6c 6f67        active_log
-00007cf0: 6c5b 776f 7273 745d 203d 206c 696b 6573  l[worst] = likes
-00007d00: 5b69 625d 0a0a 2020 2020 2020 2020 2020  [ib]..          
-00007d10: 2020 2020 2020 2020 2020 2320 6966 2077            # if w
-00007d20: 6520 6b65 6570 2074 6865 2072 6567 696f  e keep the regio
-00007d30: 6e20 696e 666f 726d 6564 2061 626f 7574  n informed about
-00007d40: 2074 6865 206e 6577 206c 6976 6520 706f   the new live po
-00007d50: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
-00007d60: 2020 2020 2020 2020 2023 2074 6865 6e20           # then 
-00007d70: 7468 6520 7265 6769 6f6e 2066 6f6c 6c6f  the region follo
-00007d80: 7773 2074 6865 206c 6976 6520 706f 696e  ws the live poin
-00007d90: 7473 2065 7665 6e20 6966 206d 6178 7261  ts even if maxra
-00007da0: 6469 7573 2069 7320 6e6f 7420 7570 6461  dius is not upda
-00007db0: 7465 640a 2020 2020 2020 2020 2020 2020  ted.            
-00007dc0: 2020 2020 2020 2020 7265 6769 6f6e 2e75          region.u
-00007dd0: 5b77 6f72 7374 2c3a 5d20 3d20 6163 7469  [worst,:] = acti
-00007de0: 7665 5f75 5b77 6f72 7374 5d0a 2020 2020  ve_u[worst].    
-00007df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e00: 7265 6769 6f6e 2e75 6e6f 726d 6564 5b77  region.unormed[w
-00007e10: 6f72 7374 2c3a 5d20 3d20 7265 6769 6f6e  orst,:] = region
-00007e20: 2e74 7261 6e73 666f 726d 4c61 7965 722e  .transformLayer.
-00007e30: 7472 616e 7366 6f72 6d28 7265 6769 6f6e  transform(region
-00007e40: 2e75 5b77 6f72 7374 2c3a 5d29 0a0a 2020  .u[worst,:])..  
-00007e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e60: 2020 2320 6966 2077 6520 7472 6163 6b20    # if we track 
-00007e70: 7468 6520 636c 7573 7465 7220 6173 7369  the cluster assi
-00007e80: 676e 6d65 6e74 2c20 7468 656e 2069 6e20  gnment, then in 
-00007e90: 7468 6520 6e65 7874 2072 6f75 6e64 0a20  the next round. 
-00007ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007eb0: 2020 2023 2074 6865 2069 6473 2077 6974     # the ids wit
-00007ec0: 6820 7468 6520 7361 6d65 206d 656d 6265  h the same membe
-00007ed0: 7273 2061 7265 206c 696b 656c 7920 746f  rs are likely to
-00007ee0: 2068 6176 6520 7468 6520 7361 6d65 2069   have the same i
-00007ef0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00007f00: 2020 2020 2020 2320 7468 6973 2069 7320        # this is 
-00007f10: 696d 7065 7266 6563 740a 2020 2020 2020  imperfect.      
-00007f20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00007f30: 7472 616e 7366 6f72 6d4c 6179 6572 2e63  transformLayer.c
-00007f40: 6c75 7374 6572 6964 735b 776f 7273 745d  lusterids[worst]
-00007f50: 203d 2074 7261 6e73 666f 726d 4c61 7965   = transformLaye
-00007f60: 722e 636c 7573 7465 7269 6473 5b66 6174  r.clusterids[fat
-00007f70: 6865 725b 6962 5d5d 0a20 2020 2020 2020  her[ib]].       
-00007f80: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-00007f90: 6f20 7765 206a 7573 7420 6d61 726b 2074  o we just mark t
-00007fa0: 6865 2072 6570 6c61 6365 6420 6f6e 6573  he replaced ones
-00007fb0: 2061 7320 2275 6e61 7373 6967 6e65 6422   as "unassigned"
-00007fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007fd0: 2020 2020 2074 7261 6e73 666f 726d 4c61       transformLa
-00007fe0: 7965 722e 636c 7573 7465 7269 6473 5b77  yer.clusterids[w
-00007ff0: 6f72 7374 5d20 3d20 300a 2020 2020 2020  orst] = 0.      
-00008000: 2020 2020 2020 2020 2020 2020 2020 6962                ib
-00008010: 203d 2069 6220 2b20 310a 2020 2020 2020   = ib + 1.      
-00008020: 2020 2020 2020 2020 2020 2020 2020 6272                br
-00008030: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-00008040: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00008050: 2020 2020 2020 2020 2020 2020 2020 6962                ib
-00008060: 203d 2069 6220 2b20 310a 0a20 2020 2020   = ib + 1..     
-00008070: 2020 2020 2020 2023 2053 6872 696e 6b20         # Shrink 
-00008080: 696e 7465 7276 616c 0a20 2020 2020 2020  interval.       
-00008090: 2020 2020 206c 6f67 766f 6c20 2d3d 2031       logvol -= 1
-000080a0: 2e30 202f 2073 656c 662e 6e75 6d5f 6c69  .0 / self.num_li
-000080b0: 7665 5f70 6f69 6e74 730a 2020 2020 2020  ve_points.      
-000080c0: 2020 2020 2020 6c6f 677a 5f72 656d 6169        logz_remai
-000080d0: 6e20 3d20 6e70 2e6d 6178 2861 6374 6976  n = np.max(activ
-000080e0: 655f 6c6f 676c 2920 2d20 6974 202f 2073  e_logl) - it / s
-000080f0: 656c 662e 6e75 6d5f 6c69 7665 5f70 6f69  elf.num_live_poi
-00008100: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
-00008110: 6672 6163 7469 6f6e 5f72 656d 6169 6e20  fraction_remain 
-00008120: 3d20 6e70 2e6c 6f67 6164 6465 7870 286c  = np.logaddexp(l
-00008130: 6f67 7a2c 206c 6f67 7a5f 7265 6d61 696e  ogz, logz_remain
-00008140: 2920 2d20 6c6f 677a 0a0a 2020 2020 2020  ) - logz..      
-00008150: 2020 2020 2020 6966 2069 7420 2520 6c6f        if it % lo
-00008160: 675f 696e 7465 7276 616c 203d 3d20 3020  g_interval == 0 
-00008170: 616e 6420 7365 6c66 2e6c 6f67 3a0a 2020  and self.log:.  
-00008180: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00008190: 6e69 6365 6c6f 6767 6572 2873 656c 662e  nicelogger(self.
-000081a0: 7061 7261 6d6e 616d 6573 2c20 6163 7469  paramnames, acti
-000081b0: 7665 5f75 2c20 6163 7469 7665 5f76 2c20  ve_u, active_v, 
-000081c0: 6163 7469 7665 5f6c 6f67 6c2c 2069 742c  active_logl, it,
-000081d0: 206e 6361 6c6c 2c20 6c6f 677a 2c20 6c6f   ncall, logz, lo
-000081e0: 677a 5f72 656d 6169 6e2c 2072 6567 696f  gz_remain, regio
-000081f0: 6e3d 7265 6769 6f6e 290a 2020 2020 2020  n=region).      
-00008200: 2020 2020 2020 2020 2020 7379 732e 7374            sys.st
-00008210: 646f 7574 2e77 7269 7465 2827 5a3d 252e  dout.write('Z=%.
-00008220: 3167 2b25 2e31 6720 7c20 4c69 6b65 3d25  1g+%.1g | Like=%
-00008230: 2e31 672e 2e25 2e31 6720 7c20 6974 2f65  .1g..%.1g | it/e
-00008240: 7661 6c73 3d25 642f 2564 2065 6666 3d25  vals=%d/%d eff=%
-00008250: 2e34 6625 2520 205c 7227 2025 2028 0a20  .4f%%  \r' % (. 
-00008260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008270: 2020 206c 6f67 7a2c 206c 6f67 7a5f 7265     logz, logz_re
-00008280: 6d61 696e 2c20 6c6f 676c 7374 6172 2c20  main, loglstar, 
-00008290: 6e70 2e6d 6178 2861 6374 6976 655f 6c6f  np.max(active_lo
-000082a0: 676c 292c 2069 742c 0a20 2020 2020 2020  gl), it,.       
-000082b0: 2020 2020 2020 2020 2020 2020 206e 6361               nca
-000082c0: 6c6c 2c20 6e70 2e69 6e66 2069 6620 6e63  ll, np.inf if nc
-000082d0: 616c 6c20 3d3d 2030 2065 6c73 6520 6974  all == 0 else it
-000082e0: 202a 2031 3030 202f 206e 6361 6c6c 2929   * 100 / ncall))
-000082f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008300: 2073 7973 2e73 7464 6f75 742e 666c 7573   sys.stdout.flus
-00008310: 6828 290a 0a20 2020 2020 2020 2020 2020  h()..           
-00008320: 2020 2020 2023 2069 6620 6566 6669 6369       # if effici
-00008330: 656e 6379 2062 6563 6f6d 6573 206c 6f77  ency becomes low
-00008340: 2c20 6275 6c6b 2d70 726f 6365 7373 206c  , bulk-process l
-00008350: 6172 6765 7220 6172 7261 7973 0a20 2020  arger arrays.   
-00008360: 2020 2020 2020 2020 2020 2020 206e 6472               ndr
-00008370: 6177 203d 206d 6178 2831 3238 2c20 6d69  aw = max(128, mi
-00008380: 6e28 3136 3338 342c 2072 6f75 6e64 2828  n(16384, round((
-00008390: 6e63 616c 6c20 2b20 3129 202f 2028 6974  ncall + 1) / (it
-000083a0: 202b 2031 2920 2f20 7365 6c66 2e6d 7069   + 1) / self.mpi
-000083b0: 5f73 697a 6529 2929 0a0a 2020 2020 2020  _size)))..      
-000083c0: 2020 2020 2020 2320 5374 6f70 7069 6e67        # Stopping
-000083d0: 2063 7269 7465 7269 6f6e 0a20 2020 2020   criterion.     
-000083e0: 2020 2020 2020 2069 6620 6672 6163 7469         if fracti
-000083f0: 6f6e 5f72 656d 6169 6e20 3c20 646c 6f67  on_remain < dlog
-00008400: 7a3a 0a20 2020 2020 2020 2020 2020 2020  z:.             
-00008410: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-00008420: 2020 2020 2069 7420 3d20 6974 202b 2031       it = it + 1
-00008430: 0a0a 2020 2020 2020 2020 6c6f 6776 6f6c  ..        logvol
-00008440: 203d 202d 6c65 6e28 7361 7665 645f 7629   = -len(saved_v)
-00008450: 202f 2073 656c 662e 6e75 6d5f 6c69 7665   / self.num_live
-00008460: 5f70 6f69 6e74 7320 2d20 6c6f 6728 7365  _points - log(se
-00008470: 6c66 2e6e 756d 5f6c 6976 655f 706f 696e  lf.num_live_poin
-00008480: 7473 290a 2020 2020 2020 2020 666f 7220  ts).        for 
-00008490: 6920 696e 2072 616e 6765 2873 656c 662e  i in range(self.
-000084a0: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7329  num_live_points)
-000084b0: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-000084c0: 6777 7420 3d20 6c6f 6776 6f6c 202b 2061  gwt = logvol + a
-000084d0: 6374 6976 655f 6c6f 676c 5b69 5d0a 2020  ctive_logl[i].  
-000084e0: 2020 2020 2020 2020 2020 6c6f 677a 5f6e            logz_n
-000084f0: 6577 203d 206e 702e 6c6f 6761 6464 6578  ew = np.logaddex
-00008500: 7028 6c6f 677a 2c20 6c6f 6777 7429 0a20  p(logz, logwt). 
-00008510: 2020 2020 2020 2020 2020 2068 203d 2028             h = (
-00008520: 6578 7028 6c6f 6777 7420 2d20 6c6f 677a  exp(logwt - logz
-00008530: 5f6e 6577 2920 2a20 6163 7469 7665 5f6c  _new) * active_l
-00008540: 6f67 6c5b 695d 202b 2065 7870 286c 6f67  ogl[i] + exp(log
-00008550: 7a20 2d20 6c6f 677a 5f6e 6577 2920 2a20  z - logz_new) * 
-00008560: 2868 202b 206c 6f67 7a29 202d 206c 6f67  (h + logz) - log
-00008570: 7a5f 6e65 7729 0a20 2020 2020 2020 2020  z_new).         
-00008580: 2020 206c 6f67 7a20 3d20 6c6f 677a 5f6e     logz = logz_n
-00008590: 6577 0a20 2020 2020 2020 2020 2020 2073  ew.            s
-000085a0: 6176 6564 5f75 2e61 7070 656e 6428 6e70  aved_u.append(np
-000085b0: 2e61 7272 6179 2861 6374 6976 655f 755b  .array(active_u[
-000085c0: 695d 2929 0a20 2020 2020 2020 2020 2020  i])).           
-000085d0: 2073 6176 6564 5f76 2e61 7070 656e 6428   saved_v.append(
-000085e0: 6e70 2e61 7272 6179 2861 6374 6976 655f  np.array(active_
-000085f0: 765b 695d 2929 0a20 2020 2020 2020 2020  v[i])).         
-00008600: 2020 2073 6176 6564 5f6c 6f67 7774 2e61     saved_logwt.a
-00008610: 7070 656e 6428 6c6f 6777 7429 0a20 2020  ppend(logwt).   
-00008620: 2020 2020 2020 2020 2073 6176 6564 5f6c           saved_l
-00008630: 6f67 6c2e 6170 7065 6e64 2861 6374 6976  ogl.append(activ
-00008640: 655f 6c6f 676c 5b69 5d29 0a0a 2020 2020  e_logl[i])..    
-00008650: 2020 2020 7361 7665 645f 7520 3d20 6e70      saved_u = np
-00008660: 2e61 7272 6179 2873 6176 6564 5f75 290a  .array(saved_u).
-00008670: 2020 2020 2020 2020 7361 7665 645f 7620          saved_v 
-00008680: 3d20 6e70 2e61 7272 6179 2873 6176 6564  = np.array(saved
-00008690: 5f76 290a 2020 2020 2020 2020 7361 7665  _v).        save
-000086a0: 645f 7774 203d 2065 7870 286e 702e 6172  d_wt = exp(np.ar
-000086b0: 7261 7928 7361 7665 645f 6c6f 6777 7429  ray(saved_logwt)
-000086c0: 202d 206c 6f67 7a29 0a20 2020 2020 2020   - logz).       
-000086d0: 2073 6176 6564 5f6c 6f67 6c20 3d20 6e70   saved_logl = np
-000086e0: 2e61 7272 6179 2873 6176 6564 5f6c 6f67  .array(saved_log
-000086f0: 6c29 0a20 2020 2020 2020 206c 6f67 7a65  l).        logze
-00008700: 7272 203d 206e 702e 7371 7274 2868 202f  rr = np.sqrt(h /
-00008710: 2073 656c 662e 6e75 6d5f 6c69 7665 5f70   self.num_live_p
-00008720: 6f69 6e74 7329 0a0a 2020 2020 2020 2020  oints)..        
-00008730: 6966 2073 656c 662e 6c6f 675f 746f 5f64  if self.log_to_d
-00008740: 6973 6b3a 0a20 2020 2020 2020 2020 2020  isk:.           
-00008750: 2077 6974 6820 6f70 656e 286f 732e 7061   with open(os.pa
-00008760: 7468 2e6a 6f69 6e28 7365 6c66 2e6c 6f67  th.join(self.log
-00008770: 735b 2772 6573 756c 7473 275d 2c20 2766  s['results'], 'f
-00008780: 696e 616c 2e63 7376 2729 2c20 2777 2729  inal.csv'), 'w')
-00008790: 2061 7320 663a 0a20 2020 2020 2020 2020   as f:.         
-000087a0: 2020 2020 2020 2077 7269 7465 7220 3d20         writer = 
-000087b0: 6373 762e 7772 6974 6572 2866 290a 2020  csv.writer(f).  
-000087c0: 2020 2020 2020 2020 2020 2020 2020 7772                wr
-000087d0: 6974 6572 2e77 7269 7465 726f 7728 5b27  iter.writerow(['
-000087e0: 6e69 7465 7227 2c20 276e 6361 6c6c 272c  niter', 'ncall',
-000087f0: 2027 6c6f 677a 272c 2027 6c6f 677a 6572   'logz', 'logzer
-00008800: 7227 2c20 2768 275d 290a 2020 2020 2020  r', 'h']).      
-00008810: 2020 2020 2020 2020 2020 7772 6974 6572            writer
-00008820: 2e77 7269 7465 726f 7728 5b69 7420 2b20  .writerow([it + 
-00008830: 312c 206e 6361 6c6c 2c20 6c6f 677a 2c20  1, ncall, logz, 
-00008840: 6c6f 677a 6572 722c 2068 5d29 0a20 2020  logzerr, h]).   
-00008850: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-00008860: 696e 7473 746f 7265 2e63 6c6f 7365 2829  intstore.close()
-00008870: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00008880: 2073 656c 662e 7573 655f 6d70 6920 6f72   self.use_mpi or
-00008890: 2073 656c 662e 6d70 695f 7261 6e6b 203d   self.mpi_rank =
-000088a0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-000088b0: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
-000088c0: 2020 2020 2070 7269 6e74 2822 6e69 7465       print("nite
-000088d0: 723a 207b 3a64 7d5c 6e20 6e63 616c 6c3a  r: {:d}\n ncall:
-000088e0: 207b 3a64 7d5c 6e20 6e73 616d 706c 6573   {:d}\n nsamples
-000088f0: 3a20 7b3a 647d 5c6e 206c 6f67 7a3a 207b  : {:d}\n logz: {
-00008900: 3a36 2e33 667d 202b 2f2d 207b 3a36 2e33  :6.3f} +/- {:6.3
-00008910: 667d 5c6e 2068 3a20 7b3a 362e 3366 7d22  f}\n h: {:6.3f}"
-00008920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008930: 2020 202e 666f 726d 6174 2869 7420 2b20     .format(it + 
-00008940: 312c 206e 6361 6c6c 2c20 6c65 6e28 7361  1, ncall, len(sa
-00008950: 7665 645f 7629 2c20 6c6f 677a 2c20 6c6f  ved_v), logz, lo
-00008960: 677a 6572 722c 2068 2929 0a0a 2020 2020  gzerr, h))..    
-00008970: 2020 2020 7365 6c66 2e72 6573 756c 7473      self.results
-00008980: 203d 2064 6963 7428 0a20 2020 2020 2020   = dict(.       
-00008990: 2020 2020 2073 616d 706c 6573 3d72 6573       samples=res
-000089a0: 616d 706c 655f 6571 7561 6c28 7361 7665  ample_equal(save
-000089b0: 645f 762c 2073 6176 6564 5f77 7420 2f20  d_v, saved_wt / 
-000089c0: 7361 7665 645f 7774 2e73 756d 2829 292c  saved_wt.sum()),
-000089d0: 0a20 2020 2020 2020 2020 2020 206e 6361  .            nca
-000089e0: 6c6c 3d6e 6361 6c6c 2c20 6e69 7465 723d  ll=ncall, niter=
-000089f0: 6974 2c20 6c6f 677a 3d6c 6f67 7a2c 206c  it, logz=logz, l
-00008a00: 6f67 7a65 7272 3d6c 6f67 7a65 7272 2c0a  ogzerr=logzerr,.
-00008a10: 2020 2020 2020 2020 2020 2020 7765 6967              weig
-00008a20: 6874 6564 5f73 616d 706c 6573 3d64 6963  hted_samples=dic
-00008a30: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00008a40: 2020 2075 706f 696e 7473 3d73 6176 6564     upoints=saved
-00008a50: 5f75 2c20 706f 696e 7473 3d73 6176 6564  _u, points=saved
-00008a60: 5f76 2c20 7765 6967 6874 733d 7361 7665  _v, weights=save
-00008a70: 645f 7774 2c0a 2020 2020 2020 2020 2020  d_wt,.          
-00008a80: 2020 2020 2020 6c6f 6777 6569 6768 7473        logweights
-00008a90: 3d73 6176 6564 5f6c 6f67 7774 2c20 6c6f  =saved_logwt, lo
-00008aa0: 676c 3d73 6176 6564 5f6c 6f67 6c29 2c0a  gl=saved_logl),.
-00008ab0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00008ac0: 2020 2072 6574 7572 6e20 7365 6c66 2e72     return self.r
-00008ad0: 6573 756c 7473 0a0a 2020 2020 6465 6620  esults..    def 
-00008ae0: 7072 696e 745f 7265 7375 6c74 7328 7365  print_results(se
-00008af0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00008b00: 4769 7665 2073 756d 6d61 7279 206f 6620  Give summary of 
-00008b10: 6d61 7267 696e 616c 206c 696b 656c 6968  marginal likelih
-00008b20: 6f6f 6420 616e 6420 7061 7261 6d65 7465  ood and paramete
-00008b30: 7273 2e22 2222 0a20 2020 2020 2020 2070  rs.""".        p
-00008b40: 7269 6e74 2829 0a20 2020 2020 2020 2070  rint().        p
-00008b50: 7269 6e74 2827 6c6f 675a 203d 2025 286c  rint('logZ = %(l
-00008b60: 6f67 7a29 2e33 6620 2b2d 2025 286c 6f67  ogz).3f +- %(log
-00008b70: 7a65 7272 292e 3366 2720 2520 7365 6c66  zerr).3f' % self
-00008b80: 2e72 6573 756c 7473 290a 0a20 2020 2020  .results)..     
-00008b90: 2020 2070 7269 6e74 2829 0a20 2020 2020     print().     
-00008ba0: 2020 2066 6f72 2069 2c20 7020 696e 2065     for i, p in e
-00008bb0: 6e75 6d65 7261 7465 2873 656c 662e 7061  numerate(self.pa
-00008bc0: 7261 6d6e 616d 6573 202b 2073 656c 662e  ramnames + self.
-00008bd0: 6465 7269 7665 6470 6172 616d 6e61 6d65  derivedparamname
-00008be0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00008bf0: 7620 3d20 7365 6c66 2e72 6573 756c 7473  v = self.results
-00008c00: 5b27 7361 6d70 6c65 7327 5d5b 3a2c 695d  ['samples'][:,i]
-00008c10: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
-00008c20: 6d61 203d 2076 2e73 7464 2829 0a20 2020  ma = v.std().   
-00008c30: 2020 2020 2020 2020 206d 6564 203d 2076           med = v
-00008c40: 2e6d 6561 6e28 290a 2020 2020 2020 2020  .mean().        
-00008c50: 2020 2020 6966 2073 6967 6d61 203d 3d20      if sigma == 
-00008c60: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00008c70: 2020 2069 203d 2033 0a20 2020 2020 2020     i = 3.       
-00008c80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00008c90: 2020 2020 2020 2020 2020 2069 203d 206d             i = m
-00008ca0: 6178 2830 2c20 696e 7428 2d6e 702e 666c  ax(0, int(-np.fl
-00008cb0: 6f6f 7228 6e70 2e6c 6f67 3130 2873 6967  oor(np.log10(sig
-00008cc0: 6d61 2929 2920 2b20 3129 0a20 2020 2020  ma))) + 1).     
-00008cd0: 2020 2020 2020 2066 6d74 203d 2027 2525         fmt = '%%
-00008ce0: 2e25 6466 2720 2520 690a 2020 2020 2020  .%df' % i.      
-00008cf0: 2020 2020 2020 666d 7473 203d 2027 5c74        fmts = '\t
-00008d00: 272e 6a6f 696e 285b 2720 2020 2025 2d32  '.join(['    %-2
-00008d10: 3073 2720 2b20 666d 7420 2b20 2220 2b2d  0s' + fmt + " +-
-00008d20: 2022 202b 2066 6d74 5d29 0a20 2020 2020   " + fmt]).     
-00008d30: 2020 2020 2020 2070 7269 6e74 2866 6d74         print(fmt
-00008d40: 7320 2520 2870 2c20 6d65 642c 2073 6967  s % (p, med, sig
-00008d50: 6d61 2929 0a0a 2020 2020 6465 6620 706c  ma))..    def pl
-00008d60: 6f74 2873 656c 6629 3a0a 2020 2020 2020  ot(self):.      
-00008d70: 2020 2222 224d 616b 6520 636f 726e 6572    """Make corner
-00008d80: 2070 6c6f 742e 2222 220a 2020 2020 2020   plot.""".      
-00008d90: 2020 6966 2073 656c 662e 6c6f 675f 746f    if self.log_to
-00008da0: 5f64 6973 6b3a 0a20 2020 2020 2020 2020  _disk:.         
-00008db0: 2020 2069 6d70 6f72 7420 6d61 7470 6c6f     import matplo
-00008dc0: 746c 6962 2e70 7970 6c6f 7420 6173 2070  tlib.pyplot as p
-00008dd0: 6c74 0a20 2020 2020 2020 2020 2020 2069  lt.            i
-00008de0: 6d70 6f72 7420 636f 726e 6572 0a20 2020  mport corner.   
-00008df0: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
-00008e00: 6e70 2e61 7272 6179 2873 656c 662e 7265  np.array(self.re
-00008e10: 7375 6c74 735b 2777 6569 6768 7465 645f  sults['weighted_
-00008e20: 7361 6d70 6c65 7327 5d5b 2770 6f69 6e74  samples']['point
-00008e30: 7327 5d29 0a20 2020 2020 2020 2020 2020  s']).           
-00008e40: 2077 6569 6768 7473 203d 206e 702e 6172   weights = np.ar
-00008e50: 7261 7928 7365 6c66 2e72 6573 756c 7473  ray(self.results
-00008e60: 5b27 7765 6967 6874 6564 5f73 616d 706c  ['weighted_sampl
-00008e70: 6573 275d 5b27 7765 6967 6874 7327 5d29  es']['weights'])
-00008e80: 0a20 2020 2020 2020 2020 2020 2063 756d  .            cum
-00008e90: 7375 6d77 6569 6768 7473 203d 206e 702e  sumweights = np.
-00008ea0: 6375 6d73 756d 2877 6569 6768 7473 290a  cumsum(weights).
-00008eb0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-00008ec0: 6b20 3d20 6375 6d73 756d 7765 6967 6874  k = cumsumweight
-00008ed0: 7320 3e20 3165 2d34 0a0a 2020 2020 2020  s > 1e-4..      
-00008ee0: 2020 2020 2020 636f 726e 6572 2e63 6f72        corner.cor
-00008ef0: 6e65 7228 0a20 2020 2020 2020 2020 2020  ner(.           
-00008f00: 2020 2020 2064 6174 615b 6d61 736b 2c3a       data[mask,:
-00008f10: 5d2c 2077 6569 6768 7473 3d77 6569 6768  ], weights=weigh
-00008f20: 7473 5b6d 6173 6b5d 2c0a 2020 2020 2020  ts[mask],.      
-00008f30: 2020 2020 2020 2020 2020 6c61 6265 6c73            labels
-00008f40: 3d73 656c 662e 7061 7261 6d6e 616d 6573  =self.paramnames
-00008f50: 202b 2073 656c 662e 6465 7269 7665 6470   + self.derivedp
-00008f60: 6172 616d 6e61 6d65 732c 0a20 2020 2020  aramnames,.     
-00008f70: 2020 2020 2020 2020 2020 2073 686f 775f             show_
-00008f80: 7469 746c 6573 3d54 7275 6529 0a20 2020  titles=True).   
-00008f90: 2020 2020 2020 2020 2070 6c74 2e73 6176           plt.sav
-00008fa0: 6566 6967 286f 732e 7061 7468 2e6a 6f69  efig(os.path.joi
-00008fb0: 6e28 7365 6c66 2e6c 6f67 735b 2770 6c6f  n(self.logs['plo
-00008fc0: 7473 275d 2c20 2763 6f72 6e65 722e 7064  ts'], 'corner.pd
-00008fd0: 6627 292c 2062 626f 785f 696e 6368 6573  f'), bbox_inches
-00008fe0: 3d27 7469 6768 7427 290a 2020 2020 2020  ='tight').      
-00008ff0: 2020 2020 2020 706c 742e 636c 6f73 6528        plt.close(
-00009000: 290a 0a0a 6465 6620 7761 726d 7374 6172  )...def warmstar
-00009010: 745f 6672 6f6d 5f73 696d 696c 6172 5f66  t_from_similar_f
-00009020: 696c 6528 0a20 2020 2075 7361 6d70 6c65  ile(.    usample
-00009030: 5f66 696c 656e 616d 652c 0a20 2020 2070  _filename,.    p
-00009040: 6172 616d 5f6e 616d 6573 2c0a 2020 2020  aram_names,.    
-00009050: 6c6f 676c 696b 652c 0a20 2020 2074 7261  loglike,.    tra
-00009060: 6e73 666f 726d 2c0a 2020 2020 7665 6374  nsform,.    vect
-00009070: 6f72 697a 6564 3d46 616c 7365 2c0a 2020  orized=False,.  
-00009080: 2020 6d69 6e5f 6e75 6d5f 7361 6d70 6c65    min_num_sample
-00009090: 733d 3530 0a29 3a0a 2020 2020 2222 2257  s=50.):.    """W
-000090a0: 6172 6d73 7461 7274 2066 726f 6d20 6120  armstart from a 
-000090b0: 7072 6576 696f 7573 2072 756e 2e0a 0a20  previous run... 
-000090c0: 2020 2055 7361 6765 3a3a 0a0a 2020 2020     Usage::..    
-000090d0: 2020 2020 6175 785f 7061 7261 6d6e 616d      aux_paramnam
-000090e0: 6573 2c20 6175 785f 6c6f 675f 6c69 6b65  es, aux_log_like
-000090f0: 6c69 686f 6f64 2c20 6175 785f 7072 696f  lihood, aux_prio
-00009100: 725f 7472 616e 7366 6f72 6d2c 2076 6563  r_transform, vec
-00009110: 746f 7269 7a65 6420 3d20 7761 726d 7374  torized = warmst
-00009120: 6172 745f 6672 6f6d 5f73 696d 696c 6172  art_from_similar
-00009130: 5f66 696c 6528 0a20 2020 2020 2020 2020  _file(.         
-00009140: 2020 2027 6d6f 6465 6c31 2f63 6861 696e     'model1/chain
-00009150: 732f 7765 6967 6874 6564 5f70 6f73 745f  s/weighted_post_
-00009160: 756e 7472 616e 7366 6f72 6d65 642e 7478  untransformed.tx
-00009170: 7427 2c20 7061 7261 6d65 7465 7273 2c20  t', parameters, 
-00009180: 6c6f 675f 6c69 6b65 6c69 686f 6f64 5f77  log_likelihood_w
-00009190: 6974 685f 6261 636b 6772 6f75 6e64 2c20  ith_background, 
-000091a0: 7072 696f 725f 7472 616e 7366 6f72 6d29  prior_transform)
-000091b0: 0a0a 2020 2020 2020 2020 6175 785f 7361  ..        aux_sa
-000091c0: 6d70 6c65 7220 3d20 5265 6163 7469 7665  mpler = Reactive
-000091d0: 4e65 7374 6564 5361 6d70 6c65 7228 6175  NestedSampler(au
-000091e0: 785f 7061 7261 6d6e 616d 6573 2c20 6175  x_paramnames, au
-000091f0: 785f 6c6f 675f 6c69 6b65 6c69 686f 6f64  x_log_likelihood
-00009200: 2c20 7472 616e 7366 6f72 6d3d 6175 785f  , transform=aux_
-00009210: 7072 696f 725f 7472 616e 7366 6f72 6d2c  prior_transform,
-00009220: 7665 6374 6f72 697a 6564 3d76 6563 746f  vectorized=vecto
-00009230: 7269 7a65 6429 0a20 2020 2020 2020 2061  rized).        a
-00009240: 7578 5f73 616d 706c 6572 2e72 756e 2829  ux_sampler.run()
-00009250: 0a20 2020 2020 2020 2070 6f73 7465 7269  .        posteri
-00009260: 6f72 5f73 616d 706c 6573 203d 2061 7578  or_samples = aux
-00009270: 5f72 6573 756c 7473 5b27 7361 6d70 6c65  _results['sample
-00009280: 7327 5d5b 3a2c 2d31 5d0a 0a20 2020 2053  s'][:,-1]..    S
-00009290: 6565 203a 7079 3a66 756e 633a 6075 6c74  ee :py:func:`ult
-000092a0: 7261 6e65 7374 2e68 6f74 7374 6172 742e  ranest.hotstart.
-000092b0: 6765 745f 6175 7869 6c69 6172 795f 636f  get_auxiliary_co
-000092c0: 6e74 626f 785f 7061 7261 6d65 7465 7269  ntbox_parameteri
-000092d0: 7a61 7469 6f6e 600a 2020 2020 666f 7220  zation`.    for 
-000092e0: 6d6f 7265 2069 6e66 6f72 6d61 7469 6f6e  more information
-000092f0: 2e0a 0a20 2020 2054 6865 2072 656d 6169  ...    The remai
-00009300: 6e69 6e67 2070 6172 616d 6574 6572 7320  ning parameters 
-00009310: 6861 7665 2074 6865 2073 616d 6520 6d65  have the same me
-00009320: 616e 696e 6720 6173 2069 6e20 3a70 793a  aning as in :py:
-00009330: 636c 6173 733a 6052 6561 6374 6976 654e  class:`ReactiveN
-00009340: 6573 7465 6453 616d 706c 6572 602e 0a0a  estedSampler`...
-00009350: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00009360: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a     ------------.
-00009370: 2020 2020 7573 616d 706c 655f 6669 6c65      usample_file
-00009380: 6e61 6d65 3a20 7374 720a 2020 2020 2020  name: str.      
-00009390: 2020 2764 6972 6563 746f 7279 2f63 6861    'directory/cha
-000093a0: 696e 732f 7765 6967 6874 6564 5f70 6f73  ins/weighted_pos
-000093b0: 745f 756e 7472 616e 7366 6f72 6d65 642e  t_untransformed.
-000093c0: 7478 7427 0a20 2020 2020 2020 2063 6f6e  txt'.        con
-000093d0: 7461 696e 7320 706f 7374 6572 696f 7273  tains posteriors
-000093e0: 2069 6e20 752d 7370 6163 6520 2875 6e74   in u-space (unt
-000093f0: 7261 6e73 666f 726d 6564 2920 6f66 2061  ransformed) of a
-00009400: 2070 7265 7669 6f75 7320 7275 6e2e 0a20   previous run.. 
-00009410: 2020 2020 2020 2043 6f6c 756d 6e73 2061         Columns a
-00009420: 7265 2077 6569 6768 742c 206c 6f67 6c2c  re weight, logl,
-00009430: 2070 6172 616d 312c 2070 6172 616d 322c   param1, param2,
-00009440: 202e 2e2e 0a20 2020 206d 696e 5f6e 756d   ....    min_num
-00009450: 5f73 616d 706c 6573 3a20 696e 740a 2020  _samples: int.  
-00009460: 2020 2020 2020 6d69 6e69 6d75 6d20 6e75        minimum nu
-00009470: 6d62 6572 206f 6620 7361 6d70 6c65 7320  mber of samples 
-00009480: 696e 2074 6865 2075 7361 6d70 6c65 5f66  in the usample_f
-00009490: 696c 656e 616d 6520 6669 6c65 2072 6571  ilename file req
-000094a0: 7569 7265 642e 0a20 2020 2020 2020 2054  uired..        T
-000094b0: 6f6f 2066 6577 2073 616d 706c 6573 2077  oo few samples w
-000094c0: 696c 6c20 6769 7665 2061 2070 6f6f 7220  ill give a poor 
-000094d0: 6170 7072 6f78 696d 6174 696f 6e2e 0a0a  approximation...
-000094e0: 2020 2020 4f74 6865 7220 5061 7261 6d65      Other Parame
-000094f0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-00009500: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2070  ----------.    p
-00009510: 6172 616d 5f6e 616d 6573 3a20 6c69 7374  aram_names: list
-00009520: 0a20 2020 206c 6f67 6c69 6b65 3a20 6675  .    loglike: fu
-00009530: 6e63 7469 6f6e 0a20 2020 2074 7261 6e73  nction.    trans
-00009540: 666f 726d 3a20 6675 6e63 7469 6f6e 0a20  form: function. 
-00009550: 2020 2076 6563 746f 7269 7a65 643a 2062     vectorized: b
-00009560: 6f6f 6c0a 0a20 2020 2052 6574 7572 6e73  ool..    Returns
-00009570: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 0a20  .    ---------. 
-00009580: 2020 2061 7578 5f70 6172 616d 5f6e 616d     aux_param_nam
-00009590: 6573 3a20 6c69 7374 0a20 2020 2020 2020  es: list.       
-000095a0: 206e 6577 2070 6172 616d 6574 6572 206c   new parameter l
-000095b0: 6973 740a 2020 2020 6175 785f 6c6f 676c  ist.    aux_logl
-000095c0: 696b 656c 6968 6f6f 643a 2066 756e 6374  ikelihood: funct
-000095d0: 696f 6e0a 2020 2020 2020 2020 6e65 7720  ion.        new 
-000095e0: 6c6f 676c 696b 656c 6968 6f6f 6420 6675  loglikelihood fu
-000095f0: 6e63 7469 6f6e 0a20 2020 2061 7578 5f74  nction.    aux_t
-00009600: 7261 6e73 666f 726d 3a20 6675 6e63 7469  ransform: functi
-00009610: 6f6e 0a20 2020 2020 2020 206e 6577 2070  on.        new p
-00009620: 7269 6f72 2074 7261 6e73 666f 726d 2066  rior transform f
-00009630: 756e 6374 696f 6e0a 2020 2020 7665 6374  unction.    vect
-00009640: 6f72 697a 6564 3a20 626f 6f6c 0a20 2020  orized: bool.   
-00009650: 2020 2020 2077 6865 7468 6572 2074 6865       whether the
-00009660: 206e 6577 2066 756e 6374 696f 6e73 2061   new functions a
-00009670: 7265 2076 6563 746f 7269 7a65 640a 2020  re vectorized.  
-00009680: 2020 2222 220a 2020 2020 2320 6c6f 6164    """.    # load
-00009690: 2073 616d 706c 6573 0a20 2020 2074 7279   samples.    try
-000096a0: 3a0a 2020 2020 2020 2020 7769 7468 206f  :.        with o
-000096b0: 7065 6e28 7573 616d 706c 655f 6669 6c65  pen(usample_file
-000096c0: 6e61 6d65 2920 6173 2066 3a0a 2020 2020  name) as f:.    
-000096d0: 2020 2020 2020 2020 6f6c 645f 7061 7261          old_para
-000096e0: 6d5f 6e61 6d65 7320 3d20 662e 7265 6164  m_names = f.read
-000096f0: 6c69 6e65 2829 2e6c 7374 7269 7028 2723  line().lstrip('#
-00009700: 2729 2e73 7472 6970 2829 2e73 706c 6974  ').strip().split
-00009710: 2829 0a20 2020 2020 2020 2020 2020 2061  ().            a
-00009720: 7578 696c 6961 7279 5f75 7361 6d70 6c65  uxiliary_usample
-00009730: 7320 3d20 6e70 2e6c 6f61 6474 7874 2866  s = np.loadtxt(f
-00009740: 290a 2020 2020 6578 6365 7074 2049 4f45  ).    except IOE
-00009750: 7272 6f72 3a0a 2020 2020 2020 2020 7761  rror:.        wa
-00009760: 726e 696e 6773 2e77 6172 6e28 276e 6f74  rnings.warn('not
-00009770: 2068 6f74 2d72 6573 756d 696e 672c 2063   hot-resuming, c
-00009780: 6f75 6c64 206e 6f74 206c 6f61 6420 6669  ould not load fi
-00009790: 6c65 2022 2573 2227 2025 2075 7361 6d70  le "%s"' % usamp
-000097a0: 6c65 5f66 696c 656e 616d 6529 0a20 2020  le_filename).   
-000097b0: 2020 2020 2072 6574 7572 6e20 7061 7261       return para
-000097c0: 6d5f 6e61 6d65 732c 206c 6f67 6c69 6b65  m_names, loglike
-000097d0: 2c20 7472 616e 7366 6f72 6d2c 2076 6563  , transform, vec
-000097e0: 746f 7269 7a65 640a 0a20 2020 2075 6c6f  torized..    ulo
-000097f0: 676c 203d 2061 7578 696c 6961 7279 5f75  gl = auxiliary_u
-00009800: 7361 6d70 6c65 735b 3a2c 315d 0a20 2020  samples[:,1].   
-00009810: 2075 7765 6967 6874 735f 6675 6c6c 203d   uweights_full =
-00009820: 2061 7578 696c 6961 7279 5f75 7361 6d70   auxiliary_usamp
-00009830: 6c65 735b 3a2c 305d 202a 206e 702e 6578  les[:,0] * np.ex
-00009840: 7028 756c 6f67 6c20 2d20 756c 6f67 6c2e  p(ulogl - ulogl.
-00009850: 6d61 7828 2929 0a20 2020 206d 6173 6b20  max()).    mask 
-00009860: 3d20 7577 6569 6768 7473 5f66 756c 6c20  = uweights_full 
-00009870: 3e20 300a 2020 2020 7577 6569 6768 7473  > 0.    uweights
-00009880: 203d 2075 7765 6967 6874 735f 6675 6c6c   = uweights_full
-00009890: 5b6d 6173 6b5d 0a20 2020 2075 7765 6967  [mask].    uweig
-000098a0: 6874 7320 2f3d 2075 7765 6967 6874 732e  hts /= uweights.
-000098b0: 7375 6d28 290a 2020 2020 7570 6f69 6e74  sum().    upoint
-000098c0: 7320 3d20 6175 7869 6c69 6172 795f 7573  s = auxiliary_us
-000098d0: 616d 706c 6573 5b6d 6173 6b2c 323a 5d0a  amples[mask,2:].
-000098e0: 2020 2020 6465 6c20 6175 7869 6c69 6172      del auxiliar
-000098f0: 795f 7573 616d 706c 6573 0a0a 2020 2020  y_usamples..    
-00009900: 6e73 616d 706c 6573 203d 206c 656e 2875  nsamples = len(u
-00009910: 706f 696e 7473 290a 2020 2020 6966 206e  points).    if n
-00009920: 7361 6d70 6c65 7320 3c20 6d69 6e5f 6e75  samples < min_nu
-00009930: 6d5f 7361 6d70 6c65 733a 0a20 2020 2020  m_samples:.     
-00009940: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00009950: 726f 7228 2766 696c 6520 2225 7322 2068  ror('file "%s" h
-00009960: 6173 2074 6f6f 2066 6577 2073 616d 706c  as too few sampl
-00009970: 6573 2028 2564 2920 746f 2068 6f74 2d72  es (%d) to hot-r
-00009980: 6573 756d 6527 2025 2028 7573 616d 706c  esume' % (usampl
-00009990: 655f 6669 6c65 6e61 6d65 2c20 6e73 616d  e_filename, nsam
-000099a0: 706c 6573 2929 0a0a 2020 2020 2320 6368  ples))..    # ch
-000099b0: 6563 6b20 7468 6174 2074 6865 2070 6172  eck that the par
-000099c0: 616d 6574 6572 206d 6561 6e69 6e67 7320  ameter meanings 
-000099d0: 6861 7665 206e 6f74 2063 6861 6e67 6564  have not changed
-000099e0: 0a20 2020 2069 6620 6f6c 645f 7061 7261  .    if old_para
-000099f0: 6d5f 6e61 6d65 7320 213d 205b 2777 6569  m_names != ['wei
-00009a00: 6768 7427 2c20 276c 6f67 6c27 5d20 2b20  ght', 'logl'] + 
-00009a10: 7061 7261 6d5f 6e61 6d65 733a 0a20 2020  param_names:.   
-00009a20: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00009a30: 4572 726f 7228 2766 696c 6520 2225 7322  Error('file "%s"
-00009a40: 2068 6173 2070 6172 616d 6574 6572 7320   has parameters 
-00009a50: 2573 2c20 6578 7065 6374 6564 2025 732c  %s, expected %s,
-00009a60: 2063 616e 6e6f 7420 686f 742d 7265 7375   cannot hot-resu
-00009a70: 6d65 2e27 2025 2028 7573 616d 706c 655f  me.' % (usample_
-00009a80: 6669 6c65 6e61 6d65 2c20 6f6c 645f 7061  filename, old_pa
-00009a90: 7261 6d5f 6e61 6d65 732c 2070 6172 616d  ram_names, param
-00009aa0: 5f6e 616d 6573 2929 0a0a 2020 2020 7265  _names))..    re
-00009ab0: 7475 726e 2067 6574 5f61 7578 696c 6961  turn get_auxilia
-00009ac0: 7279 5f63 6f6e 7462 6f78 5f70 6172 616d  ry_contbox_param
-00009ad0: 6574 6572 697a 6174 696f 6e28 0a20 2020  eterization(.   
-00009ae0: 2020 2020 2070 6172 616d 5f6e 616d 6573       param_names
-00009af0: 2c20 6c6f 676c 696b 653d 6c6f 676c 696b  , loglike=loglik
-00009b00: 652c 2074 7261 6e73 666f 726d 3d74 7261  e, transform=tra
-00009b10: 6e73 666f 726d 2c0a 2020 2020 2020 2020  nsform,.        
-00009b20: 7665 6374 6f72 697a 6564 3d76 6563 746f  vectorized=vecto
-00009b30: 7269 7a65 642c 0a20 2020 2020 2020 2075  rized,.        u
-00009b40: 706f 696e 7473 3d75 706f 696e 7473 2c0a  points=upoints,.
-00009b50: 2020 2020 2020 2020 7577 6569 6768 7473          uweights
-00009b60: 3d75 7765 6967 6874 732c 0a20 2020 2029  =uweights,.    )
-00009b70: 0a0a 0a63 6c61 7373 2052 6561 6374 6976  ...class Reactiv
-00009b80: 654e 6573 7465 6453 616d 706c 6572 286f  eNestedSampler(o
-00009b90: 626a 6563 7429 3a0a 2020 2020 2222 224e  bject):.    """N
-00009ba0: 6573 7465 6420 7361 6d70 6c65 7220 7769  ested sampler wi
-00009bb0: 7468 2072 6561 6374 6976 6520 6578 706c  th reactive expl
-00009bc0: 6f72 6174 696f 6e20 7374 7261 7465 6779  oration strategy
-00009bd0: 2e0a 0a20 2020 2053 746f 7261 6765 2026  ...    Storage &
-00009be0: 2072 6573 756d 6520 6361 7061 626c 652c   resume capable,
-00009bf0: 206f 7074 696f 6e61 6c6c 7920 4d50 4920   optionally MPI 
-00009c00: 7061 7261 6c6c 656c 6973 6564 2e0a 2020  parallelised..  
-00009c10: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-00009c20: 5f69 6e69 745f 5f28 7365 6c66 2c0a 2020  _init__(self,.  
-00009c30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00009c40: 6172 616d 5f6e 616d 6573 2c0a 2020 2020  aram_names,.    
-00009c50: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-00009c60: 6c69 6b65 2c0a 2020 2020 2020 2020 2020  like,.          
-00009c70: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
-00009c80: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00009c90: 2020 2020 2020 2020 6465 7269 7665 645f          derived_
-00009ca0: 7061 7261 6d5f 6e61 6d65 733d 5b5d 2c0a  param_names=[],.
-00009cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009cc0: 2077 7261 7070 6564 5f70 6172 616d 733d   wrapped_params=
-00009cd0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00009ce0: 2020 2020 2020 2072 6573 756d 653d 2773         resume='s
-00009cf0: 7562 666f 6c64 6572 272c 0a20 2020 2020  ubfolder',.     
-00009d00: 2020 2020 2020 2020 2020 2020 7275 6e5f              run_
-00009d10: 6e75 6d3d 4e6f 6e65 2c0a 2020 2020 2020  num=None,.      
-00009d20: 2020 2020 2020 2020 2020 206c 6f67 5f64             log_d
-00009d30: 6972 3d4e 6f6e 652c 0a20 2020 2020 2020  ir=None,.       
-00009d40: 2020 2020 2020 2020 2020 6e75 6d5f 7465            num_te
-00009d50: 7374 5f73 616d 706c 6573 3d32 2c0a 2020  st_samples=2,.  
-00009d60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00009d70: 7261 775f 6d75 6c74 6970 6c65 3d54 7275  raw_multiple=Tru
-00009d80: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00009d90: 2020 2020 6e75 6d5f 626f 6f74 7374 7261      num_bootstra
-00009da0: 7073 3d33 302c 0a20 2020 2020 2020 2020  ps=30,.         
-00009db0: 2020 2020 2020 2020 7665 6374 6f72 697a          vectoriz
-00009dc0: 6564 3d46 616c 7365 2c0a 2020 2020 2020  ed=False,.      
-00009dd0: 2020 2020 2020 2020 2020 206e 6472 6177             ndraw
-00009de0: 5f6d 696e 3d31 3238 2c0a 2020 2020 2020  _min=128,.      
-00009df0: 2020 2020 2020 2020 2020 206e 6472 6177             ndraw
-00009e00: 5f6d 6178 3d36 3535 3336 2c0a 2020 2020  _max=65536,.    
-00009e10: 2020 2020 2020 2020 2020 2020 2073 746f               sto
-00009e20: 7261 6765 5f62 6163 6b65 6e64 3d27 6864  rage_backend='hd
-00009e30: 6635 272c 0a20 2020 2020 2020 2020 2020  f5',.           
-00009e40: 2020 2020 2020 7761 726d 7374 6172 745f        warmstart_
-00009e50: 6d61 785f 7461 753d 2d31 2c0a 2020 2020  max_tau=-1,.    
-00009e60: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-00009e70: 2020 2020 2020 2020 2222 2249 6e69 7469          """Initi
-00009e80: 616c 6973 6520 6e65 7374 6564 2073 616d  alise nested sam
-00009e90: 706c 6572 2e0a 0a20 2020 2020 2020 2050  pler...        P
-00009ea0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00009eb0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020    -----------.  
-00009ec0: 2020 2020 2020 7061 7261 6d5f 6e61 6d65        param_name
-00009ed0: 733a 206c 6973 7420 6f66 2073 7472 2c20  s: list of str, 
-00009ee0: 6e61 6d65 7320 6f66 2074 6865 2070 6172  names of the par
-00009ef0: 616d 6574 6572 732e 0a20 2020 2020 2020  ameters..       
-00009f00: 2020 2020 204c 656e 6774 6820 6769 7665       Length give
-00009f10: 7320 6469 6d65 6e73 696f 6e61 6c69 7479  s dimensionality
-00009f20: 206f 6620 7468 6520 7361 6d70 6c69 6e67   of the sampling
-00009f30: 2070 726f 626c 656d 2e0a 0a20 2020 2020   problem...     
-00009f40: 2020 206c 6f67 6c69 6b65 3a20 6675 6e63     loglike: func
-00009f50: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00009f60: 206c 6f67 2d6c 696b 656c 6968 6f6f 6420   log-likelihood 
-00009f70: 6675 6e63 7469 6f6e 2e0a 2020 2020 2020  function..      
-00009f80: 2020 2020 2020 5265 6365 6976 6573 206d        Receives m
-00009f90: 756c 7469 706c 6520 7061 7261 6d65 7465  ultiple paramete
-00009fa0: 7220 7665 6374 6f72 732c 2072 6574 7572  r vectors, retur
-00009fb0: 6e73 2076 6563 746f 7220 6f66 206c 696b  ns vector of lik
-00009fc0: 656c 6968 6f6f 642e 0a20 2020 2020 2020  elihood..       
-00009fd0: 2074 7261 6e73 666f 726d 3a20 6675 6e63   transform: func
-00009fe0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00009ff0: 2070 6172 616d 6574 6572 2074 7261 6e73   parameter trans
-0000a000: 666f 726d 2066 726f 6d20 756e 6974 2063  form from unit c
-0000a010: 7562 6520 746f 2070 6879 7369 6361 6c20  ube to physical 
-0000a020: 7061 7261 6d65 7465 7273 2e0a 2020 2020  parameters..    
-0000a030: 2020 2020 2020 2020 5265 6365 6976 6573          Receives
-0000a040: 206d 756c 7469 706c 6520 6375 6265 2076   multiple cube v
-0000a050: 6563 746f 7273 2c20 7265 7475 726e 7320  ectors, returns 
-0000a060: 6d75 6c74 6970 6c65 2070 6172 616d 6574  multiple paramet
-0000a070: 6572 2076 6563 746f 7273 2e0a 0a20 2020  er vectors...   
-0000a080: 2020 2020 2064 6572 6976 6564 5f70 6172       derived_par
-0000a090: 616d 5f6e 616d 6573 3a20 6c69 7374 206f  am_names: list o
-0000a0a0: 6620 7374 720a 2020 2020 2020 2020 2020  f str.          
-0000a0b0: 2020 4164 6469 7469 6f6e 616c 2064 6572    Additional der
-0000a0c0: 6976 6564 2070 6172 616d 6574 6572 7320  ived parameters 
-0000a0d0: 6372 6561 7465 6420 6279 2074 7261 6e73  created by trans
-0000a0e0: 666f 726d 2e20 2865 6d70 7479 2062 7920  form. (empty by 
-0000a0f0: 6465 6661 756c 7429 0a0a 2020 2020 2020  default)..      
-0000a100: 2020 6c6f 675f 6469 723a 2073 7472 0a20    log_dir: str. 
-0000a110: 2020 2020 2020 2020 2020 2077 6865 7265             where
-0000a120: 2074 6f20 7374 6f72 6520 6f75 7470 7574   to store output
-0000a130: 2066 696c 6573 0a20 2020 2020 2020 2072   files.        r
-0000a140: 6573 756d 653a 2027 7265 7375 6d65 272c  esume: 'resume',
-0000a150: 2027 7265 7375 6d65 2d73 696d 696c 6172   'resume-similar
-0000a160: 272c 2027 6f76 6572 7772 6974 6527 206f  ', 'overwrite' o
-0000a170: 7220 2773 7562 666f 6c64 6572 270a 0a20  r 'subfolder'.. 
-0000a180: 2020 2020 2020 2020 2020 2069 6620 276f             if 'o
-0000a190: 7665 7277 7269 7465 272c 206f 7665 7277  verwrite', overw
-0000a1a0: 7269 7465 2070 7265 7669 6f75 7320 6461  rite previous da
-0000a1b0: 7461 2e0a 0a20 2020 2020 2020 2020 2020  ta...           
-0000a1c0: 2069 6620 2773 7562 666f 6c64 6572 272c   if 'subfolder',
-0000a1d0: 2063 7265 6174 6520 6120 6672 6573 6820   create a fresh 
-0000a1e0: 7375 6264 6972 6563 746f 7279 2069 6e20  subdirectory in 
-0000a1f0: 6c6f 675f 6469 722e 0a0a 2020 2020 2020  log_dir...      
-0000a200: 2020 2020 2020 6966 2027 7265 7375 6d65        if 'resume
-0000a210: 2720 6f72 2054 7275 652c 2063 6f6e 7469  ' or True, conti
-0000a220: 6e75 6520 7072 6576 696f 7573 2072 756e  nue previous run
-0000a230: 2069 6620 6176 6169 6c61 626c 652e 0a20   if available.. 
-0000a240: 2020 2020 2020 2020 2020 204f 6e6c 7920             Only 
-0000a250: 776f 726b 7320 7768 656e 2064 696d 656e  works when dimen
-0000a260: 7369 6f6e 616c 6974 792c 2074 7261 6e73  sionality, trans
-0000a270: 666f 726d 206f 7220 6c69 6b65 6c69 686f  form or likeliho
-0000a280: 6f64 2061 7265 2063 6f6e 7369 7374 656e  od are consisten
-0000a290: 742e 0a0a 2020 2020 2020 2020 2020 2020  t...            
-0000a2a0: 6966 2027 7265 7375 6d65 2d73 696d 696c  if 'resume-simil
-0000a2b0: 6172 272c 2063 6f6e 7469 6e75 6520 7072  ar', continue pr
-0000a2c0: 6576 696f 7573 2072 756e 2069 6620 6176  evious run if av
-0000a2d0: 6169 6c61 626c 652e 0a20 2020 2020 2020  ailable..       
-0000a2e0: 2020 2020 204f 6e6c 7920 776f 726b 7320       Only works 
-0000a2f0: 7768 656e 2064 696d 656e 7369 6f6e 616c  when dimensional
-0000a300: 6974 7920 616e 6420 7472 616e 7366 6f72  ity and transfor
-0000a310: 6d20 6172 6520 636f 6e73 6973 7465 6e74  m are consistent
-0000a320: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-0000a330: 2061 206c 696b 656c 6968 6f6f 6420 6469   a likelihood di
-0000a340: 6666 6572 656e 6365 2069 7320 6465 7465  fference is dete
-0000a350: 6374 6564 2c20 7468 6520 6578 6973 7469  cted, the existi
-0000a360: 6e67 206c 696b 656c 6968 6f6f 6473 0a20  ng likelihoods. 
-0000a370: 2020 2020 2020 2020 2020 2061 7265 2075             are u
-0000a380: 7064 6174 6564 2075 6e74 696c 2074 6865  pdated until the
-0000a390: 206c 6976 6520 706f 696e 7420 6f72 6465   live point orde
-0000a3a0: 7220 6469 6666 6572 732e 0a20 2020 2020  r differs..     
-0000a3b0: 2020 2020 2020 204f 7468 6572 7769 7365         Otherwise
-0000a3c0: 2c20 6265 6861 7665 7320 6c69 6b65 2072  , behaves like r
-0000a3d0: 6573 756d 652e 0a0a 2020 2020 2020 2020  esume...        
-0000a3e0: 7275 6e5f 6e75 6d3a 2069 6e74 206f 7220  run_num: int or 
-0000a3f0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0000a400: 2049 6620 7265 7375 6d65 3d3d 2773 7562   If resume=='sub
-0000a410: 666f 6c64 6572 272c 2074 6869 7320 6973  folder', this is
-0000a420: 2074 6865 2073 7562 666f 6c64 6572 206e   the subfolder n
-0000a430: 756d 6265 722e 0a20 2020 2020 2020 2020  umber..         
-0000a440: 2020 2041 7574 6f6d 6174 6963 616c 6c79     Automatically
-0000a450: 2069 6e63 7265 6d65 6e74 7320 6966 2073   increments if s
-0000a460: 6574 2074 6f20 4e6f 6e65 2e0a 0a20 2020  et to None...   
-0000a470: 2020 2020 2077 7261 7070 6564 5f70 6172       wrapped_par
-0000a480: 616d 733a 206c 6973 7420 6f66 2062 6f6f  ams: list of boo
-0000a490: 6c73 0a20 2020 2020 2020 2020 2020 2069  ls.            i
-0000a4a0: 6e64 6963 6174 696e 6720 7768 6574 6865  ndicating whethe
-0000a4b0: 7220 7468 6973 2070 6172 616d 6574 6572  r this parameter
-0000a4c0: 2077 7261 7073 2061 726f 756e 6420 2863   wraps around (c
-0000a4d0: 6972 6375 6c61 7220 7061 7261 6d65 7465  ircular paramete
-0000a4e0: 7229 2e0a 0a20 2020 2020 2020 206e 756d  r)...        num
-0000a4f0: 5f74 6573 745f 7361 6d70 6c65 733a 2069  _test_samples: i
-0000a500: 6e74 0a20 2020 2020 2020 2020 2020 2074  nt.            t
-0000a510: 6573 7420 7472 616e 7366 6f72 6d20 616e  est transform an
-0000a520: 6420 6c69 6b65 6c69 686f 6f64 2077 6974  d likelihood wit
-0000a530: 6820 7468 6973 206e 756d 6265 7220 6f66  h this number of
-0000a540: 0a20 2020 2020 2020 2020 2020 2072 616e  .            ran
-0000a550: 646f 6d20 706f 696e 7473 2066 6f72 2065  dom points for e
-0000a560: 7272 6f72 7320 6669 7273 742e 2055 7365  rrors first. Use
-0000a570: 6675 6c20 746f 2063 6174 6368 2062 7567  ful to catch bug
-0000a580: 732e 0a0a 2020 2020 2020 2020 7665 6374  s...        vect
-0000a590: 6f72 697a 6564 3a20 626f 6f6c 0a20 2020  orized: bool.   
-0000a5a0: 2020 2020 2020 2020 2049 6620 7472 7565           If true
-0000a5b0: 2c20 6c6f 676c 696b 6520 616e 6420 7472  , loglike and tr
-0000a5c0: 616e 7366 6f72 6d20 6675 6e63 7469 6f6e  ansform function
-0000a5d0: 2063 616e 2072 6563 6569 7665 2061 7272   can receive arr
-0000a5e0: 6179 730a 2020 2020 2020 2020 2020 2020  ays.            
-0000a5f0: 6f66 2070 6f69 6e74 732e 0a0a 2020 2020  of points...    
-0000a600: 2020 2020 6472 6177 5f6d 756c 7469 706c      draw_multipl
-0000a610: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
-0000a620: 2020 2020 4966 2065 6666 6963 6965 6e63      If efficienc
-0000a630: 7920 676f 6573 2064 6f77 6e2c 2064 796e  y goes down, dyn
-0000a640: 616d 6963 616c 6c79 2064 7261 7720 6d6f  amically draw mo
-0000a650: 7265 2070 6f69 6e74 730a 2020 2020 2020  re points.      
-0000a660: 2020 2020 2020 6672 6f6d 2074 6865 2072        from the r
-0000a670: 6567 696f 6e20 6265 7477 6565 6e20 606e  egion between `n
-0000a680: 6472 6177 5f6d 696e 6020 616e 6420 606e  draw_min` and `n
-0000a690: 6472 6177 5f6d 6178 602e 0a20 2020 2020  draw_max`..     
-0000a6a0: 2020 2020 2020 2049 6620 7365 7420 746f         If set to
-0000a6b0: 2046 616c 7365 2c20 6665 7720 706f 696e   False, few poin
-0000a6c0: 7473 2061 7265 2073 616d 706c 6564 2061  ts are sampled a
-0000a6d0: 7420 6f6e 6365 2e0a 0a20 2020 2020 2020  t once...       
-0000a6e0: 206e 6472 6177 5f6d 696e 3a20 696e 740a   ndraw_min: int.
-0000a6f0: 2020 2020 2020 2020 2020 2020 4d69 6e69              Mini
-0000a700: 6d75 6d20 6e75 6d62 6572 206f 6620 706f  mum number of po
-0000a710: 696e 7473 2074 6f20 7369 6d75 6c74 616e  ints to simultan
-0000a720: 656f 7573 6c79 2070 726f 706f 7365 2e0a  eously propose..
-0000a730: 2020 2020 2020 2020 2020 2020 496e 6372              Incr
-0000a740: 6561 7365 2074 6869 7320 6966 2079 6f75  ease this if you
-0000a750: 7220 6c69 6b65 6c69 686f 6f64 206d 616b  r likelihood mak
-0000a760: 6573 2076 6563 746f 7269 7a61 7469 6f6e  es vectorization
-0000a770: 2076 6572 7920 6368 6561 702e 0a0a 2020   very cheap...  
-0000a780: 2020 2020 2020 6e64 7261 775f 6d61 783a        ndraw_max:
-0000a790: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-0000a7a0: 204d 6178 696d 756d 206e 756d 6265 7220   Maximum number 
-0000a7b0: 6f66 2070 6f69 6e74 7320 746f 2073 696d  of points to sim
-0000a7c0: 756c 7461 6e65 6f75 736c 7920 7072 6f70  ultaneously prop
-0000a7d0: 6f73 652e 0a20 2020 2020 2020 2020 2020  ose..           
-0000a7e0: 2049 6e63 7265 6173 6520 7468 6973 2069   Increase this i
-0000a7f0: 6620 796f 7572 206c 696b 656c 6968 6f6f  f your likelihoo
-0000a800: 6420 6d61 6b65 7320 7665 6374 6f72 697a  d makes vectoriz
-0000a810: 6174 696f 6e20 7665 7279 2063 6865 6170  ation very cheap
-0000a820: 2e0a 2020 2020 2020 2020 2020 2020 4d65  ..            Me
-0000a830: 6d6f 7279 2061 6c6c 6f63 6174 696f 6e20  mory allocation 
-0000a840: 6d61 7920 6265 2073 6c6f 7720 666f 7220  may be slow for 
-0000a850: 6578 7472 656d 656c 7920 6869 6768 2076  extremely high v
-0000a860: 616c 7565 732e 0a0a 2020 2020 2020 2020  alues...        
-0000a870: 6e75 6d5f 626f 6f74 7374 7261 7073 3a20  num_bootstraps: 
-0000a880: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-0000a890: 6e75 6d62 6572 206f 6620 6c6f 675a 2065  number of logZ e
-0000a8a0: 7374 696d 6174 6f72 7320 616e 6420 4d4c  stimators and ML
-0000a8b0: 4672 6965 6e64 7320 7265 6769 6f6e 0a20  Friends region. 
-0000a8c0: 2020 2020 2020 2020 2020 2062 6f6f 7473             boots
-0000a8d0: 7472 6170 2072 6f75 6e64 732e 0a0a 2020  trap rounds...  
-0000a8e0: 2020 2020 2020 7374 6f72 6167 655f 6261        storage_ba
-0000a8f0: 636b 656e 643a 2073 7472 206f 7220 636c  ckend: str or cl
-0000a900: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-0000a910: 436c 6173 7320 746f 2075 7365 2066 6f72  Class to use for
-0000a920: 2073 746f 7269 6e67 2074 6865 2065 7661   storing the eva
-0000a930: 6c75 6174 6564 2070 6f69 6e74 7320 2873  luated points (s
-0000a940: 6565 2075 6c74 7261 6e65 7374 2e73 746f  ee ultranest.sto
-0000a950: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
-0000a960: 2768 6466 3527 2069 7320 7374 726f 6e67  'hdf5' is strong
-0000a970: 6c79 2072 6563 6f6d 6d65 6e64 6564 2e20  ly recommended. 
-0000a980: 2774 7376 2720 616e 6420 2763 7376 2720  'tsv' and 'csv' 
-0000a990: 6172 6520 616c 736f 2070 6f73 7369 626c  are also possibl
-0000a9a0: 652e 0a0a 2020 2020 2020 2020 7761 726d  e...        warm
-0000a9b0: 7374 6172 745f 6d61 785f 7461 753a 2066  start_max_tau: f
-0000a9c0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-0000a9d0: 204d 6178 696d 756d 2064 6973 6f72 6465   Maximum disorde
-0000a9e0: 7220 746f 2061 6363 6570 7420 7768 656e  r to accept when
-0000a9f0: 2072 6573 756d 653d 2772 6573 756d 652d   resume='resume-
-0000aa00: 7369 6d69 6c61 7227 3b0a 2020 2020 2020  similar';.      
-0000aa10: 2020 2020 2020 4c69 7665 2070 6f69 6e74        Live point
-0000aa20: 7320 6172 6520 7265 7573 6564 2061 7320  s are reused as 
-0000aa30: 6c6f 6e67 2061 7320 7468 6520 6c69 7665  long as the live
-0000aa40: 2070 6f69 6e74 206f 7264 6572 0a20 2020   point order.   
-0000aa50: 2020 2020 2020 2020 2069 7320 6265 6c6f           is belo
-0000aa60: 7720 7468 6973 206e 6f72 6d61 6c69 7365  w this normalise
-0000aa70: 6420 4b65 6e64 616c 6c20 7461 7520 6469  d Kendall tau di
-0000aa80: 7374 616e 6365 2e0a 2020 2020 2020 2020  stance..        
-0000aa90: 2020 2020 5661 6c75 6573 2066 726f 6d20      Values from 
-0000aaa0: 3020 2868 6967 686c 7920 636f 6e73 6572  0 (highly conser
-0000aab0: 7661 7469 7665 2920 746f 2031 2028 6578  vative) to 1 (ex
-0000aac0: 7472 656d 656c 7920 6e65 676c 6967 656e  tremely negligen
-0000aad0: 7429 2e0a 2020 2020 2020 2020 2222 220a  t)..        """.
-0000aae0: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-0000aaf0: 616d 6e61 6d65 7320 3d20 7061 7261 6d5f  amnames = param_
-0000ab00: 6e61 6d65 730a 2020 2020 2020 2020 785f  names.        x_
-0000ab10: 6469 6d20 3d20 6c65 6e28 7365 6c66 2e70  dim = len(self.p
-0000ab20: 6172 616d 6e61 6d65 7329 0a0a 2020 2020  aramnames)..    
-0000ab30: 2020 2020 7365 6c66 2e73 616d 706c 6572      self.sampler
-0000ab40: 203d 2027 7265 6163 7469 7665 2d6e 6573   = 'reactive-nes
-0000ab50: 7465 6427 0a20 2020 2020 2020 2073 656c  ted'.        sel
-0000ab60: 662e 785f 6469 6d20 3d20 785f 6469 6d0a  f.x_dim = x_dim.
-0000ab70: 2020 2020 2020 2020 7365 6c66 2e74 7261          self.tra
-0000ab80: 6e73 666f 726d 5f6c 6179 6572 5f63 6c61  nsform_layer_cla
-0000ab90: 7373 203d 204c 6f63 616c 4166 6669 6e65  ss = LocalAffine
-0000aba0: 4c61 7965 7220 6966 2078 5f64 696d 203e  Layer if x_dim >
-0000abb0: 2031 2065 6c73 6520 5363 616c 696e 674c   1 else ScalingL
-0000abc0: 6179 6572 0a20 2020 2020 2020 2073 656c  ayer.        sel
-0000abd0: 662e 6465 7269 7665 6470 6172 616d 6e61  f.derivedparamna
-0000abe0: 6d65 7320 3d20 6465 7269 7665 645f 7061  mes = derived_pa
-0000abf0: 7261 6d5f 6e61 6d65 730a 2020 2020 2020  ram_names.      
-0000ac00: 2020 7365 6c66 2e6e 756d 5f62 6f6f 7473    self.num_boots
-0000ac10: 7472 6170 7320 3d20 696e 7428 6e75 6d5f  traps = int(num_
-0000ac20: 626f 6f74 7374 7261 7073 290a 2020 2020  bootstraps).    
-0000ac30: 2020 2020 6e75 6d5f 6465 7269 7665 6420      num_derived 
-0000ac40: 3d20 6c65 6e28 7365 6c66 2e64 6572 6976  = len(self.deriv
-0000ac50: 6564 7061 7261 6d6e 616d 6573 290a 2020  edparamnames).  
-0000ac60: 2020 2020 2020 7365 6c66 2e6e 756d 5f70        self.num_p
-0000ac70: 6172 616d 7320 3d20 785f 6469 6d20 2b20  arams = x_dim + 
-0000ac80: 6e75 6d5f 6465 7269 7665 640a 2020 2020  num_derived.    
-0000ac90: 2020 2020 6966 2077 7261 7070 6564 5f70      if wrapped_p
-0000aca0: 6172 616d 7320 6973 204e 6f6e 653a 0a20  arams is None:. 
-0000acb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000acc0: 7772 6170 7065 645f 6178 6573 203d 205b  wrapped_axes = [
-0000acd0: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-0000ace0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-0000acf0: 7274 206c 656e 2877 7261 7070 6564 5f70  rt len(wrapped_p
-0000ad00: 6172 616d 7329 203d 3d20 7365 6c66 2e78  arams) == self.x
-0000ad10: 5f64 696d 2c20 2822 7772 6170 7065 645f  _dim, ("wrapped_
-0000ad20: 7061 7261 6d73 2068 6173 2074 6865 206e  params has the n
-0000ad30: 756d 6265 7220 6f66 2065 6e74 7269 6573  umber of entries
-0000ad40: 3a22 2c20 7772 6170 7065 645f 7061 7261  :", wrapped_para
-0000ad50: 6d73 2c20 222c 2065 7870 6563 7465 6422  ms, ", expected"
-0000ad60: 2c20 7365 6c66 2e78 5f64 696d 290a 2020  , self.x_dim).  
-0000ad70: 2020 2020 2020 2020 2020 7365 6c66 2e77            self.w
-0000ad80: 7261 7070 6564 5f61 7865 7320 3d20 6e70  rapped_axes = np
-0000ad90: 2e77 6865 7265 2877 7261 7070 6564 5f70  .where(wrapped_p
-0000ada0: 6172 616d 7329 5b30 5d0a 0a20 2020 2020  arams)[0]..     
-0000adb0: 2020 2073 656c 662e 7573 655f 6d70 6920     self.use_mpi 
-0000adc0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0000add0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000ade0: 2066 726f 6d20 6d70 6934 7079 2069 6d70   from mpi4py imp
-0000adf0: 6f72 7420 4d50 490a 2020 2020 2020 2020  ort MPI.        
-0000ae00: 2020 2020 7365 6c66 2e63 6f6d 6d20 3d20      self.comm = 
-0000ae10: 4d50 492e 434f 4d4d 5f57 4f52 4c44 0a20  MPI.COMM_WORLD. 
-0000ae20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000ae30: 6d70 695f 7369 7a65 203d 2073 656c 662e  mpi_size = self.
-0000ae40: 636f 6d6d 2e47 6574 5f73 697a 6528 290a  comm.Get_size().
-0000ae50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ae60: 2e6d 7069 5f72 616e 6b20 3d20 7365 6c66  .mpi_rank = self
-0000ae70: 2e63 6f6d 6d2e 4765 745f 7261 6e6b 2829  .comm.Get_rank()
-0000ae80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000ae90: 7365 6c66 2e6d 7069 5f73 697a 6520 3e20  self.mpi_size > 
-0000aea0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-0000aeb0: 2020 2073 656c 662e 7573 655f 6d70 6920     self.use_mpi 
-0000aec0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0000aed0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
-0000aee0: 7570 5f64 6973 7472 6962 7574 6564 5f73  up_distributed_s
-0000aef0: 6565 6473 2829 0a20 2020 2020 2020 2065  eeds().        e
-0000af00: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-0000af10: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000af20: 662e 6d70 695f 7369 7a65 203d 2031 0a20  f.mpi_size = 1. 
-0000af30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000af40: 6d70 695f 7261 6e6b 203d 2030 0a0a 2020  mpi_rank = 0..  
-0000af50: 2020 2020 2020 7365 6c66 2e6c 6f67 203d        self.log =
-0000af60: 2073 656c 662e 6d70 695f 7261 6e6b 203d   self.mpi_rank =
-0000af70: 3d20 300a 2020 2020 2020 2020 7365 6c66  = 0.        self
-0000af80: 2e6c 6f67 5f74 6f5f 6469 736b 203d 2073  .log_to_disk = s
-0000af90: 656c 662e 6c6f 6720 616e 6420 6c6f 675f  elf.log and log_
-0000afa0: 6469 7220 6973 206e 6f74 204e 6f6e 650a  dir is not None.
-0000afb0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0000afc0: 5f74 6f5f 706f 696e 7473 746f 7265 203d  _to_pointstore =
-0000afd0: 2073 656c 662e 6c6f 675f 746f 5f64 6973   self.log_to_dis
-0000afe0: 6b0a 0a20 2020 2020 2020 2061 7373 6572  k..        asser
-0000aff0: 7420 7265 7375 6d65 2069 6e20 2854 7275  t resume in (Tru
-0000b000: 652c 2027 6f76 6572 7772 6974 6527 2c20  e, 'overwrite', 
-0000b010: 2773 7562 666f 6c64 6572 272c 2027 7265  'subfolder', 're
-0000b020: 7375 6d65 272c 2027 7265 7375 6d65 2d73  sume', 'resume-s
-0000b030: 696d 696c 6172 2729 2c20 5c0a 2020 2020  imilar'), \.    
-0000b040: 2020 2020 2020 2020 2272 6573 756d 6520          "resume 
-0000b050: 7368 6f75 6c64 2062 6520 6f6e 6520 6f66  should be one of
-0000b060: 2027 6f76 6572 7772 6974 6527 2027 7375   'overwrite' 'su
-0000b070: 6266 6f6c 6465 7227 2c20 2772 6573 756d  bfolder', 'resum
-0000b080: 6527 206f 7220 2772 6573 756d 652d 7369  e' or 'resume-si
-0000b090: 6d69 6c61 7227 220a 2020 2020 2020 2020  milar'".        
-0000b0a0: 6170 7065 6e64 5f72 756e 5f6e 756d 203d  append_run_num =
-0000b0b0: 2072 6573 756d 6520 3d3d 2027 7375 6266   resume == 'subf
-0000b0c0: 6f6c 6465 7227 0a20 2020 2020 2020 2072  older'.        r
-0000b0d0: 6573 756d 655f 7369 6d69 6c61 7220 3d20  esume_similar = 
-0000b0e0: 7265 7375 6d65 203d 3d20 2772 6573 756d  resume == 'resum
-0000b0f0: 652d 7369 6d69 6c61 7227 0a20 2020 2020  e-similar'.     
-0000b100: 2020 2072 6573 756d 6520 3d20 7265 7375     resume = resu
-0000b110: 6d65 2069 6e20 2827 7265 7375 6d65 2d73  me in ('resume-s
-0000b120: 696d 696c 6172 272c 2027 7265 7375 6d65  imilar', 'resume
-0000b130: 272c 2054 7275 6529 0a0a 2020 2020 2020  ', True)..      
-0000b140: 2020 6966 2073 656c 662e 6c6f 6720 616e    if self.log an
-0000b150: 6420 6c6f 675f 6469 7220 6973 206e 6f74  d log_dir is not
-0000b160: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b170: 2020 2073 656c 662e 6c6f 6773 203d 206d     self.logs = m
-0000b180: 616b 655f 7275 6e5f 6469 7228 6c6f 675f  ake_run_dir(log_
-0000b190: 6469 722c 2072 756e 5f6e 756d 2c20 6170  dir, run_num, ap
-0000b1a0: 7065 6e64 5f72 756e 5f6e 756d 3d61 7070  pend_run_num=app
-0000b1b0: 656e 645f 7275 6e5f 6e75 6d29 0a20 2020  end_run_num).   
-0000b1c0: 2020 2020 2020 2020 206c 6f67 5f64 6972           log_dir
-0000b1d0: 203d 2073 656c 662e 6c6f 6773 5b27 7275   = self.logs['ru
-0000b1e0: 6e5f 6469 7227 5d0a 2020 2020 2020 2020  n_dir'].        
-0000b1f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000b200: 2020 6c6f 675f 6469 7220 3d20 4e6f 6e65    log_dir = None
-0000b210: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000b220: 662e 6c6f 673a 0a20 2020 2020 2020 2020  f.log:.         
-0000b230: 2020 2073 656c 662e 6c6f 6767 6572 203d     self.logger =
-0000b240: 2063 7265 6174 655f 6c6f 6767 6572 2827   create_logger('
-0000b250: 756c 7472 616e 6573 7427 2c20 6c6f 675f  ultranest', log_
-0000b260: 6469 723d 6c6f 675f 6469 7229 0a20 2020  dir=log_dir).   
-0000b270: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-0000b280: 6767 6572 2e64 6562 7567 2827 5265 6163  gger.debug('Reac
-0000b290: 7469 7665 4e65 7374 6564 5361 6d70 6c65  tiveNestedSample
-0000b2a0: 723a 2064 696d 733d 2564 2b25 642c 2072  r: dims=%d+%d, r
-0000b2b0: 6573 756d 653d 2573 2c20 6c6f 675f 6469  esume=%s, log_di
-0000b2c0: 723d 2573 2c20 6261 636b 656e 643d 2573  r=%s, backend=%s
-0000b2d0: 2c20 7665 6374 6f72 697a 6564 3d25 732c  , vectorized=%s,
-0000b2e0: 206e 626f 6f74 7374 7261 7073 3d25 732c   nbootstraps=%s,
-0000b2f0: 206e 6472 6177 3d25 732e 2e25 7327 2025   ndraw=%s..%s' %
-0000b300: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0000b310: 2020 2078 5f64 696d 2c20 6e75 6d5f 6465     x_dim, num_de
-0000b320: 7269 7665 642c 2072 6573 756d 652c 206c  rived, resume, l
-0000b330: 6f67 5f64 6972 2c20 7374 6f72 6167 655f  og_dir, storage_
-0000b340: 6261 636b 656e 642c 2076 6563 746f 7269  backend, vectori
-0000b350: 7a65 642c 0a20 2020 2020 2020 2020 2020  zed,.           
-0000b360: 2020 2020 206e 756d 5f62 6f6f 7473 7472       num_bootstr
-0000b370: 6170 732c 206e 6472 6177 5f6d 696e 2c20  aps, ndraw_min, 
-0000b380: 6e64 7261 775f 6d61 782c 0a20 2020 2020  ndraw_max,.     
-0000b390: 2020 2020 2020 2029 290a 2020 2020 2020         )).      
-0000b3a0: 2020 7365 6c66 2e72 6f6f 7420 3d20 5472    self.root = Tr
-0000b3b0: 6565 4e6f 6465 2869 643d 2d31 2c20 7661  eeNode(id=-1, va
-0000b3c0: 6c75 653d 2d6e 702e 696e 6629 0a0a 2020  lue=-np.inf)..  
-0000b3d0: 2020 2020 2020 7365 6c66 2e70 6f69 6e74        self.point
-0000b3e0: 7069 6c65 203d 2050 6f69 6e74 5069 6c65  pile = PointPile
-0000b3f0: 2873 656c 662e 785f 6469 6d2c 2073 656c  (self.x_dim, sel
-0000b400: 662e 6e75 6d5f 7061 7261 6d73 290a 2020  f.num_params).  
-0000b410: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
-0000b420: 675f 746f 5f70 6f69 6e74 7374 6f72 653a  g_to_pointstore:
-0000b430: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
-0000b440: 7261 6765 5f66 696c 656e 616d 6520 3d20  rage_filename = 
-0000b450: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
-0000b460: 662e 6c6f 6773 5b27 7265 7375 6c74 7327  f.logs['results'
-0000b470: 5d2c 2027 706f 696e 7473 2e27 202b 2073  ], 'points.' + s
-0000b480: 746f 7261 6765 5f62 6163 6b65 6e64 290a  torage_backend).
-0000b490: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
-0000b4a0: 6167 655f 6e75 6d5f 636f 6c73 203d 2033  age_num_cols = 3
-0000b4b0: 202b 2073 656c 662e 785f 6469 6d20 2b20   + self.x_dim + 
-0000b4c0: 7365 6c66 2e6e 756d 5f70 6172 616d 730a  self.num_params.
-0000b4d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000b4e0: 746f 7261 6765 5f62 6163 6b65 6e64 203d  torage_backend =
-0000b4f0: 3d20 2774 7376 273a 0a20 2020 2020 2020  = 'tsv':.       
-0000b500: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-0000b510: 696e 7473 746f 7265 203d 2054 6578 7450  intstore = TextP
-0000b520: 6f69 6e74 5374 6f72 6528 7374 6f72 6167  ointStore(storag
-0000b530: 655f 6669 6c65 6e61 6d65 2c20 7374 6f72  e_filename, stor
-0000b540: 6167 655f 6e75 6d5f 636f 6c73 290a 2020  age_num_cols).  
-0000b550: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000b560: 6c66 2e70 6f69 6e74 7374 6f72 652e 6465  lf.pointstore.de
-0000b570: 6c69 6d69 7465 7220 3d20 275c 6e27 0a20  limiter = '\n'. 
-0000b580: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000b590: 7374 6f72 6167 655f 6261 636b 656e 6420  storage_backend 
-0000b5a0: 3d3d 2027 6373 7627 3a0a 2020 2020 2020  == 'csv':.      
-0000b5b0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000b5c0: 6f69 6e74 7374 6f72 6520 3d20 5465 7874  ointstore = Text
-0000b5d0: 506f 696e 7453 746f 7265 2873 746f 7261  PointStore(stora
-0000b5e0: 6765 5f66 696c 656e 616d 652c 2073 746f  ge_filename, sto
-0000b5f0: 7261 6765 5f6e 756d 5f63 6f6c 7329 0a20  rage_num_cols). 
-0000b600: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b610: 656c 662e 706f 696e 7473 746f 7265 2e64  elf.pointstore.d
-0000b620: 656c 696d 6974 6572 203d 2027 2c27 0a20  elimiter = ','. 
-0000b630: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000b640: 7374 6f72 6167 655f 6261 636b 656e 6420  storage_backend 
-0000b650: 3d3d 2027 6864 6635 273a 0a20 2020 2020  == 'hdf5':.     
-0000b660: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b670: 706f 696e 7473 746f 7265 203d 2048 4446  pointstore = HDF
-0000b680: 3550 6f69 6e74 5374 6f72 6528 7374 6f72  5PointStore(stor
-0000b690: 6167 655f 6669 6c65 6e61 6d65 2c20 7374  age_filename, st
-0000b6a0: 6f72 6167 655f 6e75 6d5f 636f 6c73 2c20  orage_num_cols, 
-0000b6b0: 6d6f 6465 3d27 6127 2069 6620 7265 7375  mode='a' if resu
-0000b6c0: 6d65 2065 6c73 6520 2777 2729 0a20 2020  me else 'w').   
-0000b6d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000b6e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b6f0: 2075 7365 2063 7573 746f 6d20 6261 636b   use custom back
-0000b700: 656e 640a 2020 2020 2020 2020 2020 2020  end.            
-0000b710: 2020 2020 7365 6c66 2e70 6f69 6e74 7374      self.pointst
-0000b720: 6f72 6520 3d20 7374 6f72 6167 655f 6261  ore = storage_ba
-0000b730: 636b 656e 640a 2020 2020 2020 2020 656c  ckend.        el
-0000b740: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000b750: 7365 6c66 2e70 6f69 6e74 7374 6f72 6520  self.pointstore 
-0000b760: 3d20 4e75 6c6c 506f 696e 7453 746f 7265  = NullPointStore
-0000b770: 2833 202b 2073 656c 662e 785f 6469 6d20  (3 + self.x_dim 
-0000b780: 2b20 7365 6c66 2e6e 756d 5f70 6172 616d  + self.num_param
-0000b790: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-0000b7a0: 6e63 616c 6c20 3d20 7365 6c66 2e70 6f69  ncall = self.poi
-0000b7b0: 6e74 7374 6f72 652e 6e63 616c 6c73 0a20  ntstore.ncalls. 
-0000b7c0: 2020 2020 2020 2073 656c 662e 6e63 616c         self.ncal
-0000b7d0: 6c5f 7265 6769 6f6e 203d 2030 0a0a 2020  l_region = 0..  
-0000b7e0: 2020 2020 2020 6966 206e 6f74 2076 6563        if not vec
-0000b7f0: 746f 7269 7a65 643a 0a20 2020 2020 2020  torized:.       
-0000b800: 2020 2020 2069 6620 7472 616e 7366 6f72       if transfor
-0000b810: 6d20 6973 206e 6f74 204e 6f6e 653a 0a20  m is not None:. 
-0000b820: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000b830: 7261 6e73 666f 726d 203d 2076 6563 746f  ransform = vecto
-0000b840: 7269 7a65 2874 7261 6e73 666f 726d 290a  rize(transform).
-0000b850: 2020 2020 2020 2020 2020 2020 6c6f 676c              logl
-0000b860: 696b 6520 3d20 7665 6374 6f72 697a 6528  ike = vectorize(
-0000b870: 6c6f 676c 696b 6529 0a20 2020 2020 2020  loglike).       
-0000b880: 2020 2020 2064 7261 775f 6d75 6c74 6970       draw_multip
-0000b890: 6c65 203d 2046 616c 7365 0a0a 2020 2020  le = False..    
-0000b8a0: 2020 2020 7365 6c66 2e64 7261 775f 6d75      self.draw_mu
-0000b8b0: 6c74 6970 6c65 203d 2064 7261 775f 6d75  ltiple = draw_mu
-0000b8c0: 6c74 6970 6c65 0a20 2020 2020 2020 2073  ltiple.        s
-0000b8d0: 656c 662e 6e64 7261 775f 6d69 6e20 3d20  elf.ndraw_min = 
-0000b8e0: 6e64 7261 775f 6d69 6e0a 2020 2020 2020  ndraw_min.      
-0000b8f0: 2020 7365 6c66 2e6e 6472 6177 5f6d 6178    self.ndraw_max
-0000b900: 203d 206e 6472 6177 5f6d 6178 0a20 2020   = ndraw_max.   
-0000b910: 2020 2020 2073 656c 662e 6275 696c 645f       self.build_
-0000b920: 7472 6567 696f 6e20 3d20 7472 616e 7366  tregion = transf
-0000b930: 6f72 6d20 6973 206e 6f74 204e 6f6e 650a  orm is not None.
-0000b940: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000b950: 656c 662e 5f63 6865 636b 5f6c 696b 656c  elf._check_likel
-0000b960: 6968 6f6f 645f 6675 6e63 7469 6f6e 2874  ihood_function(t
-0000b970: 7261 6e73 666f 726d 2c20 6c6f 676c 696b  ransform, loglik
-0000b980: 652c 206e 756d 5f74 6573 745f 7361 6d70  e, num_test_samp
-0000b990: 6c65 7329 3a0a 2020 2020 2020 2020 2020  les):.          
-0000b9a0: 2020 6173 7365 7274 2073 656c 662e 6c6f    assert self.lo
-0000b9b0: 675f 746f 5f64 6973 6b0a 2020 2020 2020  g_to_disk.      
-0000b9c0: 2020 2020 2020 6966 2072 6573 756d 655f        if resume_
-0000b9d0: 7369 6d69 6c61 7220 616e 6420 7365 6c66  similar and self
-0000b9e0: 2e6c 6f67 5f74 6f5f 6469 736b 3a0a 2020  .log_to_disk:.  
-0000b9f0: 2020 2020 2020 2020 2020 2020 2020 6173                as
-0000ba00: 7365 7274 2073 746f 7261 6765 5f62 6163  sert storage_bac
-0000ba10: 6b65 6e64 203d 3d20 2768 6466 3527 2c20  kend == 'hdf5', 
-0000ba20: 2772 6573 756d 652d 7369 6d69 6c61 7220  'resume-similar 
-0000ba30: 6973 206f 6e6c 7920 7375 7070 6f72 7465  is only supporte
-0000ba40: 6420 666f 7220 4844 4635 2066 696c 6573  d for HDF5 files
-0000ba50: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000ba60: 2020 6173 7365 7274 2030 203c 3d20 7761    assert 0 <= wa
-0000ba70: 726d 7374 6172 745f 6d61 785f 7461 7520  rmstart_max_tau 
-0000ba80: 3c3d 2031 2c20 2777 6172 6d73 7461 7274  <= 1, 'warmstart
-0000ba90: 5f6d 6178 5f74 6175 2070 6172 616d 6574  _max_tau paramet
-0000baa0: 6572 206e 6565 6473 2074 6f20 6265 2073  er needs to be s
-0000bab0: 6574 2074 6f20 6120 7661 6c75 6520 6265  et to a value be
-0000bac0: 7477 6565 6e20 3020 616e 6420 3127 0a20  tween 0 and 1'. 
-0000bad0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000bae0: 2063 6c6f 7365 0a20 2020 2020 2020 2020   close.         
-0000baf0: 2020 2020 2020 2073 656c 662e 706f 696e         self.poin
-0000bb00: 7473 746f 7265 2e63 6c6f 7365 2829 0a20  tstore.close(). 
-0000bb10: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000bb20: 656c 2073 656c 662e 706f 696e 7473 746f  el self.pointsto
-0000bb30: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
-0000bb40: 2020 2023 2072 6577 7269 7465 2070 6f69     # rewrite poi
-0000bb50: 6e74 7320 6669 6c65 0a20 2020 2020 2020  nts file.       
-0000bb60: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000bb70: 2e6c 6f67 3a0a 2020 2020 2020 2020 2020  .log:.          
-0000bb80: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0000bb90: 6f67 6765 722e 696e 666f 2827 7472 7969  ogger.info('tryi
-0000bba0: 6e67 2074 6f20 7361 6c76 6167 6520 706f  ng to salvage po
-0000bbb0: 696e 7473 2066 726f 6d20 7072 6576 696f  ints from previo
-0000bbc0: 7573 2c20 6469 6666 6572 656e 7420 7275  us, different ru
-0000bbd0: 6e20 2e2e 2e27 290a 2020 2020 2020 2020  n ...').        
-0000bbe0: 2020 2020 2020 2020 7265 7375 6d65 5f66          resume_f
-0000bbf0: 726f 6d5f 7369 6d69 6c61 725f 6669 6c65  rom_similar_file
-0000bc00: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000bc10: 2020 2020 2020 6c6f 675f 6469 722c 2078        log_dir, x
-0000bc20: 5f64 696d 2c20 6c6f 676c 696b 652c 2074  _dim, loglike, t
-0000bc30: 7261 6e73 666f 726d 2c0a 2020 2020 2020  ransform,.      
-0000bc40: 2020 2020 2020 2020 2020 2020 2020 6e64                nd
-0000bc50: 7261 773d 6e64 7261 775f 6d69 6e20 6966  raw=ndraw_min if
-0000bc60: 2076 6563 746f 7269 7a65 6420 656c 7365   vectorized else
-0000bc70: 2031 2c0a 2020 2020 2020 2020 2020 2020   1,.            
-0000bc80: 2020 2020 2020 2020 6d61 785f 7461 753d          max_tau=
-0000bc90: 7761 726d 7374 6172 745f 6d61 785f 7461  warmstart_max_ta
-0000bca0: 752c 2076 6572 626f 7365 3d46 616c 7365  u, verbose=False
-0000bcb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000bcc0: 2020 7365 6c66 2e70 6f69 6e74 7374 6f72    self.pointstor
-0000bcd0: 6520 3d20 4844 4635 506f 696e 7453 746f  e = HDF5PointSto
-0000bce0: 7265 280a 2020 2020 2020 2020 2020 2020  re(.            
-0000bcf0: 2020 2020 2020 2020 6f73 2e70 6174 682e          os.path.
-0000bd00: 6a6f 696e 2873 656c 662e 6c6f 6773 5b27  join(self.logs['
-0000bd10: 7265 7375 6c74 7327 5d2c 2027 706f 696e  results'], 'poin
-0000bd20: 7473 2e68 6466 3527 292c 0a20 2020 2020  ts.hdf5'),.     
-0000bd30: 2020 2020 2020 2020 2020 2020 2020 2033                 3
-0000bd40: 202b 2073 656c 662e 785f 6469 6d20 2b20   + self.x_dim + 
-0000bd50: 7365 6c66 2e6e 756d 5f70 6172 616d 732c  self.num_params,
-0000bd60: 206d 6f64 653d 2761 2720 6966 2072 6573   mode='a' if res
-0000bd70: 756d 6520 656c 7365 2027 7727 290a 2020  ume else 'w').  
-0000bd80: 2020 2020 2020 2020 2020 656c 6966 2072            elif r
-0000bd90: 6573 756d 653a 0a20 2020 2020 2020 2020  esume:.         
-0000bda0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0000bdb0: 6570 7469 6f6e 2822 4361 6e6e 6f74 2072  eption("Cannot r
-0000bdc0: 6573 756d 6520 6265 6361 7573 6520 6c6f  esume because lo
-0000bdd0: 676c 696b 656c 6968 6f6f 6420 6675 6e63  glikelihood func
-0000bde0: 7469 6f6e 2063 6861 6e67 6564 2c20 220a  tion changed, ".
-0000bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be10: 2275 6e6c 6573 7320 7265 7375 6d65 3d72  "unless resume=r
-0000be20: 6573 756d 652d 7369 6d69 6c61 722e 2054  esume-similar. T
-0000be30: 6f20 7374 6172 7420 6672 6f6d 2073 6372  o start from scr
-0000be40: 6174 6368 2c20 6465 6c65 7465 2027 2573  atch, delete '%s
-0000be50: 272e 2220 2520 286c 6f67 5f64 6972 2929  '." % (log_dir))
-0000be60: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-0000be70: 6574 5f6c 696b 656c 6968 6f6f 645f 6675  et_likelihood_fu
-0000be80: 6e63 7469 6f6e 2874 7261 6e73 666f 726d  nction(transform
-0000be90: 2c20 6c6f 676c 696b 652c 206e 756d 5f74  , loglike, num_t
-0000bea0: 6573 745f 7361 6d70 6c65 7329 0a20 2020  est_samples).   
-0000beb0: 2020 2020 2073 656c 662e 7374 6570 7361       self.stepsa
-0000bec0: 6d70 6c65 7220 3d20 4e6f 6e65 0a0a 2020  mpler = None..  
-0000bed0: 2020 6465 6620 5f73 6574 7570 5f64 6973    def _setup_dis
-0000bee0: 7472 6962 7574 6564 5f73 6565 6473 2873  tributed_seeds(s
-0000bef0: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
-0000bf00: 206e 6f74 2073 656c 662e 7573 655f 6d70   not self.use_mp
-0000bf10: 693a 0a20 2020 2020 2020 2020 2020 2072  i:.            r
-0000bf20: 6574 7572 6e0a 2020 2020 2020 2020 7365  eturn.        se
-0000bf30: 6564 203d 2030 0a20 2020 2020 2020 2069  ed = 0.        i
-0000bf40: 6620 7365 6c66 2e6d 7069 5f72 616e 6b20  f self.mpi_rank 
-0000bf50: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0000bf60: 2020 7365 6564 203d 206e 702e 7261 6e64    seed = np.rand
-0000bf70: 6f6d 2e72 616e 6469 6e74 2830 2c20 3130  om.randint(0, 10
-0000bf80: 3030 3030 3029 0a0a 2020 2020 2020 2020  00000)..        
-0000bf90: 7365 6564 203d 2073 656c 662e 636f 6d6d  seed = self.comm
-0000bfa0: 2e62 6361 7374 2873 6565 642c 2072 6f6f  .bcast(seed, roo
-0000bfb0: 743d 3029 0a20 2020 2020 2020 2069 6620  t=0).        if 
-0000bfc0: 7365 6c66 2e6d 7069 5f72 616e 6b20 3e20  self.mpi_rank > 
-0000bfd0: 303a 0a20 2020 2020 2020 2020 2020 2023  0:.            #
-0000bfe0: 2066 726f 6d20 6874 7470 3a2f 2f61 7278   from http://arx
-0000bff0: 6976 2e6f 7267 2f61 6273 2f31 3030 352e  iv.org/abs/1005.
-0000c000: 3431 3137 0a20 2020 2020 2020 2020 2020  4117.           
-0000c010: 2073 6565 6420 3d20 696e 7428 6162 7328   seed = int(abs(
-0000c020: 2828 7365 6564 202a 2031 3831 2920 2a20  ((seed * 181) * 
-0000c030: 2828 7365 6c66 2e6d 7069 5f72 616e 6b20  ((self.mpi_rank 
-0000c040: 2d20 3833 2920 2a20 3335 3929 2920 2520  - 83) * 359)) % 
-0000c050: 3130 3437 3239 2929 0a20 2020 2020 2020  104729)).       
-0000c060: 2020 2020 2023 2070 7269 6e74 2827 7365       # print('se
-0000c070: 7474 696e 6720 7365 6564 3a27 2c20 7365  tting seed:', se
-0000c080: 6c66 2e6d 7069 5f72 616e 6b2c 2073 6565  lf.mpi_rank, see
-0000c090: 6429 0a20 2020 2020 2020 2020 2020 206e  d).            n
-0000c0a0: 702e 7261 6e64 6f6d 2e73 6565 6428 7365  p.random.seed(se
-0000c0b0: 6564 290a 0a20 2020 2064 6566 205f 6368  ed)..    def _ch
-0000c0c0: 6563 6b5f 6c69 6b65 6c69 686f 6f64 5f66  eck_likelihood_f
-0000c0d0: 756e 6374 696f 6e28 7365 6c66 2c20 7472  unction(self, tr
-0000c0e0: 616e 7366 6f72 6d2c 206c 6f67 6c69 6b65  ansform, loglike
-0000c0f0: 2c20 6e75 6d5f 7465 7374 5f73 616d 706c  , num_test_sampl
-0000c100: 6573 293a 0a20 2020 2020 2020 2022 2222  es):.        """
-0000c110: 5465 7374 2074 6865 2060 7472 616e 7366  Test the `transf
-0000c120: 6f72 6d60 2061 6e64 2060 6c6f 676c 696b  orm` and `loglik
-0000c130: 6560 6c69 686f 6f64 2066 756e 6374 696f  e`lihood functio
-0000c140: 6e73 2e0a 0a20 2020 2020 2020 2060 6e75  ns...        `nu
-0000c150: 6d5f 7465 7374 5f73 616d 706c 6573 6020  m_test_samples` 
-0000c160: 7361 6d70 6c65 7320 6172 6520 7573 6564  samples are used
-0000c170: 2074 6f20 6368 6563 6b20 7768 6574 6865   to check whethe
-0000c180: 7220 7468 6579 2077 6f72 6b20 616e 6420  r they work and 
-0000c190: 6769 7665 2074 6865 2063 6f72 7265 6374  give the correct
-0000c1a0: 206f 7574 7075 742e 0a0a 2020 2020 2020   output...      
-0000c1b0: 2020 7265 7475 726e 7320 7768 6574 6865    returns whethe
-0000c1c0: 7220 7468 6520 6d6f 7374 2072 6563 656e  r the most recen
-0000c1d0: 746c 7920 7374 6f72 6564 2070 6f69 6e74  tly stored point
-0000c1e0: 2028 6966 2061 6e79 290a 2020 2020 2020   (if any).      
-0000c1f0: 2020 7374 696c 6c20 7265 7475 726e 7320    still returns 
-0000c200: 7468 6520 7361 6d65 206c 696b 656c 6968  the same likelih
-0000c210: 6f6f 6420 7661 6c75 652e 0a20 2020 2020  ood value..     
-0000c220: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
-0000c230: 2064 6f20 736f 6d65 2063 6865 636b 7320   do some checks 
-0000c240: 6f6e 2074 6865 206c 696b 656c 6968 6f6f  on the likelihoo
-0000c250: 6420 6675 6e63 7469 6f6e 0a20 2020 2020  d function.     
-0000c260: 2020 2023 2074 6869 7320 6d61 6b65 7320     # this makes 
-0000c270: 6465 6275 6767 696e 6720 6561 7369 6572  debugging easier
-0000c280: 2062 7920 6661 696c 696e 6720 6561 726c   by failing earl
-0000c290: 7920 7769 7468 206d 6561 6e69 6e67 6675  y with meaningfu
-0000c2a0: 6c20 6572 726f 7273 0a0a 2020 2020 2020  l errors..      
-0000c2b0: 2020 2320 6966 2077 6520 6172 6520 7265    # if we are re
-0000c2c0: 7375 6d69 6e67 2c20 6368 6563 6b20 7468  suming, check th
-0000c2d0: 6174 206c 6173 7420 7361 6d70 6c65 2073  at last sample s
-0000c2e0: 7469 6c6c 2067 6976 6573 2073 616d 6520  till gives same 
-0000c2f0: 7265 7375 6c74 0a20 2020 2020 2020 206e  result.        n
-0000c300: 756d 5f72 6573 756d 655f 7465 7374 5f73  um_resume_test_s
-0000c310: 616d 706c 6573 203d 2030 0a20 2020 2020  amples = 0.     
-0000c320: 2020 2069 6620 6e75 6d5f 7465 7374 5f73     if num_test_s
-0000c330: 616d 706c 6573 2061 6e64 206e 6f74 2073  amples and not s
-0000c340: 656c 662e 706f 696e 7473 746f 7265 2e73  elf.pointstore.s
-0000c350: 7461 636b 5f65 6d70 7479 3a0a 2020 2020  tack_empty:.    
-0000c360: 2020 2020 2020 2020 6e75 6d5f 7265 7375          num_resu
-0000c370: 6d65 5f74 6573 745f 7361 6d70 6c65 7320  me_test_samples 
-0000c380: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-0000c390: 6e75 6d5f 7465 7374 5f73 616d 706c 6573  num_test_samples
-0000c3a0: 202d 3d20 310a 0a20 2020 2020 2020 2069   -= 1..        i
-0000c3b0: 6620 6e75 6d5f 7465 7374 5f73 616d 706c  f num_test_sampl
-0000c3c0: 6573 203e 2030 3a0a 2020 2020 2020 2020  es > 0:.        
-0000c3d0: 2020 2020 2320 7465 7374 2077 6974 6820      # test with 
-0000c3e0: 6e75 6d5f 7465 7374 5f73 616d 706c 6573  num_test_samples
-0000c3f0: 2072 616e 646f 6d20 706f 696e 7473 0a20   random points. 
-0000c400: 2020 2020 2020 2020 2020 2075 203d 206e             u = n
-0000c410: 702e 7261 6e64 6f6d 2e75 6e69 666f 726d  p.random.uniform
-0000c420: 2873 697a 653d 286e 756d 5f74 6573 745f  (size=(num_test_
-0000c430: 7361 6d70 6c65 732c 2073 656c 662e 785f  samples, self.x_
-0000c440: 6469 6d29 290a 2020 2020 2020 2020 2020  dim)).          
-0000c450: 2020 7020 3d20 7472 616e 7366 6f72 6d28    p = transform(
-0000c460: 7529 2069 6620 7472 616e 7366 6f72 6d20  u) if transform 
-0000c470: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-0000c480: 2075 0a20 2020 2020 2020 2020 2020 2061   u.            a
-0000c490: 7373 6572 7420 6e70 2e73 6861 7065 2870  ssert np.shape(p
-0000c4a0: 2920 3d3d 2028 6e75 6d5f 7465 7374 5f73  ) == (num_test_s
-0000c4b0: 616d 706c 6573 2c20 7365 6c66 2e6e 756d  amples, self.num
-0000c4c0: 5f70 6172 616d 7329 2c20 280a 2020 2020  _params), (.    
-0000c4d0: 2020 2020 2020 2020 2020 2020 2245 7272              "Err
-0000c4e0: 6f72 2069 6e20 7472 616e 7366 6f72 6d20  or in transform 
-0000c4f0: 6675 6e63 7469 6f6e 3a20 7265 7475 726e  function: return
-0000c500: 6564 2073 6861 7065 2069 7320 2573 2c20  ed shape is %s, 
-0000c510: 6578 7065 6374 6564 2025 7322 2025 2028  expected %s" % (
-0000c520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c530: 2020 2020 206e 702e 7368 6170 6528 7029       np.shape(p)
-0000c540: 2c20 286e 756d 5f74 6573 745f 7361 6d70  , (num_test_samp
-0000c550: 6c65 732c 2073 656c 662e 6e75 6d5f 7061  les, self.num_pa
-0000c560: 7261 6d73 2929 290a 2020 2020 2020 2020  rams))).        
-0000c570: 2020 2020 6c6f 676c 203d 206c 6f67 6c69      logl = logli
-0000c580: 6b65 2870 290a 2020 2020 2020 2020 2020  ke(p).          
-0000c590: 2020 6173 7365 7274 206e 702e 6c6f 6769    assert np.logi
-0000c5a0: 6361 6c5f 616e 6428 7520 3e20 302c 2075  cal_and(u > 0, u
-0000c5b0: 203c 2031 292e 616c 6c28 292c 2028 0a20   < 1).all(), (. 
-0000c5c0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000c5d0: 4572 726f 7220 696e 2074 7261 6e73 666f  Error in transfo
-0000c5e0: 726d 2066 756e 6374 696f 6e3a 2075 2077  rm function: u w
-0000c5f0: 6173 206d 6f64 6966 6965 6421 2229 0a20  as modified!"). 
-0000c600: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-0000c610: 7420 6e70 2e73 6861 7065 286c 6f67 6c29  t np.shape(logl)
-0000c620: 203d 3d20 286e 756d 5f74 6573 745f 7361   == (num_test_sa
-0000c630: 6d70 6c65 732c 292c 2028 0a20 2020 2020  mples,), (.     
-0000c640: 2020 2020 2020 2020 2020 2022 4572 726f             "Erro
-0000c650: 7220 696e 206c 6f67 6c69 6b65 6c69 686f  r in loglikeliho
-0000c660: 6f64 2066 756e 6374 696f 6e3a 2072 6574  od function: ret
-0000c670: 7572 6e65 6420 7368 6170 6520 6973 2025  urned shape is %
-0000c680: 732c 2065 7870 6563 7465 6420 2573 2220  s, expected %s" 
-0000c690: 2520 286e 702e 7368 6170 6528 6c6f 676c  % (np.shape(logl
-0000c6a0: 292c 2028 6e75 6d5f 7465 7374 5f73 616d  ), (num_test_sam
-0000c6b0: 706c 6573 2c29 2929 0a20 2020 2020 2020  ples,))).       
-0000c6c0: 2020 2020 2061 7373 6572 7420 6e70 2e69       assert np.i
-0000c6d0: 7366 696e 6974 6528 6c6f 676c 292e 616c  sfinite(logl).al
-0000c6e0: 6c28 292c 2028 0a20 2020 2020 2020 2020  l(), (.         
-0000c6f0: 2020 2020 2020 2022 4572 726f 7220 696e         "Error in
-0000c700: 206c 6f67 6c69 6b65 6c69 686f 6f64 2066   loglikelihood f
-0000c710: 756e 6374 696f 6e3a 2072 6574 7572 6e65  unction: returne
-0000c720: 6420 6e6f 6e2d 6669 6e69 7465 206e 756d  d non-finite num
-0000c730: 6265 723a 2025 7320 666f 7220 696e 7075  ber: %s for inpu
-0000c740: 7420 753d 2573 2070 3d25 7322 2025 2028  t u=%s p=%s" % (
-0000c750: 6c6f 676c 2c20 752c 2070 2929 0a0a 2020  logl, u, p))..  
-0000c760: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000c770: 662e 706f 696e 7473 746f 7265 2e73 7461  f.pointstore.sta
-0000c780: 636b 5f65 6d70 7479 2061 6e64 206e 756d  ck_empty and num
-0000c790: 5f72 6573 756d 655f 7465 7374 5f73 616d  _resume_test_sam
-0000c7a0: 706c 6573 203e 2030 3a0a 2020 2020 2020  ples > 0:.      
-0000c7b0: 2020 2020 2020 2320 7465 7374 2074 6861        # test tha
-0000c7c0: 7420 6c61 7374 2073 616d 706c 6520 6769  t last sample gi
-0000c7d0: 7665 7320 7468 6520 7361 6d65 206c 696b  ves the same lik
-0000c7e0: 656c 6968 6f6f 6420 7661 6c75 650a 2020  elihood value.  
-0000c7f0: 2020 2020 2020 2020 2020 5f2c 206c 6173            _, las
-0000c800: 7472 6f77 203d 2073 656c 662e 706f 696e  trow = self.poin
-0000c810: 7473 746f 7265 2e73 7461 636b 5b2d 315d  tstore.stack[-1]
-0000c820: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0000c830: 6572 7420 6c65 6e28 6c61 7374 726f 7729  ert len(lastrow)
-0000c840: 203d 3d20 3320 2b20 7365 6c66 2e78 5f64   == 3 + self.x_d
-0000c850: 696d 202b 2073 656c 662e 6e75 6d5f 7061  im + self.num_pa
-0000c860: 7261 6d73 2c20 280a 2020 2020 2020 2020  rams, (.        
-0000c870: 2020 2020 2020 2020 2243 616e 6e6f 7420          "Cannot 
-0000c880: 7265 7375 6d65 3a20 7072 6f62 6c65 6d20  resume: problem 
-0000c890: 6861 7320 6469 6666 6572 656e 7420 6469  has different di
-0000c8a0: 6d65 6e73 696f 6e61 6c69 7479 222c 0a20  mensionality",. 
-0000c8b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000c8c0: 656e 286c 6173 7472 6f77 292c 2028 322c  en(lastrow), (2,
-0000c8d0: 2073 656c 662e 785f 6469 6d2c 2073 656c   self.x_dim, sel
-0000c8e0: 662e 6e75 6d5f 7061 7261 6d73 2929 0a20  f.num_params)). 
-0000c8f0: 2020 2020 2020 2020 2020 206c 6173 744c             lastL
-0000c900: 203d 206c 6173 7472 6f77 5b31 5d0a 2020   = lastrow[1].  
-0000c910: 2020 2020 2020 2020 2020 6c61 7374 7520            lastu 
-0000c920: 3d20 6c61 7374 726f 775b 333a 3320 2b20  = lastrow[3:3 + 
-0000c930: 7365 6c66 2e78 5f64 696d 5d0a 2020 2020  self.x_dim].    
-0000c940: 2020 2020 2020 2020 7520 3d20 6c61 7374          u = last
-0000c950: 752e 7265 7368 6170 6528 2831 2c20 2d31  u.reshape((1, -1
-0000c960: 2929 0a20 2020 2020 2020 2020 2020 206c  )).            l
-0000c970: 6173 7470 203d 206c 6173 7472 6f77 5b33  astp = lastrow[3
-0000c980: 202b 2073 656c 662e 785f 6469 6d3a 3320   + self.x_dim:3 
-0000c990: 2b20 7365 6c66 2e78 5f64 696d 202b 2073  + self.x_dim + s
-0000c9a0: 656c 662e 6e75 6d5f 7061 7261 6d73 5d0a  elf.num_params].
-0000c9b0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000c9c0: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
-0000c9d0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-0000c9e0: 6767 6572 2e64 6562 7567 2822 5465 7374  gger.debug("Test
-0000c9f0: 696e 6720 7265 7375 6d65 2063 6f6e 7369  ing resume consi
-0000ca00: 7374 656e 6379 3a20 2573 3a20 753d 2573  stency: %s: u=%s
-0000ca10: 202d 3e20 703d 2573 202d 3e20 4c3d 2573   -> p=%s -> L=%s
-0000ca20: 2022 2c20 6c61 7374 726f 772c 206c 6173   ", lastrow, las
-0000ca30: 7475 2c20 6c61 7374 702c 206c 6173 744c  tu, lastp, lastL
-0000ca40: 290a 2020 2020 2020 2020 2020 2020 7020  ).            p 
-0000ca50: 3d20 7472 616e 7366 6f72 6d28 7529 2069  = transform(u) i
-0000ca60: 6620 7472 616e 7366 6f72 6d20 6973 206e  f transform is n
-0000ca70: 6f74 204e 6f6e 6520 656c 7365 2075 0a20  ot None else u. 
-0000ca80: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000ca90: 7420 6e70 2e61 6c6c 636c 6f73 6528 702e  t np.allclose(p.
-0000caa0: 666c 6174 7465 6e28 292c 206c 6173 7470  flatten(), lastp
-0000cab0: 2920 616e 6420 7365 6c66 2e6c 6f67 3a0a  ) and self.log:.
-0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 7365 6c66 2e6c 6f67 6765 722e 7761 726e  self.logger.warn
-0000cae0: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-0000caf0: 2020 2020 2020 2020 2022 5472 7969 6e67           "Trying
-0000cb00: 2074 6f20 7265 7375 6d65 2066 726f 6d20   to resume from 
-0000cb10: 7072 6576 696f 7573 2072 756e 2c20 6275  previous run, bu
-0000cb20: 7420 7472 616e 7366 6f72 6d20 6675 6e63  t transform func
-0000cb30: 7469 6f6e 2067 6976 6573 2064 6966 6665  tion gives diffe
-0000cb40: 7265 6e74 2072 6573 756c 743a 2025 7320  rent result: %s 
-0000cb50: 6761 7665 2025 732c 206e 6f77 2025 7322  gave %s, now %s"
-0000cb60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000cb70: 2020 2020 2020 6c61 7374 752c 206c 6173        lastu, las
-0000cb80: 7470 2c20 702e 666c 6174 7465 6e28 2929  tp, p.flatten())
-0000cb90: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
-0000cba0: 6572 7420 6e70 2e61 6c6c 636c 6f73 6528  ert np.allclose(
-0000cbb0: 702e 666c 6174 7465 6e28 292c 206c 6173  p.flatten(), las
-0000cbc0: 7470 292c 2028 0a20 2020 2020 2020 2020  tp), (.         
-0000cbd0: 2020 2020 2020 2022 4361 6e6e 6f74 2072         "Cannot r
-0000cbe0: 6573 756d 6520 6265 6361 7573 6520 7472  esume because tr
-0000cbf0: 616e 7366 6f72 6d20 6675 6e63 7469 6f6e  ansform function
-0000cc00: 2063 6861 6e67 6564 2e20 220a 2020 2020   changed. ".    
-0000cc10: 2020 2020 2020 2020 2020 2020 2254 6f20              "To 
-0000cc20: 7374 6172 7420 6672 6f6d 2073 6372 6174  start from scrat
-0000cc30: 6368 2c20 6465 6c65 7465 2027 2573 272e  ch, delete '%s'.
-0000cc40: 2220 2520 2873 656c 662e 6c6f 6773 5b27  " % (self.logs['
-0000cc50: 7275 6e5f 6469 7227 5d29 290a 2020 2020  run_dir'])).    
-0000cc60: 2020 2020 2020 2020 6c6f 676c 203d 206c          logl = l
-0000cc70: 6f67 6c69 6b65 2870 292e 666c 6174 7465  oglike(p).flatte
-0000cc80: 6e28 295b 305d 0a20 2020 2020 2020 2020  n()[0].         
-0000cc90: 2020 2069 6620 6e6f 7420 6e70 2e69 7363     if not np.isc
-0000cca0: 6c6f 7365 286c 6f67 6c2c 206c 6173 744c  lose(logl, lastL
-0000ccb0: 2920 616e 6420 7365 6c66 2e6c 6f67 3a0a  ) and self.log:.
-0000ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ccd0: 7365 6c66 2e6c 6f67 6765 722e 7761 726e  self.logger.warn
-0000cce0: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-0000ccf0: 2020 2020 2020 2020 2022 5472 7969 6e67           "Trying
-0000cd00: 2074 6f20 7265 7375 6d65 2066 726f 6d20   to resume from 
-0000cd10: 7072 6576 696f 7573 2072 756e 2c20 6275  previous run, bu
-0000cd20: 7420 6c69 6b65 6c69 686f 6f64 2066 756e  t likelihood fun
-0000cd30: 6374 696f 6e20 6769 7665 7320 6469 6666  ction gives diff
-0000cd40: 6572 656e 7420 7265 7375 6c74 3a20 2573  erent result: %s
-0000cd50: 2067 6176 6520 2573 2c20 6e6f 7720 2573   gave %s, now %s
-0000cd60: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000cd70: 2020 2020 2020 206c 6173 7475 2e66 6c61         lastu.fla
-0000cd80: 7474 656e 2829 2c20 6c61 7374 4c2c 206c  tten(), lastL, l
-0000cd90: 6f67 6c29 0a20 2020 2020 2020 2020 2020  ogl).           
-0000cda0: 2072 6574 7572 6e20 6e70 2e69 7363 6c6f   return np.isclo
-0000cdb0: 7365 286c 6f67 6c2c 206c 6173 744c 290a  se(logl, lastL).
-0000cdc0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-0000cdd0: 7275 650a 0a20 2020 2064 6566 205f 7365  rue..    def _se
-0000cde0: 745f 6c69 6b65 6c69 686f 6f64 5f66 756e  t_likelihood_fun
-0000cdf0: 6374 696f 6e28 7365 6c66 2c20 7472 616e  ction(self, tran
-0000ce00: 7366 6f72 6d2c 206c 6f67 6c69 6b65 2c20  sform, loglike, 
-0000ce10: 6e75 6d5f 7465 7374 5f73 616d 706c 6573  num_test_samples
-0000ce20: 2c20 6d61 6b65 5f73 6166 653d 4661 6c73  , make_safe=Fals
-0000ce30: 6529 3a0a 2020 2020 2020 2020 2222 2253  e):.        """S
-0000ce40: 746f 7265 2074 6865 2074 7261 6e73 666f  tore the transfo
-0000ce50: 726d 2061 6e64 206c 6f67 2d6c 696b 656c  rm and log-likel
-0000ce60: 6968 6f6f 6420 6675 6e63 7469 6f6e 732e  ihood functions.
-0000ce70: 0a0a 2020 2020 2020 2020 6966 206d 616b  ..        if mak
-0000ce80: 655f 7361 6665 2069 7320 7365 742c 206d  e_safe is set, m
-0000ce90: 616b 6520 6675 6e63 7469 6f6e 7320 7361  ake functions sa
-0000cea0: 6665 7220 6279 2061 6363 6570 7469 6e67  fer by accepting
-0000ceb0: 206d 6973 666f 726d 6564 0a20 2020 2020   misformed.     
-0000cec0: 2020 2072 6574 7572 6e20 7368 6170 6573     return shapes
-0000ced0: 2061 6e64 206e 6f6e 2d66 696e 6974 6520   and non-finite 
-0000cee0: 6c69 6b65 6c69 686f 6f64 2076 616c 7565  likelihood value
-0000cef0: 732e 0a20 2020 2020 2020 2022 2222 0a0a  s..        """..
-0000cf00: 2020 2020 2020 2020 6465 6620 7361 6665          def safe
-0000cf10: 5f6c 6f67 6c69 6b65 2878 293a 0a20 2020  _loglike(x):.   
-0000cf20: 2020 2020 2020 2020 2022 2222 5361 6665           """Safe
-0000cf30: 2077 7261 7070 6572 206f 6620 6c69 6b65   wrapper of like
-0000cf40: 6c69 686f 6f64 2066 756e 6374 696f 6e2e  lihood function.
-0000cf50: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
-0000cf60: 7820 3d20 6e70 2e61 7361 7272 6179 2878  x = np.asarray(x
-0000cf70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-0000cf80: 206c 656e 2878 2e73 6861 7065 2920 3d3d   len(x.shape) ==
-0000cf90: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-0000cfa0: 2020 2020 6173 7365 7274 2078 2e73 6861      assert x.sha
-0000cfb0: 7065 5b30 5d20 3d3d 2073 656c 662e 785f  pe[0] == self.x_
-0000cfc0: 6469 6d0a 2020 2020 2020 2020 2020 2020  dim.            
-0000cfd0: 2020 2020 7820 3d20 6e70 2e65 7870 616e      x = np.expan
-0000cfe0: 645f 6469 6d73 2878 2c20 3029 0a20 2020  d_dims(x, 0).   
-0000cff0: 2020 2020 2020 2020 206c 6f67 6c20 3d20           logl = 
-0000d000: 6c6f 676c 696b 6528 7829 0a20 2020 2020  loglike(x).     
-0000d010: 2020 2020 2020 2069 6620 6c65 6e28 6c6f         if len(lo
-0000d020: 676c 2e73 6861 7065 2920 3d3d 2030 3a0a  gl.shape) == 0:.
-0000d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d040: 6c6f 676c 203d 206e 702e 6578 7061 6e64  logl = np.expand
-0000d050: 5f64 696d 7328 6c6f 676c 2c20 3029 0a20  _dims(logl, 0). 
-0000d060: 2020 2020 2020 2020 2020 206c 6f67 6c5b             logl[
-0000d070: 6e70 2e6c 6f67 6963 616c 5f6e 6f74 286e  np.logical_not(n
-0000d080: 702e 6973 6669 6e69 7465 286c 6f67 6c29  p.isfinite(logl)
-0000d090: 295d 203d 202d 3165 3130 300a 2020 2020  )] = -1e100.    
-0000d0a0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-0000d0b0: 6f67 6c0a 0a20 2020 2020 2020 2069 6620  ogl..        if 
-0000d0c0: 6d61 6b65 5f73 6166 653a 0a20 2020 2020  make_safe:.     
-0000d0d0: 2020 2020 2020 2073 656c 662e 6c6f 676c         self.logl
-0000d0e0: 696b 6520 3d20 7361 6665 5f6c 6f67 6c69  ike = safe_logli
-0000d0f0: 6b65 0a20 2020 2020 2020 2065 6c73 653a  ke.        else:
-0000d100: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000d110: 662e 6c6f 676c 696b 6520 3d20 6c6f 676c  f.loglike = logl
-0000d120: 696b 650a 0a20 2020 2020 2020 2069 6620  ike..        if 
-0000d130: 7472 616e 7366 6f72 6d20 6973 204e 6f6e  transform is Non
-0000d140: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0000d150: 656c 662e 7472 616e 7366 6f72 6d20 3d20  elf.transform = 
-0000d160: 6c61 6d62 6461 2078 3a20 780a 2020 2020  lambda x: x.    
-0000d170: 2020 2020 656c 6966 206d 616b 655f 7361      elif make_sa
-0000d180: 6665 3a0a 2020 2020 2020 2020 2020 2020  fe:.            
-0000d190: 6465 6620 7361 6665 5f74 7261 6e73 666f  def safe_transfo
-0000d1a0: 726d 2878 293a 0a20 2020 2020 2020 2020  rm(x):.         
-0000d1b0: 2020 2020 2020 2022 2222 5361 6665 2077         """Safe w
-0000d1c0: 7261 7070 6572 206f 6620 7472 616e 7366  rapper of transf
-0000d1d0: 6f72 6d20 6675 6e63 7469 6f6e 2e22 2222  orm function."""
-0000d1e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d1f0: 2078 203d 206e 702e 6173 6172 7261 7928   x = np.asarray(
-0000d200: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
-0000d210: 2020 2069 6620 6c65 6e28 782e 7368 6170     if len(x.shap
-0000d220: 6529 203d 3d20 313a 0a20 2020 2020 2020  e) == 1:.       
-0000d230: 2020 2020 2020 2020 2020 2020 2061 7373               ass
-0000d240: 6572 7420 782e 7368 6170 655b 305d 203d  ert x.shape[0] =
-0000d250: 3d20 7365 6c66 2e78 5f64 696d 0a20 2020  = self.x_dim.   
-0000d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d270: 2078 203d 206e 702e 6578 7061 6e64 5f64   x = np.expand_d
-0000d280: 696d 7328 782c 2030 290a 2020 2020 2020  ims(x, 0).      
-0000d290: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d2a0: 2074 7261 6e73 666f 726d 2878 290a 2020   transform(x).  
-0000d2b0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
-0000d2c0: 7261 6e73 666f 726d 203d 2073 6166 655f  ransform = safe_
-0000d2d0: 7472 616e 7366 6f72 6d0a 2020 2020 2020  transform.      
-0000d2e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000d2f0: 2020 2020 7365 6c66 2e74 7261 6e73 666f      self.transfo
-0000d300: 726d 203d 2074 7261 6e73 666f 726d 0a0a  rm = transform..
-0000d310: 2020 2020 2020 2020 6c69 6d73 203d 206e          lims = n
-0000d320: 702e 6f6e 6573 2828 322c 2073 656c 662e  p.ones((2, self.
-0000d330: 785f 6469 6d29 290a 2020 2020 2020 2020  x_dim)).        
-0000d340: 6c69 6d73 5b30 2c3a 5d20 3d20 3165 2d36  lims[0,:] = 1e-6
-0000d350: 0a20 2020 2020 2020 206c 696d 735b 312c  .        lims[1,
-0000d360: 3a5d 203d 2031 202d 2031 652d 360a 2020  :] = 1 - 1e-6.  
-0000d370: 2020 2020 2020 7365 6c66 2e74 7261 6e73        self.trans
-0000d380: 666f 726d 5f6c 696d 6974 7320 3d20 7365  form_limits = se
-0000d390: 6c66 2e74 7261 6e73 666f 726d 286c 696d  lf.transform(lim
-0000d3a0: 7329 2e74 7261 6e73 706f 7365 2829 0a0a  s).transpose()..
-0000d3b0: 2020 2020 2020 2020 7365 6c66 2e76 6f6c          self.vol
-0000d3c0: 6661 6374 6f72 203d 2076 6f6c 5f70 7265  factor = vol_pre
-0000d3d0: 6661 6374 6f72 2873 656c 662e 785f 6469  factor(self.x_di
-0000d3e0: 6d29 0a0a 2020 2020 6465 6620 5f77 6964  m)..    def _wid
-0000d3f0: 656e 5f6e 6f64 6573 2873 656c 662c 2077  en_nodes(self, w
-0000d400: 6569 6768 7465 645f 7061 7265 6e74 732c  eighted_parents,
-0000d410: 2077 6569 6768 7473 2c20 6e6e 6f64 6573   weights, nnodes
-0000d420: 5f6e 6565 6465 642c 2075 7064 6174 655f  _needed, update_
-0000d430: 696e 7465 7276 616c 5f6e 6361 6c6c 293a  interval_ncall):
-0000d440: 0a20 2020 2020 2020 2022 2222 456e 7375  .        """Ensu
-0000d450: 7265 2074 6861 7420 6174 2070 6172 656e  re that at paren
-0000d460: 7473 2068 6176 6520 606e 6e6f 6465 735f  ts have `nnodes_
-0000d470: 6e65 6564 6564 6020 6c69 7665 2070 6f69  needed` live poi
-0000d480: 6e74 7320 2870 6172 616c 6c65 6c20 6172  nts (parallel ar
-0000d490: 6373 292e 0a0a 2020 2020 2020 2020 4966  cs)...        If
-0000d4a0: 206e 6f74 2c20 6669 6c6c 2075 7020 6279   not, fill up by
-0000d4b0: 2073 616d 706c 696e 672e 0a20 2020 2020   sampling..     
-0000d4c0: 2020 2022 2222 0a20 2020 2020 2020 206e     """.        n
-0000d4d0: 646f 6e65 203d 206c 656e 2877 6569 6768  done = len(weigh
-0000d4e0: 7465 645f 7061 7265 6e74 7329 0a20 2020  ted_parents).   
-0000d4f0: 2020 2020 2069 6620 6e64 6f6e 6520 3d3d       if ndone ==
-0000d500: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0000d510: 6966 2073 656c 662e 6c6f 673a 0a20 2020  if self.log:.   
-0000d520: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000d530: 662e 6c6f 6767 6572 2e69 6e66 6f28 274e  f.logger.info('N
-0000d540: 6f20 7061 7265 6e74 732c 2073 6f20 7769  o parents, so wi
-0000d550: 6465 6e69 6e67 2072 6f6f 7473 2729 0a20  dening roots'). 
-0000d560: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d570: 5f77 6964 656e 5f72 6f6f 7473 286e 6e6f  _widen_roots(nno
-0000d580: 6465 735f 6e65 6564 6564 290a 2020 2020  des_needed).    
-0000d590: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-0000d5a0: 7d0a 0a20 2020 2020 2020 2023 2073 656c  }..        # sel
-0000d5b0: 6563 7420 7061 7265 6e74 7320 7769 7468  ect parents with
-0000d5c0: 2077 6569 6768 7420 312f 7061 7265 6e74   weight 1/parent
-0000d5d0: 5f77 6569 6768 7473 0a20 2020 2020 2020  _weights.       
-0000d5e0: 2070 203d 2031 2e20 2f20 6e70 2e61 7272   p = 1. / np.arr
-0000d5f0: 6179 2877 6569 6768 7473 290a 2020 2020  ay(weights).    
-0000d600: 2020 2020 6966 2028 7020 3d3d 2070 5b30      if (p == p[0
-0000d610: 5d29 2e61 6c6c 2829 3a0a 2020 2020 2020  ]).all():.      
-0000d620: 2020 2020 2020 7061 7265 6e74 7320 3d20        parents = 
-0000d630: 7765 6967 6874 6564 5f70 6172 656e 7473  weighted_parents
-0000d640: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000d650: 2020 2020 2020 2020 2020 2023 2070 7265             # pre
-0000d660: 6665 7265 6e74 6961 6c6c 7920 7365 6c65  ferentially sele
-0000d670: 6374 206e 6f64 6573 2077 6974 6820 6665  ct nodes with fe
-0000d680: 7720 7061 7265 6e74 732c 2061 7320 7468  w parents, as th
-0000d690: 6f73 650a 2020 2020 2020 2020 2020 2020  ose.            
-0000d6a0: 2320 6861 7665 206d 6f73 7420 7765 6967  # have most weig
-0000d6b0: 6874 0a20 2020 2020 2020 2020 2020 2069  ht.            i
-0000d6c0: 203d 206e 702e 7261 6e64 6f6d 2e63 686f   = np.random.cho
-0000d6d0: 6963 6528 6c65 6e28 7765 6967 6874 6564  ice(len(weighted
-0000d6e0: 5f70 6172 656e 7473 292c 2073 697a 653d  _parents), size=
-0000d6f0: 6e6e 6f64 6573 5f6e 6565 6465 642c 2070  nnodes_needed, p
-0000d700: 3d70 202f 2070 2e73 756d 2829 290a 2020  =p / p.sum()).  
-0000d710: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000d720: 662e 7573 655f 6d70 693a 0a20 2020 2020  f.use_mpi:.     
-0000d730: 2020 2020 2020 2020 2020 2069 203d 2073             i = s
-0000d740: 656c 662e 636f 6d6d 2e62 6361 7374 2869  elf.comm.bcast(i
-0000d750: 2c20 726f 6f74 3d30 290a 0a20 2020 2020  , root=0)..     
-0000d760: 2020 2020 2020 2070 6172 656e 7473 203d         parents =
-0000d770: 205b 7765 6967 6874 6564 5f70 6172 656e   [weighted_paren
-0000d780: 7473 5b69 695d 2066 6f72 2069 6920 696e  ts[ii] for ii in
-0000d790: 2069 5d0a 0a20 2020 2020 2020 2064 656c   i]..        del
-0000d7a0: 2077 6569 6768 7465 645f 7061 7265 6e74   weighted_parent
-0000d7b0: 732c 2077 6569 6768 7473 0a0a 2020 2020  s, weights..    
-0000d7c0: 2020 2020 2320 736f 7274 2066 726f 6d20      # sort from 
-0000d7d0: 6c6f 7720 746f 2068 6967 680a 2020 2020  low to high.    
-0000d7e0: 2020 2020 7061 7265 6e74 732e 736f 7274      parents.sort
-0000d7f0: 286b 6579 3d6f 7065 7261 746f 722e 6174  (key=operator.at
-0000d800: 7472 6765 7474 6572 2827 7661 6c75 6527  trgetter('value'
-0000d810: 2929 0a20 2020 2020 2020 204c 6d69 6e20  )).        Lmin 
-0000d820: 3d20 7061 7265 6e74 735b 305d 2e76 616c  = parents[0].val
-0000d830: 7565 0a20 2020 2020 2020 2069 6620 6e70  ue.        if np
-0000d840: 2e69 7369 6e66 284c 6d69 6e29 3a0a 2020  .isinf(Lmin):.  
-0000d850: 2020 2020 2020 2020 2020 2320 736f 6d65            # some
-0000d860: 206f 6620 7468 6520 7061 7265 6e74 7320   of the parents 
-0000d870: 7765 7265 2062 6f72 6e20 6279 2073 616d  were born by sam
-0000d880: 706c 696e 6720 6672 6f6d 2074 6865 2065  pling from the e
-0000d890: 6e74 6972 650a 2020 2020 2020 2020 2020  ntire.          
-0000d8a0: 2020 2320 7072 696f 7220 766f 6c75 6d65    # prior volume
-0000d8b0: 2e20 536f 2077 6520 6361 6e20 6566 6669  . So we can effi
-0000d8c0: 6369 656e 746c 7920 6170 706c 7920 6120  ciently apply a 
-0000d8d0: 736f 6c75 7469 6f6e 3a0a 2020 2020 2020  solution:.      
-0000d8e0: 2020 2020 2020 2320 6578 7061 6e64 2074        # expand t
-0000d8f0: 6865 2072 6f6f 7473 0a20 2020 2020 2020  he roots.       
-0000d900: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
-0000d910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d920: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
-0000d930: 666f 2827 7061 7265 6e74 2076 616c 7565  fo('parent value
-0000d940: 2069 7320 2d69 6e66 2c20 736f 2077 6964   is -inf, so wid
-0000d950: 656e 696e 6720 726f 6f74 7327 290a 2020  ening roots').  
-0000d960: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000d970: 7769 6465 6e5f 726f 6f74 7328 6e6e 6f64  widen_roots(nnod
-0000d980: 6573 5f6e 6565 6465 6429 0a20 2020 2020  es_needed).     
-0000d990: 2020 2020 2020 2072 6574 7572 6e20 7b7d         return {}
-0000d9a0: 0a0a 2020 2020 2020 2020 2320 646f 7562  ..        # doub
-0000d9b0: 6c65 2075 6e74 696c 2077 6520 7265 6163  le until we reac
-0000d9c0: 6820 7468 6520 6e65 6365 7373 6172 7920  h the necessary 
-0000d9d0: 706f 696e 7473 0a20 2020 2020 2020 2023  points.        #
-0000d9e0: 2074 6869 7320 6973 2070 726f 6261 626c   this is probabl
-0000d9f0: 7920 312c 2066 726f 6d20 2832 4b20 2d20  y 1, from (2K - 
-0000da00: 4b29 202f 204b 0a20 2020 2020 2020 206e  K) / K.        n
-0000da10: 7361 6d70 6c65 7320 3d20 696e 7428 6e70  samples = int(np
-0000da20: 2e63 6569 6c28 286e 6e6f 6465 735f 6e65  .ceil((nnodes_ne
-0000da30: 6564 6564 202d 206e 646f 6e65 2920 2f20  eded - ndone) / 
-0000da40: 6c65 6e28 7061 7265 6e74 7329 2929 0a0a  len(parents)))..
-0000da50: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000da60: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
-0000da70: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
-0000da80: 6f28 2757 696c 6c20 6164 6420 2564 206c  o('Will add %d l
-0000da90: 6976 6520 706f 696e 7473 2028 7825 6429  ive points (x%d)
-0000daa0: 2061 7420 4c3d 252e 3167 202e 2e2e 272c   at L=%.1g ...',
-0000dab0: 206e 6e6f 6465 735f 6e65 6564 6564 202d   nnodes_needed -
-0000dac0: 206e 646f 6e65 2c20 6e73 616d 706c 6573   ndone, nsamples
-0000dad0: 2c20 4c6d 696e 290a 0a20 2020 2020 2020  , Lmin)..       
-0000dae0: 2023 2061 6464 2070 6f69 6e74 7320 7768   # add points wh
-0000daf0: 6572 6520 6e65 6365 7373 6172 7920 2870  ere necessary (p
-0000db00: 6172 656e 7473 2063 616e 2068 6176 6520  arents can have 
-0000db10: 6d75 6c74 6970 6c65 2065 6e74 7269 6573  multiple entries
-0000db20: 290a 2020 2020 2020 2020 7461 7267 6574  ).        target
-0000db30: 5f6d 696e 5f6e 756d 5f63 6869 6c64 7265  _min_num_childre
-0000db40: 6e20 3d20 7b7d 0a20 2020 2020 2020 2066  n = {}.        f
-0000db50: 6f72 206e 2069 6e20 7061 7265 6e74 733a  or n in parents:
-0000db60: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-0000db70: 676e 203d 2074 6172 6765 745f 6d69 6e5f  gn = target_min_
-0000db80: 6e75 6d5f 6368 696c 6472 656e 2e67 6574  num_children.get
-0000db90: 286e 2e69 642c 206c 656e 286e 2e63 6869  (n.id, len(n.chi
-0000dba0: 6c64 7265 6e29 290a 2020 2020 2020 2020  ldren)).        
-0000dbb0: 2020 2020 7461 7267 6574 5f6d 696e 5f6e      target_min_n
-0000dbc0: 756d 5f63 6869 6c64 7265 6e5b 6e2e 6964  um_children[n.id
-0000dbd0: 5d20 3d20 6f72 6967 6e20 2b20 6e73 616d  ] = orign + nsam
-0000dbe0: 706c 6573 0a0a 2020 2020 2020 2020 7265  ples..        re
-0000dbf0: 7475 726e 2074 6172 6765 745f 6d69 6e5f  turn target_min_
-0000dc00: 6e75 6d5f 6368 696c 6472 656e 0a0a 2020  num_children..  
-0000dc10: 2020 6465 6620 5f77 6964 656e 5f72 6f6f    def _widen_roo
-0000dc20: 7473 5f62 6579 6f6e 645f 696e 6974 6961  ts_beyond_initia
-0000dc30: 6c5f 706c 6174 6561 7528 7365 6c66 2c20  l_plateau(self, 
-0000dc40: 6e72 6f6f 7473 2c20 6e75 6d5f 7761 726e  nroots, num_warn
-0000dc50: 2c20 6e75 6d5f 7374 6f70 293a 0a20 2020  , num_stop):.   
-0000dc60: 2020 2020 2022 2222 5769 6465 6e20 726f       """Widen ro
-0000dc70: 6f74 732c 2062 7574 2070 6f70 756c 6174  ots, but populat
-0000dc80: 6520 6168 6561 6420 6f66 2069 6e69 7469  e ahead of initi
-0000dc90: 616c 2070 6c61 7465 6175 2e0a 0a20 2020  al plateau...   
-0000dca0: 2020 2020 2063 616c 6c73 205f 7769 6465       calls _wide
-0000dcb0: 6e5f 726f 6f74 732c 2061 6e64 2069 6620  n_roots, and if 
-0000dcc0: 7468 6572 6520 6172 6520 7365 7665 7261  there are severa
-0000dcd0: 6c20 706f 696e 7473 2077 6974 6820 7468  l points with th
-0000dce0: 6520 7361 6d65 0a20 2020 2020 2020 2076  e same.        v
-0000dcf0: 616c 7565 2065 7175 616c 2074 6f20 7468  alue equal to th
-0000dd00: 6520 6c6f 7765 7374 206c 6f67 6c69 6b65  e lowest loglike
-0000dd10: 6c69 686f 6f64 2c20 7769 6465 6e73 2073  lihood, widens s
-0000dd20: 6f6d 6520 6d6f 7265 2075 6e74 696c 0a20  ome more until. 
-0000dd30: 2020 2020 2020 2074 6865 7265 2061 7265         there are
-0000dd40: 2060 6e72 6f6f 7473 602d 3120 7468 6174   `nroots`-1 that
-0000dd50: 2061 7265 2064 6966 6665 7265 6e74 2074   are different t
-0000dd60: 6f20 7468 6520 6c6f 7765 7374 0a20 2020  o the lowest.   
-0000dd70: 2020 2020 206c 6f67 6c69 6b65 6c69 686f       loglikeliho
-0000dd80: 6f64 2076 616c 7565 2e0a 0a20 2020 2020  od value...     
-0000dd90: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0000dda0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0000ddb0: 2d0a 2020 2020 2020 2020 6e72 6f6f 7473  -.        nroots
-0000ddc0: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
-0000ddd0: 2020 4e75 6d62 6572 206f 6620 726f 6f74    Number of root
-0000dde0: 206c 6976 6520 706f 696e 7473 2c20 6166   live points, af
-0000ddf0: 7465 7220 7468 6520 706c 6174 6561 7520  ter the plateau 
-0000de00: 6973 2074 7261 7665 7273 6564 2e0a 0a20  is traversed... 
-0000de10: 2020 2020 2020 206e 756d 5f77 6172 6e3a         num_warn:
-0000de20: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-0000de30: 2057 6172 6e20 6966 2074 6865 206e 756d   Warn if the num
-0000de40: 6265 7220 6f66 2072 6f6f 7420 6c69 7665  ber of root live
-0000de50: 2070 6f69 6e74 7320 7265 6163 6865 6420   points reached 
-0000de60: 7468 6973 2e0a 0a20 2020 2020 2020 206e  this...        n
-0000de70: 756d 5f73 746f 703a 2069 6e74 0a20 2020  um_stop: int.   
-0000de80: 2020 2020 2020 2020 2044 6f20 6e6f 7420           Do not 
-0000de90: 696e 6372 6561 7369 6e67 2074 6865 206e  increasing the n
-0000dea0: 756d 6265 7220 6f66 2072 6f6f 7420 6c69  umber of root li
-0000deb0: 7665 2070 6f69 6e74 7320 6265 796f 6e64  ve points beyond
-0000dec0: 2074 6869 7320 6c69 6d69 742e 0a0a 2020   this limit...  
-0000ded0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000dee0: 2020 6e72 6f6f 7473 5f6e 6565 6465 6420    nroots_needed 
-0000def0: 3d20 6e72 6f6f 7473 0a20 2020 2020 2020  = nroots.       
-0000df00: 2075 7365 725f 6861 735f 6265 656e 5f77   user_has_been_w
-0000df10: 6172 6e65 6420 3d20 4661 6c73 650a 2020  arned = False.  
-0000df20: 2020 2020 2020 7768 696c 6520 5472 7565        while True
-0000df30: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000df40: 6c66 2e5f 7769 6465 6e5f 726f 6f74 7328  lf._widen_roots(
-0000df50: 6e72 6f6f 7473 5f6e 6565 6465 6429 0a20  nroots_needed). 
-0000df60: 2020 2020 2020 2020 2020 204c 7320 3d20             Ls = 
-0000df70: 6e70 2e61 7272 6179 285b 6e6f 6465 2e76  np.array([node.v
-0000df80: 616c 7565 2066 6f72 206e 6f64 6520 696e  alue for node in
-0000df90: 2073 656c 662e 726f 6f74 2e63 6869 6c64   self.root.child
-0000dfa0: 7265 6e5d 290a 2020 2020 2020 2020 2020  ren]).          
-0000dfb0: 2020 4c6d 696e 203d 206e 702e 6d69 6e28    Lmin = np.min(
-0000dfc0: 4c73 290a 2020 2020 2020 2020 2020 2020  Ls).            
-0000dfd0: 6966 2073 656c 662e 6c6f 6720 616e 6420  if self.log and 
-0000dfe0: 6e72 6f6f 7473 5f6e 6565 6465 6420 3e20  nroots_needed > 
-0000dff0: 6e75 6d5f 7761 726e 2061 6e64 206e 6f74  num_warn and not
-0000e000: 2075 7365 725f 6861 735f 6265 656e 5f77   user_has_been_w
-0000e010: 6172 6e65 643a 0a20 2020 2020 2020 2020  arned:.         
-0000e020: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-0000e030: 6572 2e77 6172 6e69 6e67 2822 2222 5761  er.warning("""Wa
-0000e040: 726e 696e 673a 2054 6865 206c 6f67 2d6c  rning: The log-l
-0000e050: 696b 656c 6968 6f6f 6420 6861 7320 6120  ikelihood has a 
-0000e060: 6c61 7267 6520 706c 6174 6561 7520 7769  large plateau wi
-0000e070: 7468 204c 3d25 672e 0a0a 2020 5072 6f62  th L=%g...  Prob
-0000e080: 6162 6c79 2079 6f75 2061 7265 2072 6574  ably you are ret
-0000e090: 7572 6e69 6e67 2061 206c 6f77 2076 616c  urning a low val
-0000e0a0: 7565 2077 6865 6e20 7468 6520 7061 7261  ue when the para
-0000e0b0: 6d65 7465 7273 2061 7265 2070 726f 626c  meters are probl
-0000e0c0: 656d 6174 6963 2f75 6e70 6879 7369 6361  ematic/unphysica
-0000e0d0: 6c2e 0a20 2075 6c74 7261 6e65 7374 2063  l..  ultranest c
-0000e0e0: 616e 2068 616e 646c 6520 7468 6973 2063  an handle this c
-0000e0f0: 6f72 7265 6374 6c79 2c20 6279 2064 6973  orrectly, by dis
-0000e100: 6361 7264 696e 6720 6c69 7665 2070 6f69  carding live poi
-0000e110: 6e74 7320 7769 7468 2074 6865 2073 616d  nts with the sam
-0000e120: 6520 6c6f 676c 696b 656c 6968 6f6f 642e  e loglikelihood.
-0000e130: 0a20 2028 6172 7869 763a 3230 3035 2e30  .  (arxiv:2005.0
-0000e140: 3836 3032 2061 7278 6976 3a32 3031 302e  8602 arxiv:2010.
-0000e150: 3133 3838 3429 2e20 546f 206d 6974 6967  13884). To mitig
-0000e160: 6174 6520 7275 6e6e 696e 6720 6f75 7420  ate running out 
-0000e170: 6f66 206c 6976 6520 706f 696e 7473 2c0a  of live points,.
-0000e180: 2020 7468 6520 696e 6974 6961 6c20 6e75    the initial nu
-0000e190: 6d62 6572 206f 6620 6c69 7665 2070 6f69  mber of live poi
-0000e1a0: 6e74 7320 6973 2069 6e63 7265 6173 6564  nts is increased
-0000e1b0: 2e20 4275 7420 6e6f 7720 7468 6973 2068  . But now this h
-0000e1c0: 6173 2072 6561 6368 6564 206f 7665 7220  as reached over 
-0000e1d0: 2564 2070 6f69 6e74 732e 0a0a 2020 596f  %d points...  Yo
-0000e1e0: 7520 6361 6e20 6176 6f69 6420 7468 6973  u can avoid this
-0000e1f0: 206d 616b 696e 6720 7468 6520 6c6f 676c   making the logl
-0000e200: 696b 656c 6968 6f6f 6420 696e 6372 6561  ikelihood increa
-0000e210: 7365 2074 6f77 6172 6473 2077 6865 7265  se towards where
-0000e220: 2074 6865 2067 6f6f 6420 7265 6769 6f6e   the good region
-0000e230: 2069 732e 0a20 2046 6f72 2065 7861 6d70   is..  For examp
-0000e240: 6c65 2c20 6c65 7427 7320 7361 7920 796f  le, let's say yo
-0000e250: 7520 6861 7665 2074 776f 2070 6172 616d  u have two param
-0000e260: 6574 6572 7320 7768 6572 6520 7468 6520  eters where the 
-0000e270: 7375 6d20 6d75 7374 2062 6520 6265 6c6f  sum must be belo
-0000e280: 7720 312e 2052 6570 6c61 6365 2074 6869  w 1. Replace thi
-0000e290: 733a 0a0a 2020 2020 6966 2070 6172 616d  s:..    if param
-0000e2a0: 735b 305d 202b 2070 6172 616d 735b 315d  s[0] + params[1]
-0000e2b0: 203e 2031 3a0a 2020 2020 2020 2020 2072   > 1:.         r
-0000e2c0: 6574 7572 6e20 2d31 6533 3030 0a0a 2020  eturn -1e300..  
-0000e2d0: 7769 7468 3a0a 0a20 2020 2069 6620 7061  with:..    if pa
-0000e2e0: 7261 6d73 5b30 5d20 2b20 7061 7261 6d73  rams[0] + params
-0000e2f0: 5b31 5d20 3e20 313a 0a20 2020 2020 2020  [1] > 1:.       
-0000e300: 2020 7265 7475 726e 202d 3165 3330 3020    return -1e300 
-0000e310: 2a20 2870 6172 616d 735b 305d 202b 2070  * (params[0] + p
-0000e320: 6172 616d 735b 315d 290a 0a20 2054 6865  arams[1])..  The
-0000e330: 2063 7572 7265 6e74 2073 7472 6174 6567   current strateg
-0000e340: 7920 7769 6c6c 2063 6f6e 7469 6e75 6520  y will continue 
-0000e350: 756e 7469 6c20 2564 206c 6976 6520 706f  until %d live po
-0000e360: 696e 7473 2061 7265 2072 6561 6368 6564  ints are reached
-0000e370: 2e0a 2020 4974 2069 7320 7361 6665 2074  ..  It is safe t
-0000e380: 6f20 6967 6e6f 7265 2074 6869 7320 7761  o ignore this wa
-0000e390: 726e 696e 672e 2222 222c 204c 6d69 6e2c  rning.""", Lmin,
-0000e3a0: 206e 756d 5f77 6172 6e2c 206e 756d 5f73   num_warn, num_s
-0000e3b0: 746f 7029 0a20 2020 2020 2020 2020 2020  top).           
-0000e3c0: 2020 2020 2075 7365 725f 6861 735f 6265       user_has_be
-0000e3d0: 656e 5f77 6172 6e65 6420 3d20 5472 7565  en_warned = True
-0000e3e0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000e3f0: 206e 726f 6f74 735f 6e65 6564 6564 203e   nroots_needed >
-0000e400: 3d20 6e75 6d5f 7374 6f70 3a0a 2020 2020  = num_stop:.    
-0000e410: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0000e420: 6b0a 2020 2020 2020 2020 2020 2020 5020  k.            P 
-0000e430: 3d20 284c 7320 3d3d 204c 6d69 6e29 2e73  = (Ls == Lmin).s
-0000e440: 756d 2829 0a20 2020 2020 2020 2020 2020  um().           
-0000e450: 2069 6620 3120 3c20 5020 3c20 6c65 6e28   if 1 < P < len(
-0000e460: 4c73 2920 616e 6420 6c65 6e28 4c73 2920  Ls) and len(Ls) 
-0000e470: 2d20 5020 2b20 3120 3c20 6e72 6f6f 7473  - P + 1 < nroots
-0000e480: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e490: 2020 2320 6775 6573 7320 7468 6520 6e75    # guess the nu
-0000e4a0: 6d62 6572 206f 6620 706f 696e 7473 206e  mber of points n
-0000e4b0: 6565 6465 643a 2050 2d31 2061 7265 2075  eeded: P-1 are u
-0000e4c0: 7365 6c65 7373 0a20 2020 2020 2020 2020  seless.         
-0000e4d0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-0000e4e0: 6f67 3a0a 2020 2020 2020 2020 2020 2020  og:.            
-0000e4f0: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0000e500: 6765 722e 6465 6275 6728 0a20 2020 2020  ger.debug(.     
-0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e520: 2020 2027 466f 756e 6420 706c 6174 6561     'Found platea
-0000e530: 7520 6f66 2025 642f 2564 2069 6e69 7469  u of %d/%d initi
-0000e540: 616c 2070 6f69 6e74 7320 6174 204c 3d25  al points at L=%
-0000e550: 672e 2027 0a20 2020 2020 2020 2020 2020  g. '.           
-0000e560: 2020 2020 2020 2020 2020 2020 2027 4176               'Av
-0000e570: 6f69 6420 7468 6973 2062 7920 6120 636f  oid this by a co
-0000e580: 6e74 696e 756f 7573 6c79 2069 6e63 7265  ntinuously incre
-0000e590: 6173 696e 6720 6c6f 676c 696b 656c 6968  asing loglikelih
-0000e5a0: 6f6f 6420 746f 7761 7264 7320 676f 6f64  ood towards good
-0000e5b0: 2072 6567 696f 6e73 2e27 2c0a 2020 2020   regions.',.    
-0000e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5d0: 2020 2020 502c 206e 726f 6f74 735f 6e65      P, nroots_ne
-0000e5e0: 6564 6564 2c20 4c6d 696e 290a 2020 2020  eded, Lmin).    
-0000e5f0: 2020 2020 2020 2020 2020 2020 6e72 6f6f              nroo
-0000e600: 7473 5f6e 6565 6465 6420 3d20 6d69 6e28  ts_needed = min(
-0000e610: 6e75 6d5f 7374 6f70 2c20 6e72 6f6f 7473  num_stop, nroots
-0000e620: 5f6e 6565 6465 6420 2b20 2850 202d 2031  _needed + (P - 1
-0000e630: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
-0000e640: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000e650: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
-0000e660: 6465 6620 5f77 6964 656e 5f72 6f6f 7473  def _widen_roots
-0000e670: 2873 656c 662c 206e 726f 6f74 7329 3a0a  (self, nroots):.
-0000e680: 2020 2020 2020 2020 2222 2245 6e73 7572          """Ensur
-0000e690: 6520 726f 6f74 2068 6173 2060 6e72 6f6f  e root has `nroo
-0000e6a0: 7473 6020 6368 696c 6472 656e 2e0a 0a20  ts` children... 
-0000e6b0: 2020 2020 2020 2053 616d 706c 6520 6672         Sample fr
-0000e6c0: 6f6d 2070 7269 6f72 2074 6f20 6669 6c6c  om prior to fill
-0000e6d0: 2075 7020 2869 6620 6e65 6564 6564 292e   up (if needed).
-0000e6e0: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0000e6f0: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0000e700: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0000e710: 206e 726f 6f74 733a 2069 6e74 0a20 2020   nroots: int.   
-0000e720: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
-0000e730: 6f66 2072 6f6f 7420 6c69 7665 2070 6f69  of root live poi
-0000e740: 6e74 732c 2061 6674 6572 2074 6865 2070  nts, after the p
-0000e750: 6c61 7465 6175 2069 7320 7472 6176 6572  lateau is traver
-0000e760: 7365 642e 0a20 2020 2020 2020 2022 2222  sed..        """
-0000e770: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000e780: 2e6c 6f67 2061 6e64 206c 656e 2873 656c  .log and len(sel
-0000e790: 662e 726f 6f74 2e63 6869 6c64 7265 6e29  f.root.children)
-0000e7a0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-0000e7b0: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
-0000e7c0: 666f 2827 5769 6465 6e69 6e67 2072 6f6f  fo('Widening roo
-0000e7d0: 7473 2074 6f20 2564 206c 6976 6520 706f  ts to %d live po
-0000e7e0: 696e 7473 2028 6861 7665 2025 6420 616c  ints (have %d al
-0000e7f0: 7265 6164 7929 202e 2e2e 272c 206e 726f  ready) ...', nro
-0000e800: 6f74 732c 206c 656e 2873 656c 662e 726f  ots, len(self.ro
-0000e810: 6f74 2e63 6869 6c64 7265 6e29 290a 2020  ot.children)).  
-0000e820: 2020 2020 2020 6e6e 6577 726f 6f74 7320        nnewroots 
-0000e830: 3d20 6e72 6f6f 7473 202d 206c 656e 2873  = nroots - len(s
-0000e840: 656c 662e 726f 6f74 2e63 6869 6c64 7265  elf.root.childre
-0000e850: 6e29 0a20 2020 2020 2020 2069 6620 6e6e  n).        if nn
-0000e860: 6577 726f 6f74 7320 3c3d 2030 3a0a 2020  ewroots <= 0:.  
-0000e870: 2020 2020 2020 2020 2020 2320 6e6f 7468            # noth
-0000e880: 696e 6720 746f 2064 6f0a 2020 2020 2020  ing to do.      
-0000e890: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-0000e8a0: 2020 2020 2020 7072 6576 5f75 203d 205b        prev_u = [
-0000e8b0: 5d0a 2020 2020 2020 2020 7072 6576 5f76  ].        prev_v
-0000e8c0: 203d 205b 5d0a 2020 2020 2020 2020 7072   = [].        pr
-0000e8d0: 6576 5f6c 6f67 6c20 3d20 5b5d 0a20 2020  ev_logl = [].   
-0000e8e0: 2020 2020 2070 7265 765f 726f 7769 6420       prev_rowid 
-0000e8f0: 3d20 5b5d 0a0a 2020 2020 2020 2020 6966  = []..        if
-0000e900: 2073 656c 662e 6c6f 6720 616e 6420 7365   self.log and se
-0000e910: 6c66 2e75 7365 5f70 6f69 6e74 5f73 7461  lf.use_point_sta
-0000e920: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
-0000e930: 2320 7472 7920 746f 2072 6573 756d 653a  # try to resume:
-0000e940: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-0000e950: 656c 662e 6c6f 6767 6572 2e69 6e66 6f28  elf.logger.info(
-0000e960: 2752 6573 756d 696e 672e 2e2e 2729 0a20  'Resuming...'). 
-0000e970: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0000e980: 2069 6e20 7261 6e67 6528 6e6e 6577 726f   in range(nnewro
-0000e990: 6f74 7329 3a0a 2020 2020 2020 2020 2020  ots):.          
-0000e9a0: 2020 2020 2020 726f 7769 642c 2072 6f77        rowid, row
-0000e9b0: 203d 2073 656c 662e 706f 696e 7473 746f   = self.pointsto
-0000e9c0: 7265 2e70 6f70 282d 6e70 2e69 6e66 290a  re.pop(-np.inf).
-0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9e0: 6966 2072 6f77 2069 7320 4e6f 6e65 3a0a  if row is None:.
-0000e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea00: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0000ea10: 2020 2020 2020 2020 2020 7072 6576 5f6c            prev_l
-0000ea20: 6f67 6c2e 6170 7065 6e64 2872 6f77 5b31  ogl.append(row[1
-0000ea30: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0000ea40: 2020 2070 7265 765f 752e 6170 7065 6e64     prev_u.append
-0000ea50: 2872 6f77 5b33 3a33 202b 2073 656c 662e  (row[3:3 + self.
-0000ea60: 785f 6469 6d5d 290a 2020 2020 2020 2020  x_dim]).        
-0000ea70: 2020 2020 2020 2020 7072 6576 5f76 2e61          prev_v.a
-0000ea80: 7070 656e 6428 726f 775b 3320 2b20 7365  ppend(row[3 + se
-0000ea90: 6c66 2e78 5f64 696d 3a33 202b 2073 656c  lf.x_dim:3 + sel
-0000eaa0: 662e 785f 6469 6d20 2b20 7365 6c66 2e6e  f.x_dim + self.n
-0000eab0: 756d 5f70 6172 616d 735d 290a 2020 2020  um_params]).    
-0000eac0: 2020 2020 2020 2020 2020 2020 7072 6576              prev
-0000ead0: 5f72 6f77 6964 2e61 7070 656e 6428 726f  _rowid.append(ro
-0000eae0: 7769 6429 0a0a 2020 2020 2020 2020 6966  wid)..        if
-0000eaf0: 2073 656c 662e 6c6f 673a 0a20 2020 2020   self.log:.     
-0000eb00: 2020 2020 2020 2070 7265 765f 7520 3d20         prev_u = 
-0000eb10: 6e70 2e61 7272 6179 2870 7265 765f 7529  np.array(prev_u)
-0000eb20: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-0000eb30: 765f 7620 3d20 6e70 2e61 7272 6179 2870  v_v = np.array(p
-0000eb40: 7265 765f 7629 0a20 2020 2020 2020 2020  rev_v).         
-0000eb50: 2020 2070 7265 765f 6c6f 676c 203d 206e     prev_logl = n
-0000eb60: 702e 6172 7261 7928 7072 6576 5f6c 6f67  p.array(prev_log
-0000eb70: 6c29 0a0a 2020 2020 2020 2020 2020 2020  l)..            
-0000eb80: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 735f  num_live_points_
-0000eb90: 6d69 7373 696e 6720 3d20 6e6e 6577 726f  missing = nnewro
-0000eba0: 6f74 7320 2d20 6c65 6e28 7072 6576 5f6c  ots - len(prev_l
-0000ebb0: 6f67 6c29 0a20 2020 2020 2020 2065 6c73  ogl).        els
-0000ebc0: 653a 0a20 2020 2020 2020 2020 2020 206e  e:.            n
-0000ebd0: 756d 5f6c 6976 655f 706f 696e 7473 5f6d  um_live_points_m
-0000ebe0: 6973 7369 6e67 203d 202d 310a 0a20 2020  issing = -1..   
-0000ebf0: 2020 2020 2069 6620 7365 6c66 2e75 7365       if self.use
-0000ec00: 5f6d 7069 3a0a 2020 2020 2020 2020 2020  _mpi:.          
-0000ec10: 2020 6e75 6d5f 6c69 7665 5f70 6f69 6e74    num_live_point
-0000ec20: 735f 6d69 7373 696e 6720 3d20 7365 6c66  s_missing = self
-0000ec30: 2e63 6f6d 6d2e 6263 6173 7428 6e75 6d5f  .comm.bcast(num_
-0000ec40: 6c69 7665 5f70 6f69 6e74 735f 6d69 7373  live_points_miss
-0000ec50: 696e 672c 2072 6f6f 743d 3029 0a20 2020  ing, root=0).   
-0000ec60: 2020 2020 2020 2020 2070 7265 765f 7520           prev_u 
-0000ec70: 3d20 7365 6c66 2e63 6f6d 6d2e 6263 6173  = self.comm.bcas
-0000ec80: 7428 7072 6576 5f75 2c20 726f 6f74 3d30  t(prev_u, root=0
-0000ec90: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-0000eca0: 6576 5f76 203d 2073 656c 662e 636f 6d6d  ev_v = self.comm
-0000ecb0: 2e62 6361 7374 2870 7265 765f 762c 2072  .bcast(prev_v, r
-0000ecc0: 6f6f 743d 3029 0a20 2020 2020 2020 2020  oot=0).         
-0000ecd0: 2020 2070 7265 765f 6c6f 676c 203d 2073     prev_logl = s
-0000ece0: 656c 662e 636f 6d6d 2e62 6361 7374 2870  elf.comm.bcast(p
-0000ecf0: 7265 765f 6c6f 676c 2c20 726f 6f74 3d30  rev_logl, root=0
-0000ed00: 290a 0a20 2020 2020 2020 2061 7373 6572  )..        asser
-0000ed10: 7420 6e75 6d5f 6c69 7665 5f70 6f69 6e74  t num_live_point
-0000ed20: 735f 6d69 7373 696e 6720 3e3d 2030 0a20  s_missing >= 0. 
-0000ed30: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-0000ed40: 6f67 2061 6e64 206e 756d 5f6c 6976 655f  og and num_live_
-0000ed50: 706f 696e 7473 5f6d 6973 7369 6e67 203e  points_missing >
-0000ed60: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0000ed70: 7365 6c66 2e6c 6f67 6765 722e 696e 666f  self.logger.info
-0000ed80: 2827 5361 6d70 6c69 6e67 2025 6420 6c69  ('Sampling %d li
-0000ed90: 7665 2070 6f69 6e74 7320 6672 6f6d 2070  ve points from p
-0000eda0: 7269 6f72 202e 2e2e 272c 206e 756d 5f6c  rior ...', num_l
-0000edb0: 6976 655f 706f 696e 7473 5f6d 6973 7369  ive_points_missi
-0000edc0: 6e67 290a 2020 2020 2020 2020 6966 206e  ng).        if n
-0000edd0: 756d 5f6c 6976 655f 706f 696e 7473 5f6d  um_live_points_m
-0000ede0: 6973 7369 6e67 203e 2030 3a0a 2020 2020  issing > 0:.    
-0000edf0: 2020 2020 2020 2020 6e75 6d5f 6c69 7665          num_live
-0000ee00: 5f70 6f69 6e74 735f 746f 646f 203d 2064  _points_todo = d
-0000ee10: 6973 7472 6962 7574 6564 5f77 6f72 6b5f  istributed_work_
-0000ee20: 6368 756e 6b5f 7369 7a65 286e 756d 5f6c  chunk_size(num_l
-0000ee30: 6976 655f 706f 696e 7473 5f6d 6973 7369  ive_points_missi
-0000ee40: 6e67 2c20 7365 6c66 2e6d 7069 5f72 616e  ng, self.mpi_ran
-0000ee50: 6b2c 2073 656c 662e 6d70 695f 7369 7a65  k, self.mpi_size
-0000ee60: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0000ee70: 6c66 2e6e 6361 6c6c 202b 3d20 6e75 6d5f  lf.ncall += num_
-0000ee80: 6c69 7665 5f70 6f69 6e74 735f 6d69 7373  live_points_miss
-0000ee90: 696e 670a 0a20 2020 2020 2020 2020 2020  ing..           
-0000eea0: 2069 6620 6e75 6d5f 6c69 7665 5f70 6f69   if num_live_poi
-0000eeb0: 6e74 735f 746f 646f 203e 2030 3a0a 2020  nts_todo > 0:.  
-0000eec0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-0000eed0: 7469 7665 5f75 203d 206e 702e 7261 6e64  tive_u = np.rand
-0000eee0: 6f6d 2e75 6e69 666f 726d 2873 697a 653d  om.uniform(size=
-0000eef0: 286e 756d 5f6c 6976 655f 706f 696e 7473  (num_live_points
-0000ef00: 5f74 6f64 6f2c 2073 656c 662e 785f 6469  _todo, self.x_di
-0000ef10: 6d29 290a 2020 2020 2020 2020 2020 2020  m)).            
-0000ef20: 2020 2020 6163 7469 7665 5f76 203d 2073      active_v = s
-0000ef30: 656c 662e 7472 616e 7366 6f72 6d28 6163  elf.transform(ac
-0000ef40: 7469 7665 5f75 290a 2020 2020 2020 2020  tive_u).        
-0000ef50: 2020 2020 2020 2020 6163 7469 7665 5f6c          active_l
-0000ef60: 6f67 6c20 3d20 7365 6c66 2e6c 6f67 6c69  ogl = self.logli
-0000ef70: 6b65 2861 6374 6976 655f 7629 0a20 2020  ke(active_v).   
-0000ef80: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000ef90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000efa0: 6374 6976 655f 7520 3d20 6e70 2e65 6d70  ctive_u = np.emp
-0000efb0: 7479 2828 302c 2073 656c 662e 785f 6469  ty((0, self.x_di
-0000efc0: 6d29 290a 2020 2020 2020 2020 2020 2020  m)).            
-0000efd0: 2020 2020 6163 7469 7665 5f76 203d 206e      active_v = n
-0000efe0: 702e 656d 7074 7928 2830 2c20 7365 6c66  p.empty((0, self
-0000eff0: 2e6e 756d 5f70 6172 616d 7329 290a 2020  .num_params)).  
-0000f000: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-0000f010: 7469 7665 5f6c 6f67 6c20 3d20 6e70 2e65  tive_logl = np.e
-0000f020: 6d70 7479 2828 302c 2929 0a0a 2020 2020  mpty((0,))..    
-0000f030: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000f040: 7573 655f 6d70 693a 0a20 2020 2020 2020  use_mpi:.       
-0000f050: 2020 2020 2020 2020 2072 6563 765f 7361           recv_sa
-0000f060: 6d70 6c65 7320 3d20 7365 6c66 2e63 6f6d  mples = self.com
-0000f070: 6d2e 6761 7468 6572 2861 6374 6976 655f  m.gather(active_
-0000f080: 752c 2072 6f6f 743d 3029 0a20 2020 2020  u, root=0).     
-0000f090: 2020 2020 2020 2020 2020 2072 6563 765f             recv_
-0000f0a0: 7361 6d70 6c65 7376 203d 2073 656c 662e  samplesv = self.
-0000f0b0: 636f 6d6d 2e67 6174 6865 7228 6163 7469  comm.gather(acti
-0000f0c0: 7665 5f76 2c20 726f 6f74 3d30 290a 2020  ve_v, root=0).  
-0000f0d0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000f0e0: 6376 5f6c 696b 6573 203d 2073 656c 662e  cv_likes = self.
-0000f0f0: 636f 6d6d 2e67 6174 6865 7228 6163 7469  comm.gather(acti
-0000f100: 7665 5f6c 6f67 6c2c 2072 6f6f 743d 3029  ve_logl, root=0)
-0000f110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f120: 2072 6563 765f 7361 6d70 6c65 7320 3d20   recv_samples = 
-0000f130: 7365 6c66 2e63 6f6d 6d2e 6263 6173 7428  self.comm.bcast(
-0000f140: 7265 6376 5f73 616d 706c 6573 2c20 726f  recv_samples, ro
-0000f150: 6f74 3d30 290a 2020 2020 2020 2020 2020  ot=0).          
-0000f160: 2020 2020 2020 7265 6376 5f73 616d 706c        recv_sampl
-0000f170: 6573 7620 3d20 7365 6c66 2e63 6f6d 6d2e  esv = self.comm.
-0000f180: 6263 6173 7428 7265 6376 5f73 616d 706c  bcast(recv_sampl
-0000f190: 6573 762c 2072 6f6f 743d 3029 0a20 2020  esv, root=0).   
-0000f1a0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-0000f1b0: 765f 6c69 6b65 7320 3d20 7365 6c66 2e63  v_likes = self.c
-0000f1c0: 6f6d 6d2e 6263 6173 7428 7265 6376 5f6c  omm.bcast(recv_l
-0000f1d0: 696b 6573 2c20 726f 6f74 3d30 290a 0a20  ikes, root=0).. 
-0000f1e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000f1f0: 6374 6976 655f 7520 3d20 6e70 2e63 6f6e  ctive_u = np.con
-0000f200: 6361 7465 6e61 7465 2872 6563 765f 7361  catenate(recv_sa
-0000f210: 6d70 6c65 732c 2061 7869 733d 3029 0a20  mples, axis=0). 
-0000f220: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000f230: 6374 6976 655f 7620 3d20 6e70 2e63 6f6e  ctive_v = np.con
-0000f240: 6361 7465 6e61 7465 2872 6563 765f 7361  catenate(recv_sa
-0000f250: 6d70 6c65 7376 2c20 6178 6973 3d30 290a  mplesv, axis=0).
-0000f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f270: 6163 7469 7665 5f6c 6f67 6c20 3d20 6e70  active_logl = np
-0000f280: 2e63 6f6e 6361 7465 6e61 7465 2872 6563  .concatenate(rec
-0000f290: 765f 6c69 6b65 732c 2061 7869 733d 3029  v_likes, axis=0)
-0000f2a0: 0a0a 2020 2020 2020 2020 2020 2020 6173  ..            as
-0000f2b0: 7365 7274 2061 6374 6976 655f 6c6f 676c  sert active_logl
-0000f2c0: 2e73 6861 7065 203d 3d20 286e 756d 5f6c  .shape == (num_l
-0000f2d0: 6976 655f 706f 696e 7473 5f6d 6973 7369  ive_points_missi
-0000f2e0: 6e67 2c29 2c20 2861 6374 6976 655f 6c6f  ng,), (active_lo
-0000f2f0: 676c 2e73 6861 7065 2c20 6e75 6d5f 6c69  gl.shape, num_li
-0000f300: 7665 5f70 6f69 6e74 735f 6d69 7373 696e  ve_points_missin
-0000f310: 6729 0a0a 2020 2020 2020 2020 2020 2020  g)..            
-0000f320: 6966 2073 656c 662e 6c6f 675f 746f 5f70  if self.log_to_p
-0000f330: 6f69 6e74 7374 6f72 653a 0a20 2020 2020  ointstore:.     
-0000f340: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0000f350: 2069 6e20 7261 6e67 6528 6e75 6d5f 6c69   in range(num_li
-0000f360: 7665 5f70 6f69 6e74 735f 6d69 7373 696e  ve_points_missin
-0000f370: 6729 3a0a 2020 2020 2020 2020 2020 2020  g):.            
-0000f380: 2020 2020 2020 2020 726f 7769 6420 3d20          rowid = 
-0000f390: 7365 6c66 2e70 6f69 6e74 7374 6f72 652e  self.pointstore.
-0000f3a0: 6164 6428 5f6c 6973 7469 6679 280a 2020  add(_listify(.  
-0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3c0: 2020 2020 2020 5b2d 6e70 2e69 6e66 2c20        [-np.inf, 
-0000f3d0: 6163 7469 7665 5f6c 6f67 6c5b 695d 2c20  active_logl[i], 
-0000f3e0: 302e 305d 2c0a 2020 2020 2020 2020 2020  0.0],.          
-0000f3f0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-0000f400: 7469 7665 5f75 5b69 2c3a 5d2c 0a20 2020  tive_u[i,:],.   
+00007b40: 2020 2020 2020 206e 6361 6c6c 202b 3d20         ncall += 
+00007b50: 6e63 0a0a 2020 2020 2020 2020 2020 2020  nc..            
+00007b60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00007b70: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
+00007b80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00007b90: 2075 692c 2076 692c 206c 6f67 6c69 2069   ui, vi, logli i
+00007ba0: 6e20 7a69 7028 7361 6d70 6c65 732c 2073  n zip(samples, s
+00007bb0: 616d 706c 6573 762c 206c 696b 6573 293a  amplesv, likes):
+00007bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007bd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00007be0: 662e 706f 696e 7473 746f 7265 2e61 6464  f.pointstore.add
+00007bf0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00007c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c10: 2020 5f6c 6973 7469 6679 285b 6c6f 676c    _listify([logl
+00007c20: 7374 6172 2c20 6c6f 676c 692c 2030 2e30  star, logli, 0.0
+00007c30: 5d2c 2075 692c 2076 6929 2c0a 2020 2020  ], ui, vi),.    
+00007c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c50: 2020 2020 2020 2020 2020 2020 6e63 616c              ncal
+00007c60: 6c29 0a0a 2020 2020 2020 2020 2020 2020  l)..            
+00007c70: 2020 2020 6966 206c 696b 6573 5b69 625d      if likes[ib]
+00007c80: 203e 206c 6f67 6c73 7461 723a 0a20 2020   > loglstar:.   
+00007c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ca0: 2061 6374 6976 655f 755b 776f 7273 745d   active_u[worst]
+00007cb0: 203d 2073 616d 706c 6573 5b69 622c 203a   = samples[ib, :
+00007cc0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00007cd0: 2020 2020 2020 6163 7469 7665 5f76 5b77        active_v[w
+00007ce0: 6f72 7374 5d20 3d20 7361 6d70 6c65 7376  orst] = samplesv
+00007cf0: 5b69 622c 3a5d 0a20 2020 2020 2020 2020  [ib,:].         
+00007d00: 2020 2020 2020 2020 2020 2061 6374 6976             activ
+00007d10: 655f 6c6f 676c 5b77 6f72 7374 5d20 3d20  e_logl[worst] = 
+00007d20: 6c69 6b65 735b 6962 5d0a 0a20 2020 2020  likes[ib]..     
+00007d30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00007d40: 2069 6620 7765 206b 6565 7020 7468 6520   if we keep the 
+00007d50: 7265 6769 6f6e 2069 6e66 6f72 6d65 6420  region informed 
+00007d60: 6162 6f75 7420 7468 6520 6e65 7720 6c69  about the new li
+00007d70: 7665 2070 6f69 6e74 730a 2020 2020 2020  ve points.      
+00007d80: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00007d90: 7468 656e 2074 6865 2072 6567 696f 6e20  then the region 
+00007da0: 666f 6c6c 6f77 7320 7468 6520 6c69 7665  follows the live
+00007db0: 2070 6f69 6e74 7320 6576 656e 2069 6620   points even if 
+00007dc0: 6d61 7872 6164 6975 7320 6973 206e 6f74  maxradius is not
+00007dd0: 2075 7064 6174 6564 0a20 2020 2020 2020   updated.       
+00007de0: 2020 2020 2020 2020 2020 2020 2072 6567               reg
+00007df0: 696f 6e2e 755b 776f 7273 742c 3a5d 203d  ion.u[worst,:] =
+00007e00: 2061 6374 6976 655f 755b 776f 7273 745d   active_u[worst]
+00007e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007e20: 2020 2020 2072 6567 696f 6e2e 756e 6f72       region.unor
+00007e30: 6d65 645b 776f 7273 742c 3a5d 203d 2072  med[worst,:] = r
+00007e40: 6567 696f 6e2e 7472 616e 7366 6f72 6d4c  egion.transformL
+00007e50: 6179 6572 2e74 7261 6e73 666f 726d 2872  ayer.transform(r
+00007e60: 6567 696f 6e2e 755b 776f 7273 742c 3a5d  egion.u[worst,:]
+00007e70: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00007e80: 2020 2020 2020 2023 2069 6620 7765 2074         # if we t
+00007e90: 7261 636b 2074 6865 2063 6c75 7374 6572  rack the cluster
+00007ea0: 2061 7373 6967 6e6d 656e 742c 2074 6865   assignment, the
+00007eb0: 6e20 696e 2074 6865 206e 6578 7420 726f  n in the next ro
+00007ec0: 756e 640a 2020 2020 2020 2020 2020 2020  und.            
+00007ed0: 2020 2020 2020 2020 2320 7468 6520 6964          # the id
+00007ee0: 7320 7769 7468 2074 6865 2073 616d 6520  s with the same 
+00007ef0: 6d65 6d62 6572 7320 6172 6520 6c69 6b65  members are like
+00007f00: 6c79 2074 6f20 6861 7665 2074 6865 2073  ly to have the s
+00007f10: 616d 6520 6964 0a20 2020 2020 2020 2020  ame id.         
+00007f20: 2020 2020 2020 2020 2020 2023 2074 6869             # thi
+00007f30: 7320 6973 2069 6d70 6572 6665 6374 0a20  s is imperfect. 
+00007f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f50: 2020 2023 2074 7261 6e73 666f 726d 4c61     # transformLa
+00007f60: 7965 722e 636c 7573 7465 7269 6473 5b77  yer.clusterids[w
+00007f70: 6f72 7374 5d20 3d20 7472 616e 7366 6f72  orst] = transfor
+00007f80: 6d4c 6179 6572 2e63 6c75 7374 6572 6964  mLayer.clusterid
+00007f90: 735b 6661 7468 6572 5b69 625d 5d0a 2020  s[father[ib]].  
+00007fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007fb0: 2020 2320 736f 2077 6520 6a75 7374 206d    # so we just m
+00007fc0: 6172 6b20 7468 6520 7265 706c 6163 6564  ark the replaced
+00007fd0: 206f 6e65 7320 6173 2022 756e 6173 7369   ones as "unassi
+00007fe0: 676e 6564 220a 2020 2020 2020 2020 2020  gned".          
+00007ff0: 2020 2020 2020 2020 2020 7472 616e 7366            transf
+00008000: 6f72 6d4c 6179 6572 2e63 6c75 7374 6572  ormLayer.cluster
+00008010: 6964 735b 776f 7273 745d 203d 2030 0a20  ids[worst] = 0. 
+00008020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008030: 2020 2069 6220 3d20 6962 202b 2031 0a20     ib = ib + 1. 
+00008040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008050: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+00008060: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00008070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008080: 2020 2069 6220 3d20 6962 202b 2031 0a0a     ib = ib + 1..
+00008090: 2020 2020 2020 2020 2020 2020 2320 5368              # Sh
+000080a0: 7269 6e6b 2069 6e74 6572 7661 6c0a 2020  rink interval.  
+000080b0: 2020 2020 2020 2020 2020 6c6f 6776 6f6c            logvol
+000080c0: 202d 3d20 312e 3020 2f20 7365 6c66 2e6e   -= 1.0 / self.n
+000080d0: 756d 5f6c 6976 655f 706f 696e 7473 0a20  um_live_points. 
+000080e0: 2020 2020 2020 2020 2020 206c 6f67 7a5f             logz_
+000080f0: 7265 6d61 696e 203d 206e 702e 6d61 7828  remain = np.max(
+00008100: 6163 7469 7665 5f6c 6f67 6c29 202d 2069  active_logl) - i
+00008110: 7420 2f20 7365 6c66 2e6e 756d 5f6c 6976  t / self.num_liv
+00008120: 655f 706f 696e 7473 0a20 2020 2020 2020  e_points.       
+00008130: 2020 2020 2066 7261 6374 696f 6e5f 7265       fraction_re
+00008140: 6d61 696e 203d 206e 702e 6c6f 6761 6464  main = np.logadd
+00008150: 6578 7028 6c6f 677a 2c20 6c6f 677a 5f72  exp(logz, logz_r
+00008160: 656d 6169 6e29 202d 206c 6f67 7a0a 0a20  emain) - logz.. 
+00008170: 2020 2020 2020 2020 2020 2069 6620 6974             if it
+00008180: 2025 206c 6f67 5f69 6e74 6572 7661 6c20   % log_interval 
+00008190: 3d3d 2030 2061 6e64 2073 656c 662e 6c6f  == 0 and self.lo
+000081a0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+000081b0: 2020 2023 206e 6963 656c 6f67 6765 7228     # nicelogger(
+000081c0: 7365 6c66 2e70 6172 616d 6e61 6d65 732c  self.paramnames,
+000081d0: 2061 6374 6976 655f 752c 2061 6374 6976   active_u, activ
+000081e0: 655f 762c 2061 6374 6976 655f 6c6f 676c  e_v, active_logl
+000081f0: 2c20 6974 2c20 6e63 616c 6c2c 206c 6f67  , it, ncall, log
+00008200: 7a2c 206c 6f67 7a5f 7265 6d61 696e 2c20  z, logz_remain, 
+00008210: 7265 6769 6f6e 3d72 6567 696f 6e29 0a20  region=region). 
+00008220: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008230: 7973 2e73 7464 6f75 742e 7772 6974 6528  ys.stdout.write(
+00008240: 275a 3d25 2e31 672b 252e 3167 207c 204c  'Z=%.1g+%.1g | L
+00008250: 696b 653d 252e 3167 2e2e 252e 3167 207c  ike=%.1g..%.1g |
+00008260: 2069 742f 6576 616c 733d 2564 2f25 6420   it/evals=%d/%d 
+00008270: 6566 663d 252e 3466 2525 2020 5c72 2720  eff=%.4f%%  \r' 
+00008280: 2520 280a 2020 2020 2020 2020 2020 2020  % (.            
+00008290: 2020 2020 2020 2020 6c6f 677a 2c20 6c6f          logz, lo
+000082a0: 677a 5f72 656d 6169 6e2c 206c 6f67 6c73  gz_remain, logls
+000082b0: 7461 722c 206e 702e 6d61 7828 6163 7469  tar, np.max(acti
+000082c0: 7665 5f6c 6f67 6c29 2c20 6974 2c0a 2020  ve_logl), it,.  
+000082d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000082e0: 2020 6e63 616c 6c2c 206e 702e 696e 6620    ncall, np.inf 
+000082f0: 6966 206e 6361 6c6c 203d 3d20 3020 656c  if ncall == 0 el
+00008300: 7365 2069 7420 2a20 3130 3020 2f20 6e63  se it * 100 / nc
+00008310: 616c 6c29 290a 2020 2020 2020 2020 2020  all)).          
+00008320: 2020 2020 2020 7379 732e 7374 646f 7574        sys.stdout
+00008330: 2e66 6c75 7368 2829 0a0a 2020 2020 2020  .flush()..      
+00008340: 2020 2020 2020 2020 2020 2320 6966 2065            # if e
+00008350: 6666 6963 6965 6e63 7920 6265 636f 6d65  fficiency become
+00008360: 7320 6c6f 772c 2062 756c 6b2d 7072 6f63  s low, bulk-proc
+00008370: 6573 7320 6c61 7267 6572 2061 7272 6179  ess larger array
+00008380: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00008390: 2020 6e64 7261 7720 3d20 6d61 7828 3132    ndraw = max(12
+000083a0: 382c 206d 696e 2831 3633 3834 2c20 726f  8, min(16384, ro
+000083b0: 756e 6428 286e 6361 6c6c 202b 2031 2920  und((ncall + 1) 
+000083c0: 2f20 2869 7420 2b20 3129 202f 2073 656c  / (it + 1) / sel
+000083d0: 662e 6d70 695f 7369 7a65 2929 290a 0a20  f.mpi_size))).. 
+000083e0: 2020 2020 2020 2020 2020 2023 2053 746f             # Sto
+000083f0: 7070 696e 6720 6372 6974 6572 696f 6e0a  pping criterion.
+00008400: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00008410: 7261 6374 696f 6e5f 7265 6d61 696e 203c  raction_remain <
+00008420: 2064 6c6f 677a 3a0a 2020 2020 2020 2020   dlogz:.        
+00008430: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00008440: 2020 2020 2020 2020 2020 6974 203d 2069            it = i
+00008450: 7420 2b20 310a 0a20 2020 2020 2020 206c  t + 1..        l
+00008460: 6f67 766f 6c20 3d20 2d6c 656e 2873 6176  ogvol = -len(sav
+00008470: 6564 5f76 2920 2f20 7365 6c66 2e6e 756d  ed_v) / self.num
+00008480: 5f6c 6976 655f 706f 696e 7473 202d 206c  _live_points - l
+00008490: 6f67 2873 656c 662e 6e75 6d5f 6c69 7665  og(self.num_live
+000084a0: 5f70 6f69 6e74 7329 0a20 2020 2020 2020  _points).       
+000084b0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+000084c0: 7365 6c66 2e6e 756d 5f6c 6976 655f 706f  self.num_live_po
+000084d0: 696e 7473 293a 0a20 2020 2020 2020 2020  ints):.         
+000084e0: 2020 206c 6f67 7774 203d 206c 6f67 766f     logwt = logvo
+000084f0: 6c20 2b20 6163 7469 7665 5f6c 6f67 6c5b  l + active_logl[
+00008500: 695d 0a20 2020 2020 2020 2020 2020 206c  i].            l
+00008510: 6f67 7a5f 6e65 7720 3d20 6e70 2e6c 6f67  ogz_new = np.log
+00008520: 6164 6465 7870 286c 6f67 7a2c 206c 6f67  addexp(logz, log
+00008530: 7774 290a 2020 2020 2020 2020 2020 2020  wt).            
+00008540: 6820 3d20 2865 7870 286c 6f67 7774 202d  h = (exp(logwt -
+00008550: 206c 6f67 7a5f 6e65 7729 202a 2061 6374   logz_new) * act
+00008560: 6976 655f 6c6f 676c 5b69 5d20 2b20 6578  ive_logl[i] + ex
+00008570: 7028 6c6f 677a 202d 206c 6f67 7a5f 6e65  p(logz - logz_ne
+00008580: 7729 202a 2028 6820 2b20 6c6f 677a 2920  w) * (h + logz) 
+00008590: 2d20 6c6f 677a 5f6e 6577 290a 2020 2020  - logz_new).    
+000085a0: 2020 2020 2020 2020 6c6f 677a 203d 206c          logz = l
+000085b0: 6f67 7a5f 6e65 770a 2020 2020 2020 2020  ogz_new.        
+000085c0: 2020 2020 7361 7665 645f 752e 6170 7065      saved_u.appe
+000085d0: 6e64 286e 702e 6172 7261 7928 6163 7469  nd(np.array(acti
+000085e0: 7665 5f75 5b69 5d29 290a 2020 2020 2020  ve_u[i])).      
+000085f0: 2020 2020 2020 7361 7665 645f 762e 6170        saved_v.ap
+00008600: 7065 6e64 286e 702e 6172 7261 7928 6163  pend(np.array(ac
+00008610: 7469 7665 5f76 5b69 5d29 290a 2020 2020  tive_v[i])).    
+00008620: 2020 2020 2020 2020 7361 7665 645f 6c6f          saved_lo
+00008630: 6777 742e 6170 7065 6e64 286c 6f67 7774  gwt.append(logwt
+00008640: 290a 2020 2020 2020 2020 2020 2020 7361  ).            sa
+00008650: 7665 645f 6c6f 676c 2e61 7070 656e 6428  ved_logl.append(
+00008660: 6163 7469 7665 5f6c 6f67 6c5b 695d 290a  active_logl[i]).
+00008670: 0a20 2020 2020 2020 2073 6176 6564 5f75  .        saved_u
+00008680: 203d 206e 702e 6172 7261 7928 7361 7665   = np.array(save
+00008690: 645f 7529 0a20 2020 2020 2020 2073 6176  d_u).        sav
+000086a0: 6564 5f76 203d 206e 702e 6172 7261 7928  ed_v = np.array(
+000086b0: 7361 7665 645f 7629 0a20 2020 2020 2020  saved_v).       
+000086c0: 2073 6176 6564 5f77 7420 3d20 6578 7028   saved_wt = exp(
+000086d0: 6e70 2e61 7272 6179 2873 6176 6564 5f6c  np.array(saved_l
+000086e0: 6f67 7774 2920 2d20 6c6f 677a 290a 2020  ogwt) - logz).  
+000086f0: 2020 2020 2020 7361 7665 645f 6c6f 676c        saved_logl
+00008700: 203d 206e 702e 6172 7261 7928 7361 7665   = np.array(save
+00008710: 645f 6c6f 676c 290a 2020 2020 2020 2020  d_logl).        
+00008720: 6c6f 677a 6572 7220 3d20 6e70 2e73 7172  logzerr = np.sqr
+00008730: 7428 6820 2f20 7365 6c66 2e6e 756d 5f6c  t(h / self.num_l
+00008740: 6976 655f 706f 696e 7473 290a 0a20 2020  ive_points)..   
+00008750: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
+00008760: 5f74 6f5f 6469 736b 3a0a 2020 2020 2020  _to_disk:.      
+00008770: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00008780: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
+00008790: 662e 6c6f 6773 5b27 7265 7375 6c74 7327  f.logs['results'
+000087a0: 5d2c 2027 6669 6e61 6c2e 6373 7627 292c  ], 'final.csv'),
+000087b0: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
+000087c0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+000087d0: 6572 203d 2063 7376 2e77 7269 7465 7228  er = csv.writer(
+000087e0: 6629 0a20 2020 2020 2020 2020 2020 2020  f).             
+000087f0: 2020 2077 7269 7465 722e 7772 6974 6572     writer.writer
+00008800: 6f77 285b 276e 6974 6572 272c 2027 6e63  ow(['niter', 'nc
+00008810: 616c 6c27 2c20 276c 6f67 7a27 2c20 276c  all', 'logz', 'l
+00008820: 6f67 7a65 7272 272c 2027 6827 5d29 0a20  ogzerr', 'h']). 
+00008830: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00008840: 7269 7465 722e 7772 6974 6572 6f77 285b  riter.writerow([
+00008850: 6974 202b 2031 2c20 6e63 616c 6c2c 206c  it + 1, ncall, l
+00008860: 6f67 7a2c 206c 6f67 7a65 7272 2c20 685d  ogz, logzerr, h]
+00008870: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00008880: 6c66 2e70 6f69 6e74 7374 6f72 652e 636c  lf.pointstore.cl
+00008890: 6f73 6528 290a 0a20 2020 2020 2020 2069  ose()..        i
+000088a0: 6620 6e6f 7420 7365 6c66 2e75 7365 5f6d  f not self.use_m
+000088b0: 7069 206f 7220 7365 6c66 2e6d 7069 5f72  pi or self.mpi_r
+000088c0: 616e 6b20 3d3d 2030 3a0a 2020 2020 2020  ank == 0:.      
+000088d0: 2020 2020 2020 7072 696e 7428 290a 2020        print().  
+000088e0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000088f0: 226e 6974 6572 3a20 7b3a 647d 5c6e 206e  "niter: {:d}\n n
+00008900: 6361 6c6c 3a20 7b3a 647d 5c6e 206e 7361  call: {:d}\n nsa
+00008910: 6d70 6c65 733a 207b 3a64 7d5c 6e20 6c6f  mples: {:d}\n lo
+00008920: 677a 3a20 7b3a 362e 3366 7d20 2b2f 2d20  gz: {:6.3f} +/- 
+00008930: 7b3a 362e 3366 7d5c 6e20 683a 207b 3a36  {:6.3f}\n h: {:6
+00008940: 2e33 667d 220a 2020 2020 2020 2020 2020  .3f}".          
+00008950: 2020 2020 2020 2020 2e66 6f72 6d61 7428          .format(
+00008960: 6974 202b 2031 2c20 6e63 616c 6c2c 206c  it + 1, ncall, l
+00008970: 656e 2873 6176 6564 5f76 292c 206c 6f67  en(saved_v), log
+00008980: 7a2c 206c 6f67 7a65 7272 2c20 6829 290a  z, logzerr, h)).
+00008990: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+000089a0: 7375 6c74 7320 3d20 6469 6374 280a 2020  sults = dict(.  
+000089b0: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+000089c0: 733d 7265 7361 6d70 6c65 5f65 7175 616c  s=resample_equal
+000089d0: 2873 6176 6564 5f76 2c20 7361 7665 645f  (saved_v, saved_
+000089e0: 7774 202f 2073 6176 6564 5f77 742e 7375  wt / saved_wt.su
+000089f0: 6d28 2929 2c0a 2020 2020 2020 2020 2020  m()),.          
+00008a00: 2020 6e63 616c 6c3d 6e63 616c 6c2c 206e    ncall=ncall, n
+00008a10: 6974 6572 3d69 742c 206c 6f67 7a3d 6c6f  iter=it, logz=lo
+00008a20: 677a 2c20 6c6f 677a 6572 723d 6c6f 677a  gz, logzerr=logz
+00008a30: 6572 722c 0a20 2020 2020 2020 2020 2020  err,.           
+00008a40: 2077 6569 6768 7465 645f 7361 6d70 6c65   weighted_sample
+00008a50: 733d 6469 6374 280a 2020 2020 2020 2020  s=dict(.        
+00008a60: 2020 2020 2020 2020 7570 6f69 6e74 733d          upoints=
+00008a70: 7361 7665 645f 752c 2070 6f69 6e74 733d  saved_u, points=
+00008a80: 7361 7665 645f 762c 2077 6569 6768 7473  saved_v, weights
+00008a90: 3d73 6176 6564 5f77 742c 0a20 2020 2020  =saved_wt,.     
+00008aa0: 2020 2020 2020 2020 2020 206c 6f67 7765             logwe
+00008ab0: 6967 6874 733d 7361 7665 645f 6c6f 6777  ights=saved_logw
+00008ac0: 742c 206c 6f67 6c3d 7361 7665 645f 6c6f  t, logl=saved_lo
+00008ad0: 676c 292c 0a20 2020 2020 2020 2029 0a0a  gl),.        )..
+00008ae0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00008af0: 656c 662e 7265 7375 6c74 730a 0a20 2020  elf.results..   
+00008b00: 2064 6566 2070 7269 6e74 5f72 6573 756c   def print_resul
+00008b10: 7473 2873 656c 6629 3a0a 2020 2020 2020  ts(self):.      
+00008b20: 2020 2222 2247 6976 6520 7375 6d6d 6172    """Give summar
+00008b30: 7920 6f66 206d 6172 6769 6e61 6c20 6c69  y of marginal li
+00008b40: 6b65 6c69 686f 6f64 2061 6e64 2070 6172  kelihood and par
+00008b50: 616d 6574 6572 732e 2222 220a 2020 2020  ameters.""".    
+00008b60: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
+00008b70: 2020 2020 7072 696e 7428 276c 6f67 5a20      print('logZ 
+00008b80: 3d20 2528 6c6f 677a 292e 3366 202b 2d20  = %(logz).3f +- 
+00008b90: 2528 6c6f 677a 6572 7229 2e33 6627 2025  %(logzerr).3f' %
+00008ba0: 2073 656c 662e 7265 7375 6c74 7329 0a0a   self.results)..
+00008bb0: 2020 2020 2020 2020 7072 696e 7428 290a          print().
+00008bc0: 2020 2020 2020 2020 666f 7220 692c 2070          for i, p
+00008bd0: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
+00008be0: 6c66 2e70 6172 616d 6e61 6d65 7320 2b20  lf.paramnames + 
+00008bf0: 7365 6c66 2e64 6572 6976 6564 7061 7261  self.derivedpara
+00008c00: 6d6e 616d 6573 293a 0a20 2020 2020 2020  mnames):.       
+00008c10: 2020 2020 2076 203d 2073 656c 662e 7265       v = self.re
+00008c20: 7375 6c74 735b 2773 616d 706c 6573 275d  sults['samples']
+00008c30: 5b3a 2c69 5d0a 2020 2020 2020 2020 2020  [:,i].          
+00008c40: 2020 7369 676d 6120 3d20 762e 7374 6428    sigma = v.std(
+00008c50: 290a 2020 2020 2020 2020 2020 2020 6d65  ).            me
+00008c60: 6420 3d20 762e 6d65 616e 2829 0a20 2020  d = v.mean().   
+00008c70: 2020 2020 2020 2020 2069 6620 7369 676d           if sigm
+00008c80: 6120 3d3d 2030 3a0a 2020 2020 2020 2020  a == 0:.        
+00008c90: 2020 2020 2020 2020 6920 3d20 330a 2020          i = 3.  
+00008ca0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00008cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008cc0: 6920 3d20 6d61 7828 302c 2069 6e74 282d  i = max(0, int(-
+00008cd0: 6e70 2e66 6c6f 6f72 286e 702e 6c6f 6731  np.floor(np.log1
+00008ce0: 3028 7369 676d 6129 2929 202b 2031 290a  0(sigma))) + 1).
+00008cf0: 2020 2020 2020 2020 2020 2020 666d 7420              fmt 
+00008d00: 3d20 2725 252e 2564 6627 2025 2069 0a20  = '%%.%df' % i. 
+00008d10: 2020 2020 2020 2020 2020 2066 6d74 7320             fmts 
+00008d20: 3d20 275c 7427 2e6a 6f69 6e28 5b27 2020  = '\t'.join(['  
+00008d30: 2020 252d 3230 7327 202b 2066 6d74 202b    %-20s' + fmt +
+00008d40: 2022 202b 2d20 2220 2b20 666d 745d 290a   " +- " + fmt]).
+00008d50: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00008d60: 7428 666d 7473 2025 2028 702c 206d 6564  t(fmts % (p, med
+00008d70: 2c20 7369 676d 6129 290a 0a20 2020 2064  , sigma))..    d
+00008d80: 6566 2070 6c6f 7428 7365 6c66 293a 0a20  ef plot(self):. 
+00008d90: 2020 2020 2020 2022 2222 4d61 6b65 2063         """Make c
+00008da0: 6f72 6e65 7220 706c 6f74 2e22 2222 0a20  orner plot.""". 
+00008db0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
+00008dc0: 6f67 5f74 6f5f 6469 736b 3a0a 2020 2020  og_to_disk:.    
+00008dd0: 2020 2020 2020 2020 696d 706f 7274 206d          import m
+00008de0: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
+00008df0: 2061 7320 706c 740a 2020 2020 2020 2020   as plt.        
+00008e00: 2020 2020 696d 706f 7274 2063 6f72 6e65      import corne
+00008e10: 720a 2020 2020 2020 2020 2020 2020 6461  r.            da
+00008e20: 7461 203d 206e 702e 6172 7261 7928 7365  ta = np.array(se
+00008e30: 6c66 2e72 6573 756c 7473 5b27 7765 6967  lf.results['weig
+00008e40: 6874 6564 5f73 616d 706c 6573 275d 5b27  hted_samples']['
+00008e50: 706f 696e 7473 275d 290a 2020 2020 2020  points']).      
+00008e60: 2020 2020 2020 7765 6967 6874 7320 3d20        weights = 
+00008e70: 6e70 2e61 7272 6179 2873 656c 662e 7265  np.array(self.re
+00008e80: 7375 6c74 735b 2777 6569 6768 7465 645f  sults['weighted_
+00008e90: 7361 6d70 6c65 7327 5d5b 2777 6569 6768  samples']['weigh
+00008ea0: 7473 275d 290a 2020 2020 2020 2020 2020  ts']).          
+00008eb0: 2020 6375 6d73 756d 7765 6967 6874 7320    cumsumweights 
+00008ec0: 3d20 6e70 2e63 756d 7375 6d28 7765 6967  = np.cumsum(weig
+00008ed0: 6874 7329 0a0a 2020 2020 2020 2020 2020  hts)..          
+00008ee0: 2020 6d61 736b 203d 2063 756d 7375 6d77    mask = cumsumw
+00008ef0: 6569 6768 7473 203e 2031 652d 340a 0a20  eights > 1e-4.. 
+00008f00: 2020 2020 2020 2020 2020 2063 6f72 6e65             corne
+00008f10: 722e 636f 726e 6572 280a 2020 2020 2020  r.corner(.      
+00008f20: 2020 2020 2020 2020 2020 6461 7461 5b6d            data[m
+00008f30: 6173 6b2c 3a5d 2c20 7765 6967 6874 733d  ask,:], weights=
+00008f40: 7765 6967 6874 735b 6d61 736b 5d2c 0a20  weights[mask],. 
+00008f50: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00008f60: 6162 656c 733d 7365 6c66 2e70 6172 616d  abels=self.param
+00008f70: 6e61 6d65 7320 2b20 7365 6c66 2e64 6572  names + self.der
+00008f80: 6976 6564 7061 7261 6d6e 616d 6573 2c0a  ivedparamnames,.
+00008f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fa0: 7368 6f77 5f74 6974 6c65 733d 5472 7565  show_titles=True
+00008fb0: 290a 2020 2020 2020 2020 2020 2020 706c  ).            pl
+00008fc0: 742e 7361 7665 6669 6728 6f73 2e70 6174  t.savefig(os.pat
+00008fd0: 682e 6a6f 696e 2873 656c 662e 6c6f 6773  h.join(self.logs
+00008fe0: 5b27 706c 6f74 7327 5d2c 2027 636f 726e  ['plots'], 'corn
+00008ff0: 6572 2e70 6466 2729 2c20 6262 6f78 5f69  er.pdf'), bbox_i
+00009000: 6e63 6865 733d 2774 6967 6874 2729 0a20  nches='tight'). 
+00009010: 2020 2020 2020 2020 2020 2070 6c74 2e63             plt.c
+00009020: 6c6f 7365 2829 0a0a 0a64 6566 2077 6172  lose()...def war
+00009030: 6d73 7461 7274 5f66 726f 6d5f 7369 6d69  mstart_from_simi
+00009040: 6c61 725f 6669 6c65 280a 2020 2020 7573  lar_file(.    us
+00009050: 616d 706c 655f 6669 6c65 6e61 6d65 2c0a  ample_filename,.
+00009060: 2020 2020 7061 7261 6d5f 6e61 6d65 732c      param_names,
+00009070: 0a20 2020 206c 6f67 6c69 6b65 2c0a 2020  .    loglike,.  
+00009080: 2020 7472 616e 7366 6f72 6d2c 0a20 2020    transform,.   
+00009090: 2076 6563 746f 7269 7a65 643d 4661 6c73   vectorized=Fals
+000090a0: 652c 0a20 2020 206d 696e 5f6e 756d 5f73  e,.    min_num_s
+000090b0: 616d 706c 6573 3d35 300a 293a 0a20 2020  amples=50.):.   
+000090c0: 2022 2222 5761 726d 7374 6172 7420 6672   """Warmstart fr
+000090d0: 6f6d 2061 2070 7265 7669 6f75 7320 7275  om a previous ru
+000090e0: 6e2e 0a0a 2020 2020 5573 6167 653a 3a0a  n...    Usage::.
+000090f0: 0a20 2020 2020 2020 2061 7578 5f70 6172  .        aux_par
+00009100: 616d 6e61 6d65 732c 2061 7578 5f6c 6f67  amnames, aux_log
+00009110: 5f6c 696b 656c 6968 6f6f 642c 2061 7578  _likelihood, aux
+00009120: 5f70 7269 6f72 5f74 7261 6e73 666f 726d  _prior_transform
+00009130: 2c20 7665 6374 6f72 697a 6564 203d 2077  , vectorized = w
+00009140: 6172 6d73 7461 7274 5f66 726f 6d5f 7369  armstart_from_si
+00009150: 6d69 6c61 725f 6669 6c65 280a 2020 2020  milar_file(.    
+00009160: 2020 2020 2020 2020 276d 6f64 656c 312f          'model1/
+00009170: 6368 6169 6e73 2f77 6569 6768 7465 645f  chains/weighted_
+00009180: 706f 7374 5f75 6e74 7261 6e73 666f 726d  post_untransform
+00009190: 6564 2e74 7874 272c 2070 6172 616d 6574  ed.txt', paramet
+000091a0: 6572 732c 206c 6f67 5f6c 696b 656c 6968  ers, log_likelih
+000091b0: 6f6f 645f 7769 7468 5f62 6163 6b67 726f  ood_with_backgro
+000091c0: 756e 642c 2070 7269 6f72 5f74 7261 6e73  und, prior_trans
+000091d0: 666f 726d 290a 0a20 2020 2020 2020 2061  form)..        a
+000091e0: 7578 5f73 616d 706c 6572 203d 2052 6561  ux_sampler = Rea
+000091f0: 6374 6976 654e 6573 7465 6453 616d 706c  ctiveNestedSampl
+00009200: 6572 2861 7578 5f70 6172 616d 6e61 6d65  er(aux_paramname
+00009210: 732c 2061 7578 5f6c 6f67 5f6c 696b 656c  s, aux_log_likel
+00009220: 6968 6f6f 642c 2074 7261 6e73 666f 726d  ihood, transform
+00009230: 3d61 7578 5f70 7269 6f72 5f74 7261 6e73  =aux_prior_trans
+00009240: 666f 726d 2c76 6563 746f 7269 7a65 643d  form,vectorized=
+00009250: 7665 6374 6f72 697a 6564 290a 2020 2020  vectorized).    
+00009260: 2020 2020 6175 785f 7361 6d70 6c65 722e      aux_sampler.
+00009270: 7275 6e28 290a 2020 2020 2020 2020 706f  run().        po
+00009280: 7374 6572 696f 725f 7361 6d70 6c65 7320  sterior_samples 
+00009290: 3d20 6175 785f 7265 7375 6c74 735b 2773  = aux_results['s
+000092a0: 616d 706c 6573 275d 5b3a 2c2d 315d 0a0a  amples'][:,-1]..
+000092b0: 2020 2020 5365 6520 3a70 793a 6675 6e63      See :py:func
+000092c0: 3a60 756c 7472 616e 6573 742e 686f 7473  :`ultranest.hots
+000092d0: 7461 7274 2e67 6574 5f61 7578 696c 6961  tart.get_auxilia
+000092e0: 7279 5f63 6f6e 7462 6f78 5f70 6172 616d  ry_contbox_param
+000092f0: 6574 6572 697a 6174 696f 6e60 0a20 2020  eterization`.   
+00009300: 2066 6f72 206d 6f72 6520 696e 666f 726d   for more inform
+00009310: 6174 696f 6e2e 0a0a 2020 2020 5468 6520  ation...    The 
+00009320: 7265 6d61 696e 696e 6720 7061 7261 6d65  remaining parame
+00009330: 7465 7273 2068 6176 6520 7468 6520 7361  ters have the sa
+00009340: 6d65 206d 6561 6e69 6e67 2061 7320 696e  me meaning as in
+00009350: 203a 7079 3a63 6c61 7373 3a60 5265 6163   :py:class:`Reac
+00009360: 7469 7665 4e65 7374 6564 5361 6d70 6c65  tiveNestedSample
+00009370: 7260 2e0a 0a20 2020 2050 6172 616d 6574  r`...    Paramet
+00009380: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+00009390: 2d2d 2d2d 0a20 2020 2075 7361 6d70 6c65  ----.    usample
+000093a0: 5f66 696c 656e 616d 653a 2073 7472 0a20  _filename: str. 
+000093b0: 2020 2020 2020 2027 6469 7265 6374 6f72         'director
+000093c0: 792f 6368 6169 6e73 2f77 6569 6768 7465  y/chains/weighte
+000093d0: 645f 706f 7374 5f75 6e74 7261 6e73 666f  d_post_untransfo
+000093e0: 726d 6564 2e74 7874 270a 2020 2020 2020  rmed.txt'.      
+000093f0: 2020 636f 6e74 6169 6e73 2070 6f73 7465    contains poste
+00009400: 7269 6f72 7320 696e 2075 2d73 7061 6365  riors in u-space
+00009410: 2028 756e 7472 616e 7366 6f72 6d65 6429   (untransformed)
+00009420: 206f 6620 6120 7072 6576 696f 7573 2072   of a previous r
+00009430: 756e 2e0a 2020 2020 2020 2020 436f 6c75  un..        Colu
+00009440: 6d6e 7320 6172 6520 7765 6967 6874 2c20  mns are weight, 
+00009450: 6c6f 676c 2c20 7061 7261 6d31 2c20 7061  logl, param1, pa
+00009460: 7261 6d32 2c20 2e2e 2e0a 2020 2020 6d69  ram2, ....    mi
+00009470: 6e5f 6e75 6d5f 7361 6d70 6c65 733a 2069  n_num_samples: i
+00009480: 6e74 0a20 2020 2020 2020 206d 696e 696d  nt.        minim
+00009490: 756d 206e 756d 6265 7220 6f66 2073 616d  um number of sam
+000094a0: 706c 6573 2069 6e20 7468 6520 7573 616d  ples in the usam
+000094b0: 706c 655f 6669 6c65 6e61 6d65 2066 696c  ple_filename fil
+000094c0: 6520 7265 7175 6972 6564 2e0a 2020 2020  e required..    
+000094d0: 2020 2020 546f 6f20 6665 7720 7361 6d70      Too few samp
+000094e0: 6c65 7320 7769 6c6c 2067 6976 6520 6120  les will give a 
+000094f0: 706f 6f72 2061 7070 726f 7869 6d61 7469  poor approximati
+00009500: 6f6e 2e0a 0a20 2020 204f 7468 6572 2050  on...    Other P
+00009510: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00009520: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a  ---------------.
+00009530: 2020 2020 7061 7261 6d5f 6e61 6d65 733a      param_names:
+00009540: 206c 6973 740a 2020 2020 6c6f 676c 696b   list.    loglik
+00009550: 653a 2066 756e 6374 696f 6e0a 2020 2020  e: function.    
+00009560: 7472 616e 7366 6f72 6d3a 2066 756e 6374  transform: funct
+00009570: 696f 6e0a 2020 2020 7665 6374 6f72 697a  ion.    vectoriz
+00009580: 6564 3a20 626f 6f6c 0a0a 2020 2020 5265  ed: bool..    Re
+00009590: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+000095a0: 2d2d 2d0a 2020 2020 6175 785f 7061 7261  ---.    aux_para
+000095b0: 6d5f 6e61 6d65 733a 206c 6973 740a 2020  m_names: list.  
+000095c0: 2020 2020 2020 6e65 7720 7061 7261 6d65        new parame
+000095d0: 7465 7220 6c69 7374 0a20 2020 2061 7578  ter list.    aux
+000095e0: 5f6c 6f67 6c69 6b65 6c69 686f 6f64 3a20  _loglikelihood: 
+000095f0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
+00009600: 206e 6577 206c 6f67 6c69 6b65 6c69 686f   new loglikeliho
+00009610: 6f64 2066 756e 6374 696f 6e0a 2020 2020  od function.    
+00009620: 6175 785f 7472 616e 7366 6f72 6d3a 2066  aux_transform: f
+00009630: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
+00009640: 6e65 7720 7072 696f 7220 7472 616e 7366  new prior transf
+00009650: 6f72 6d20 6675 6e63 7469 6f6e 0a20 2020  orm function.   
+00009660: 2076 6563 746f 7269 7a65 643a 2062 6f6f   vectorized: boo
+00009670: 6c0a 2020 2020 2020 2020 7768 6574 6865  l.        whethe
+00009680: 7220 7468 6520 6e65 7720 6675 6e63 7469  r the new functi
+00009690: 6f6e 7320 6172 6520 7665 6374 6f72 697a  ons are vectoriz
+000096a0: 6564 0a20 2020 2022 2222 0a20 2020 2023  ed.    """.    #
+000096b0: 206c 6f61 6420 7361 6d70 6c65 730a 2020   load samples.  
+000096c0: 2020 7472 793a 0a20 2020 2020 2020 2077    try:.        w
+000096d0: 6974 6820 6f70 656e 2875 7361 6d70 6c65  ith open(usample
+000096e0: 5f66 696c 656e 616d 6529 2061 7320 663a  _filename) as f:
+000096f0: 0a20 2020 2020 2020 2020 2020 206f 6c64  .            old
+00009700: 5f70 6172 616d 5f6e 616d 6573 203d 2066  _param_names = f
+00009710: 2e72 6561 646c 696e 6528 292e 6c73 7472  .readline().lstr
+00009720: 6970 2827 2327 292e 7374 7269 7028 292e  ip('#').strip().
+00009730: 7370 6c69 7428 290a 2020 2020 2020 2020  split().        
+00009740: 2020 2020 6175 7869 6c69 6172 795f 7573      auxiliary_us
+00009750: 616d 706c 6573 203d 206e 702e 6c6f 6164  amples = np.load
+00009760: 7478 7428 6629 0a20 2020 2065 7863 6570  txt(f).    excep
+00009770: 7420 494f 4572 726f 723a 0a20 2020 2020  t IOError:.     
+00009780: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+00009790: 2827 6e6f 7420 686f 742d 7265 7375 6d69  ('not hot-resumi
+000097a0: 6e67 2c20 636f 756c 6420 6e6f 7420 6c6f  ng, could not lo
+000097b0: 6164 2066 696c 6520 2225 7322 2720 2520  ad file "%s"' % 
+000097c0: 7573 616d 706c 655f 6669 6c65 6e61 6d65  usample_filename
+000097d0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000097e0: 2070 6172 616d 5f6e 616d 6573 2c20 6c6f   param_names, lo
+000097f0: 676c 696b 652c 2074 7261 6e73 666f 726d  glike, transform
+00009800: 2c20 7665 6374 6f72 697a 6564 0a0a 2020  , vectorized..  
+00009810: 2020 756c 6f67 6c20 3d20 6175 7869 6c69    ulogl = auxili
+00009820: 6172 795f 7573 616d 706c 6573 5b3a 2c31  ary_usamples[:,1
+00009830: 5d0a 2020 2020 7577 6569 6768 7473 5f66  ].    uweights_f
+00009840: 756c 6c20 3d20 6175 7869 6c69 6172 795f  ull = auxiliary_
+00009850: 7573 616d 706c 6573 5b3a 2c30 5d20 2a20  usamples[:,0] * 
+00009860: 6e70 2e65 7870 2875 6c6f 676c 202d 2075  np.exp(ulogl - u
+00009870: 6c6f 676c 2e6d 6178 2829 290a 2020 2020  logl.max()).    
+00009880: 6d61 736b 203d 2075 7765 6967 6874 735f  mask = uweights_
+00009890: 6675 6c6c 203e 2030 0a20 2020 2075 7765  full > 0.    uwe
+000098a0: 6967 6874 7320 3d20 7577 6569 6768 7473  ights = uweights
+000098b0: 5f66 756c 6c5b 6d61 736b 5d0a 2020 2020  _full[mask].    
+000098c0: 7577 6569 6768 7473 202f 3d20 7577 6569  uweights /= uwei
+000098d0: 6768 7473 2e73 756d 2829 0a20 2020 2075  ghts.sum().    u
+000098e0: 706f 696e 7473 203d 2061 7578 696c 6961  points = auxilia
+000098f0: 7279 5f75 7361 6d70 6c65 735b 6d61 736b  ry_usamples[mask
+00009900: 2c32 3a5d 0a20 2020 2064 656c 2061 7578  ,2:].    del aux
+00009910: 696c 6961 7279 5f75 7361 6d70 6c65 730a  iliary_usamples.
+00009920: 0a20 2020 206e 7361 6d70 6c65 7320 3d20  .    nsamples = 
+00009930: 6c65 6e28 7570 6f69 6e74 7329 0a20 2020  len(upoints).   
+00009940: 2069 6620 6e73 616d 706c 6573 203c 206d   if nsamples < m
+00009950: 696e 5f6e 756d 5f73 616d 706c 6573 3a0a  in_num_samples:.
+00009960: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00009970: 6c75 6545 7272 6f72 2827 6669 6c65 2022  lueError('file "
+00009980: 2573 2220 6861 7320 746f 6f20 6665 7720  %s" has too few 
+00009990: 7361 6d70 6c65 7320 2825 6429 2074 6f20  samples (%d) to 
+000099a0: 686f 742d 7265 7375 6d65 2720 2520 2875  hot-resume' % (u
+000099b0: 7361 6d70 6c65 5f66 696c 656e 616d 652c  sample_filename,
+000099c0: 206e 7361 6d70 6c65 7329 290a 0a20 2020   nsamples))..   
+000099d0: 2023 2063 6865 636b 2074 6861 7420 7468   # check that th
+000099e0: 6520 7061 7261 6d65 7465 7220 6d65 616e  e parameter mean
+000099f0: 696e 6773 2068 6176 6520 6e6f 7420 6368  ings have not ch
+00009a00: 616e 6765 640a 2020 2020 6966 206f 6c64  anged.    if old
+00009a10: 5f70 6172 616d 5f6e 616d 6573 2021 3d20  _param_names != 
+00009a20: 5b27 7765 6967 6874 272c 2027 6c6f 676c  ['weight', 'logl
+00009a30: 275d 202b 2070 6172 616d 5f6e 616d 6573  '] + param_names
+00009a40: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00009a50: 5661 6c75 6545 7272 6f72 2827 6669 6c65  ValueError('file
+00009a60: 2022 2573 2220 6861 7320 7061 7261 6d65   "%s" has parame
+00009a70: 7465 7273 2025 732c 2065 7870 6563 7465  ters %s, expecte
+00009a80: 6420 2573 2c20 6361 6e6e 6f74 2068 6f74  d %s, cannot hot
+00009a90: 2d72 6573 756d 652e 2720 2520 2875 7361  -resume.' % (usa
+00009aa0: 6d70 6c65 5f66 696c 656e 616d 652c 206f  mple_filename, o
+00009ab0: 6c64 5f70 6172 616d 5f6e 616d 6573 2c20  ld_param_names, 
+00009ac0: 7061 7261 6d5f 6e61 6d65 7329 290a 0a20  param_names)).. 
+00009ad0: 2020 2072 6574 7572 6e20 6765 745f 6175     return get_au
+00009ae0: 7869 6c69 6172 795f 636f 6e74 626f 785f  xiliary_contbox_
+00009af0: 7061 7261 6d65 7465 7269 7a61 7469 6f6e  parameterization
+00009b00: 280a 2020 2020 2020 2020 7061 7261 6d5f  (.        param_
+00009b10: 6e61 6d65 732c 206c 6f67 6c69 6b65 3d6c  names, loglike=l
+00009b20: 6f67 6c69 6b65 2c20 7472 616e 7366 6f72  oglike, transfor
+00009b30: 6d3d 7472 616e 7366 6f72 6d2c 0a20 2020  m=transform,.   
+00009b40: 2020 2020 2076 6563 746f 7269 7a65 643d       vectorized=
+00009b50: 7665 6374 6f72 697a 6564 2c0a 2020 2020  vectorized,.    
+00009b60: 2020 2020 7570 6f69 6e74 733d 7570 6f69      upoints=upoi
+00009b70: 6e74 732c 0a20 2020 2020 2020 2075 7765  nts,.        uwe
+00009b80: 6967 6874 733d 7577 6569 6768 7473 2c0a  ights=uweights,.
+00009b90: 2020 2020 290a 0a0a 636c 6173 7320 5265      )...class Re
+00009ba0: 6163 7469 7665 4e65 7374 6564 5361 6d70  activeNestedSamp
+00009bb0: 6c65 7228 6f62 6a65 6374 293a 0a20 2020  ler(object):.   
+00009bc0: 2022 2222 4e65 7374 6564 2073 616d 706c   """Nested sampl
+00009bd0: 6572 2077 6974 6820 7265 6163 7469 7665  er with reactive
+00009be0: 2065 7870 6c6f 7261 7469 6f6e 2073 7472   exploration str
+00009bf0: 6174 6567 792e 0a0a 2020 2020 5374 6f72  ategy...    Stor
+00009c00: 6167 6520 2620 7265 7375 6d65 2063 6170  age & resume cap
+00009c10: 6162 6c65 2c20 6f70 7469 6f6e 616c 6c79  able, optionally
+00009c20: 204d 5049 2070 6172 616c 6c65 6c69 7365   MPI parallelise
+00009c30: 642e 0a20 2020 2022 2222 0a0a 2020 2020  d..    """..    
+00009c40: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00009c50: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+00009c60: 2020 2020 7061 7261 6d5f 6e61 6d65 732c      param_names,
+00009c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009c80: 2020 6c6f 676c 696b 652c 0a20 2020 2020    loglike,.     
+00009c90: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+00009ca0: 7366 6f72 6d3d 4e6f 6e65 2c0a 2020 2020  sform=None,.    
+00009cb0: 2020 2020 2020 2020 2020 2020 2064 6572               der
+00009cc0: 6976 6564 5f70 6172 616d 5f6e 616d 6573  ived_param_names
+00009cd0: 3d5b 5d2c 0a20 2020 2020 2020 2020 2020  =[],.           
+00009ce0: 2020 2020 2020 7772 6170 7065 645f 7061        wrapped_pa
+00009cf0: 7261 6d73 3d4e 6f6e 652c 0a20 2020 2020  rams=None,.     
+00009d00: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00009d10: 6d65 3d27 7375 6266 6f6c 6465 7227 2c0a  me='subfolder',.
+00009d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d30: 2072 756e 5f6e 756d 3d4e 6f6e 652c 0a20   run_num=None,. 
+00009d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d50: 6c6f 675f 6469 723d 4e6f 6e65 2c0a 2020  log_dir=None,.  
+00009d60: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00009d70: 756d 5f74 6573 745f 7361 6d70 6c65 733d  um_test_samples=
+00009d80: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+00009d90: 2020 2020 6472 6177 5f6d 756c 7469 706c      draw_multipl
+00009da0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+00009db0: 2020 2020 2020 2020 206e 756d 5f62 6f6f           num_boo
+00009dc0: 7473 7472 6170 733d 3330 2c0a 2020 2020  tstraps=30,.    
+00009dd0: 2020 2020 2020 2020 2020 2020 2076 6563               vec
+00009de0: 746f 7269 7a65 643d 4661 6c73 652c 0a20  torized=False,. 
+00009df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e00: 6e64 7261 775f 6d69 6e3d 3132 382c 0a20  ndraw_min=128,. 
+00009e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e20: 6e64 7261 775f 6d61 783d 3635 3533 362c  ndraw_max=65536,
+00009e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e40: 2020 7374 6f72 6167 655f 6261 636b 656e    storage_backen
+00009e50: 643d 2768 6466 3527 2c0a 2020 2020 2020  d='hdf5',.      
+00009e60: 2020 2020 2020 2020 2020 2077 6172 6d73             warms
+00009e70: 7461 7274 5f6d 6178 5f74 6175 3d2d 312c  tart_max_tau=-1,
+00009e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009e90: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00009ea0: 496e 6974 6961 6c69 7365 206e 6573 7465  Initialise neste
+00009eb0: 6420 7361 6d70 6c65 722e 0a0a 2020 2020  d sampler...    
+00009ec0: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+00009ed0: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+00009ee0: 2d2d 0a20 2020 2020 2020 2070 6172 616d  --.        param
+00009ef0: 5f6e 616d 6573 3a20 6c69 7374 206f 6620  _names: list of 
+00009f00: 7374 722c 206e 616d 6573 206f 6620 7468  str, names of th
+00009f10: 6520 7061 7261 6d65 7465 7273 2e0a 2020  e parameters..  
+00009f20: 2020 2020 2020 2020 2020 4c65 6e67 7468            Length
+00009f30: 2067 6976 6573 2064 696d 656e 7369 6f6e   gives dimension
+00009f40: 616c 6974 7920 6f66 2074 6865 2073 616d  ality of the sam
+00009f50: 706c 696e 6720 7072 6f62 6c65 6d2e 0a0a  pling problem...
+00009f60: 2020 2020 2020 2020 6c6f 676c 696b 653a          loglike:
+00009f70: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00009f80: 2020 2020 2020 6c6f 672d 6c69 6b65 6c69        log-likeli
+00009f90: 686f 6f64 2066 756e 6374 696f 6e2e 0a20  hood function.. 
+00009fa0: 2020 2020 2020 2020 2020 2052 6563 6569             Recei
+00009fb0: 7665 7320 6d75 6c74 6970 6c65 2070 6172  ves multiple par
+00009fc0: 616d 6574 6572 2076 6563 746f 7273 2c20  ameter vectors, 
+00009fd0: 7265 7475 726e 7320 7665 6374 6f72 206f  returns vector o
+00009fe0: 6620 6c69 6b65 6c69 686f 6f64 2e0a 2020  f likelihood..  
+00009ff0: 2020 2020 2020 7472 616e 7366 6f72 6d3a        transform:
+0000a000: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+0000a010: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
+0000a020: 7472 616e 7366 6f72 6d20 6672 6f6d 2075  transform from u
+0000a030: 6e69 7420 6375 6265 2074 6f20 7068 7973  nit cube to phys
+0000a040: 6963 616c 2070 6172 616d 6574 6572 732e  ical parameters.
+0000a050: 0a20 2020 2020 2020 2020 2020 2052 6563  .            Rec
+0000a060: 6569 7665 7320 6d75 6c74 6970 6c65 2063  eives multiple c
+0000a070: 7562 6520 7665 6374 6f72 732c 2072 6574  ube vectors, ret
+0000a080: 7572 6e73 206d 756c 7469 706c 6520 7061  urns multiple pa
+0000a090: 7261 6d65 7465 7220 7665 6374 6f72 732e  rameter vectors.
+0000a0a0: 0a0a 2020 2020 2020 2020 6465 7269 7665  ..        derive
+0000a0b0: 645f 7061 7261 6d5f 6e61 6d65 733a 206c  d_param_names: l
+0000a0c0: 6973 7420 6f66 2073 7472 0a20 2020 2020  ist of str.     
+0000a0d0: 2020 2020 2020 2041 6464 6974 696f 6e61         Additiona
+0000a0e0: 6c20 6465 7269 7665 6420 7061 7261 6d65  l derived parame
+0000a0f0: 7465 7273 2063 7265 6174 6564 2062 7920  ters created by 
+0000a100: 7472 616e 7366 6f72 6d2e 2028 656d 7074  transform. (empt
+0000a110: 7920 6279 2064 6566 6175 6c74 290a 0a20  y by default).. 
+0000a120: 2020 2020 2020 206c 6f67 5f64 6972 3a20         log_dir: 
+0000a130: 7374 720a 2020 2020 2020 2020 2020 2020  str.            
+0000a140: 7768 6572 6520 746f 2073 746f 7265 206f  where to store o
+0000a150: 7574 7075 7420 6669 6c65 730a 2020 2020  utput files.    
+0000a160: 2020 2020 7265 7375 6d65 3a20 2772 6573      resume: 'res
+0000a170: 756d 6527 2c20 2772 6573 756d 652d 7369  ume', 'resume-si
+0000a180: 6d69 6c61 7227 2c20 276f 7665 7277 7269  milar', 'overwri
+0000a190: 7465 2720 6f72 2027 7375 6266 6f6c 6465  te' or 'subfolde
+0000a1a0: 7227 0a0a 2020 2020 2020 2020 2020 2020  r'..            
+0000a1b0: 6966 2027 6f76 6572 7772 6974 6527 2c20  if 'overwrite', 
+0000a1c0: 6f76 6572 7772 6974 6520 7072 6576 696f  overwrite previo
+0000a1d0: 7573 2064 6174 612e 0a0a 2020 2020 2020  us data...      
+0000a1e0: 2020 2020 2020 6966 2027 7375 6266 6f6c        if 'subfol
+0000a1f0: 6465 7227 2c20 6372 6561 7465 2061 2066  der', create a f
+0000a200: 7265 7368 2073 7562 6469 7265 6374 6f72  resh subdirector
+0000a210: 7920 696e 206c 6f67 5f64 6972 2e0a 0a20  y in log_dir... 
+0000a220: 2020 2020 2020 2020 2020 2069 6620 2772             if 'r
+0000a230: 6573 756d 6527 206f 7220 5472 7565 2c20  esume' or True, 
+0000a240: 636f 6e74 696e 7565 2070 7265 7669 6f75  continue previou
+0000a250: 7320 7275 6e20 6966 2061 7661 696c 6162  s run if availab
+0000a260: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
+0000a270: 4f6e 6c79 2077 6f72 6b73 2077 6865 6e20  Only works when 
+0000a280: 6469 6d65 6e73 696f 6e61 6c69 7479 2c20  dimensionality, 
+0000a290: 7472 616e 7366 6f72 6d20 6f72 206c 696b  transform or lik
+0000a2a0: 656c 6968 6f6f 6420 6172 6520 636f 6e73  elihood are cons
+0000a2b0: 6973 7465 6e74 2e0a 0a20 2020 2020 2020  istent...       
+0000a2c0: 2020 2020 2069 6620 2772 6573 756d 652d       if 'resume-
+0000a2d0: 7369 6d69 6c61 7227 2c20 636f 6e74 696e  similar', contin
+0000a2e0: 7565 2070 7265 7669 6f75 7320 7275 6e20  ue previous run 
+0000a2f0: 6966 2061 7661 696c 6162 6c65 2e0a 2020  if available..  
+0000a300: 2020 2020 2020 2020 2020 4f6e 6c79 2077            Only w
+0000a310: 6f72 6b73 2077 6865 6e20 6469 6d65 6e73  orks when dimens
+0000a320: 696f 6e61 6c69 7479 2061 6e64 2074 7261  ionality and tra
+0000a330: 6e73 666f 726d 2061 7265 2063 6f6e 7369  nsform are consi
+0000a340: 7374 656e 742e 0a20 2020 2020 2020 2020  stent..         
+0000a350: 2020 2049 6620 6120 6c69 6b65 6c69 686f     If a likeliho
+0000a360: 6f64 2064 6966 6665 7265 6e63 6520 6973  od difference is
+0000a370: 2064 6574 6563 7465 642c 2074 6865 2065   detected, the e
+0000a380: 7869 7374 696e 6720 6c69 6b65 6c69 686f  xisting likeliho
+0000a390: 6f64 730a 2020 2020 2020 2020 2020 2020  ods.            
+0000a3a0: 6172 6520 7570 6461 7465 6420 756e 7469  are updated unti
+0000a3b0: 6c20 7468 6520 6c69 7665 2070 6f69 6e74  l the live point
+0000a3c0: 206f 7264 6572 2064 6966 6665 7273 2e0a   order differs..
+0000a3d0: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
+0000a3e0: 7277 6973 652c 2062 6568 6176 6573 206c  rwise, behaves l
+0000a3f0: 696b 6520 7265 7375 6d65 2e0a 0a20 2020  ike resume...   
+0000a400: 2020 2020 2072 756e 5f6e 756d 3a20 696e       run_num: in
+0000a410: 7420 6f72 204e 6f6e 650a 2020 2020 2020  t or None.      
+0000a420: 2020 2020 2020 4966 2072 6573 756d 653d        If resume=
+0000a430: 3d27 7375 6266 6f6c 6465 7227 2c20 7468  ='subfolder', th
+0000a440: 6973 2069 7320 7468 6520 7375 6266 6f6c  is is the subfol
+0000a450: 6465 7220 6e75 6d62 6572 2e0a 2020 2020  der number..    
+0000a460: 2020 2020 2020 2020 4175 746f 6d61 7469          Automati
+0000a470: 6361 6c6c 7920 696e 6372 656d 656e 7473  cally increments
+0000a480: 2069 6620 7365 7420 746f 204e 6f6e 652e   if set to None.
+0000a490: 0a0a 2020 2020 2020 2020 7772 6170 7065  ..        wrappe
+0000a4a0: 645f 7061 7261 6d73 3a20 6c69 7374 206f  d_params: list o
+0000a4b0: 6620 626f 6f6c 730a 2020 2020 2020 2020  f bools.        
+0000a4c0: 2020 2020 696e 6469 6361 7469 6e67 2077      indicating w
+0000a4d0: 6865 7468 6572 2074 6869 7320 7061 7261  hether this para
+0000a4e0: 6d65 7465 7220 7772 6170 7320 6172 6f75  meter wraps arou
+0000a4f0: 6e64 2028 6369 7263 756c 6172 2070 6172  nd (circular par
+0000a500: 616d 6574 6572 292e 0a0a 2020 2020 2020  ameter)...      
+0000a510: 2020 6e75 6d5f 7465 7374 5f73 616d 706c    num_test_sampl
+0000a520: 6573 3a20 696e 740a 2020 2020 2020 2020  es: int.        
+0000a530: 2020 2020 7465 7374 2074 7261 6e73 666f      test transfo
+0000a540: 726d 2061 6e64 206c 696b 656c 6968 6f6f  rm and likelihoo
+0000a550: 6420 7769 7468 2074 6869 7320 6e75 6d62  d with this numb
+0000a560: 6572 206f 660a 2020 2020 2020 2020 2020  er of.          
+0000a570: 2020 7261 6e64 6f6d 2070 6f69 6e74 7320    random points 
+0000a580: 666f 7220 6572 726f 7273 2066 6972 7374  for errors first
+0000a590: 2e20 5573 6566 756c 2074 6f20 6361 7463  . Useful to catc
+0000a5a0: 6820 6275 6773 2e0a 0a20 2020 2020 2020  h bugs...       
+0000a5b0: 2076 6563 746f 7269 7a65 643a 2062 6f6f   vectorized: boo
+0000a5c0: 6c0a 2020 2020 2020 2020 2020 2020 4966  l.            If
+0000a5d0: 2074 7275 652c 206c 6f67 6c69 6b65 2061   true, loglike a
+0000a5e0: 6e64 2074 7261 6e73 666f 726d 2066 756e  nd transform fun
+0000a5f0: 6374 696f 6e20 6361 6e20 7265 6365 6976  ction can receiv
+0000a600: 6520 6172 7261 7973 0a20 2020 2020 2020  e arrays.       
+0000a610: 2020 2020 206f 6620 706f 696e 7473 2e0a       of points..
+0000a620: 0a20 2020 2020 2020 2064 7261 775f 6d75  .        draw_mu
+0000a630: 6c74 6970 6c65 3a20 626f 6f6c 0a20 2020  ltiple: bool.   
+0000a640: 2020 2020 2020 2020 2049 6620 6566 6669           If effi
+0000a650: 6369 656e 6379 2067 6f65 7320 646f 776e  ciency goes down
+0000a660: 2c20 6479 6e61 6d69 6361 6c6c 7920 6472  , dynamically dr
+0000a670: 6177 206d 6f72 6520 706f 696e 7473 0a20  aw more points. 
+0000a680: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+0000a690: 7468 6520 7265 6769 6f6e 2062 6574 7765  the region betwe
+0000a6a0: 656e 2060 6e64 7261 775f 6d69 6e60 2061  en `ndraw_min` a
+0000a6b0: 6e64 2060 6e64 7261 775f 6d61 7860 2e0a  nd `ndraw_max`..
+0000a6c0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
+0000a6d0: 6574 2074 6f20 4661 6c73 652c 2066 6577  et to False, few
+0000a6e0: 2070 6f69 6e74 7320 6172 6520 7361 6d70   points are samp
+0000a6f0: 6c65 6420 6174 206f 6e63 652e 0a0a 2020  led at once...  
+0000a700: 2020 2020 2020 6e64 7261 775f 6d69 6e3a        ndraw_min:
+0000a710: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
+0000a720: 204d 696e 696d 756d 206e 756d 6265 7220   Minimum number 
+0000a730: 6f66 2070 6f69 6e74 7320 746f 2073 696d  of points to sim
+0000a740: 756c 7461 6e65 6f75 736c 7920 7072 6f70  ultaneously prop
+0000a750: 6f73 652e 0a20 2020 2020 2020 2020 2020  ose..           
+0000a760: 2049 6e63 7265 6173 6520 7468 6973 2069   Increase this i
+0000a770: 6620 796f 7572 206c 696b 656c 6968 6f6f  f your likelihoo
+0000a780: 6420 6d61 6b65 7320 7665 6374 6f72 697a  d makes vectoriz
+0000a790: 6174 696f 6e20 7665 7279 2063 6865 6170  ation very cheap
+0000a7a0: 2e0a 0a20 2020 2020 2020 206e 6472 6177  ...        ndraw
+0000a7b0: 5f6d 6178 3a20 696e 740a 2020 2020 2020  _max: int.      
+0000a7c0: 2020 2020 2020 4d61 7869 6d75 6d20 6e75        Maximum nu
+0000a7d0: 6d62 6572 206f 6620 706f 696e 7473 2074  mber of points t
+0000a7e0: 6f20 7369 6d75 6c74 616e 656f 7573 6c79  o simultaneously
+0000a7f0: 2070 726f 706f 7365 2e0a 2020 2020 2020   propose..      
+0000a800: 2020 2020 2020 496e 6372 6561 7365 2074        Increase t
+0000a810: 6869 7320 6966 2079 6f75 7220 6c69 6b65  his if your like
+0000a820: 6c69 686f 6f64 206d 616b 6573 2076 6563  lihood makes vec
+0000a830: 746f 7269 7a61 7469 6f6e 2076 6572 7920  torization very 
+0000a840: 6368 6561 702e 0a20 2020 2020 2020 2020  cheap..         
+0000a850: 2020 204d 656d 6f72 7920 616c 6c6f 6361     Memory alloca
+0000a860: 7469 6f6e 206d 6179 2062 6520 736c 6f77  tion may be slow
+0000a870: 2066 6f72 2065 7874 7265 6d65 6c79 2068   for extremely h
+0000a880: 6967 6820 7661 6c75 6573 2e0a 0a20 2020  igh values...   
+0000a890: 2020 2020 206e 756d 5f62 6f6f 7473 7472       num_bootstr
+0000a8a0: 6170 733a 2069 6e74 0a20 2020 2020 2020  aps: int.       
+0000a8b0: 2020 2020 206e 756d 6265 7220 6f66 206c       number of l
+0000a8c0: 6f67 5a20 6573 7469 6d61 746f 7273 2061  ogZ estimators a
+0000a8d0: 6e64 204d 4c46 7269 656e 6473 2072 6567  nd MLFriends reg
+0000a8e0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+0000a8f0: 626f 6f74 7374 7261 7020 726f 756e 6473  bootstrap rounds
+0000a900: 2e0a 0a20 2020 2020 2020 2073 746f 7261  ...        stora
+0000a910: 6765 5f62 6163 6b65 6e64 3a20 7374 7220  ge_backend: str 
+0000a920: 6f72 2063 6c61 7373 0a20 2020 2020 2020  or class.       
+0000a930: 2020 2020 2043 6c61 7373 2074 6f20 7573       Class to us
+0000a940: 6520 666f 7220 7374 6f72 696e 6720 7468  e for storing th
+0000a950: 6520 6576 616c 7561 7465 6420 706f 696e  e evaluated poin
+0000a960: 7473 2028 7365 6520 756c 7472 616e 6573  ts (see ultranes
+0000a970: 742e 7374 6f72 6529 0a20 2020 2020 2020  t.store).       
+0000a980: 2020 2020 2027 6864 6635 2720 6973 2073       'hdf5' is s
+0000a990: 7472 6f6e 676c 7920 7265 636f 6d6d 656e  trongly recommen
+0000a9a0: 6465 642e 2027 7473 7627 2061 6e64 2027  ded. 'tsv' and '
+0000a9b0: 6373 7627 2061 7265 2061 6c73 6f20 706f  csv' are also po
+0000a9c0: 7373 6962 6c65 2e0a 0a20 2020 2020 2020  ssible...       
+0000a9d0: 2077 6172 6d73 7461 7274 5f6d 6178 5f74   warmstart_max_t
+0000a9e0: 6175 3a20 666c 6f61 740a 2020 2020 2020  au: float.      
+0000a9f0: 2020 2020 2020 4d61 7869 6d75 6d20 6469        Maximum di
+0000aa00: 736f 7264 6572 2074 6f20 6163 6365 7074  sorder to accept
+0000aa10: 2077 6865 6e20 7265 7375 6d65 3d27 7265   when resume='re
+0000aa20: 7375 6d65 2d73 696d 696c 6172 273b 0a20  sume-similar';. 
+0000aa30: 2020 2020 2020 2020 2020 204c 6976 6520             Live 
+0000aa40: 706f 696e 7473 2061 7265 2072 6575 7365  points are reuse
+0000aa50: 6420 6173 206c 6f6e 6720 6173 2074 6865  d as long as the
+0000aa60: 206c 6976 6520 706f 696e 7420 6f72 6465   live point orde
+0000aa70: 720a 2020 2020 2020 2020 2020 2020 6973  r.            is
+0000aa80: 2062 656c 6f77 2074 6869 7320 6e6f 726d   below this norm
+0000aa90: 616c 6973 6564 204b 656e 6461 6c6c 2074  alised Kendall t
+0000aaa0: 6175 2064 6973 7461 6e63 652e 0a20 2020  au distance..   
+0000aab0: 2020 2020 2020 2020 2056 616c 7565 7320           Values 
+0000aac0: 6672 6f6d 2030 2028 6869 6768 6c79 2063  from 0 (highly c
+0000aad0: 6f6e 7365 7276 6174 6976 6529 2074 6f20  onservative) to 
+0000aae0: 3120 2865 7874 7265 6d65 6c79 206e 6567  1 (extremely neg
+0000aaf0: 6c69 6765 6e74 292e 0a20 2020 2020 2020  ligent)..       
+0000ab00: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+0000ab10: 662e 7061 7261 6d6e 616d 6573 203d 2070  f.paramnames = p
+0000ab20: 6172 616d 5f6e 616d 6573 0a20 2020 2020  aram_names.     
+0000ab30: 2020 2078 5f64 696d 203d 206c 656e 2873     x_dim = len(s
+0000ab40: 656c 662e 7061 7261 6d6e 616d 6573 290a  elf.paramnames).
+0000ab50: 0a20 2020 2020 2020 2073 656c 662e 7361  .        self.sa
+0000ab60: 6d70 6c65 7220 3d20 2772 6561 6374 6976  mpler = 'reactiv
+0000ab70: 652d 6e65 7374 6564 270a 2020 2020 2020  e-nested'.      
+0000ab80: 2020 7365 6c66 2e78 5f64 696d 203d 2078    self.x_dim = x
+0000ab90: 5f64 696d 0a20 2020 2020 2020 2073 656c  _dim.        sel
+0000aba0: 662e 7472 616e 7366 6f72 6d5f 6c61 7965  f.transform_laye
+0000abb0: 725f 636c 6173 7320 3d20 4c6f 6361 6c41  r_class = LocalA
+0000abc0: 6666 696e 654c 6179 6572 2069 6620 785f  ffineLayer if x_
+0000abd0: 6469 6d20 3e20 3120 656c 7365 2053 6361  dim > 1 else Sca
+0000abe0: 6c69 6e67 4c61 7965 720a 2020 2020 2020  lingLayer.      
+0000abf0: 2020 7365 6c66 2e64 6572 6976 6564 7061    self.derivedpa
+0000ac00: 7261 6d6e 616d 6573 203d 2064 6572 6976  ramnames = deriv
+0000ac10: 6564 5f70 6172 616d 5f6e 616d 6573 0a20  ed_param_names. 
+0000ac20: 2020 2020 2020 2073 656c 662e 6e75 6d5f         self.num_
+0000ac30: 626f 6f74 7374 7261 7073 203d 2069 6e74  bootstraps = int
+0000ac40: 286e 756d 5f62 6f6f 7473 7472 6170 7329  (num_bootstraps)
+0000ac50: 0a20 2020 2020 2020 206e 756d 5f64 6572  .        num_der
+0000ac60: 6976 6564 203d 206c 656e 2873 656c 662e  ived = len(self.
+0000ac70: 6465 7269 7665 6470 6172 616d 6e61 6d65  derivedparamname
+0000ac80: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+0000ac90: 6e75 6d5f 7061 7261 6d73 203d 2078 5f64  num_params = x_d
+0000aca0: 696d 202b 206e 756d 5f64 6572 6976 6564  im + num_derived
+0000acb0: 0a20 2020 2020 2020 2069 6620 7772 6170  .        if wrap
+0000acc0: 7065 645f 7061 7261 6d73 2069 7320 4e6f  ped_params is No
+0000acd0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000ace0: 7365 6c66 2e77 7261 7070 6564 5f61 7865  self.wrapped_axe
+0000acf0: 7320 3d20 5b5d 0a20 2020 2020 2020 2065  s = [].        e
+0000ad00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000ad10: 2061 7373 6572 7420 6c65 6e28 7772 6170   assert len(wrap
+0000ad20: 7065 645f 7061 7261 6d73 2920 3d3d 2073  ped_params) == s
+0000ad30: 656c 662e 785f 6469 6d2c 2028 2277 7261  elf.x_dim, ("wra
+0000ad40: 7070 6564 5f70 6172 616d 7320 6861 7320  pped_params has 
+0000ad50: 7468 6520 6e75 6d62 6572 206f 6620 656e  the number of en
+0000ad60: 7472 6965 733a 222c 2077 7261 7070 6564  tries:", wrapped
+0000ad70: 5f70 6172 616d 732c 2022 2c20 6578 7065  _params, ", expe
+0000ad80: 6374 6564 222c 2073 656c 662e 785f 6469  cted", self.x_di
+0000ad90: 6d29 0a20 2020 2020 2020 2020 2020 2073  m).            s
+0000ada0: 656c 662e 7772 6170 7065 645f 6178 6573  elf.wrapped_axes
+0000adb0: 203d 206e 702e 7768 6572 6528 7772 6170   = np.where(wrap
+0000adc0: 7065 645f 7061 7261 6d73 295b 305d 0a0a  ped_params)[0]..
+0000add0: 2020 2020 2020 2020 7365 6c66 2e75 7365          self.use
+0000ade0: 5f6d 7069 203d 2046 616c 7365 0a20 2020  _mpi = False.   
+0000adf0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000ae00: 2020 2020 2020 6672 6f6d 206d 7069 3470        from mpi4p
+0000ae10: 7920 696d 706f 7274 204d 5049 0a20 2020  y import MPI.   
+0000ae20: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+0000ae30: 6d6d 203d 204d 5049 2e43 4f4d 4d5f 574f  mm = MPI.COMM_WO
+0000ae40: 524c 440a 2020 2020 2020 2020 2020 2020  RLD.            
+0000ae50: 7365 6c66 2e6d 7069 5f73 697a 6520 3d20  self.mpi_size = 
+0000ae60: 7365 6c66 2e63 6f6d 6d2e 4765 745f 7369  self.comm.Get_si
+0000ae70: 7a65 2829 0a20 2020 2020 2020 2020 2020  ze().           
+0000ae80: 2073 656c 662e 6d70 695f 7261 6e6b 203d   self.mpi_rank =
+0000ae90: 2073 656c 662e 636f 6d6d 2e47 6574 5f72   self.comm.Get_r
+0000aea0: 616e 6b28 290a 2020 2020 2020 2020 2020  ank().          
+0000aeb0: 2020 6966 2073 656c 662e 6d70 695f 7369    if self.mpi_si
+0000aec0: 7a65 203e 2031 3a0a 2020 2020 2020 2020  ze > 1:.        
+0000aed0: 2020 2020 2020 2020 7365 6c66 2e75 7365          self.use
+0000aee0: 5f6d 7069 203d 2054 7275 650a 2020 2020  _mpi = True.    
+0000aef0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000af00: 2e5f 7365 7475 705f 6469 7374 7269 6275  ._setup_distribu
+0000af10: 7465 645f 7365 6564 7328 290a 2020 2020  ted_seeds().    
+0000af20: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+0000af30: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+0000af40: 2020 7365 6c66 2e6d 7069 5f73 697a 6520    self.mpi_size 
+0000af50: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0000af60: 7365 6c66 2e6d 7069 5f72 616e 6b20 3d20  self.mpi_rank = 
+0000af70: 300a 0a20 2020 2020 2020 2073 656c 662e  0..        self.
+0000af80: 6c6f 6720 3d20 7365 6c66 2e6d 7069 5f72  log = self.mpi_r
+0000af90: 616e 6b20 3d3d 2030 0a20 2020 2020 2020  ank == 0.       
+0000afa0: 2073 656c 662e 6c6f 675f 746f 5f64 6973   self.log_to_dis
+0000afb0: 6b20 3d20 7365 6c66 2e6c 6f67 2061 6e64  k = self.log and
+0000afc0: 206c 6f67 5f64 6972 2069 7320 6e6f 7420   log_dir is not 
+0000afd0: 4e6f 6e65 0a20 2020 2020 2020 2073 656c  None.        sel
+0000afe0: 662e 6c6f 675f 746f 5f70 6f69 6e74 7374  f.log_to_pointst
+0000aff0: 6f72 6520 3d20 7365 6c66 2e6c 6f67 5f74  ore = self.log_t
+0000b000: 6f5f 6469 736b 0a0a 2020 2020 2020 2020  o_disk..        
+0000b010: 6173 7365 7274 2072 6573 756d 6520 696e  assert resume in
+0000b020: 2028 5472 7565 2c20 276f 7665 7277 7269   (True, 'overwri
+0000b030: 7465 272c 2027 7375 6266 6f6c 6465 7227  te', 'subfolder'
+0000b040: 2c20 2772 6573 756d 6527 2c20 2772 6573  , 'resume', 'res
+0000b050: 756d 652d 7369 6d69 6c61 7227 292c 205c  ume-similar'), \
+0000b060: 0a20 2020 2020 2020 2020 2020 2022 7265  .            "re
+0000b070: 7375 6d65 2073 686f 756c 6420 6265 206f  sume should be o
+0000b080: 6e65 206f 6620 276f 7665 7277 7269 7465  ne of 'overwrite
+0000b090: 2720 2773 7562 666f 6c64 6572 272c 2027  ' 'subfolder', '
+0000b0a0: 7265 7375 6d65 2720 6f72 2027 7265 7375  resume' or 'resu
+0000b0b0: 6d65 2d73 696d 696c 6172 2722 0a20 2020  me-similar'".   
+0000b0c0: 2020 2020 2061 7070 656e 645f 7275 6e5f       append_run_
+0000b0d0: 6e75 6d20 3d20 7265 7375 6d65 203d 3d20  num = resume == 
+0000b0e0: 2773 7562 666f 6c64 6572 270a 2020 2020  'subfolder'.    
+0000b0f0: 2020 2020 7265 7375 6d65 5f73 696d 696c      resume_simil
+0000b100: 6172 203d 2072 6573 756d 6520 3d3d 2027  ar = resume == '
+0000b110: 7265 7375 6d65 2d73 696d 696c 6172 270a  resume-similar'.
+0000b120: 2020 2020 2020 2020 7265 7375 6d65 203d          resume =
+0000b130: 2072 6573 756d 6520 696e 2028 2772 6573   resume in ('res
+0000b140: 756d 652d 7369 6d69 6c61 7227 2c20 2772  ume-similar', 'r
+0000b150: 6573 756d 6527 2c20 5472 7565 290a 0a20  esume', True).. 
+0000b160: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
+0000b170: 6f67 2061 6e64 206c 6f67 5f64 6972 2069  og and log_dir i
+0000b180: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000b190: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0000b1a0: 7320 3d20 6d61 6b65 5f72 756e 5f64 6972  s = make_run_dir
+0000b1b0: 286c 6f67 5f64 6972 2c20 7275 6e5f 6e75  (log_dir, run_nu
+0000b1c0: 6d2c 2061 7070 656e 645f 7275 6e5f 6e75  m, append_run_nu
+0000b1d0: 6d3d 6170 7065 6e64 5f72 756e 5f6e 756d  m=append_run_num
+0000b1e0: 290a 2020 2020 2020 2020 2020 2020 6c6f  ).            lo
+0000b1f0: 675f 6469 7220 3d20 7365 6c66 2e6c 6f67  g_dir = self.log
+0000b200: 735b 2772 756e 5f64 6972 275d 0a20 2020  s['run_dir'].   
+0000b210: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000b220: 2020 2020 2020 206c 6f67 5f64 6972 203d         log_dir =
+0000b230: 204e 6f6e 650a 0a20 2020 2020 2020 2069   None..        i
+0000b240: 6620 7365 6c66 2e6c 6f67 3a0a 2020 2020  f self.log:.    
+0000b250: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
+0000b260: 6765 7220 3d20 6372 6561 7465 5f6c 6f67  ger = create_log
+0000b270: 6765 7228 2775 6c74 7261 6e65 7374 272c  ger('ultranest',
+0000b280: 206c 6f67 5f64 6972 3d6c 6f67 5f64 6972   log_dir=log_dir
+0000b290: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000b2a0: 6c66 2e6c 6f67 6765 722e 6465 6275 6728  lf.logger.debug(
+0000b2b0: 2752 6561 6374 6976 654e 6573 7465 6453  'ReactiveNestedS
+0000b2c0: 616d 706c 6572 3a20 6469 6d73 3d25 642b  ampler: dims=%d+
+0000b2d0: 2564 2c20 7265 7375 6d65 3d25 732c 206c  %d, resume=%s, l
+0000b2e0: 6f67 5f64 6972 3d25 732c 2062 6163 6b65  og_dir=%s, backe
+0000b2f0: 6e64 3d25 732c 2076 6563 746f 7269 7a65  nd=%s, vectorize
+0000b300: 643d 2573 2c20 6e62 6f6f 7473 7472 6170  d=%s, nbootstrap
+0000b310: 733d 2573 2c20 6e64 7261 773d 2573 2e2e  s=%s, ndraw=%s..
+0000b320: 2573 2720 2520 280a 2020 2020 2020 2020  %s' % (.        
+0000b330: 2020 2020 2020 2020 785f 6469 6d2c 206e          x_dim, n
+0000b340: 756d 5f64 6572 6976 6564 2c20 7265 7375  um_derived, resu
+0000b350: 6d65 2c20 6c6f 675f 6469 722c 2073 746f  me, log_dir, sto
+0000b360: 7261 6765 5f62 6163 6b65 6e64 2c20 7665  rage_backend, ve
+0000b370: 6374 6f72 697a 6564 2c0a 2020 2020 2020  ctorized,.      
+0000b380: 2020 2020 2020 2020 2020 6e75 6d5f 626f            num_bo
+0000b390: 6f74 7374 7261 7073 2c20 6e64 7261 775f  otstraps, ndraw_
+0000b3a0: 6d69 6e2c 206e 6472 6177 5f6d 6178 2c0a  min, ndraw_max,.
+0000b3b0: 2020 2020 2020 2020 2020 2020 2929 0a20              )). 
+0000b3c0: 2020 2020 2020 2073 656c 662e 726f 6f74         self.root
+0000b3d0: 203d 2054 7265 654e 6f64 6528 6964 3d2d   = TreeNode(id=-
+0000b3e0: 312c 2076 616c 7565 3d2d 6e70 2e69 6e66  1, value=-np.inf
+0000b3f0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000b400: 706f 696e 7470 696c 6520 3d20 506f 696e  pointpile = Poin
+0000b410: 7450 696c 6528 7365 6c66 2e78 5f64 696d  tPile(self.x_dim
+0000b420: 2c20 7365 6c66 2e6e 756d 5f70 6172 616d  , self.num_param
+0000b430: 7329 0a20 2020 2020 2020 2069 6620 7365  s).        if se
+0000b440: 6c66 2e6c 6f67 5f74 6f5f 706f 696e 7473  lf.log_to_points
+0000b450: 746f 7265 3a0a 2020 2020 2020 2020 2020  tore:.          
+0000b460: 2020 7374 6f72 6167 655f 6669 6c65 6e61    storage_filena
+0000b470: 6d65 203d 206f 732e 7061 7468 2e6a 6f69  me = os.path.joi
+0000b480: 6e28 7365 6c66 2e6c 6f67 735b 2772 6573  n(self.logs['res
+0000b490: 756c 7473 275d 2c20 2770 6f69 6e74 732e  ults'], 'points.
+0000b4a0: 2720 2b20 7374 6f72 6167 655f 6261 636b  ' + storage_back
+0000b4b0: 656e 6429 0a20 2020 2020 2020 2020 2020  end).           
+0000b4c0: 2073 746f 7261 6765 5f6e 756d 5f63 6f6c   storage_num_col
+0000b4d0: 7320 3d20 3320 2b20 7365 6c66 2e78 5f64  s = 3 + self.x_d
+0000b4e0: 696d 202b 2073 656c 662e 6e75 6d5f 7061  im + self.num_pa
+0000b4f0: 7261 6d73 0a20 2020 2020 2020 2020 2020  rams.           
+0000b500: 2069 6620 7374 6f72 6167 655f 6261 636b   if storage_back
+0000b510: 656e 6420 3d3d 2027 7473 7627 3a0a 2020  end == 'tsv':.  
+0000b520: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000b530: 6c66 2e70 6f69 6e74 7374 6f72 6520 3d20  lf.pointstore = 
+0000b540: 5465 7874 506f 696e 7453 746f 7265 2873  TextPointStore(s
+0000b550: 746f 7261 6765 5f66 696c 656e 616d 652c  torage_filename,
+0000b560: 2073 746f 7261 6765 5f6e 756d 5f63 6f6c   storage_num_col
+0000b570: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0000b580: 2020 2073 656c 662e 706f 696e 7473 746f     self.pointsto
+0000b590: 7265 2e64 656c 696d 6974 6572 203d 2027  re.delimiter = '
+0000b5a0: 5c6e 270a 2020 2020 2020 2020 2020 2020  \n'.            
+0000b5b0: 656c 6966 2073 746f 7261 6765 5f62 6163  elif storage_bac
+0000b5c0: 6b65 6e64 203d 3d20 2763 7376 273a 0a20  kend == 'csv':. 
+0000b5d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b5e0: 656c 662e 706f 696e 7473 746f 7265 203d  elf.pointstore =
+0000b5f0: 2054 6578 7450 6f69 6e74 5374 6f72 6528   TextPointStore(
+0000b600: 7374 6f72 6167 655f 6669 6c65 6e61 6d65  storage_filename
+0000b610: 2c20 7374 6f72 6167 655f 6e75 6d5f 636f  , storage_num_co
+0000b620: 6c73 290a 2020 2020 2020 2020 2020 2020  ls).            
+0000b630: 2020 2020 7365 6c66 2e70 6f69 6e74 7374      self.pointst
+0000b640: 6f72 652e 6465 6c69 6d69 7465 7220 3d20  ore.delimiter = 
+0000b650: 272c 270a 2020 2020 2020 2020 2020 2020  ','.            
+0000b660: 656c 6966 2073 746f 7261 6765 5f62 6163  elif storage_bac
+0000b670: 6b65 6e64 203d 3d20 2768 6466 3527 3a0a  kend == 'hdf5':.
+0000b680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b690: 7365 6c66 2e70 6f69 6e74 7374 6f72 6520  self.pointstore 
+0000b6a0: 3d20 4844 4635 506f 696e 7453 746f 7265  = HDF5PointStore
+0000b6b0: 2873 746f 7261 6765 5f66 696c 656e 616d  (storage_filenam
+0000b6c0: 652c 2073 746f 7261 6765 5f6e 756d 5f63  e, storage_num_c
+0000b6d0: 6f6c 732c 206d 6f64 653d 2761 2720 6966  ols, mode='a' if
+0000b6e0: 2072 6573 756d 6520 656c 7365 2027 7727   resume else 'w'
+0000b6f0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000b700: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000b710: 2020 2020 2320 7573 6520 6375 7374 6f6d      # use custom
+0000b720: 2062 6163 6b65 6e64 0a20 2020 2020 2020   backend.       
+0000b730: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
+0000b740: 696e 7473 746f 7265 203d 2073 746f 7261  intstore = stora
+0000b750: 6765 5f62 6163 6b65 6e64 0a20 2020 2020  ge_backend.     
+0000b760: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000b770: 2020 2020 2073 656c 662e 706f 696e 7473       self.points
+0000b780: 746f 7265 203d 204e 756c 6c50 6f69 6e74  tore = NullPoint
+0000b790: 5374 6f72 6528 3320 2b20 7365 6c66 2e78  Store(3 + self.x
+0000b7a0: 5f64 696d 202b 2073 656c 662e 6e75 6d5f  _dim + self.num_
+0000b7b0: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+0000b7c0: 7365 6c66 2e6e 6361 6c6c 203d 2073 656c  self.ncall = sel
+0000b7d0: 662e 706f 696e 7473 746f 7265 2e6e 6361  f.pointstore.nca
+0000b7e0: 6c6c 730a 2020 2020 2020 2020 7365 6c66  lls.        self
+0000b7f0: 2e6e 6361 6c6c 5f72 6567 696f 6e20 3d20  .ncall_region = 
+0000b800: 300a 0a20 2020 2020 2020 2069 6620 6e6f  0..        if no
+0000b810: 7420 7665 6374 6f72 697a 6564 3a0a 2020  t vectorized:.  
+0000b820: 2020 2020 2020 2020 2020 6966 2074 7261            if tra
+0000b830: 6e73 666f 726d 2069 7320 6e6f 7420 4e6f  nsform is not No
+0000b840: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000b850: 2020 2020 7472 616e 7366 6f72 6d20 3d20      transform = 
+0000b860: 7665 6374 6f72 697a 6528 7472 616e 7366  vectorize(transf
+0000b870: 6f72 6d29 0a20 2020 2020 2020 2020 2020  orm).           
+0000b880: 206c 6f67 6c69 6b65 203d 2076 6563 746f   loglike = vecto
+0000b890: 7269 7a65 286c 6f67 6c69 6b65 290a 2020  rize(loglike).  
+0000b8a0: 2020 2020 2020 2020 2020 6472 6177 5f6d            draw_m
+0000b8b0: 756c 7469 706c 6520 3d20 4661 6c73 650a  ultiple = False.
+0000b8c0: 0a20 2020 2020 2020 2073 656c 662e 6472  .        self.dr
+0000b8d0: 6177 5f6d 756c 7469 706c 6520 3d20 6472  aw_multiple = dr
+0000b8e0: 6177 5f6d 756c 7469 706c 650a 2020 2020  aw_multiple.    
+0000b8f0: 2020 2020 7365 6c66 2e6e 6472 6177 5f6d      self.ndraw_m
+0000b900: 696e 203d 206e 6472 6177 5f6d 696e 0a20  in = ndraw_min. 
+0000b910: 2020 2020 2020 2073 656c 662e 6e64 7261         self.ndra
+0000b920: 775f 6d61 7820 3d20 6e64 7261 775f 6d61  w_max = ndraw_ma
+0000b930: 780a 2020 2020 2020 2020 7365 6c66 2e62  x.        self.b
+0000b940: 7569 6c64 5f74 7265 6769 6f6e 203d 2074  uild_tregion = t
+0000b950: 7261 6e73 666f 726d 2069 7320 6e6f 7420  ransform is not 
+0000b960: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
+0000b970: 6e6f 7420 7365 6c66 2e5f 6368 6563 6b5f  not self._check_
+0000b980: 6c69 6b65 6c69 686f 6f64 5f66 756e 6374  likelihood_funct
+0000b990: 696f 6e28 7472 616e 7366 6f72 6d2c 206c  ion(transform, l
+0000b9a0: 6f67 6c69 6b65 2c20 6e75 6d5f 7465 7374  oglike, num_test
+0000b9b0: 5f73 616d 706c 6573 293a 0a20 2020 2020  _samples):.     
+0000b9c0: 2020 2020 2020 2061 7373 6572 7420 7365         assert se
+0000b9d0: 6c66 2e6c 6f67 5f74 6f5f 6469 736b 0a20  lf.log_to_disk. 
+0000b9e0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0000b9f0: 7375 6d65 5f73 696d 696c 6172 2061 6e64  sume_similar and
+0000ba00: 2073 656c 662e 6c6f 675f 746f 5f64 6973   self.log_to_dis
+0000ba10: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
+0000ba20: 2020 2061 7373 6572 7420 7374 6f72 6167     assert storag
+0000ba30: 655f 6261 636b 656e 6420 3d3d 2027 6864  e_backend == 'hd
+0000ba40: 6635 272c 2027 7265 7375 6d65 2d73 696d  f5', 'resume-sim
+0000ba50: 696c 6172 2069 7320 6f6e 6c79 2073 7570  ilar is only sup
+0000ba60: 706f 7274 6564 2066 6f72 2048 4446 3520  ported for HDF5 
+0000ba70: 6669 6c65 7327 0a20 2020 2020 2020 2020  files'.         
+0000ba80: 2020 2020 2020 2061 7373 6572 7420 3020         assert 0 
+0000ba90: 3c3d 2077 6172 6d73 7461 7274 5f6d 6178  <= warmstart_max
+0000baa0: 5f74 6175 203c 3d20 312c 2027 7761 726d  _tau <= 1, 'warm
+0000bab0: 7374 6172 745f 6d61 785f 7461 7520 7061  start_max_tau pa
+0000bac0: 7261 6d65 7465 7220 6e65 6564 7320 746f  rameter needs to
+0000bad0: 2062 6520 7365 7420 746f 2061 2076 616c   be set to a val
+0000bae0: 7565 2062 6574 7765 656e 2030 2061 6e64  ue between 0 and
+0000baf0: 2031 270a 2020 2020 2020 2020 2020 2020   1'.            
+0000bb00: 2020 2020 2320 636c 6f73 650a 2020 2020      # close.    
+0000bb10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bb20: 2e70 6f69 6e74 7374 6f72 652e 636c 6f73  .pointstore.clos
+0000bb30: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+0000bb40: 2020 2020 6465 6c20 7365 6c66 2e70 6f69      del self.poi
+0000bb50: 6e74 7374 6f72 650a 2020 2020 2020 2020  ntstore.        
+0000bb60: 2020 2020 2020 2020 2320 7265 7772 6974          # rewrit
+0000bb70: 6520 706f 696e 7473 2066 696c 650a 2020  e points file.  
+0000bb80: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000bb90: 2073 656c 662e 6c6f 673a 0a20 2020 2020   self.log:.     
+0000bba0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000bbb0: 656c 662e 6c6f 6767 6572 2e69 6e66 6f28  elf.logger.info(
+0000bbc0: 2774 7279 696e 6720 746f 2073 616c 7661  'trying to salva
+0000bbd0: 6765 2070 6f69 6e74 7320 6672 6f6d 2070  ge points from p
+0000bbe0: 7265 7669 6f75 732c 2064 6966 6665 7265  revious, differe
+0000bbf0: 6e74 2072 756e 202e 2e2e 2729 0a20 2020  nt run ...').   
+0000bc00: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0000bc10: 756d 655f 6672 6f6d 5f73 696d 696c 6172  ume_from_similar
+0000bc20: 5f66 696c 6528 0a20 2020 2020 2020 2020  _file(.         
+0000bc30: 2020 2020 2020 2020 2020 206c 6f67 5f64             log_d
+0000bc40: 6972 2c20 785f 6469 6d2c 206c 6f67 6c69  ir, x_dim, logli
+0000bc50: 6b65 2c20 7472 616e 7366 6f72 6d2c 0a20  ke, transform,. 
+0000bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc70: 2020 206e 6472 6177 3d6e 6472 6177 5f6d     ndraw=ndraw_m
+0000bc80: 696e 2069 6620 7665 6374 6f72 697a 6564  in if vectorized
+0000bc90: 2065 6c73 6520 312c 0a20 2020 2020 2020   else 1,.       
+0000bca0: 2020 2020 2020 2020 2020 2020 206d 6178               max
+0000bcb0: 5f74 6175 3d77 6172 6d73 7461 7274 5f6d  _tau=warmstart_m
+0000bcc0: 6178 5f74 6175 2c20 7665 7262 6f73 653d  ax_tau, verbose=
+0000bcd0: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+0000bce0: 2020 2020 2020 2073 656c 662e 706f 696e         self.poin
+0000bcf0: 7473 746f 7265 203d 2048 4446 3550 6f69  tstore = HDF5Poi
+0000bd00: 6e74 5374 6f72 6528 0a20 2020 2020 2020  ntStore(.       
+0000bd10: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+0000bd20: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e6c  path.join(self.l
+0000bd30: 6f67 735b 2772 6573 756c 7473 275d 2c20  ogs['results'], 
+0000bd40: 2770 6f69 6e74 732e 6864 6635 2729 2c0a  'points.hdf5'),.
+0000bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd60: 2020 2020 3320 2b20 7365 6c66 2e78 5f64      3 + self.x_d
+0000bd70: 696d 202b 2073 656c 662e 6e75 6d5f 7061  im + self.num_pa
+0000bd80: 7261 6d73 2c20 6d6f 6465 3d27 6127 2069  rams, mode='a' i
+0000bd90: 6620 7265 7375 6d65 2065 6c73 6520 2777  f resume else 'w
+0000bda0: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
+0000bdb0: 6c69 6620 7265 7375 6d65 3a0a 2020 2020  lif resume:.    
+0000bdc0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000bdd0: 6520 4578 6365 7074 696f 6e28 2243 616e  e Exception("Can
+0000bde0: 6e6f 7420 7265 7375 6d65 2062 6563 6175  not resume becau
+0000bdf0: 7365 206c 6f67 6c69 6b65 6c69 686f 6f64  se loglikelihood
+0000be00: 2066 756e 6374 696f 6e20 6368 616e 6765   function change
+0000be10: 642c 2022 0a20 2020 2020 2020 2020 2020  d, ".           
+0000be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be30: 2020 2020 2022 756e 6c65 7373 2072 6573       "unless res
+0000be40: 756d 653d 7265 7375 6d65 2d73 696d 696c  ume=resume-simil
+0000be50: 6172 2e20 546f 2073 7461 7274 2066 726f  ar. To start fro
+0000be60: 6d20 7363 7261 7463 682c 2064 656c 6574  m scratch, delet
+0000be70: 6520 2725 7327 2e22 2025 2028 6c6f 675f  e '%s'." % (log_
+0000be80: 6469 7229 290a 2020 2020 2020 2020 7365  dir)).        se
+0000be90: 6c66 2e5f 7365 745f 6c69 6b65 6c69 686f  lf._set_likeliho
+0000bea0: 6f64 5f66 756e 6374 696f 6e28 7472 616e  od_function(tran
+0000beb0: 7366 6f72 6d2c 206c 6f67 6c69 6b65 2c20  sform, loglike, 
+0000bec0: 6e75 6d5f 7465 7374 5f73 616d 706c 6573  num_test_samples
+0000bed0: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+0000bee0: 7465 7073 616d 706c 6572 203d 204e 6f6e  tepsampler = Non
+0000bef0: 650a 0a20 2020 2064 6566 205f 7365 7475  e..    def _setu
+0000bf00: 705f 6469 7374 7269 6275 7465 645f 7365  p_distributed_se
+0000bf10: 6564 7328 7365 6c66 293a 0a20 2020 2020  eds(self):.     
+0000bf20: 2020 2069 6620 6e6f 7420 7365 6c66 2e75     if not self.u
+0000bf30: 7365 5f6d 7069 3a0a 2020 2020 2020 2020  se_mpi:.        
+0000bf40: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+0000bf50: 2020 2073 6565 6420 3d20 300a 2020 2020     seed = 0.    
+0000bf60: 2020 2020 6966 2073 656c 662e 6d70 695f      if self.mpi_
+0000bf70: 7261 6e6b 203d 3d20 303a 0a20 2020 2020  rank == 0:.     
+0000bf80: 2020 2020 2020 2073 6565 6420 3d20 6e70         seed = np
+0000bf90: 2e72 616e 646f 6d2e 7261 6e64 696e 7428  .random.randint(
+0000bfa0: 302c 2031 3030 3030 3030 290a 0a20 2020  0, 1000000)..   
+0000bfb0: 2020 2020 2073 6565 6420 3d20 7365 6c66       seed = self
+0000bfc0: 2e63 6f6d 6d2e 6263 6173 7428 7365 6564  .comm.bcast(seed
+0000bfd0: 2c20 726f 6f74 3d30 290a 2020 2020 2020  , root=0).      
+0000bfe0: 2020 6966 2073 656c 662e 6d70 695f 7261    if self.mpi_ra
+0000bff0: 6e6b 203e 2030 3a0a 2020 2020 2020 2020  nk > 0:.        
+0000c000: 2020 2020 2320 6672 6f6d 2068 7474 703a      # from http:
+0000c010: 2f2f 6172 7869 762e 6f72 672f 6162 732f  //arxiv.org/abs/
+0000c020: 3130 3035 2e34 3131 370a 2020 2020 2020  1005.4117.      
+0000c030: 2020 2020 2020 7365 6564 203d 2069 6e74        seed = int
+0000c040: 2861 6273 2828 2873 6565 6420 2a20 3138  (abs(((seed * 18
+0000c050: 3129 202a 2028 2873 656c 662e 6d70 695f  1) * ((self.mpi_
+0000c060: 7261 6e6b 202d 2038 3329 202a 2033 3539  rank - 83) * 359
+0000c070: 2929 2025 2031 3034 3732 3929 290a 2020  )) % 104729)).  
+0000c080: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
+0000c090: 7428 2773 6574 7469 6e67 2073 6565 643a  t('setting seed:
+0000c0a0: 272c 2073 656c 662e 6d70 695f 7261 6e6b  ', self.mpi_rank
+0000c0b0: 2c20 7365 6564 290a 2020 2020 2020 2020  , seed).        
+0000c0c0: 2020 2020 6e70 2e72 616e 646f 6d2e 7365      np.random.se
+0000c0d0: 6564 2873 6565 6429 0a0a 2020 2020 6465  ed(seed)..    de
+0000c0e0: 6620 5f63 6865 636b 5f6c 696b 656c 6968  f _check_likelih
+0000c0f0: 6f6f 645f 6675 6e63 7469 6f6e 2873 656c  ood_function(sel
+0000c100: 662c 2074 7261 6e73 666f 726d 2c20 6c6f  f, transform, lo
+0000c110: 676c 696b 652c 206e 756d 5f74 6573 745f  glike, num_test_
+0000c120: 7361 6d70 6c65 7329 3a0a 2020 2020 2020  samples):.      
+0000c130: 2020 2222 2254 6573 7420 7468 6520 6074    """Test the `t
+0000c140: 7261 6e73 666f 726d 6020 616e 6420 606c  ransform` and `l
+0000c150: 6f67 6c69 6b65 606c 6968 6f6f 6420 6675  oglike`lihood fu
+0000c160: 6e63 7469 6f6e 732e 0a0a 2020 2020 2020  nctions...      
+0000c170: 2020 606e 756d 5f74 6573 745f 7361 6d70    `num_test_samp
+0000c180: 6c65 7360 2073 616d 706c 6573 2061 7265  les` samples are
+0000c190: 2075 7365 6420 746f 2063 6865 636b 2077   used to check w
+0000c1a0: 6865 7468 6572 2074 6865 7920 776f 726b  hether they work
+0000c1b0: 2061 6e64 2067 6976 6520 7468 6520 636f   and give the co
+0000c1c0: 7272 6563 7420 6f75 7470 7574 2e0a 0a20  rrect output... 
+0000c1d0: 2020 2020 2020 2072 6574 7572 6e73 2077         returns w
+0000c1e0: 6865 7468 6572 2074 6865 206d 6f73 7420  hether the most 
+0000c1f0: 7265 6365 6e74 6c79 2073 746f 7265 6420  recently stored 
+0000c200: 706f 696e 7420 2869 6620 616e 7929 0a20  point (if any). 
+0000c210: 2020 2020 2020 2073 7469 6c6c 2072 6574         still ret
+0000c220: 7572 6e73 2074 6865 2073 616d 6520 6c69  urns the same li
+0000c230: 6b65 6c69 686f 6f64 2076 616c 7565 2e0a  kelihood value..
+0000c240: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000c250: 2020 2020 2320 646f 2073 6f6d 6520 6368      # do some ch
+0000c260: 6563 6b73 206f 6e20 7468 6520 6c69 6b65  ecks on the like
+0000c270: 6c69 686f 6f64 2066 756e 6374 696f 6e0a  lihood function.
+0000c280: 2020 2020 2020 2020 2320 7468 6973 206d          # this m
+0000c290: 616b 6573 2064 6562 7567 6769 6e67 2065  akes debugging e
+0000c2a0: 6173 6965 7220 6279 2066 6169 6c69 6e67  asier by failing
+0000c2b0: 2065 6172 6c79 2077 6974 6820 6d65 616e   early with mean
+0000c2c0: 696e 6766 756c 2065 7272 6f72 730a 0a20  ingful errors.. 
+0000c2d0: 2020 2020 2020 2023 2069 6620 7765 2061         # if we a
+0000c2e0: 7265 2072 6573 756d 696e 672c 2063 6865  re resuming, che
+0000c2f0: 636b 2074 6861 7420 6c61 7374 2073 616d  ck that last sam
+0000c300: 706c 6520 7374 696c 6c20 6769 7665 7320  ple still gives 
+0000c310: 7361 6d65 2072 6573 756c 740a 2020 2020  same result.    
+0000c320: 2020 2020 6e75 6d5f 7265 7375 6d65 5f74      num_resume_t
+0000c330: 6573 745f 7361 6d70 6c65 7320 3d20 300a  est_samples = 0.
+0000c340: 2020 2020 2020 2020 6966 206e 756d 5f74          if num_t
+0000c350: 6573 745f 7361 6d70 6c65 7320 616e 6420  est_samples and 
+0000c360: 6e6f 7420 7365 6c66 2e70 6f69 6e74 7374  not self.pointst
+0000c370: 6f72 652e 7374 6163 6b5f 656d 7074 793a  ore.stack_empty:
+0000c380: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+0000c390: 5f72 6573 756d 655f 7465 7374 5f73 616d  _resume_test_sam
+0000c3a0: 706c 6573 203d 2031 0a20 2020 2020 2020  ples = 1.       
+0000c3b0: 2020 2020 206e 756d 5f74 6573 745f 7361       num_test_sa
+0000c3c0: 6d70 6c65 7320 2d3d 2031 0a0a 2020 2020  mples -= 1..    
+0000c3d0: 2020 2020 6966 206e 756d 5f74 6573 745f      if num_test_
+0000c3e0: 7361 6d70 6c65 7320 3e20 303a 0a20 2020  samples > 0:.   
+0000c3f0: 2020 2020 2020 2020 2023 2074 6573 7420           # test 
+0000c400: 7769 7468 206e 756d 5f74 6573 745f 7361  with num_test_sa
+0000c410: 6d70 6c65 7320 7261 6e64 6f6d 2070 6f69  mples random poi
+0000c420: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
+0000c430: 7520 3d20 6e70 2e72 616e 646f 6d2e 756e  u = np.random.un
+0000c440: 6966 6f72 6d28 7369 7a65 3d28 6e75 6d5f  iform(size=(num_
+0000c450: 7465 7374 5f73 616d 706c 6573 2c20 7365  test_samples, se
+0000c460: 6c66 2e78 5f64 696d 2929 0a20 2020 2020  lf.x_dim)).     
+0000c470: 2020 2020 2020 2070 203d 2074 7261 6e73         p = trans
+0000c480: 666f 726d 2875 2920 6966 2074 7261 6e73  form(u) if trans
+0000c490: 666f 726d 2069 7320 6e6f 7420 4e6f 6e65  form is not None
+0000c4a0: 2065 6c73 6520 750a 2020 2020 2020 2020   else u.        
+0000c4b0: 2020 2020 6173 7365 7274 206e 702e 7368      assert np.sh
+0000c4c0: 6170 6528 7029 203d 3d20 286e 756d 5f74  ape(p) == (num_t
+0000c4d0: 6573 745f 7361 6d70 6c65 732c 2073 656c  est_samples, sel
+0000c4e0: 662e 6e75 6d5f 7061 7261 6d73 292c 2028  f.num_params), (
+0000c4f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c500: 2022 4572 726f 7220 696e 2074 7261 6e73   "Error in trans
+0000c510: 666f 726d 2066 756e 6374 696f 6e3a 2072  form function: r
+0000c520: 6574 7572 6e65 6420 7368 6170 6520 6973  eturned shape is
+0000c530: 2025 732c 2065 7870 6563 7465 6420 2573   %s, expected %s
+0000c540: 2220 2520 280a 2020 2020 2020 2020 2020  " % (.          
+0000c550: 2020 2020 2020 2020 2020 6e70 2e73 6861            np.sha
+0000c560: 7065 2870 292c 2028 6e75 6d5f 7465 7374  pe(p), (num_test
+0000c570: 5f73 616d 706c 6573 2c20 7365 6c66 2e6e  _samples, self.n
+0000c580: 756d 5f70 6172 616d 7329 2929 0a20 2020  um_params))).   
+0000c590: 2020 2020 2020 2020 206c 6f67 6c20 3d20           logl = 
+0000c5a0: 6c6f 676c 696b 6528 7029 0a20 2020 2020  loglike(p).     
+0000c5b0: 2020 2020 2020 2061 7373 6572 7420 6e70         assert np
+0000c5c0: 2e6c 6f67 6963 616c 5f61 6e64 2875 203e  .logical_and(u >
+0000c5d0: 2030 2c20 7520 3c20 3129 2e61 6c6c 2829   0, u < 1).all()
+0000c5e0: 2c20 280a 2020 2020 2020 2020 2020 2020  , (.            
+0000c5f0: 2020 2020 2245 7272 6f72 2069 6e20 7472      "Error in tr
+0000c600: 616e 7366 6f72 6d20 6675 6e63 7469 6f6e  ansform function
+0000c610: 3a20 7520 7761 7320 6d6f 6469 6669 6564  : u was modified
+0000c620: 2122 290a 2020 2020 2020 2020 2020 2020  !").            
+0000c630: 6173 7365 7274 206e 702e 7368 6170 6528  assert np.shape(
+0000c640: 6c6f 676c 2920 3d3d 2028 6e75 6d5f 7465  logl) == (num_te
+0000c650: 7374 5f73 616d 706c 6573 2c29 2c20 280a  st_samples,), (.
+0000c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c670: 2245 7272 6f72 2069 6e20 6c6f 676c 696b  "Error in loglik
+0000c680: 656c 6968 6f6f 6420 6675 6e63 7469 6f6e  elihood function
+0000c690: 3a20 7265 7475 726e 6564 2073 6861 7065  : returned shape
+0000c6a0: 2069 7320 2573 2c20 6578 7065 6374 6564   is %s, expected
+0000c6b0: 2025 7322 2025 2028 6e70 2e73 6861 7065   %s" % (np.shape
+0000c6c0: 286c 6f67 6c29 2c20 286e 756d 5f74 6573  (logl), (num_tes
+0000c6d0: 745f 7361 6d70 6c65 732c 2929 290a 2020  t_samples,))).  
+0000c6e0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+0000c6f0: 206e 702e 6973 6669 6e69 7465 286c 6f67   np.isfinite(log
+0000c700: 6c29 2e61 6c6c 2829 2c20 280a 2020 2020  l).all(), (.    
+0000c710: 2020 2020 2020 2020 2020 2020 2245 7272              "Err
+0000c720: 6f72 2069 6e20 6c6f 676c 696b 656c 6968  or in loglikelih
+0000c730: 6f6f 6420 6675 6e63 7469 6f6e 3a20 7265  ood function: re
+0000c740: 7475 726e 6564 206e 6f6e 2d66 696e 6974  turned non-finit
+0000c750: 6520 6e75 6d62 6572 3a20 2573 2066 6f72  e number: %s for
+0000c760: 2069 6e70 7574 2075 3d25 7320 703d 2573   input u=%s p=%s
+0000c770: 2220 2520 286c 6f67 6c2c 2075 2c20 7029  " % (logl, u, p)
+0000c780: 290a 0a20 2020 2020 2020 2069 6620 6e6f  )..        if no
+0000c790: 7420 7365 6c66 2e70 6f69 6e74 7374 6f72  t self.pointstor
+0000c7a0: 652e 7374 6163 6b5f 656d 7074 7920 616e  e.stack_empty an
+0000c7b0: 6420 6e75 6d5f 7265 7375 6d65 5f74 6573  d num_resume_tes
+0000c7c0: 745f 7361 6d70 6c65 7320 3e20 303a 0a20  t_samples > 0:. 
+0000c7d0: 2020 2020 2020 2020 2020 2023 2074 6573             # tes
+0000c7e0: 7420 7468 6174 206c 6173 7420 7361 6d70  t that last samp
+0000c7f0: 6c65 2067 6976 6573 2074 6865 2073 616d  le gives the sam
+0000c800: 6520 6c69 6b65 6c69 686f 6f64 2076 616c  e likelihood val
+0000c810: 7565 0a20 2020 2020 2020 2020 2020 205f  ue.            _
+0000c820: 2c20 6c61 7374 726f 7720 3d20 7365 6c66  , lastrow = self
+0000c830: 2e70 6f69 6e74 7374 6f72 652e 7374 6163  .pointstore.stac
+0000c840: 6b5b 2d31 5d0a 2020 2020 2020 2020 2020  k[-1].          
+0000c850: 2020 6173 7365 7274 206c 656e 286c 6173    assert len(las
+0000c860: 7472 6f77 2920 3d3d 2033 202b 2073 656c  trow) == 3 + sel
+0000c870: 662e 785f 6469 6d20 2b20 7365 6c66 2e6e  f.x_dim + self.n
+0000c880: 756d 5f70 6172 616d 732c 2028 0a20 2020  um_params, (.   
+0000c890: 2020 2020 2020 2020 2020 2020 2022 4361               "Ca
+0000c8a0: 6e6e 6f74 2072 6573 756d 653a 2070 726f  nnot resume: pro
+0000c8b0: 626c 656d 2068 6173 2064 6966 6665 7265  blem has differe
+0000c8c0: 6e74 2064 696d 656e 7369 6f6e 616c 6974  nt dimensionalit
+0000c8d0: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
+0000c8e0: 2020 2020 6c65 6e28 6c61 7374 726f 7729      len(lastrow)
+0000c8f0: 2c20 2832 2c20 7365 6c66 2e78 5f64 696d  , (2, self.x_dim
+0000c900: 2c20 7365 6c66 2e6e 756d 5f70 6172 616d  , self.num_param
+0000c910: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
+0000c920: 6c61 7374 4c20 3d20 6c61 7374 726f 775b  lastL = lastrow[
+0000c930: 315d 0a20 2020 2020 2020 2020 2020 206c  1].            l
+0000c940: 6173 7475 203d 206c 6173 7472 6f77 5b33  astu = lastrow[3
+0000c950: 3a33 202b 2073 656c 662e 785f 6469 6d5d  :3 + self.x_dim]
+0000c960: 0a20 2020 2020 2020 2020 2020 2075 203d  .            u =
+0000c970: 206c 6173 7475 2e72 6573 6861 7065 2828   lastu.reshape((
+0000c980: 312c 202d 3129 290a 2020 2020 2020 2020  1, -1)).        
+0000c990: 2020 2020 6c61 7374 7020 3d20 6c61 7374      lastp = last
+0000c9a0: 726f 775b 3320 2b20 7365 6c66 2e78 5f64  row[3 + self.x_d
+0000c9b0: 696d 3a33 202b 2073 656c 662e 785f 6469  im:3 + self.x_di
+0000c9c0: 6d20 2b20 7365 6c66 2e6e 756d 5f70 6172  m + self.num_par
+0000c9d0: 616d 735d 0a20 2020 2020 2020 2020 2020  ams].           
+0000c9e0: 2069 6620 7365 6c66 2e6c 6f67 3a0a 2020   if self.log:.  
+0000c9f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000ca00: 6c66 2e6c 6f67 6765 722e 6465 6275 6728  lf.logger.debug(
+0000ca10: 2254 6573 7469 6e67 2072 6573 756d 6520  "Testing resume 
+0000ca20: 636f 6e73 6973 7465 6e63 793a 2025 733a  consistency: %s:
+0000ca30: 2075 3d25 7320 2d3e 2070 3d25 7320 2d3e   u=%s -> p=%s ->
+0000ca40: 204c 3d25 7320 222c 206c 6173 7472 6f77   L=%s ", lastrow
+0000ca50: 2c20 6c61 7374 752c 206c 6173 7470 2c20  , lastu, lastp, 
+0000ca60: 6c61 7374 4c29 0a20 2020 2020 2020 2020  lastL).         
+0000ca70: 2020 2070 203d 2074 7261 6e73 666f 726d     p = transform
+0000ca80: 2875 2920 6966 2074 7261 6e73 666f 726d  (u) if transform
+0000ca90: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
+0000caa0: 6520 750a 2020 2020 2020 2020 2020 2020  e u.            
+0000cab0: 6966 206e 6f74 206e 702e 616c 6c63 6c6f  if not np.allclo
+0000cac0: 7365 2870 2e66 6c61 7474 656e 2829 2c20  se(p.flatten(), 
+0000cad0: 6c61 7374 7029 2061 6e64 2073 656c 662e  lastp) and self.
+0000cae0: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
+0000caf0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0000cb00: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+0000cb10: 2020 2020 2020 2020 2020 2020 2020 2254                "T
+0000cb20: 7279 696e 6720 746f 2072 6573 756d 6520  rying to resume 
+0000cb30: 6672 6f6d 2070 7265 7669 6f75 7320 7275  from previous ru
+0000cb40: 6e2c 2062 7574 2074 7261 6e73 666f 726d  n, but transform
+0000cb50: 2066 756e 6374 696f 6e20 6769 7665 7320   function gives 
+0000cb60: 6469 6666 6572 656e 7420 7265 7375 6c74  different result
+0000cb70: 3a20 2573 2067 6176 6520 2573 2c20 6e6f  : %s gave %s, no
+0000cb80: 7720 2573 222c 0a20 2020 2020 2020 2020  w %s",.         
+0000cb90: 2020 2020 2020 2020 2020 206c 6173 7475             lastu
+0000cba0: 2c20 6c61 7374 702c 2070 2e66 6c61 7474  , lastp, p.flatt
+0000cbb0: 656e 2829 290a 2020 2020 2020 2020 2020  en()).          
+0000cbc0: 2020 6173 7365 7274 206e 702e 616c 6c63    assert np.allc
+0000cbd0: 6c6f 7365 2870 2e66 6c61 7474 656e 2829  lose(p.flatten()
+0000cbe0: 2c20 6c61 7374 7029 2c20 280a 2020 2020  , lastp), (.    
+0000cbf0: 2020 2020 2020 2020 2020 2020 2243 616e              "Can
+0000cc00: 6e6f 7420 7265 7375 6d65 2062 6563 6175  not resume becau
+0000cc10: 7365 2074 7261 6e73 666f 726d 2066 756e  se transform fun
+0000cc20: 6374 696f 6e20 6368 616e 6765 642e 2022  ction changed. "
+0000cc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cc40: 2022 546f 2073 7461 7274 2066 726f 6d20   "To start from 
+0000cc50: 7363 7261 7463 682c 2064 656c 6574 6520  scratch, delete 
+0000cc60: 2725 7327 2e22 2025 2028 7365 6c66 2e6c  '%s'." % (self.l
+0000cc70: 6f67 735b 2772 756e 5f64 6972 275d 2929  ogs['run_dir']))
+0000cc80: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+0000cc90: 6c20 3d20 6c6f 676c 696b 6528 7029 2e66  l = loglike(p).f
+0000cca0: 6c61 7474 656e 2829 5b30 5d0a 2020 2020  latten()[0].    
+0000ccb0: 2020 2020 2020 2020 6966 206e 6f74 206e          if not n
+0000ccc0: 702e 6973 636c 6f73 6528 6c6f 676c 2c20  p.isclose(logl, 
+0000ccd0: 6c61 7374 4c29 2061 6e64 2073 656c 662e  lastL) and self.
+0000cce0: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
+0000ccf0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0000cd00: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+0000cd10: 2020 2020 2020 2020 2020 2020 2020 2254                "T
+0000cd20: 7279 696e 6720 746f 2072 6573 756d 6520  rying to resume 
+0000cd30: 6672 6f6d 2070 7265 7669 6f75 7320 7275  from previous ru
+0000cd40: 6e2c 2062 7574 206c 696b 656c 6968 6f6f  n, but likelihoo
+0000cd50: 6420 6675 6e63 7469 6f6e 2067 6976 6573  d function gives
+0000cd60: 2064 6966 6665 7265 6e74 2072 6573 756c   different resul
+0000cd70: 743a 2025 7320 6761 7665 2025 732c 206e  t: %s gave %s, n
+0000cd80: 6f77 2025 7322 2c0a 2020 2020 2020 2020  ow %s",.        
+0000cd90: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+0000cda0: 752e 666c 6174 7465 6e28 292c 206c 6173  u.flatten(), las
+0000cdb0: 744c 2c20 6c6f 676c 290a 2020 2020 2020  tL, logl).      
+0000cdc0: 2020 2020 2020 7265 7475 726e 206e 702e        return np.
+0000cdd0: 6973 636c 6f73 6528 6c6f 676c 2c20 6c61  isclose(logl, la
+0000cde0: 7374 4c29 0a20 2020 2020 2020 2072 6574  stL).        ret
+0000cdf0: 7572 6e20 5472 7565 0a0a 2020 2020 6465  urn True..    de
+0000ce00: 6620 5f73 6574 5f6c 696b 656c 6968 6f6f  f _set_likelihoo
+0000ce10: 645f 6675 6e63 7469 6f6e 2873 656c 662c  d_function(self,
+0000ce20: 2074 7261 6e73 666f 726d 2c20 6c6f 676c   transform, logl
+0000ce30: 696b 652c 206e 756d 5f74 6573 745f 7361  ike, num_test_sa
+0000ce40: 6d70 6c65 732c 206d 616b 655f 7361 6665  mples, make_safe
+0000ce50: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+0000ce60: 2022 2222 5374 6f72 6520 7468 6520 7472   """Store the tr
+0000ce70: 616e 7366 6f72 6d20 616e 6420 6c6f 672d  ansform and log-
+0000ce80: 6c69 6b65 6c69 686f 6f64 2066 756e 6374  likelihood funct
+0000ce90: 696f 6e73 2e0a 0a20 2020 2020 2020 2069  ions...        i
+0000cea0: 6620 6d61 6b65 5f73 6166 6520 6973 2073  f make_safe is s
+0000ceb0: 6574 2c20 6d61 6b65 2066 756e 6374 696f  et, make functio
+0000cec0: 6e73 2073 6166 6572 2062 7920 6163 6365  ns safer by acce
+0000ced0: 7074 696e 6720 6d69 7366 6f72 6d65 640a  pting misformed.
+0000cee0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000cef0: 6861 7065 7320 616e 6420 6e6f 6e2d 6669  hapes and non-fi
+0000cf00: 6e69 7465 206c 696b 656c 6968 6f6f 6420  nite likelihood 
+0000cf10: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
+0000cf20: 2222 220a 0a20 2020 2020 2020 2064 6566  """..        def
+0000cf30: 2073 6166 655f 6c6f 676c 696b 6528 7829   safe_loglike(x)
+0000cf40: 3a0a 2020 2020 2020 2020 2020 2020 2222  :.            ""
+0000cf50: 2253 6166 6520 7772 6170 7065 7220 6f66  "Safe wrapper of
+0000cf60: 206c 696b 656c 6968 6f6f 6420 6675 6e63   likelihood func
+0000cf70: 7469 6f6e 2e22 2222 0a20 2020 2020 2020  tion.""".       
+0000cf80: 2020 2020 2078 203d 206e 702e 6173 6172       x = np.asar
+0000cf90: 7261 7928 7829 0a20 2020 2020 2020 2020  ray(x).         
+0000cfa0: 2020 2069 6620 6c65 6e28 782e 7368 6170     if len(x.shap
+0000cfb0: 6529 203d 3d20 313a 0a20 2020 2020 2020  e) == 1:.       
+0000cfc0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+0000cfd0: 782e 7368 6170 655b 305d 203d 3d20 7365  x.shape[0] == se
+0000cfe0: 6c66 2e78 5f64 696d 0a20 2020 2020 2020  lf.x_dim.       
+0000cff0: 2020 2020 2020 2020 2078 203d 206e 702e           x = np.
+0000d000: 6578 7061 6e64 5f64 696d 7328 782c 2030  expand_dims(x, 0
+0000d010: 290a 2020 2020 2020 2020 2020 2020 6c6f  ).            lo
+0000d020: 676c 203d 206c 6f67 6c69 6b65 2878 290a  gl = loglike(x).
+0000d030: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000d040: 656e 286c 6f67 6c2e 7368 6170 6529 203d  en(logl.shape) =
+0000d050: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0000d060: 2020 2020 206c 6f67 6c20 3d20 6e70 2e65       logl = np.e
+0000d070: 7870 616e 645f 6469 6d73 286c 6f67 6c2c  xpand_dims(logl,
+0000d080: 2030 290a 2020 2020 2020 2020 2020 2020   0).            
+0000d090: 6c6f 676c 5b6e 702e 6c6f 6769 6361 6c5f  logl[np.logical_
+0000d0a0: 6e6f 7428 6e70 2e69 7366 696e 6974 6528  not(np.isfinite(
+0000d0b0: 6c6f 676c 2929 5d20 3d20 2d31 6531 3030  logl))] = -1e100
+0000d0c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000d0d0: 7572 6e20 6c6f 676c 0a0a 2020 2020 2020  urn logl..      
+0000d0e0: 2020 6966 206d 616b 655f 7361 6665 3a0a    if make_safe:.
+0000d0f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000d100: 2e6c 6f67 6c69 6b65 203d 2073 6166 655f  .loglike = safe_
+0000d110: 6c6f 676c 696b 650a 2020 2020 2020 2020  loglike.        
+0000d120: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000d130: 2020 7365 6c66 2e6c 6f67 6c69 6b65 203d    self.loglike =
+0000d140: 206c 6f67 6c69 6b65 0a0a 2020 2020 2020   loglike..      
+0000d150: 2020 6966 2074 7261 6e73 666f 726d 2069    if transform i
+0000d160: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0000d170: 2020 2020 7365 6c66 2e74 7261 6e73 666f      self.transfo
+0000d180: 726d 203d 206c 616d 6264 6120 783a 2078  rm = lambda x: x
+0000d190: 0a20 2020 2020 2020 2065 6c69 6620 6d61  .        elif ma
+0000d1a0: 6b65 5f73 6166 653a 0a20 2020 2020 2020  ke_safe:.       
+0000d1b0: 2020 2020 2064 6566 2073 6166 655f 7472       def safe_tr
+0000d1c0: 616e 7366 6f72 6d28 7829 3a0a 2020 2020  ansform(x):.    
+0000d1d0: 2020 2020 2020 2020 2020 2020 2222 2253              """S
+0000d1e0: 6166 6520 7772 6170 7065 7220 6f66 2074  afe wrapper of t
+0000d1f0: 7261 6e73 666f 726d 2066 756e 6374 696f  ransform functio
+0000d200: 6e2e 2222 220a 2020 2020 2020 2020 2020  n.""".          
+0000d210: 2020 2020 2020 7820 3d20 6e70 2e61 7361        x = np.asa
+0000d220: 7272 6179 2878 290a 2020 2020 2020 2020  rray(x).        
+0000d230: 2020 2020 2020 2020 6966 206c 656e 2878          if len(x
+0000d240: 2e73 6861 7065 2920 3d3d 2031 3a0a 2020  .shape) == 1:.  
+0000d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d260: 2020 6173 7365 7274 2078 2e73 6861 7065    assert x.shape
+0000d270: 5b30 5d20 3d3d 2073 656c 662e 785f 6469  [0] == self.x_di
+0000d280: 6d0a 2020 2020 2020 2020 2020 2020 2020  m.              
+0000d290: 2020 2020 2020 7820 3d20 6e70 2e65 7870        x = np.exp
+0000d2a0: 616e 645f 6469 6d73 2878 2c20 3029 0a20  and_dims(x, 0). 
+0000d2b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d2c0: 6574 7572 6e20 7472 616e 7366 6f72 6d28  eturn transform(
+0000d2d0: 7829 0a20 2020 2020 2020 2020 2020 2073  x).            s
+0000d2e0: 656c 662e 7472 616e 7366 6f72 6d20 3d20  elf.transform = 
+0000d2f0: 7361 6665 5f74 7261 6e73 666f 726d 0a20  safe_transform. 
+0000d300: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000d310: 2020 2020 2020 2020 2073 656c 662e 7472           self.tr
+0000d320: 616e 7366 6f72 6d20 3d20 7472 616e 7366  ansform = transf
+0000d330: 6f72 6d0a 0a20 2020 2020 2020 206c 696d  orm..        lim
+0000d340: 7320 3d20 6e70 2e6f 6e65 7328 2832 2c20  s = np.ones((2, 
+0000d350: 7365 6c66 2e78 5f64 696d 2929 0a20 2020  self.x_dim)).   
+0000d360: 2020 2020 206c 696d 735b 302c 3a5d 203d       lims[0,:] =
+0000d370: 2031 652d 360a 2020 2020 2020 2020 6c69   1e-6.        li
+0000d380: 6d73 5b31 2c3a 5d20 3d20 3120 2d20 3165  ms[1,:] = 1 - 1e
+0000d390: 2d36 0a20 2020 2020 2020 2073 656c 662e  -6.        self.
+0000d3a0: 7472 616e 7366 6f72 6d5f 6c69 6d69 7473  transform_limits
+0000d3b0: 203d 2073 656c 662e 7472 616e 7366 6f72   = self.transfor
+0000d3c0: 6d28 6c69 6d73 292e 7472 616e 7370 6f73  m(lims).transpos
+0000d3d0: 6528 290a 0a20 2020 2020 2020 2073 656c  e()..        sel
+0000d3e0: 662e 766f 6c66 6163 746f 7220 3d20 766f  f.volfactor = vo
+0000d3f0: 6c5f 7072 6566 6163 746f 7228 7365 6c66  l_prefactor(self
+0000d400: 2e78 5f64 696d 290a 0a20 2020 2064 6566  .x_dim)..    def
+0000d410: 205f 7769 6465 6e5f 6e6f 6465 7328 7365   _widen_nodes(se
+0000d420: 6c66 2c20 7765 6967 6874 6564 5f70 6172  lf, weighted_par
+0000d430: 656e 7473 2c20 7765 6967 6874 732c 206e  ents, weights, n
+0000d440: 6e6f 6465 735f 6e65 6564 6564 2c20 7570  nodes_needed, up
+0000d450: 6461 7465 5f69 6e74 6572 7661 6c5f 6e63  date_interval_nc
+0000d460: 616c 6c29 3a0a 2020 2020 2020 2020 2222  all):.        ""
+0000d470: 2245 6e73 7572 6520 7468 6174 2061 7420  "Ensure that at 
+0000d480: 7061 7265 6e74 7320 6861 7665 2060 6e6e  parents have `nn
+0000d490: 6f64 6573 5f6e 6565 6465 6460 206c 6976  odes_needed` liv
+0000d4a0: 6520 706f 696e 7473 2028 7061 7261 6c6c  e points (parall
+0000d4b0: 656c 2061 7263 7329 2e0a 0a20 2020 2020  el arcs)...     
+0000d4c0: 2020 2049 6620 6e6f 742c 2066 696c 6c20     If not, fill 
+0000d4d0: 7570 2062 7920 7361 6d70 6c69 6e67 2e0a  up by sampling..
+0000d4e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000d4f0: 2020 2020 6e64 6f6e 6520 3d20 6c65 6e28      ndone = len(
+0000d500: 7765 6967 6874 6564 5f70 6172 656e 7473  weighted_parents
+0000d510: 290a 2020 2020 2020 2020 6966 206e 646f  ).        if ndo
+0000d520: 6e65 203d 3d20 303a 0a20 2020 2020 2020  ne == 0:.       
+0000d530: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
+0000d540: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d550: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
+0000d560: 666f 2827 4e6f 2070 6172 656e 7473 2c20  fo('No parents, 
+0000d570: 736f 2077 6964 656e 696e 6720 726f 6f74  so widening root
+0000d580: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
+0000d590: 7365 6c66 2e5f 7769 6465 6e5f 726f 6f74  self._widen_root
+0000d5a0: 7328 6e6e 6f64 6573 5f6e 6565 6465 6429  s(nnodes_needed)
+0000d5b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000d5c0: 7572 6e20 7b7d 0a0a 2020 2020 2020 2020  urn {}..        
+0000d5d0: 2320 7365 6c65 6374 2070 6172 656e 7473  # select parents
+0000d5e0: 2077 6974 6820 7765 6967 6874 2031 2f70   with weight 1/p
+0000d5f0: 6172 656e 745f 7765 6967 6874 730a 2020  arent_weights.  
+0000d600: 2020 2020 2020 7020 3d20 312e 202f 206e        p = 1. / n
+0000d610: 702e 6172 7261 7928 7765 6967 6874 7329  p.array(weights)
+0000d620: 0a20 2020 2020 2020 2069 6620 2870 203d  .        if (p =
+0000d630: 3d20 705b 305d 292e 616c 6c28 293a 0a20  = p[0]).all():. 
+0000d640: 2020 2020 2020 2020 2020 2070 6172 656e             paren
+0000d650: 7473 203d 2077 6569 6768 7465 645f 7061  ts = weighted_pa
+0000d660: 7265 6e74 730a 2020 2020 2020 2020 656c  rents.        el
+0000d670: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000d680: 2320 7072 6566 6572 656e 7469 616c 6c79  # preferentially
+0000d690: 2073 656c 6563 7420 6e6f 6465 7320 7769   select nodes wi
+0000d6a0: 7468 2066 6577 2070 6172 656e 7473 2c20  th few parents, 
+0000d6b0: 6173 2074 686f 7365 0a20 2020 2020 2020  as those.       
+0000d6c0: 2020 2020 2023 2068 6176 6520 6d6f 7374       # have most
+0000d6d0: 2077 6569 6768 740a 2020 2020 2020 2020   weight.        
+0000d6e0: 2020 2020 6920 3d20 6e70 2e72 616e 646f      i = np.rando
+0000d6f0: 6d2e 6368 6f69 6365 286c 656e 2877 6569  m.choice(len(wei
+0000d700: 6768 7465 645f 7061 7265 6e74 7329 2c20  ghted_parents), 
+0000d710: 7369 7a65 3d6e 6e6f 6465 735f 6e65 6564  size=nnodes_need
+0000d720: 6564 2c20 703d 7020 2f20 702e 7375 6d28  ed, p=p / p.sum(
+0000d730: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
+0000d740: 6620 7365 6c66 2e75 7365 5f6d 7069 3a0a  f self.use_mpi:.
+0000d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d760: 6920 3d20 7365 6c66 2e63 6f6d 6d2e 6263  i = self.comm.bc
+0000d770: 6173 7428 692c 2072 6f6f 743d 3029 0a0a  ast(i, root=0)..
+0000d780: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+0000d790: 6e74 7320 3d20 5b77 6569 6768 7465 645f  nts = [weighted_
+0000d7a0: 7061 7265 6e74 735b 6969 5d20 666f 7220  parents[ii] for 
+0000d7b0: 6969 2069 6e20 695d 0a0a 2020 2020 2020  ii in i]..      
+0000d7c0: 2020 6465 6c20 7765 6967 6874 6564 5f70    del weighted_p
+0000d7d0: 6172 656e 7473 2c20 7765 6967 6874 730a  arents, weights.
+0000d7e0: 0a20 2020 2020 2020 2023 2073 6f72 7420  .        # sort 
+0000d7f0: 6672 6f6d 206c 6f77 2074 6f20 6869 6768  from low to high
+0000d800: 0a20 2020 2020 2020 2070 6172 656e 7473  .        parents
+0000d810: 2e73 6f72 7428 6b65 793d 6f70 6572 6174  .sort(key=operat
+0000d820: 6f72 2e61 7474 7267 6574 7465 7228 2776  or.attrgetter('v
+0000d830: 616c 7565 2729 290a 2020 2020 2020 2020  alue')).        
+0000d840: 4c6d 696e 203d 2070 6172 656e 7473 5b30  Lmin = parents[0
+0000d850: 5d2e 7661 6c75 650a 2020 2020 2020 2020  ].value.        
+0000d860: 6966 206e 702e 6973 696e 6628 4c6d 696e  if np.isinf(Lmin
+0000d870: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+0000d880: 2073 6f6d 6520 6f66 2074 6865 2070 6172   some of the par
+0000d890: 656e 7473 2077 6572 6520 626f 726e 2062  ents were born b
+0000d8a0: 7920 7361 6d70 6c69 6e67 2066 726f 6d20  y sampling from 
+0000d8b0: 7468 6520 656e 7469 7265 0a20 2020 2020  the entire.     
+0000d8c0: 2020 2020 2020 2023 2070 7269 6f72 2076         # prior v
+0000d8d0: 6f6c 756d 652e 2053 6f20 7765 2063 616e  olume. So we can
+0000d8e0: 2065 6666 6963 6965 6e74 6c79 2061 7070   efficiently app
+0000d8f0: 6c79 2061 2073 6f6c 7574 696f 6e3a 0a20  ly a solution:. 
+0000d900: 2020 2020 2020 2020 2020 2023 2065 7870             # exp
+0000d910: 616e 6420 7468 6520 726f 6f74 730a 2020  and the roots.  
+0000d920: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000d930: 662e 6c6f 673a 0a20 2020 2020 2020 2020  f.log:.         
+0000d940: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+0000d950: 6572 2e69 6e66 6f28 2770 6172 656e 7420  er.info('parent 
+0000d960: 7661 6c75 6520 6973 202d 696e 662c 2073  value is -inf, s
+0000d970: 6f20 7769 6465 6e69 6e67 2072 6f6f 7473  o widening roots
+0000d980: 2729 0a20 2020 2020 2020 2020 2020 2073  ').            s
+0000d990: 656c 662e 5f77 6964 656e 5f72 6f6f 7473  elf._widen_roots
+0000d9a0: 286e 6e6f 6465 735f 6e65 6564 6564 290a  (nnodes_needed).
+0000d9b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000d9c0: 726e 207b 7d0a 0a20 2020 2020 2020 2023  rn {}..        #
+0000d9d0: 2064 6f75 626c 6520 756e 7469 6c20 7765   double until we
+0000d9e0: 2072 6561 6368 2074 6865 206e 6563 6573   reach the neces
+0000d9f0: 7361 7279 2070 6f69 6e74 730a 2020 2020  sary points.    
+0000da00: 2020 2020 2320 7468 6973 2069 7320 7072      # this is pr
+0000da10: 6f62 6162 6c79 2031 2c20 6672 6f6d 2028  obably 1, from (
+0000da20: 324b 202d 204b 2920 2f20 4b0a 2020 2020  2K - K) / K.    
+0000da30: 2020 2020 6e73 616d 706c 6573 203d 2069      nsamples = i
+0000da40: 6e74 286e 702e 6365 696c 2828 6e6e 6f64  nt(np.ceil((nnod
+0000da50: 6573 5f6e 6565 6465 6420 2d20 6e64 6f6e  es_needed - ndon
+0000da60: 6529 202f 206c 656e 2870 6172 656e 7473  e) / len(parents
+0000da70: 2929 290a 0a20 2020 2020 2020 2069 6620  )))..        if 
+0000da80: 7365 6c66 2e6c 6f67 3a0a 2020 2020 2020  self.log:.      
+0000da90: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0000daa0: 722e 696e 666f 2827 5769 6c6c 2061 6464  r.info('Will add
+0000dab0: 2025 6420 6c69 7665 2070 6f69 6e74 7320   %d live points 
+0000dac0: 2878 2564 2920 6174 204c 3d25 2e31 6720  (x%d) at L=%.1g 
+0000dad0: 2e2e 2e27 2c20 6e6e 6f64 6573 5f6e 6565  ...', nnodes_nee
+0000dae0: 6465 6420 2d20 6e64 6f6e 652c 206e 7361  ded - ndone, nsa
+0000daf0: 6d70 6c65 732c 204c 6d69 6e29 0a0a 2020  mples, Lmin)..  
+0000db00: 2020 2020 2020 2320 6164 6420 706f 696e        # add poin
+0000db10: 7473 2077 6865 7265 206e 6563 6573 7361  ts where necessa
+0000db20: 7279 2028 7061 7265 6e74 7320 6361 6e20  ry (parents can 
+0000db30: 6861 7665 206d 756c 7469 706c 6520 656e  have multiple en
+0000db40: 7472 6965 7329 0a20 2020 2020 2020 2074  tries).        t
+0000db50: 6172 6765 745f 6d69 6e5f 6e75 6d5f 6368  arget_min_num_ch
+0000db60: 696c 6472 656e 203d 207b 7d0a 2020 2020  ildren = {}.    
+0000db70: 2020 2020 666f 7220 6e20 696e 2070 6172      for n in par
+0000db80: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
+0000db90: 2020 6f72 6967 6e20 3d20 7461 7267 6574    orign = target
+0000dba0: 5f6d 696e 5f6e 756d 5f63 6869 6c64 7265  _min_num_childre
+0000dbb0: 6e2e 6765 7428 6e2e 6964 2c20 6c65 6e28  n.get(n.id, len(
+0000dbc0: 6e2e 6368 696c 6472 656e 2929 0a20 2020  n.children)).   
+0000dbd0: 2020 2020 2020 2020 2074 6172 6765 745f           target_
+0000dbe0: 6d69 6e5f 6e75 6d5f 6368 696c 6472 656e  min_num_children
+0000dbf0: 5b6e 2e69 645d 203d 206f 7269 676e 202b  [n.id] = orign +
+0000dc00: 206e 7361 6d70 6c65 730a 0a20 2020 2020   nsamples..     
+0000dc10: 2020 2072 6574 7572 6e20 7461 7267 6574     return target
+0000dc20: 5f6d 696e 5f6e 756d 5f63 6869 6c64 7265  _min_num_childre
+0000dc30: 6e0a 0a20 2020 2064 6566 205f 7769 6465  n..    def _wide
+0000dc40: 6e5f 726f 6f74 735f 6265 796f 6e64 5f69  n_roots_beyond_i
+0000dc50: 6e69 7469 616c 5f70 6c61 7465 6175 2873  nitial_plateau(s
+0000dc60: 656c 662c 206e 726f 6f74 732c 206e 756d  elf, nroots, num
+0000dc70: 5f77 6172 6e2c 206e 756d 5f73 746f 7029  _warn, num_stop)
+0000dc80: 3a0a 2020 2020 2020 2020 2222 2257 6964  :.        """Wid
+0000dc90: 656e 2072 6f6f 7473 2c20 6275 7420 706f  en roots, but po
+0000dca0: 7075 6c61 7465 2061 6865 6164 206f 6620  pulate ahead of 
+0000dcb0: 696e 6974 6961 6c20 706c 6174 6561 752e  initial plateau.
+0000dcc0: 0a0a 2020 2020 2020 2020 6361 6c6c 7320  ..        calls 
+0000dcd0: 5f77 6964 656e 5f72 6f6f 7473 2c20 616e  _widen_roots, an
+0000dce0: 6420 6966 2074 6865 7265 2061 7265 2073  d if there are s
+0000dcf0: 6576 6572 616c 2070 6f69 6e74 7320 7769  everal points wi
+0000dd00: 7468 2074 6865 2073 616d 650a 2020 2020  th the same.    
+0000dd10: 2020 2020 7661 6c75 6520 6571 7561 6c20      value equal 
+0000dd20: 746f 2074 6865 206c 6f77 6573 7420 6c6f  to the lowest lo
+0000dd30: 676c 696b 656c 6968 6f6f 642c 2077 6964  glikelihood, wid
+0000dd40: 656e 7320 736f 6d65 206d 6f72 6520 756e  ens some more un
+0000dd50: 7469 6c0a 2020 2020 2020 2020 7468 6572  til.        ther
+0000dd60: 6520 6172 6520 606e 726f 6f74 7360 2d31  e are `nroots`-1
+0000dd70: 2074 6861 7420 6172 6520 6469 6666 6572   that are differ
+0000dd80: 656e 7420 746f 2074 6865 206c 6f77 6573  ent to the lowes
+0000dd90: 740a 2020 2020 2020 2020 6c6f 676c 696b  t.        loglik
+0000dda0: 656c 6968 6f6f 6420 7661 6c75 652e 0a0a  elihood value...
+0000ddb0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+0000ddc0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+0000ddd0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 206e  ------.        n
+0000dde0: 726f 6f74 733a 2069 6e74 0a20 2020 2020  roots: int.     
+0000ddf0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
+0000de00: 2072 6f6f 7420 6c69 7665 2070 6f69 6e74   root live point
+0000de10: 732c 2061 6674 6572 2074 6865 2070 6c61  s, after the pla
+0000de20: 7465 6175 2069 7320 7472 6176 6572 7365  teau is traverse
+0000de30: 642e 0a0a 2020 2020 2020 2020 6e75 6d5f  d...        num_
+0000de40: 7761 726e 3a20 696e 740a 2020 2020 2020  warn: int.      
+0000de50: 2020 2020 2020 5761 726e 2069 6620 7468        Warn if th
+0000de60: 6520 6e75 6d62 6572 206f 6620 726f 6f74  e number of root
+0000de70: 206c 6976 6520 706f 696e 7473 2072 6561   live points rea
+0000de80: 6368 6564 2074 6869 732e 0a0a 2020 2020  ched this...    
+0000de90: 2020 2020 6e75 6d5f 7374 6f70 3a20 696e      num_stop: in
+0000dea0: 740a 2020 2020 2020 2020 2020 2020 446f  t.            Do
+0000deb0: 206e 6f74 2069 6e63 7265 6173 696e 6720   not increasing 
+0000dec0: 7468 6520 6e75 6d62 6572 206f 6620 726f  the number of ro
+0000ded0: 6f74 206c 6976 6520 706f 696e 7473 2062  ot live points b
+0000dee0: 6579 6f6e 6420 7468 6973 206c 696d 6974  eyond this limit
+0000def0: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
+0000df00: 2020 2020 2020 206e 726f 6f74 735f 6e65         nroots_ne
+0000df10: 6564 6564 203d 206e 726f 6f74 730a 2020  eded = nroots.  
+0000df20: 2020 2020 2020 7573 6572 5f68 6173 5f62        user_has_b
+0000df30: 6565 6e5f 7761 726e 6564 203d 2046 616c  een_warned = Fal
+0000df40: 7365 0a20 2020 2020 2020 2077 6869 6c65  se.        while
+0000df50: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+0000df60: 2020 2073 656c 662e 5f77 6964 656e 5f72     self._widen_r
+0000df70: 6f6f 7473 286e 726f 6f74 735f 6e65 6564  oots(nroots_need
+0000df80: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
+0000df90: 4c73 203d 206e 702e 6172 7261 7928 5b6e  Ls = np.array([n
+0000dfa0: 6f64 652e 7661 6c75 6520 666f 7220 6e6f  ode.value for no
+0000dfb0: 6465 2069 6e20 7365 6c66 2e72 6f6f 742e  de in self.root.
+0000dfc0: 6368 696c 6472 656e 5d29 0a20 2020 2020  children]).     
+0000dfd0: 2020 2020 2020 204c 6d69 6e20 3d20 6e70         Lmin = np
+0000dfe0: 2e6d 696e 284c 7329 0a20 2020 2020 2020  .min(Ls).       
+0000dff0: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
+0000e000: 2061 6e64 206e 726f 6f74 735f 6e65 6564   and nroots_need
+0000e010: 6564 203e 206e 756d 5f77 6172 6e20 616e  ed > num_warn an
+0000e020: 6420 6e6f 7420 7573 6572 5f68 6173 5f62  d not user_has_b
+0000e030: 6565 6e5f 7761 726e 6564 3a0a 2020 2020  een_warned:.    
+0000e040: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000e050: 2e6c 6f67 6765 722e 7761 726e 696e 6728  .logger.warning(
+0000e060: 2222 2257 6172 6e69 6e67 3a20 5468 6520  """Warning: The 
+0000e070: 6c6f 672d 6c69 6b65 6c69 686f 6f64 2068  log-likelihood h
+0000e080: 6173 2061 206c 6172 6765 2070 6c61 7465  as a large plate
+0000e090: 6175 2077 6974 6820 4c3d 2567 2e0a 0a20  au with L=%g... 
+0000e0a0: 2050 726f 6261 626c 7920 796f 7520 6172   Probably you ar
+0000e0b0: 6520 7265 7475 726e 696e 6720 6120 6c6f  e returning a lo
+0000e0c0: 7720 7661 6c75 6520 7768 656e 2074 6865  w value when the
+0000e0d0: 2070 6172 616d 6574 6572 7320 6172 6520   parameters are 
+0000e0e0: 7072 6f62 6c65 6d61 7469 632f 756e 7068  problematic/unph
+0000e0f0: 7973 6963 616c 2e0a 2020 756c 7472 616e  ysical..  ultran
+0000e100: 6573 7420 6361 6e20 6861 6e64 6c65 2074  est can handle t
+0000e110: 6869 7320 636f 7272 6563 746c 792c 2062  his correctly, b
+0000e120: 7920 6469 7363 6172 6469 6e67 206c 6976  y discarding liv
+0000e130: 6520 706f 696e 7473 2077 6974 6820 7468  e points with th
+0000e140: 6520 7361 6d65 206c 6f67 6c69 6b65 6c69  e same loglikeli
+0000e150: 686f 6f64 2e0a 2020 2861 7278 6976 3a32  hood..  (arxiv:2
+0000e160: 3030 352e 3038 3630 3220 6172 7869 763a  005.08602 arxiv:
+0000e170: 3230 3130 2e31 3338 3834 292e 2054 6f20  2010.13884). To 
+0000e180: 6d69 7469 6761 7465 2072 756e 6e69 6e67  mitigate running
+0000e190: 206f 7574 206f 6620 6c69 7665 2070 6f69   out of live poi
+0000e1a0: 6e74 732c 0a20 2074 6865 2069 6e69 7469  nts,.  the initi
+0000e1b0: 616c 206e 756d 6265 7220 6f66 206c 6976  al number of liv
+0000e1c0: 6520 706f 696e 7473 2069 7320 696e 6372  e points is incr
+0000e1d0: 6561 7365 642e 2042 7574 206e 6f77 2074  eased. But now t
+0000e1e0: 6869 7320 6861 7320 7265 6163 6865 6420  his has reached 
+0000e1f0: 6f76 6572 2025 6420 706f 696e 7473 2e0a  over %d points..
+0000e200: 0a20 2059 6f75 2063 616e 2061 766f 6964  .  You can avoid
+0000e210: 2074 6869 7320 6d61 6b69 6e67 2074 6865   this making the
+0000e220: 206c 6f67 6c69 6b65 6c69 686f 6f64 2069   loglikelihood i
+0000e230: 6e63 7265 6173 6520 746f 7761 7264 7320  ncrease towards 
+0000e240: 7768 6572 6520 7468 6520 676f 6f64 2072  where the good r
+0000e250: 6567 696f 6e20 6973 2e0a 2020 466f 7220  egion is..  For 
+0000e260: 6578 616d 706c 652c 206c 6574 2773 2073  example, let's s
+0000e270: 6179 2079 6f75 2068 6176 6520 7477 6f20  ay you have two 
+0000e280: 7061 7261 6d65 7465 7273 2077 6865 7265  parameters where
+0000e290: 2074 6865 2073 756d 206d 7573 7420 6265   the sum must be
+0000e2a0: 2062 656c 6f77 2031 2e20 5265 706c 6163   below 1. Replac
+0000e2b0: 6520 7468 6973 3a0a 0a20 2020 2069 6620  e this:..    if 
+0000e2c0: 7061 7261 6d73 5b30 5d20 2b20 7061 7261  params[0] + para
+0000e2d0: 6d73 5b31 5d20 3e20 313a 0a20 2020 2020  ms[1] > 1:.     
+0000e2e0: 2020 2020 7265 7475 726e 202d 3165 3330      return -1e30
+0000e2f0: 300a 0a20 2077 6974 683a 0a0a 2020 2020  0..  with:..    
+0000e300: 6966 2070 6172 616d 735b 305d 202b 2070  if params[0] + p
+0000e310: 6172 616d 735b 315d 203e 2031 3a0a 2020  arams[1] > 1:.  
+0000e320: 2020 2020 2020 2072 6574 7572 6e20 2d31         return -1
+0000e330: 6533 3030 202a 2028 7061 7261 6d73 5b30  e300 * (params[0
+0000e340: 5d20 2b20 7061 7261 6d73 5b31 5d29 0a0a  ] + params[1])..
+0000e350: 2020 5468 6520 6375 7272 656e 7420 7374    The current st
+0000e360: 7261 7465 6779 2077 696c 6c20 636f 6e74  rategy will cont
+0000e370: 696e 7565 2075 6e74 696c 2025 6420 6c69  inue until %d li
+0000e380: 7665 2070 6f69 6e74 7320 6172 6520 7265  ve points are re
+0000e390: 6163 6865 642e 0a20 2049 7420 6973 2073  ached..  It is s
+0000e3a0: 6166 6520 746f 2069 676e 6f72 6520 7468  afe to ignore th
+0000e3b0: 6973 2077 6172 6e69 6e67 2e22 2222 2c20  is warning.""", 
+0000e3c0: 4c6d 696e 2c20 6e75 6d5f 7761 726e 2c20  Lmin, num_warn, 
+0000e3d0: 6e75 6d5f 7374 6f70 290a 2020 2020 2020  num_stop).      
+0000e3e0: 2020 2020 2020 2020 2020 7573 6572 5f68            user_h
+0000e3f0: 6173 5f62 6565 6e5f 7761 726e 6564 203d  as_been_warned =
+0000e400: 2054 7275 650a 0a20 2020 2020 2020 2020   True..         
+0000e410: 2020 2069 6620 6e72 6f6f 7473 5f6e 6565     if nroots_nee
+0000e420: 6465 6420 3e3d 206e 756d 5f73 746f 703a  ded >= num_stop:
+0000e430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e440: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+0000e450: 2020 2050 203d 2028 4c73 203d 3d20 4c6d     P = (Ls == Lm
+0000e460: 696e 292e 7375 6d28 290a 2020 2020 2020  in).sum().      
+0000e470: 2020 2020 2020 6966 2031 203c 2050 203c        if 1 < P <
+0000e480: 206c 656e 284c 7329 2061 6e64 206c 656e   len(Ls) and len
+0000e490: 284c 7329 202d 2050 202b 2031 203c 206e  (Ls) - P + 1 < n
+0000e4a0: 726f 6f74 733a 0a20 2020 2020 2020 2020  roots:.         
+0000e4b0: 2020 2020 2020 2023 2067 7565 7373 2074         # guess t
+0000e4c0: 6865 206e 756d 6265 7220 6f66 2070 6f69  he number of poi
+0000e4d0: 6e74 7320 6e65 6564 6564 3a20 502d 3120  nts needed: P-1 
+0000e4e0: 6172 6520 7573 656c 6573 730a 2020 2020  are useless.    
+0000e4f0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000e500: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
+0000e510: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000e520: 662e 6c6f 6767 6572 2e64 6562 7567 280a  f.logger.debug(.
+0000e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e540: 2020 2020 2020 2020 2746 6f75 6e64 2070          'Found p
+0000e550: 6c61 7465 6175 206f 6620 2564 2f25 6420  lateau of %d/%d 
+0000e560: 696e 6974 6961 6c20 706f 696e 7473 2061  initial points a
+0000e570: 7420 4c3d 2567 2e20 270a 2020 2020 2020  t L=%g. '.      
+0000e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e590: 2020 2741 766f 6964 2074 6869 7320 6279    'Avoid this by
+0000e5a0: 2061 2063 6f6e 7469 6e75 6f75 736c 7920   a continuously 
+0000e5b0: 696e 6372 6561 7369 6e67 206c 6f67 6c69  increasing logli
+0000e5c0: 6b65 6c69 686f 6f64 2074 6f77 6172 6473  kelihood towards
+0000e5d0: 2067 6f6f 6420 7265 6769 6f6e 732e 272c   good regions.',
+0000e5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e5f0: 2020 2020 2020 2020 2050 2c20 6e72 6f6f           P, nroo
+0000e600: 7473 5f6e 6565 6465 642c 204c 6d69 6e29  ts_needed, Lmin)
+0000e610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e620: 206e 726f 6f74 735f 6e65 6564 6564 203d   nroots_needed =
+0000e630: 206d 696e 286e 756d 5f73 746f 702c 206e   min(num_stop, n
+0000e640: 726f 6f74 735f 6e65 6564 6564 202b 2028  roots_needed + (
+0000e650: 5020 2d20 3129 290a 2020 2020 2020 2020  P - 1)).        
+0000e660: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000e670: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0000e680: 0a20 2020 2064 6566 205f 7769 6465 6e5f  .    def _widen_
+0000e690: 726f 6f74 7328 7365 6c66 2c20 6e72 6f6f  roots(self, nroo
+0000e6a0: 7473 293a 0a20 2020 2020 2020 2022 2222  ts):.        """
+0000e6b0: 456e 7375 7265 2072 6f6f 7420 6861 7320  Ensure root has 
+0000e6c0: 606e 726f 6f74 7360 2063 6869 6c64 7265  `nroots` childre
+0000e6d0: 6e2e 0a0a 2020 2020 2020 2020 5361 6d70  n...        Samp
+0000e6e0: 6c65 2066 726f 6d20 7072 696f 7220 746f  le from prior to
+0000e6f0: 2066 696c 6c20 7570 2028 6966 206e 6565   fill up (if nee
+0000e700: 6465 6429 2e0a 0a20 2020 2020 2020 2050  ded)...        P
+0000e710: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
+0000e720: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020    -----------.  
+0000e730: 2020 2020 2020 6e72 6f6f 7473 3a20 696e        nroots: in
+0000e740: 740a 2020 2020 2020 2020 2020 2020 4e75  t.            Nu
+0000e750: 6d62 6572 206f 6620 726f 6f74 206c 6976  mber of root liv
+0000e760: 6520 706f 696e 7473 2c20 6166 7465 7220  e points, after 
+0000e770: 7468 6520 706c 6174 6561 7520 6973 2074  the plateau is t
+0000e780: 7261 7665 7273 6564 2e0a 2020 2020 2020  raversed..      
+0000e790: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000e7a0: 2073 656c 662e 6c6f 6720 616e 6420 6c65   self.log and le
+0000e7b0: 6e28 7365 6c66 2e72 6f6f 742e 6368 696c  n(self.root.chil
+0000e7c0: 6472 656e 2920 3e20 303a 0a20 2020 2020  dren) > 0:.     
+0000e7d0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+0000e7e0: 6572 2e69 6e66 6f28 2757 6964 656e 696e  er.info('Widenin
+0000e7f0: 6720 726f 6f74 7320 746f 2025 6420 6c69  g roots to %d li
+0000e800: 7665 2070 6f69 6e74 7320 2868 6176 6520  ve points (have 
+0000e810: 2564 2061 6c72 6561 6479 2920 2e2e 2e27  %d already) ...'
+0000e820: 2c20 6e72 6f6f 7473 2c20 6c65 6e28 7365  , nroots, len(se
+0000e830: 6c66 2e72 6f6f 742e 6368 696c 6472 656e  lf.root.children
+0000e840: 2929 0a20 2020 2020 2020 206e 6e65 7772  )).        nnewr
+0000e850: 6f6f 7473 203d 206e 726f 6f74 7320 2d20  oots = nroots - 
+0000e860: 6c65 6e28 7365 6c66 2e72 6f6f 742e 6368  len(self.root.ch
+0000e870: 696c 6472 656e 290a 2020 2020 2020 2020  ildren).        
+0000e880: 6966 206e 6e65 7772 6f6f 7473 203c 3d20  if nnewroots <= 
+0000e890: 303a 0a20 2020 2020 2020 2020 2020 2023  0:.            #
+0000e8a0: 206e 6f74 6869 6e67 2074 6f20 646f 0a20   nothing to do. 
+0000e8b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000e8c0: 6e0a 0a20 2020 2020 2020 2070 7265 765f  n..        prev_
+0000e8d0: 7520 3d20 5b5d 0a20 2020 2020 2020 2070  u = [].        p
+0000e8e0: 7265 765f 7620 3d20 5b5d 0a20 2020 2020  rev_v = [].     
+0000e8f0: 2020 2070 7265 765f 6c6f 676c 203d 205b     prev_logl = [
+0000e900: 5d0a 2020 2020 2020 2020 7072 6576 5f72  ].        prev_r
+0000e910: 6f77 6964 203d 205b 5d0a 0a20 2020 2020  owid = []..     
+0000e920: 2020 2069 6620 7365 6c66 2e6c 6f67 2061     if self.log a
+0000e930: 6e64 2073 656c 662e 7573 655f 706f 696e  nd self.use_poin
+0000e940: 745f 7374 6163 6b3a 0a20 2020 2020 2020  t_stack:.       
+0000e950: 2020 2020 2023 2074 7279 2074 6f20 7265       # try to re
+0000e960: 7375 6d65 3a0a 2020 2020 2020 2020 2020  sume:.          
+0000e970: 2020 2320 7365 6c66 2e6c 6f67 6765 722e    # self.logger.
+0000e980: 696e 666f 2827 5265 7375 6d69 6e67 2e2e  info('Resuming..
+0000e990: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
+0000e9a0: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
+0000e9b0: 6e65 7772 6f6f 7473 293a 0a20 2020 2020  newroots):.     
+0000e9c0: 2020 2020 2020 2020 2020 2072 6f77 6964             rowid
+0000e9d0: 2c20 726f 7720 3d20 7365 6c66 2e70 6f69  , row = self.poi
+0000e9e0: 6e74 7374 6f72 652e 706f 7028 2d6e 702e  ntstore.pop(-np.
+0000e9f0: 696e 6629 0a20 2020 2020 2020 2020 2020  inf).           
+0000ea00: 2020 2020 2069 6620 726f 7720 6973 204e       if row is N
+0000ea10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000ea20: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0000ea30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000ea40: 7265 765f 6c6f 676c 2e61 7070 656e 6428  rev_logl.append(
+0000ea50: 726f 775b 315d 290a 2020 2020 2020 2020  row[1]).        
+0000ea60: 2020 2020 2020 2020 7072 6576 5f75 2e61          prev_u.a
+0000ea70: 7070 656e 6428 726f 775b 333a 3320 2b20  ppend(row[3:3 + 
+0000ea80: 7365 6c66 2e78 5f64 696d 5d29 0a20 2020  self.x_dim]).   
+0000ea90: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+0000eaa0: 765f 762e 6170 7065 6e64 2872 6f77 5b33  v_v.append(row[3
+0000eab0: 202b 2073 656c 662e 785f 6469 6d3a 3320   + self.x_dim:3 
+0000eac0: 2b20 7365 6c66 2e78 5f64 696d 202b 2073  + self.x_dim + s
+0000ead0: 656c 662e 6e75 6d5f 7061 7261 6d73 5d29  elf.num_params])
+0000eae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eaf0: 2070 7265 765f 726f 7769 642e 6170 7065   prev_rowid.appe
+0000eb00: 6e64 2872 6f77 6964 290a 0a20 2020 2020  nd(rowid)..     
+0000eb10: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
+0000eb20: 2020 2020 2020 2020 2020 2020 7072 6576              prev
+0000eb30: 5f75 203d 206e 702e 6172 7261 7928 7072  _u = np.array(pr
+0000eb40: 6576 5f75 290a 2020 2020 2020 2020 2020  ev_u).          
+0000eb50: 2020 7072 6576 5f76 203d 206e 702e 6172    prev_v = np.ar
+0000eb60: 7261 7928 7072 6576 5f76 290a 2020 2020  ray(prev_v).    
+0000eb70: 2020 2020 2020 2020 7072 6576 5f6c 6f67          prev_log
+0000eb80: 6c20 3d20 6e70 2e61 7272 6179 2870 7265  l = np.array(pre
+0000eb90: 765f 6c6f 676c 290a 0a20 2020 2020 2020  v_logl)..       
+0000eba0: 2020 2020 206e 756d 5f6c 6976 655f 706f       num_live_po
+0000ebb0: 696e 7473 5f6d 6973 7369 6e67 203d 206e  ints_missing = n
+0000ebc0: 6e65 7772 6f6f 7473 202d 206c 656e 2870  newroots - len(p
+0000ebd0: 7265 765f 6c6f 676c 290a 2020 2020 2020  rev_logl).      
+0000ebe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ebf0: 2020 2020 6e75 6d5f 6c69 7665 5f70 6f69      num_live_poi
+0000ec00: 6e74 735f 6d69 7373 696e 6720 3d20 2d31  nts_missing = -1
+0000ec10: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000ec20: 662e 7573 655f 6d70 693a 0a20 2020 2020  f.use_mpi:.     
+0000ec30: 2020 2020 2020 206e 756d 5f6c 6976 655f         num_live_
+0000ec40: 706f 696e 7473 5f6d 6973 7369 6e67 203d  points_missing =
+0000ec50: 2073 656c 662e 636f 6d6d 2e62 6361 7374   self.comm.bcast
+0000ec60: 286e 756d 5f6c 6976 655f 706f 696e 7473  (num_live_points
+0000ec70: 5f6d 6973 7369 6e67 2c20 726f 6f74 3d30  _missing, root=0
+0000ec80: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+0000ec90: 6576 5f75 203d 2073 656c 662e 636f 6d6d  ev_u = self.comm
+0000eca0: 2e62 6361 7374 2870 7265 765f 752c 2072  .bcast(prev_u, r
+0000ecb0: 6f6f 743d 3029 0a20 2020 2020 2020 2020  oot=0).         
+0000ecc0: 2020 2070 7265 765f 7620 3d20 7365 6c66     prev_v = self
+0000ecd0: 2e63 6f6d 6d2e 6263 6173 7428 7072 6576  .comm.bcast(prev
+0000ece0: 5f76 2c20 726f 6f74 3d30 290a 2020 2020  _v, root=0).    
+0000ecf0: 2020 2020 2020 2020 7072 6576 5f6c 6f67          prev_log
+0000ed00: 6c20 3d20 7365 6c66 2e63 6f6d 6d2e 6263  l = self.comm.bc
+0000ed10: 6173 7428 7072 6576 5f6c 6f67 6c2c 2072  ast(prev_logl, r
+0000ed20: 6f6f 743d 3029 0a0a 2020 2020 2020 2020  oot=0)..        
+0000ed30: 6173 7365 7274 206e 756d 5f6c 6976 655f  assert num_live_
+0000ed40: 706f 696e 7473 5f6d 6973 7369 6e67 203e  points_missing >
+0000ed50: 3d20 300a 2020 2020 2020 2020 6966 2073  = 0.        if s
+0000ed60: 656c 662e 6c6f 6720 616e 6420 6e75 6d5f  elf.log and num_
+0000ed70: 6c69 7665 5f70 6f69 6e74 735f 6d69 7373  live_points_miss
+0000ed80: 696e 6720 3e20 303a 0a20 2020 2020 2020  ing > 0:.       
+0000ed90: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0000eda0: 2e69 6e66 6f28 2753 616d 706c 696e 6720  .info('Sampling 
+0000edb0: 2564 206c 6976 6520 706f 696e 7473 2066  %d live points f
+0000edc0: 726f 6d20 7072 696f 7220 2e2e 2e27 2c20  rom prior ...', 
+0000edd0: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 735f  num_live_points_
+0000ede0: 6d69 7373 696e 6729 0a20 2020 2020 2020  missing).       
+0000edf0: 2069 6620 6e75 6d5f 6c69 7665 5f70 6f69   if num_live_poi
+0000ee00: 6e74 735f 6d69 7373 696e 6720 3e20 303a  nts_missing > 0:
+0000ee10: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+0000ee20: 5f6c 6976 655f 706f 696e 7473 5f74 6f64  _live_points_tod
+0000ee30: 6f20 3d20 6469 7374 7269 6275 7465 645f  o = distributed_
+0000ee40: 776f 726b 5f63 6875 6e6b 5f73 697a 6528  work_chunk_size(
+0000ee50: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 735f  num_live_points_
+0000ee60: 6d69 7373 696e 672c 2073 656c 662e 6d70  missing, self.mp
+0000ee70: 695f 7261 6e6b 2c20 7365 6c66 2e6d 7069  i_rank, self.mpi
+0000ee80: 5f73 697a 6529 0a20 2020 2020 2020 2020  _size).         
+0000ee90: 2020 2073 656c 662e 6e63 616c 6c20 2b3d     self.ncall +=
+0000eea0: 206e 756d 5f6c 6976 655f 706f 696e 7473   num_live_points
+0000eeb0: 5f6d 6973 7369 6e67 0a0a 2020 2020 2020  _missing..      
+0000eec0: 2020 2020 2020 6966 206e 756d 5f6c 6976        if num_liv
+0000eed0: 655f 706f 696e 7473 5f74 6f64 6f20 3e20  e_points_todo > 
+0000eee0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000eef0: 2020 2061 6374 6976 655f 7520 3d20 6e70     active_u = np
+0000ef00: 2e72 616e 646f 6d2e 756e 6966 6f72 6d28  .random.uniform(
+0000ef10: 7369 7a65 3d28 6e75 6d5f 6c69 7665 5f70  size=(num_live_p
+0000ef20: 6f69 6e74 735f 746f 646f 2c20 7365 6c66  oints_todo, self
+0000ef30: 2e78 5f64 696d 2929 0a20 2020 2020 2020  .x_dim)).       
+0000ef40: 2020 2020 2020 2020 2061 6374 6976 655f           active_
+0000ef50: 7620 3d20 7365 6c66 2e74 7261 6e73 666f  v = self.transfo
+0000ef60: 726d 2861 6374 6976 655f 7529 0a20 2020  rm(active_u).   
+0000ef70: 2020 2020 2020 2020 2020 2020 2061 6374               act
+0000ef80: 6976 655f 6c6f 676c 203d 2073 656c 662e  ive_logl = self.
+0000ef90: 6c6f 676c 696b 6528 6163 7469 7665 5f76  loglike(active_v
+0000efa0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000efb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000efc0: 2020 2020 6163 7469 7665 5f75 203d 206e      active_u = n
+0000efd0: 702e 656d 7074 7928 2830 2c20 7365 6c66  p.empty((0, self
+0000efe0: 2e78 5f64 696d 2929 0a20 2020 2020 2020  .x_dim)).       
+0000eff0: 2020 2020 2020 2020 2061 6374 6976 655f           active_
+0000f000: 7620 3d20 6e70 2e65 6d70 7479 2828 302c  v = np.empty((0,
+0000f010: 2073 656c 662e 6e75 6d5f 7061 7261 6d73   self.num_params
+0000f020: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0000f030: 2020 2061 6374 6976 655f 6c6f 676c 203d     active_logl =
+0000f040: 206e 702e 656d 7074 7928 2830 2c29 290a   np.empty((0,)).
+0000f050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000f060: 7365 6c66 2e75 7365 5f6d 7069 3a0a 2020  self.use_mpi:.  
+0000f070: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000f080: 6376 5f73 616d 706c 6573 203d 2073 656c  cv_samples = sel
+0000f090: 662e 636f 6d6d 2e67 6174 6865 7228 6163  f.comm.gather(ac
+0000f0a0: 7469 7665 5f75 2c20 726f 6f74 3d30 290a  tive_u, root=0).
+0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0c0: 7265 6376 5f73 616d 706c 6573 7620 3d20  recv_samplesv = 
+0000f0d0: 7365 6c66 2e63 6f6d 6d2e 6761 7468 6572  self.comm.gather
+0000f0e0: 2861 6374 6976 655f 762c 2072 6f6f 743d  (active_v, root=
+0000f0f0: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+0000f100: 2020 2072 6563 765f 6c69 6b65 7320 3d20     recv_likes = 
+0000f110: 7365 6c66 2e63 6f6d 6d2e 6761 7468 6572  self.comm.gather
+0000f120: 2861 6374 6976 655f 6c6f 676c 2c20 726f  (active_logl, ro
+0000f130: 6f74 3d30 290a 2020 2020 2020 2020 2020  ot=0).          
+0000f140: 2020 2020 2020 7265 6376 5f73 616d 706c        recv_sampl
+0000f150: 6573 203d 2073 656c 662e 636f 6d6d 2e62  es = self.comm.b
+0000f160: 6361 7374 2872 6563 765f 7361 6d70 6c65  cast(recv_sample
+0000f170: 732c 2072 6f6f 743d 3029 0a20 2020 2020  s, root=0).     
+0000f180: 2020 2020 2020 2020 2020 2072 6563 765f             recv_
+0000f190: 7361 6d70 6c65 7376 203d 2073 656c 662e  samplesv = self.
+0000f1a0: 636f 6d6d 2e62 6361 7374 2872 6563 765f  comm.bcast(recv_
+0000f1b0: 7361 6d70 6c65 7376 2c20 726f 6f74 3d30  samplesv, root=0
+0000f1c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000f1d0: 2020 7265 6376 5f6c 696b 6573 203d 2073    recv_likes = s
+0000f1e0: 656c 662e 636f 6d6d 2e62 6361 7374 2872  elf.comm.bcast(r
+0000f1f0: 6563 765f 6c69 6b65 732c 2072 6f6f 743d  ecv_likes, root=
+0000f200: 3029 0a0a 2020 2020 2020 2020 2020 2020  0)..            
+0000f210: 2020 2020 6163 7469 7665 5f75 203d 206e      active_u = n
+0000f220: 702e 636f 6e63 6174 656e 6174 6528 7265  p.concatenate(re
+0000f230: 6376 5f73 616d 706c 6573 2c20 6178 6973  cv_samples, axis
+0000f240: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
+0000f250: 2020 2020 6163 7469 7665 5f76 203d 206e      active_v = n
+0000f260: 702e 636f 6e63 6174 656e 6174 6528 7265  p.concatenate(re
+0000f270: 6376 5f73 616d 706c 6573 762c 2061 7869  cv_samplesv, axi
+0000f280: 733d 3029 0a20 2020 2020 2020 2020 2020  s=0).           
+0000f290: 2020 2020 2061 6374 6976 655f 6c6f 676c       active_logl
+0000f2a0: 203d 206e 702e 636f 6e63 6174 656e 6174   = np.concatenat
+0000f2b0: 6528 7265 6376 5f6c 696b 6573 2c20 6178  e(recv_likes, ax
+0000f2c0: 6973 3d30 290a 0a20 2020 2020 2020 2020  is=0)..         
+0000f2d0: 2020 2061 7373 6572 7420 6163 7469 7665     assert active
+0000f2e0: 5f6c 6f67 6c2e 7368 6170 6520 3d3d 2028  _logl.shape == (
+0000f2f0: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 735f  num_live_points_
+0000f300: 6d69 7373 696e 672c 292c 2028 6163 7469  missing,), (acti
+0000f310: 7665 5f6c 6f67 6c2e 7368 6170 652c 206e  ve_logl.shape, n
+0000f320: 756d 5f6c 6976 655f 706f 696e 7473 5f6d  um_live_points_m
+0000f330: 6973 7369 6e67 290a 0a20 2020 2020 2020  issing)..       
+0000f340: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
+0000f350: 5f74 6f5f 706f 696e 7473 746f 7265 3a0a  _to_pointstore:.
+0000f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f370: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
+0000f380: 756d 5f6c 6976 655f 706f 696e 7473 5f6d  um_live_points_m
+0000f390: 6973 7369 6e67 293a 0a20 2020 2020 2020  issing):.       
+0000f3a0: 2020 2020 2020 2020 2020 2020 2072 6f77               row
+0000f3b0: 6964 203d 2073 656c 662e 706f 696e 7473  id = self.points
+0000f3c0: 746f 7265 2e61 6464 285f 6c69 7374 6966  tore.add(_listif
+0000f3d0: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
+0000f3e0: 2020 2020 2020 2020 2020 205b 2d6e 702e             [-np.
+0000f3f0: 696e 662c 2061 6374 6976 655f 6c6f 676c  inf, active_logl
+0000f400: 5b69 5d2c 2030 2e30 5d2c 0a20 2020 2020  [i], 0.0],.     
 0000f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f420: 2020 2020 2061 6374 6976 655f 765b 692c       active_v[i,
-0000f430: 3a5d 292c 2031 290a 0a20 2020 2020 2020  :]), 1)..       
-0000f440: 2020 2020 2069 6620 6c65 6e28 7072 6576       if len(prev
-0000f450: 5f75 2920 3e20 303a 0a20 2020 2020 2020  _u) > 0:.       
-0000f460: 2020 2020 2020 2020 2061 6374 6976 655f           active_
-0000f470: 7520 3d20 6e70 2e63 6f6e 6361 7465 6e61  u = np.concatena
-0000f480: 7465 2828 7072 6576 5f75 2c20 6163 7469  te((prev_u, acti
-0000f490: 7665 5f75 2929 0a20 2020 2020 2020 2020  ve_u)).         
-0000f4a0: 2020 2020 2020 2061 6374 6976 655f 7620         active_v 
-0000f4b0: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
-0000f4c0: 2828 7072 6576 5f76 2c20 6163 7469 7665  ((prev_v, active
-0000f4d0: 5f76 2929 0a20 2020 2020 2020 2020 2020  _v)).           
-0000f4e0: 2020 2020 2061 6374 6976 655f 6c6f 676c       active_logl
-0000f4f0: 203d 206e 702e 636f 6e63 6174 656e 6174   = np.concatenat
-0000f500: 6528 2870 7265 765f 6c6f 676c 2c20 6163  e((prev_logl, ac
-0000f510: 7469 7665 5f6c 6f67 6c29 290a 2020 2020  tive_logl)).    
-0000f520: 2020 2020 2020 2020 6173 7365 7274 2061          assert a
-0000f530: 6374 6976 655f 752e 7368 6170 6520 3d3d  ctive_u.shape ==
-0000f540: 2028 6e6e 6577 726f 6f74 732c 2073 656c   (nnewroots, sel
-0000f550: 662e 785f 6469 6d29 2c20 2861 6374 6976  f.x_dim), (activ
-0000f560: 655f 752e 7368 6170 652c 206e 6e65 7772  e_u.shape, nnewr
-0000f570: 6f6f 7473 2c20 7365 6c66 2e78 5f64 696d  oots, self.x_dim
-0000f580: 2c20 6e75 6d5f 6c69 7665 5f70 6f69 6e74  , num_live_point
-0000f590: 735f 6d69 7373 696e 672c 206c 656e 2870  s_missing, len(p
-0000f5a0: 7265 765f 7529 290a 2020 2020 2020 2020  rev_u)).        
-0000f5b0: 2020 2020 6173 7365 7274 2061 6374 6976      assert activ
-0000f5c0: 655f 762e 7368 6170 6520 3d3d 2028 6e6e  e_v.shape == (nn
-0000f5d0: 6577 726f 6f74 732c 2073 656c 662e 6e75  ewroots, self.nu
-0000f5e0: 6d5f 7061 7261 6d73 292c 2028 6163 7469  m_params), (acti
-0000f5f0: 7665 5f76 2e73 6861 7065 2c20 6e6e 6577  ve_v.shape, nnew
-0000f600: 726f 6f74 732c 2073 656c 662e 6e75 6d5f  roots, self.num_
-0000f610: 7061 7261 6d73 2c20 6e75 6d5f 6c69 7665  params, num_live
-0000f620: 5f70 6f69 6e74 735f 6d69 7373 696e 672c  _points_missing,
-0000f630: 206c 656e 2870 7265 765f 7529 290a 2020   len(prev_u)).  
-0000f640: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0000f650: 2061 6374 6976 655f 6c6f 676c 2e73 6861   active_logl.sha
-0000f660: 7065 203d 3d20 286e 6e65 7772 6f6f 7473  pe == (nnewroots
-0000f670: 2c29 2c20 2861 6374 6976 655f 6c6f 676c  ,), (active_logl
-0000f680: 2e73 6861 7065 2c20 6e6e 6577 726f 6f74  .shape, nnewroot
-0000f690: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-0000f6a0: 0a20 2020 2020 2020 2020 2020 2061 6374  .            act
-0000f6b0: 6976 655f 7520 3d20 7072 6576 5f75 0a20  ive_u = prev_u. 
-0000f6c0: 2020 2020 2020 2020 2020 2061 6374 6976             activ
-0000f6d0: 655f 7620 3d20 7072 6576 5f76 0a20 2020  e_v = prev_v.   
-0000f6e0: 2020 2020 2020 2020 2061 6374 6976 655f           active_
-0000f6f0: 6c6f 676c 203d 2070 7265 765f 6c6f 676c  logl = prev_logl
-0000f700: 0a0a 2020 2020 2020 2020 726f 6f74 7320  ..        roots 
-0000f710: 3d20 5b73 656c 662e 706f 696e 7470 696c  = [self.pointpil
-0000f720: 652e 6d61 6b65 5f6e 6f64 6528 6c6f 676c  e.make_node(logl
-0000f730: 2c20 752c 2070 2920 666f 7220 752c 2070  , u, p) for u, p
-0000f740: 2c20 6c6f 676c 2069 6e20 7a69 7028 6163  , logl in zip(ac
-0000f750: 7469 7665 5f75 2c20 6163 7469 7665 5f76  tive_u, active_v
-0000f760: 2c20 6163 7469 7665 5f6c 6f67 6c29 5d0a  , active_logl)].
-0000f770: 2020 2020 2020 2020 6966 206c 656e 2861          if len(a
-0000f780: 6374 6976 655f 7529 203e 2034 3a0a 2020  ctive_u) > 4:.  
-0000f790: 2020 2020 2020 2020 2020 7365 6c66 2e62            self.b
-0000f7a0: 7569 6c64 5f74 7265 6769 6f6e 203d 206e  uild_tregion = n
-0000f7b0: 6f74 2069 735f 6166 6669 6e65 5f74 7261  ot is_affine_tra
-0000f7c0: 6e73 666f 726d 2861 6374 6976 655f 752c  nsform(active_u,
-0000f7d0: 2061 6374 6976 655f 7629 0a20 2020 2020   active_v).     
-0000f7e0: 2020 2073 656c 662e 726f 6f74 2e63 6869     self.root.chi
-0000f7f0: 6c64 7265 6e20 2b3d 2072 6f6f 7473 0a0a  ldren += roots..
-0000f800: 2020 2020 6465 6620 5f61 6461 7074 6976      def _adaptiv
-0000f810: 655f 7374 7261 7465 6779 5f61 6476 6963  e_strategy_advic
-0000f820: 6528 7365 6c66 2c20 4c6d 696e 2c20 7061  e(self, Lmin, pa
-0000f830: 7261 6c6c 656c 5f76 616c 7565 732c 206d  rallel_values, m
-0000f840: 6169 6e5f 6974 6572 6174 6f72 2c20 6d69  ain_iterator, mi
-0000f850: 6e69 6d61 6c5f 7769 6474 6873 2c20 6672  nimal_widths, fr
-0000f860: 6163 5f72 656d 6169 6e2c 204c 6570 7369  ac_remain, Lepsi
-0000f870: 6c6f 6e29 3a0a 2020 2020 2020 2020 2222  lon):.        ""
-0000f880: 2243 6865 636b 2069 6620 696e 7465 6772  "Check if integr
-0000f890: 6174 696f 6e20 6973 2064 6f6e 652e 0a0a  ation is done...
-0000f8a0: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
-0000f8b0: 7261 6e67 6520 7768 6572 6520 6d6f 7265  range where more
-0000f8c0: 2073 616d 706c 696e 6720 6973 206e 6565   sampling is nee
-0000f8d0: 6465 640a 0a20 2020 2020 2020 2052 6574  ded..        Ret
-0000f8e0: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-0000f8f0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 4c6c  -----.        Ll
-0000f900: 6f3a 2066 6c6f 6174 0a20 2020 2020 2020  o: float.       
-0000f910: 2020 2020 206c 6f77 6572 206c 6f67 2d6c       lower log-l
-0000f920: 696b 656c 6968 6f6f 6420 626f 756e 642c  ikelihood bound,
-0000f930: 206e 616e 2069 6620 646f 6e65 0a20 2020   nan if done.   
-0000f940: 2020 2020 204c 6869 3a20 666c 6f61 740a       Lhi: float.
-0000f950: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
-0000f960: 7220 6c6f 672d 6c69 6b65 6c69 686f 6f64  r log-likelihood
-0000f970: 2062 6f75 6e64 2c20 6e61 6e20 6966 2064   bound, nan if d
-0000f980: 6f6e 650a 0a20 2020 2020 2020 2050 6172  one..        Par
-0000f990: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-0000f9a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-0000f9b0: 2020 2020 4c6d 696e 3a20 666c 6f61 740a      Lmin: float.
-0000f9c0: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-0000f9d0: 656e 7420 6c6f 676c 696b 656c 6968 6f6f  ent loglikelihoo
-0000f9e0: 6420 7468 7265 7368 6f6c 640a 2020 2020  d threshold.    
-0000f9f0: 2020 2020 7061 7261 6c6c 656c 5f76 616c      parallel_val
-0000fa00: 7565 733a 2061 7272 6179 206f 6620 666c  ues: array of fl
-0000fa10: 6f61 7473 0a20 2020 2020 2020 2020 2020  oats.           
-0000fa20: 206c 6f67 6c69 6b65 6c69 686f 6f64 7320   loglikelihoods 
-0000fa30: 6f66 206c 6976 6520 706f 696e 7473 0a20  of live points. 
-0000fa40: 2020 2020 2020 206d 6169 6e5f 6974 6572         main_iter
-0000fa50: 6174 6f72 3a20 4272 6561 6474 6846 6972  ator: BreadthFir
-0000fa60: 7374 4974 6572 6174 6f72 0a20 2020 2020  stIterator.     
-0000fa70: 2020 2020 2020 2063 7572 7265 6e74 2074         current t
-0000fa80: 7265 6520 6578 706c 6f72 6174 696f 6e20  ree exploration 
-0000fa90: 6974 6572 6174 6f72 0a20 2020 2020 2020  iterator.       
-0000faa0: 206d 696e 696d 616c 5f77 6964 7468 733a   minimal_widths:
-0000fab0: 206c 6973 740a 2020 2020 2020 2020 2020   list.          
-0000fac0: 2020 6375 7272 656e 7420 7769 6474 6820    current width 
-0000fad0: 7265 7175 6972 6564 0a20 2020 2020 2020  required.       
-0000fae0: 2066 7261 635f 7265 6d61 696e 3a20 666c   frac_remain: fl
-0000faf0: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
-0000fb00: 6d61 7869 6d75 6d20 6672 6163 7469 6f6e  maximum fraction
-0000fb10: 206f 6620 696e 7465 6772 616c 2069 6e20   of integral in 
-0000fb20: 7265 6d61 696e 6465 7220 666f 7220 7465  remainder for te
-0000fb30: 726d 696e 6174 696f 6e0a 2020 2020 2020  rmination.      
-0000fb40: 2020 4c65 7073 696c 6f6e 3a20 666c 6f61    Lepsilon: floa
-0000fb50: 740a 2020 2020 2020 2020 2020 2020 6c6f  t.            lo
-0000fb60: 676c 696b 656c 6968 6f6f 6420 6163 6375  glikelihood accu
-0000fb70: 7261 6379 2074 6872 6573 686f 6c64 0a20  racy threshold. 
-0000fb80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000fb90: 2020 204c 7320 3d20 7061 7261 6c6c 656c     Ls = parallel
-0000fba0: 5f76 616c 7565 732e 636f 7079 2829 0a20  _values.copy(). 
-0000fbb0: 2020 2020 2020 204c 732e 736f 7274 2829         Ls.sort()
-0000fbc0: 0a20 2020 2020 2020 2023 204c 7320 3d20  .        # Ls = 
-0000fbd0: 5b6e 6f64 652e 7661 6c75 655d 202b 205b  [node.value] + [
-0000fbe0: 6e2e 7661 6c75 6520 666f 7220 726f 6f74  n.value for root
-0000fbf0: 6964 322c 206e 2069 6e20 7061 7261 6c6c  id2, n in parall
-0000fc00: 656c 5f6e 6f64 6573 5d0a 2020 2020 2020  el_nodes].      
-0000fc10: 2020 4c6d 6178 203d 204c 735b 2d31 5d0a    Lmax = Ls[-1].
-0000fc20: 2020 2020 2020 2020 4c6d 696e 203d 204c          Lmin = L
-0000fc30: 735b 305d 0a0a 2020 2020 2020 2020 2320  s[0]..        # 
-0000fc40: 616c 6c20 706f 696e 7473 2074 6865 2073  all points the s
-0000fc50: 616d 652c 2073 746f 700a 2020 2020 2020  ame, stop.      
-0000fc60: 2020 6966 204c 6d61 7820 2d20 4c6d 696e    if Lmax - Lmin
-0000fc70: 203c 204c 6570 7369 6c6f 6e3a 0a20 2020   < Lepsilon:.   
-0000fc80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000fc90: 6e70 2e6e 616e 2c20 6e70 2e6e 616e 0a0a  np.nan, np.nan..
-0000fca0: 2020 2020 2020 2020 2320 6d61 7820 7265          # max re
-0000fcb0: 6d61 696e 6465 7220 636f 6e74 7269 6275  mainder contribu
-0000fcc0: 7469 6f6e 2069 7320 4c6d 6178 202b 2077  tion is Lmax + w
-0000fcd0: 6569 6768 742c 2074 6f20 6265 2061 6464  eight, to be add
-0000fce0: 6564 2074 6f20 6d61 696e 5f69 7465 7261  ed to main_itera
-0000fcf0: 746f 722e 6c6f 675a 0a20 2020 2020 2020  tor.logZ.       
-0000fd00: 2023 2074 6865 206c 696b 656c 6968 6f6f   # the likelihoo
-0000fd10: 6420 7468 6174 2077 6f75 6c64 2061 6464  d that would add
-0000fd20: 2061 6e20 6571 7561 6c20 616d 6f75 6e74   an equal amount
-0000fd30: 2061 7320 6d61 696e 5f69 7465 7261 746f   as main_iterato
-0000fd40: 722e 6c6f 675a 2069 733a 0a20 2020 2020  r.logZ is:.     
-0000fd50: 2020 206c 6f67 5a6d 6178 203d 206d 6169     logZmax = mai
-0000fd60: 6e5f 6974 6572 6174 6f72 2e6c 6f67 5a72  n_iterator.logZr
-0000fd70: 656d 6169 6e0a 2020 2020 2020 2020 4c6e  emain.        Ln
-0000fd80: 6578 7420 3d20 6c6f 675a 6d61 7820 2d20  ext = logZmax - 
-0000fd90: 286d 6169 6e5f 6974 6572 6174 6f72 2e6c  (main_iterator.l
-0000fda0: 6f67 566f 6c72 656d 6169 6e69 6e67 202b  ogVolremaining +
-0000fdb0: 206c 6f67 2866 7261 635f 7265 6d61 696e   log(frac_remain
-0000fdc0: 2929 202d 206c 6f67 286c 656e 284c 7329  )) - log(len(Ls)
-0000fdd0: 290a 2020 2020 2020 2020 4c31 203d 204c  ).        L1 = L
-0000fde0: 735b 315d 2069 6620 6c65 6e28 4c73 2920  s[1] if len(Ls) 
-0000fdf0: 3e20 3120 656c 7365 204c 735b 305d 0a20  > 1 else Ls[0]. 
-0000fe00: 2020 2020 2020 204c 6d61 7831 203d 206e         Lmax1 = n
-0000fe10: 702e 6d65 6469 616e 284c 7329 0a20 2020  p.median(Ls).   
-0000fe20: 2020 2020 204c 6e65 7874 203d 206d 6178       Lnext = max
-0000fe30: 286d 696e 284c 6e65 7874 2c20 4c6d 6178  (min(Lnext, Lmax
-0000fe40: 3129 2c20 4c31 290a 0a20 2020 2020 2020  1), L1)..       
-0000fe50: 2023 2069 6620 7468 6520 7265 6d61 696e   # if the remain
-0000fe60: 6465 7220 646f 6d69 6e61 7465 732c 2072  der dominates, r
-0000fe70: 6574 7572 6e20 7468 6174 2072 616e 6765  eturn that range
-0000fe80: 0a20 2020 2020 2020 2069 6620 6d61 696e  .        if main
-0000fe90: 5f69 7465 7261 746f 722e 6c6f 675a 7265  _iterator.logZre
-0000fea0: 6d61 696e 203e 206d 6169 6e5f 6974 6572  main > main_iter
-0000feb0: 6174 6f72 2e6c 6f67 5a3a 0a20 2020 2020  ator.logZ:.     
-0000fec0: 2020 2020 2020 2072 6574 7572 6e20 4c6d         return Lm
-0000fed0: 696e 2c20 4c6e 6578 740a 0a20 2020 2020  in, Lnext..     
-0000fee0: 2020 2069 6620 6d61 696e 5f69 7465 7261     if main_itera
-0000fef0: 746f 722e 7265 6d61 696e 6465 725f 6672  tor.remainder_fr
-0000ff00: 6163 7469 6f6e 203e 2066 7261 635f 7265  action > frac_re
-0000ff10: 6d61 696e 3a0a 2020 2020 2020 2020 2020  main:.          
-0000ff20: 2020 7265 7475 726e 204c 6d69 6e2c 204c    return Lmin, L
-0000ff30: 6e65 7874 0a0a 2020 2020 2020 2020 7265  next..        re
-0000ff40: 7475 726e 206e 702e 6e61 6e2c 206e 702e  turn np.nan, np.
-0000ff50: 6e61 6e0a 0a20 2020 2064 6566 205f 6669  nan..    def _fi
-0000ff60: 6e64 5f73 7472 6174 6567 7928 7365 6c66  nd_strategy(self
-0000ff70: 2c20 7361 7665 645f 6c6f 676c 2c20 6d61  , saved_logl, ma
-0000ff80: 696e 5f69 7465 7261 746f 722c 2064 6c6f  in_iterator, dlo
-0000ff90: 677a 2c20 644b 4c2c 206d 696e 5f65 7373  gz, dKL, min_ess
-0000ffa0: 293a 0a20 2020 2020 2020 2022 2222 4173  ):.        """As
-0000ffb0: 6b20 6561 6368 2073 7472 6174 6567 7920  k each strategy 
-0000ffc0: 7768 6963 6820 6c6f 672d 6c69 6b65 6c69  which log-likeli
-0000ffd0: 686f 6f64 2069 6e74 6572 7661 6c20 6e65  hood interval ne
-0000ffe0: 6564 7320 6d6f 7265 2065 7870 6c6f 7261  eds more explora
-0000fff0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2052  tion...        R
-00010000: 6574 7572 6e73 0a20 2020 2020 2020 202d  eturns.        -
-00010010: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2028  ------.        (
-00010020: 4c6c 6f5f 5a2c 204c 6869 5f5a 293a 2066  Llo_Z, Lhi_Z): f
-00010030: 6c6f 6174 730a 2020 2020 2020 2020 2020  loats.          
-00010040: 2020 696e 7465 7276 616c 2077 6865 7265    interval where
-00010050: 2064 6c6f 677a 2073 7472 6174 6567 7920   dlogz strategy 
-00010060: 7265 7175 6972 6573 206d 6f72 6520 7361  requires more sa
-00010070: 6d70 6c65 732e 0a20 2020 2020 2020 2028  mples..        (
-00010080: 4c6c 6f5f 4b4c 2c20 4c68 695f 4b4c 293a  Llo_KL, Lhi_KL):
-00010090: 2066 6c6f 6174 730a 2020 2020 2020 2020   floats.        
-000100a0: 2020 2020 696e 7465 7276 616c 2077 6865      interval whe
-000100b0: 7265 2070 6f73 7465 7269 6f72 2075 6e63  re posterior unc
-000100c0: 6572 7461 696e 7479 2073 7472 6174 6567  ertainty strateg
-000100d0: 7920 7265 7175 6972 6573 206d 6f72 6520  y requires more 
-000100e0: 7361 6d70 6c65 732e 0a20 2020 2020 2020  samples..       
-000100f0: 2028 4c6c 6f5f 6573 732c 204c 6869 5f65   (Llo_ess, Lhi_e
-00010100: 7373 293a 2066 6c6f 6174 730a 2020 2020  ss): floats.    
-00010110: 2020 2020 2020 2020 696e 7465 7276 616c          interval
-00010120: 2077 6865 7265 2065 6666 6563 7469 7665   where effective
-00010130: 2073 616d 706c 6520 7374 7261 7465 6779   sample strategy
-00010140: 2072 6571 7569 7265 7320 6d6f 7265 2073   requires more s
-00010150: 616d 706c 6573 2e0a 0a20 2020 2020 2020  amples...       
-00010160: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00010170: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00010180: 2020 2020 2020 2073 6176 6564 5f6c 6f67         saved_log
-00010190: 6c3a 2061 7272 6179 206f 6620 666c 6f61  l: array of floa
-000101a0: 740a 2020 2020 2020 2020 2020 2020 6c6f  t.            lo
-000101b0: 676c 696b 656c 6968 6f6f 6420 7661 6c75  glikelihood valu
-000101c0: 6573 2069 6e20 696e 7465 6772 6174 696f  es in integratio
-000101d0: 6e0a 2020 2020 2020 2020 6d61 696e 5f69  n.        main_i
-000101e0: 7465 7261 746f 723a 2042 7265 6164 7468  terator: Breadth
-000101f0: 4669 7273 7449 7465 7261 746f 720a 2020  FirstIterator.  
-00010200: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-00010210: 7420 7472 6565 2065 7870 6c6f 7261 7469  t tree explorati
-00010220: 6f6e 2069 7465 7261 746f 720a 2020 2020  on iterator.    
-00010230: 2020 2020 646c 6f67 7a3a 2066 6c6f 6174      dlogz: float
-00010240: 0a20 2020 2020 2020 2020 2020 2072 6571  .            req
-00010250: 7569 7265 6420 6c6f 675a 2061 6363 7572  uired logZ accur
-00010260: 6163 7920 2873 6d61 6c6c 6572 2069 7320  acy (smaller is 
-00010270: 7374 7269 6374 6572 290a 2020 2020 2020  stricter).      
-00010280: 2020 644b 4c3a 2066 6c6f 6174 0a20 2020    dKL: float.   
-00010290: 2020 2020 2020 2020 2072 6571 7569 7265           require
-000102a0: 6420 4b75 6c62 6163 6b2d 4c65 6962 6c65  d Kulback-Leible
-000102b0: 7220 696e 666f 726d 6174 696f 6e20 6761  r information ga
-000102c0: 696e 2062 6574 7765 656e 2062 6f6f 7473  in between boots
-000102d0: 7472 6170 7065 640a 2020 2020 2020 2020  trapped.        
-000102e0: 2020 2020 6e65 7374 6564 2073 616d 706c      nested sampl
-000102f0: 696e 6720 696e 6361 726e 6174 696f 6e73  ing incarnations
-00010300: 2028 736d 616c 6c65 7220 6973 2073 7472   (smaller is str
-00010310: 6963 7465 7229 2e0a 2020 2020 2020 2020  icter)..        
-00010320: 6d69 6e5f 6573 733a 2066 6c6f 6174 0a20  min_ess: float. 
-00010330: 2020 2020 2020 2020 2020 2072 6571 7569             requi
-00010340: 7265 6420 6e75 6d62 6572 206f 6620 6566  red number of ef
-00010350: 6665 6374 6976 6520 7361 6d70 6c65 7320  fective samples 
-00010360: 2868 6967 6865 7220 6973 2073 7472 6963  (higher is stric
-00010370: 7465 7229 2e0a 0a20 2020 2020 2020 2022  ter)...        "
-00010380: 2222 0a20 2020 2020 2020 2073 6176 6564  "".        saved
-00010390: 5f6c 6f67 6c20 3d20 6e70 2e61 7361 7272  _logl = np.asarr
-000103a0: 6179 2873 6176 6564 5f6c 6f67 6c29 0a20  ay(saved_logl). 
-000103b0: 2020 2020 2020 206c 6f67 7720 3d20 6e70         logw = np
-000103c0: 2e61 7361 7272 6179 286d 6169 6e5f 6974  .asarray(main_it
-000103d0: 6572 6174 6f72 2e6c 6f67 7765 6967 6874  erator.logweight
-000103e0: 7329 202b 2073 6176 6564 5f6c 6f67 6c2e  s) + saved_logl.
-000103f0: 7265 7368 6170 6528 282d 312c 3129 2920  reshape((-1,1)) 
-00010400: 2d20 6d61 696e 5f69 7465 7261 746f 722e  - main_iterator.
-00010410: 616c 6c5f 6c6f 675a 0a20 2020 2020 2020  all_logZ.       
-00010420: 2072 6566 5f6c 6f67 7720 3d20 6c6f 6777   ref_logw = logw
-00010430: 5b3a 2c30 5d2e 7265 7368 6170 6528 282d  [:,0].reshape((-
-00010440: 312c 3129 290a 2020 2020 2020 2020 6f74  1,1)).        ot
-00010450: 6865 725f 6c6f 6777 203d 206c 6f67 775b  her_logw = logw[
-00010460: 3a2c 313a 5d0a 0a20 2020 2020 2020 204c  :,1:]..        L
-00010470: 6c6f 5f65 7373 203d 206e 702e 696e 660a  lo_ess = np.inf.
-00010480: 2020 2020 2020 2020 4c68 695f 6573 7320          Lhi_ess 
-00010490: 3d20 2d6e 702e 696e 660a 2020 2020 2020  = -np.inf.      
-000104a0: 2020 7720 3d20 6578 7028 7265 665f 6c6f    w = exp(ref_lo
-000104b0: 6777 2e66 6c61 7474 656e 2829 290a 2020  gw.flatten()).  
-000104c0: 2020 2020 2020 7720 2f3d 2077 2e73 756d        w /= w.sum
-000104d0: 2829 0a20 2020 2020 2020 2065 7373 203d  ().        ess =
-000104e0: 206c 656e 2877 2920 2f20 2831 2e30 202b   len(w) / (1.0 +
-000104f0: 2028 286c 656e 2877 2920 2a20 7720 2d20   ((len(w) * w - 
-00010500: 3129 2a2a 3229 2e73 756d 2829 202f 206c  1)**2).sum() / l
-00010510: 656e 2877 2929 0a20 2020 2020 2020 2069  en(w)).        i
-00010520: 6620 6573 7320 3c20 6d69 6e5f 6573 733a  f ess < min_ess:
-00010530: 0a20 2020 2020 2020 2020 2020 2073 616d  .            sam
-00010540: 706c 6573 203d 206e 702e 7261 6e64 6f6d  ples = np.random
-00010550: 2e63 686f 6963 6528 6c65 6e28 7729 2c20  .choice(len(w), 
-00010560: 703d 772c 2073 697a 653d 6d69 6e5f 6573  p=w, size=min_es
-00010570: 7329 0a20 2020 2020 2020 2020 2020 204c  s).            L
-00010580: 6c6f 5f65 7373 203d 2073 6176 6564 5f6c  lo_ess = saved_l
-00010590: 6f67 6c5b 7361 6d70 6c65 735d 2e6d 696e  ogl[samples].min
-000105a0: 2829 0a20 2020 2020 2020 2020 2020 204c  ().            L
-000105b0: 6869 5f65 7373 203d 2073 6176 6564 5f6c  hi_ess = saved_l
-000105c0: 6f67 6c5b 7361 6d70 6c65 735d 2e6d 6178  ogl[samples].max
-000105d0: 2829 0a20 2020 2020 2020 2069 6620 7365  ().        if se
-000105e0: 6c66 2e6c 6f67 2061 6e64 204c 6869 5f65  lf.log and Lhi_e
-000105f0: 7373 203e 204c 6c6f 5f65 7373 3a0a 2020  ss > Llo_ess:.  
-00010600: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00010610: 6f67 6765 722e 696e 666f 2822 4566 6665  ogger.info("Effe
-00010620: 6374 6976 6520 7361 6d70 6c65 7320 7374  ctive samples st
-00010630: 7261 7465 6779 2077 616e 7473 2074 6f20  rategy wants to 
-00010640: 696d 7072 6f76 653a 2025 2e32 662e 2e25  improve: %.2f..%
-00010650: 2e32 6620 2845 5353 203d 2025 2e31 662c  .2f (ESS = %.1f,
-00010660: 206e 6565 6420 3e25 6429 222c 0a20 2020   need >%d)",.   
-00010670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010680: 2020 2020 2020 2020 2020 4c6c 6f5f 6573            Llo_es
-00010690: 732c 204c 6869 5f65 7373 2c20 6573 732c  s, Lhi_ess, ess,
-000106a0: 206d 696e 5f65 7373 290a 2020 2020 2020   min_ess).      
-000106b0: 2020 656c 6966 2073 656c 662e 6c6f 6720    elif self.log 
-000106c0: 616e 6420 6d69 6e5f 6573 7320 3e20 303a  and min_ess > 0:
-000106d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000106e0: 662e 6c6f 6767 6572 2e69 6e66 6f28 2245  f.logger.info("E
-000106f0: 6666 6563 7469 7665 2073 616d 706c 6573  ffective samples
-00010700: 2073 7472 6174 6567 7920 7361 7469 7366   strategy satisf
-00010710: 6965 6420 2845 5353 203d 2025 2e31 662c  ied (ESS = %.1f,
-00010720: 206e 6565 6420 3e25 6429 222c 0a20 2020   need >%d)",.   
-00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010740: 2020 2020 2020 2020 2020 6573 732c 206d            ess, m
-00010750: 696e 5f65 7373 290a 0a20 2020 2020 2020  in_ess)..       
-00010760: 2023 2063 6f6d 7075 7465 204b 4c20 6469   # compute KL di
-00010770: 7665 7267 656e 6365 0a20 2020 2020 2020  vergence.       
-00010780: 2077 6974 6820 6e70 2e65 7272 7374 6174   with np.errstat
-00010790: 6528 696e 7661 6c69 643d 2769 676e 6f72  e(invalid='ignor
-000107a0: 6527 293a 0a20 2020 2020 2020 2020 2020  e'):.           
-000107b0: 204b 4c20 3d20 6e70 2e77 6865 7265 286e   KL = np.where(n
-000107c0: 702e 6973 6669 6e69 7465 286f 7468 6572  p.isfinite(other
-000107d0: 5f6c 6f67 7729 2c20 6578 7028 6f74 6865  _logw), exp(othe
-000107e0: 725f 6c6f 6777 2920 2a20 286f 7468 6572  r_logw) * (other
-000107f0: 5f6c 6f67 7720 2d20 7265 665f 6c6f 6777  _logw - ref_logw
-00010800: 292c 2030 290a 2020 2020 2020 2020 4b4c  ), 0).        KL
-00010810: 746f 7420 3d20 4b4c 2e73 756d 2861 7869  tot = KL.sum(axi
-00010820: 733d 3029 0a20 2020 2020 2020 2064 4b4c  s=0).        dKL
-00010830: 746f 7420 3d20 6e70 2e61 6273 284b 4c74  tot = np.abs(KLt
-00010840: 6f74 202d 204b 4c74 6f74 2e6d 6561 6e28  ot - KLtot.mean(
-00010850: 2929 0a20 2020 2020 2020 2070 203d 206e  )).        p = n
-00010860: 702e 7768 6572 6528 4b4c 203e 2030 2c20  p.where(KL > 0, 
-00010870: 4b4c 2c20 3029 0a20 2020 2020 2020 2070  KL, 0).        p
-00010880: 202f 3d20 702e 7375 6d28 6178 6973 3d30   /= p.sum(axis=0
-00010890: 292e 7265 7368 6170 6528 2831 2c20 2d31  ).reshape((1, -1
-000108a0: 2929 0a0a 2020 2020 2020 2020 4c6c 6f5f  ))..        Llo_
-000108b0: 4b4c 203d 206e 702e 696e 660a 2020 2020  KL = np.inf.    
-000108c0: 2020 2020 4c68 695f 4b4c 203d 202d 6e70      Lhi_KL = -np
-000108d0: 2e69 6e66 0a20 2020 2020 2020 2066 6f72  .inf.        for
-000108e0: 2069 2c20 2870 692c 2064 4b4c 692c 206c   i, (pi, dKLi, l
-000108f0: 6f67 7769 2920 696e 2065 6e75 6d65 7261  ogwi) in enumera
-00010900: 7465 287a 6970 2870 2e74 7261 6e73 706f  te(zip(p.transpo
-00010910: 7365 2829 2c20 644b 4c74 6f74 2c20 6f74  se(), dKLtot, ot
-00010920: 6865 725f 6c6f 6777 2929 3a0a 2020 2020  her_logw)):.    
-00010930: 2020 2020 2020 2020 6966 2064 4b4c 6920          if dKLi 
-00010940: 3e20 644b 4c3a 0a20 2020 2020 2020 2020  > dKL:.         
-00010950: 2020 2020 2020 2069 6c6f 2c20 6968 6920         ilo, ihi 
-00010960: 3d20 5f67 6574 5f63 756d 7375 6d5f 7261  = _get_cumsum_ra
-00010970: 6e67 6528 7069 2c20 312e 202f 2034 3030  nge(pi, 1. / 400
-00010980: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00010990: 2020 2320 696c 6f20 616e 6420 6968 6920    # ilo and ihi 
-000109a0: 6172 6520 6d6f 7374 206c 696b 656c 7920  are most likely 
-000109b0: 6d69 7373 696e 6720 696e 2074 6869 7320  missing in this 
-000109c0: 6974 6572 6174 6f72 0a20 2020 2020 2020  iterator.       
-000109d0: 2020 2020 2020 2020 2023 202d 2d3e 2073           # --> s
-000109e0: 656c 6563 7420 7468 6520 6f6e 6520 6265  elect the one be
-000109f0: 666f 7265 2f61 6674 6572 2069 6e20 7468  fore/after in th
-00010a00: 6973 2069 7465 7261 746f 720a 2020 2020  is iterator.    
-00010a10: 2020 2020 2020 2020 2020 2020 696c 6f73              ilos
-00010a20: 203d 206e 702e 7768 6572 6528 6e70 2e69   = np.where(np.i
-00010a30: 7366 696e 6974 6528 6c6f 6777 695b 3a69  sfinite(logwi[:i
-00010a40: 6c6f 5d29 295b 305d 0a20 2020 2020 2020  lo]))[0].       
-00010a50: 2020 2020 2020 2020 2069 6869 7320 3d20           ihis = 
-00010a60: 6e70 2e77 6865 7265 286e 702e 6973 6669  np.where(np.isfi
-00010a70: 6e69 7465 286c 6f67 7769 5b69 6869 3a5d  nite(logwi[ihi:]
-00010a80: 2929 5b30 5d0a 2020 2020 2020 2020 2020  ))[0].          
-00010a90: 2020 2020 2020 696c 6f32 203d 2069 6c6f        ilo2 = ilo
-00010aa0: 735b 2d31 5d20 6966 206c 656e 2869 6c6f  s[-1] if len(ilo
-00010ab0: 7329 203e 2030 2065 6c73 6520 300a 2020  s) > 0 else 0.  
-00010ac0: 2020 2020 2020 2020 2020 2020 2020 6968                ih
-00010ad0: 6932 203d 2028 6968 6920 2b20 6968 6973  i2 = (ihi + ihis
-00010ae0: 5b30 5d29 2069 6620 6c65 6e28 6968 6973  [0]) if len(ihis
-00010af0: 2920 3e20 3020 656c 7365 202d 310a 2020  ) > 0 else -1.  
-00010b00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010b10: 7365 6c66 2e6c 6f67 6765 722e 696e 666f  self.logger.info
-00010b20: 2827 2020 202d 204b 4c5b 2564 5d20 3d20  ('   - KL[%d] = 
-00010b30: 252e 3266 3a20 6e65 6564 2074 6f20 696d  %.2f: need to im
-00010b40: 7072 6f76 6520 6e65 6172 2025 2e32 662e  prove near %.2f.
-00010b50: 2e25 2e32 6620 2d2d 3e20 252e 3266 2e2e  .%.2f --> %.2f..
-00010b60: 252e 3266 2720 2520 280a 2020 2020 2020  %.2f' % (.      
-00010b70: 2020 2020 2020 2020 2020 2320 2069 2c20            #  i, 
-00010b80: 644b 4c69 2c20 7361 7665 645f 6c6f 676c  dKLi, saved_logl
-00010b90: 5b69 6c6f 5d2c 2073 6176 6564 5f6c 6f67  [ilo], saved_log
-00010ba0: 6c5b 6968 695d 2c20 7361 7665 645f 6c6f  l[ihi], saved_lo
-00010bb0: 676c 5b69 6c6f 325d 2c20 7361 7665 645f  gl[ilo2], saved_
-00010bc0: 6c6f 676c 5b69 6869 325d 2929 0a20 2020  logl[ihi2])).   
-00010bd0: 2020 2020 2020 2020 2020 2020 204c 6c6f               Llo
-00010be0: 5f4b 4c20 3d20 6d69 6e28 4c6c 6f5f 4b4c  _KL = min(Llo_KL
-00010bf0: 2c20 7361 7665 645f 6c6f 676c 5b69 6c6f  , saved_logl[ilo
-00010c00: 325d 290a 2020 2020 2020 2020 2020 2020  2]).            
-00010c10: 2020 2020 4c68 695f 4b4c 203d 206d 6178      Lhi_KL = max
-00010c20: 284c 6869 5f4b 4c2c 2073 6176 6564 5f6c  (Lhi_KL, saved_l
-00010c30: 6f67 6c5b 6968 6932 5d29 0a0a 2020 2020  ogl[ihi2])..    
-00010c40: 2020 2020 6966 2073 656c 662e 6c6f 6720      if self.log 
-00010c50: 616e 6420 4c68 695f 4b4c 203e 204c 6c6f  and Lhi_KL > Llo
-00010c60: 5f4b 4c3a 0a20 2020 2020 2020 2020 2020  _KL:.           
-00010c70: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
-00010c80: 6f28 2250 6f73 7465 7269 6f72 2075 6e63  o("Posterior unc
-00010c90: 6572 7461 696e 7479 2073 7472 6174 6567  ertainty strateg
-00010ca0: 7920 7761 6e74 7320 746f 2069 6d70 726f  y wants to impro
-00010cb0: 7665 3a20 252e 3266 2e2e 252e 3266 2028  ve: %.2f..%.2f (
-00010cc0: 4b4c 3a20 252e 3266 2b2d 252e 3266 206e  KL: %.2f+-%.2f n
-00010cd0: 6174 2c20 6e65 6564 203c 252e 3266 206e  at, need <%.2f n
-00010ce0: 6174 2922 2c0a 2020 2020 2020 2020 2020  at)",.          
-00010cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d00: 2020 204c 6c6f 5f4b 4c2c 204c 6869 5f4b     Llo_KL, Lhi_K
-00010d10: 4c2c 204b 4c74 6f74 2e6d 6561 6e28 292c  L, KLtot.mean(),
-00010d20: 2064 4b4c 746f 742e 6d61 7828 292c 2064   dKLtot.max(), d
-00010d30: 4b4c 290a 2020 2020 2020 2020 656c 6966  KL).        elif
-00010d40: 2073 656c 662e 6c6f 673a 0a20 2020 2020   self.log:.     
-00010d50: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-00010d60: 6572 2e69 6e66 6f28 2250 6f73 7465 7269  er.info("Posteri
-00010d70: 6f72 2075 6e63 6572 7461 696e 7479 2073  or uncertainty s
-00010d80: 7472 6174 6567 7920 6973 2073 6174 6973  trategy is satis
-00010d90: 6669 6564 2028 4b4c 3a20 252e 3266 2b2d  fied (KL: %.2f+-
-00010da0: 252e 3266 206e 6174 2c20 6e65 6564 203c  %.2f nat, need <
-00010db0: 252e 3266 206e 6174 2922 2c0a 2020 2020  %.2f nat)",.    
-00010dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010dd0: 2020 2020 2020 2020 204b 4c74 6f74 2e6d           KLtot.m
-00010de0: 6561 6e28 292c 2064 4b4c 746f 742e 6d61  ean(), dKLtot.ma
-00010df0: 7828 292c 2064 4b4c 290a 0a20 2020 2020  x(), dKL)..     
-00010e00: 2020 204e 6c69 7665 5f6d 696e 203d 2030     Nlive_min = 0
-00010e10: 0a20 2020 2020 2020 2070 203d 2065 7870  .        p = exp
-00010e20: 286c 6f67 7729 0a20 2020 2020 2020 2070  (logw).        p
-00010e30: 202f 3d20 702e 7375 6d28 6178 6973 3d30   /= p.sum(axis=0
-00010e40: 292e 7265 7368 6170 6528 2831 2c20 2d31  ).reshape((1, -1
-00010e50: 2929 0a20 2020 2020 2020 2064 656c 7461  )).        delta
-00010e60: 6c6f 675a 203d 206e 702e 6162 7328 6d61  logZ = np.abs(ma
-00010e70: 696e 5f69 7465 7261 746f 722e 616c 6c5f  in_iterator.all_
-00010e80: 6c6f 675a 5b31 3a5d 202d 206d 6169 6e5f  logZ[1:] - main_
-00010e90: 6974 6572 6174 6f72 2e6c 6f67 5a29 0a0a  iterator.logZ)..
-00010ea0: 2020 2020 2020 2020 7461 696c 5f66 7261          tail_fra
-00010eb0: 6374 696f 6e20 3d20 775b 6e70 2e61 7361  ction = w[np.asa
-00010ec0: 7272 6179 286d 6169 6e5f 6974 6572 6174  rray(main_iterat
-00010ed0: 6f72 2e69 7374 6169 6c29 5d2e 7375 6d28  or.istail)].sum(
-00010ee0: 2920 2f20 772e 7375 6d28 290a 2020 2020  ) / w.sum().    
-00010ef0: 2020 2020 6c6f 677a 6572 725f 7461 696c      logzerr_tail
-00010f00: 203d 206c 6f67 6164 6465 7870 286c 6f67   = logaddexp(log
-00010f10: 2874 6169 6c5f 6672 6163 7469 6f6e 2920  (tail_fraction) 
-00010f20: 2b20 6d61 696e 5f69 7465 7261 746f 722e  + main_iterator.
-00010f30: 6c6f 675a 2c20 6d61 696e 5f69 7465 7261  logZ, main_itera
-00010f40: 746f 722e 6c6f 675a 2920 2d20 6d61 696e  tor.logZ) - main
-00010f50: 5f69 7465 7261 746f 722e 6c6f 675a 0a20  _iterator.logZ. 
-00010f60: 2020 2020 2020 206d 6178 6c6f 677a 6572         maxlogzer
-00010f70: 7220 3d20 6d61 7828 6d61 696e 5f69 7465  r = max(main_ite
-00010f80: 7261 746f 722e 6c6f 675a 6572 722c 2064  rator.logZerr, d
-00010f90: 656c 7461 6c6f 675a 2e6d 6178 2829 2c20  eltalogZ.max(), 
-00010fa0: 6d61 696e 5f69 7465 7261 746f 722e 6c6f  main_iterator.lo
-00010fb0: 675a 6572 725f 6273 290a 2020 2020 2020  gZerr_bs).      
-00010fc0: 2020 6966 206d 6178 6c6f 677a 6572 7220    if maxlogzerr 
-00010fd0: 3e20 646c 6f67 7a3a 0a20 2020 2020 2020  > dlogz:.       
-00010fe0: 2020 2020 2069 6620 6c6f 677a 6572 725f       if logzerr_
-00010ff0: 7461 696c 203e 206d 6178 6c6f 677a 6572  tail > maxlogzer
-00011000: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00011010: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
-00011020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011030: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-00011040: 696e 666f 2822 6c6f 677a 2065 7272 6f72  info("logz error
-00011050: 2069 7320 646f 6d69 6e61 7465 6420 6279   is dominated by
-00011060: 2074 6169 6c2e 2044 6563 7265 6173 6520   tail. Decrease 
-00011070: 6672 6163 5f72 656d 6169 6e20 746f 206d  frac_remain to m
-00011080: 616b 6520 7072 6f67 7265 7373 2e22 290a  ake progress.").
-00011090: 2020 2020 2020 2020 2020 2020 2320 7665              # ve
-000110a0: 7279 2063 6f6e 7665 7276 6174 6976 6520  ry convervative 
-000110b0: 6573 7469 6d61 7469 6f6e 2075 7369 6e67  estimation using
-000110c0: 2061 6c6c 2069 7465 7261 7469 6f6e 730a   all iterations.
-000110d0: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-000110e0: 6973 2070 756e 6973 6865 7320 7368 6f72  is punishes shor
-000110f0: 7420 696e 7465 7276 616c 7320 7769 7468  t intervals with
-00011100: 206d 616e 7920 6c69 7665 2070 6f69 6e74   many live point
-00011110: 730a 2020 2020 2020 2020 2020 2020 6e69  s.            ni
-00011120: 7465 725f 6d61 7820 3d20 6c65 6e28 7361  ter_max = len(sa
-00011130: 7665 645f 6c6f 676c 290a 2020 2020 2020  ved_logl).      
-00011140: 2020 2020 2020 4e6c 6976 655f 6d69 6e20        Nlive_min 
-00011150: 3d20 696e 7428 6e70 2e63 6569 6c28 6e69  = int(np.ceil(ni
-00011160: 7465 725f 6d61 782a 2a30 2e35 202f 2064  ter_max**0.5 / d
-00011170: 6c6f 677a 2929 0a20 2020 2020 2020 2020  logz)).         
-00011180: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
-00011190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000111a0: 7365 6c66 2e6c 6f67 6765 722e 6465 6275  self.logger.debu
-000111b0: 6728 2220 2063 6f6e 7365 7276 6174 6976  g("  conservativ
-000111c0: 6520 6573 7469 6d61 7465 2073 6179 7320  e estimate says 
-000111d0: 6174 206c 6561 7374 2025 6420 6c69 7665  at least %d live
-000111e0: 2070 6f69 6e74 7320 6172 6520 6e65 6564   points are need
-000111f0: 6564 2074 6f20 7265 6163 6820 646c 6f67  ed to reach dlog
-00011200: 7a20 676f 616c 222c 204e 6c69 7665 5f6d  z goal", Nlive_m
-00011210: 696e 290a 0a20 2020 2020 2020 2020 2020  in)..           
-00011220: 2023 2062 6574 7465 7220 6573 7469 6d61   # better estima
-00011230: 7469 6f6e 3a0a 0a20 2020 2020 2020 2020  tion:..         
-00011240: 2020 2023 2067 6574 206f 6e6c 7920 756e     # get only un
-00011250: 7469 6c20 7768 6572 6520 6c6f 677a 2062  til where logz b
-00011260: 756c 6b20 6973 2028 7261 6e64 6f6d 2073  ulk is (random s
-00011270: 616d 706c 6520 6865 7265 290a 2020 2020  ample here).    
-00011280: 2020 2020 2020 2020 6974 6d61 7820 3d20          itmax = 
-00011290: 6e70 2e72 616e 646f 6d2e 6368 6f69 6365  np.random.choice
-000112a0: 286c 656e 2877 292c 2070 3d77 290a 2020  (len(w), p=w).  
-000112b0: 2020 2020 2020 2020 2020 2320 6261 636b            # back
-000112c0: 206f 7574 206e 6c69 7665 2073 6571 7565   out nlive seque
-000112d0: 6e63 6520 2877 6964 7468 2063 6861 6e67  nce (width chang
-000112e0: 6564 2062 7920 2831 202d 2065 7870 282d  ed by (1 - exp(-
-000112f0: 312f 4e29 292a 2865 7870 282d 312f 4e29  1/N))*(exp(-1/N)
-00011300: 2920 290a 2020 2020 2020 2020 2020 2020  ) ).            
-00011310: 6c6f 6777 6569 6768 7473 203d 206e 702e  logweights = np.
-00011320: 6172 7261 7928 6d61 696e 5f69 7465 7261  array(main_itera
-00011330: 746f 722e 6c6f 6777 6569 6768 7473 5b3a  tor.logweights[:
-00011340: 6974 6d61 785d 290a 2020 2020 2020 2020  itmax]).        
-00011350: 2020 2020 7769 7468 206e 702e 6572 7273      with np.errs
-00011360: 7461 7465 2864 6976 6964 653d 2769 676e  tate(divide='ign
-00011370: 6f72 6527 2c20 696e 7661 6c69 643d 2769  ore', invalid='i
-00011380: 676e 6f72 6527 293a 0a20 2020 2020 2020  gnore'):.       
-00011390: 2020 2020 2020 2020 2077 6964 7468 7261           widthra
-000113a0: 7469 6f20 3d20 3120 2d20 6e70 2e65 7870  tio = 1 - np.exp
-000113b0: 286c 6f67 7765 6967 6874 735b 313a 2c30  (logweights[1:,0
-000113c0: 5d20 2d20 6c6f 6777 6569 6768 7473 5b3a  ] - logweights[:
-000113d0: 2d31 2c30 5d29 0a20 2020 2020 2020 2020  -1,0]).         
-000113e0: 2020 2020 2020 206e 6c69 7665 203d 2031         nlive = 1
-000113f0: 2e20 2f20 6e70 2e6c 6f67 2828 3120 2d20  . / np.log((1 - 
-00011400: 6e70 2e73 7172 7428 3120 2d20 3420 2a20  np.sqrt(1 - 4 * 
-00011410: 7769 6474 6872 6174 696f 2929 202f 2028  widthratio)) / (
-00011420: 3220 2a20 7769 6474 6872 6174 696f 2929  2 * widthratio))
-00011430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011440: 206e 6c69 7665 5b7e 6e70 2e6c 6f67 6963   nlive[~np.logic
-00011450: 616c 5f61 6e64 286e 702e 6973 6669 6e69  al_and(np.isfini
-00011460: 7465 286e 6c69 7665 292c 206e 6c69 7665  te(nlive), nlive
-00011470: 203e 2031 295d 203d 2031 0a0a 2020 2020   > 1)] = 1..    
-00011480: 2020 2020 2020 2020 2320 6275 696c 6420          # build 
-00011490: 6974 6572 6174 696f 6e20 6772 6f75 7073  iteration groups
-000114a0: 0a20 2020 2020 2020 2020 2020 206e 6c69  .            nli
-000114b0: 7665 5f73 6574 732c 206e 6974 6572 203d  ve_sets, niter =
-000114c0: 206e 702e 756e 6971 7565 286e 6c69 7665   np.unique(nlive
-000114d0: 2e61 7374 7970 6528 696e 7429 2c20 7265  .astype(int), re
-000114e0: 7475 726e 5f63 6f75 6e74 733d 5472 7565  turn_counts=True
-000114f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00011500: 2073 656c 662e 6c6f 673a 0a20 2020 2020   self.log:.     
-00011510: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00011520: 6c6f 6767 6572 2e64 6562 7567 280a 2020  logger.debug(.  
+0000f420: 2020 2061 6374 6976 655f 755b 692c 3a5d     active_u[i,:]
+0000f430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f440: 2020 2020 2020 2020 2020 6163 7469 7665            active
+0000f450: 5f76 5b69 2c3a 5d29 2c20 3129 0a0a 2020  _v[i,:]), 1)..  
+0000f460: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0000f470: 2870 7265 765f 7529 203e 2030 3a0a 2020  (prev_u) > 0:.  
+0000f480: 2020 2020 2020 2020 2020 2020 2020 6163                ac
+0000f490: 7469 7665 5f75 203d 206e 702e 636f 6e63  tive_u = np.conc
+0000f4a0: 6174 656e 6174 6528 2870 7265 765f 752c  atenate((prev_u,
+0000f4b0: 2061 6374 6976 655f 7529 290a 2020 2020   active_u)).    
+0000f4c0: 2020 2020 2020 2020 2020 2020 6163 7469              acti
+0000f4d0: 7665 5f76 203d 206e 702e 636f 6e63 6174  ve_v = np.concat
+0000f4e0: 656e 6174 6528 2870 7265 765f 762c 2061  enate((prev_v, a
+0000f4f0: 6374 6976 655f 7629 290a 2020 2020 2020  ctive_v)).      
+0000f500: 2020 2020 2020 2020 2020 6163 7469 7665            active
+0000f510: 5f6c 6f67 6c20 3d20 6e70 2e63 6f6e 6361  _logl = np.conca
+0000f520: 7465 6e61 7465 2828 7072 6576 5f6c 6f67  tenate((prev_log
+0000f530: 6c2c 2061 6374 6976 655f 6c6f 676c 2929  l, active_logl))
+0000f540: 0a20 2020 2020 2020 2020 2020 2061 7373  .            ass
+0000f550: 6572 7420 6163 7469 7665 5f75 2e73 6861  ert active_u.sha
+0000f560: 7065 203d 3d20 286e 6e65 7772 6f6f 7473  pe == (nnewroots
+0000f570: 2c20 7365 6c66 2e78 5f64 696d 292c 2028  , self.x_dim), (
+0000f580: 6163 7469 7665 5f75 2e73 6861 7065 2c20  active_u.shape, 
+0000f590: 6e6e 6577 726f 6f74 732c 2073 656c 662e  nnewroots, self.
+0000f5a0: 785f 6469 6d2c 206e 756d 5f6c 6976 655f  x_dim, num_live_
+0000f5b0: 706f 696e 7473 5f6d 6973 7369 6e67 2c20  points_missing, 
+0000f5c0: 6c65 6e28 7072 6576 5f75 2929 0a20 2020  len(prev_u)).   
+0000f5d0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+0000f5e0: 6163 7469 7665 5f76 2e73 6861 7065 203d  active_v.shape =
+0000f5f0: 3d20 286e 6e65 7772 6f6f 7473 2c20 7365  = (nnewroots, se
+0000f600: 6c66 2e6e 756d 5f70 6172 616d 7329 2c20  lf.num_params), 
+0000f610: 2861 6374 6976 655f 762e 7368 6170 652c  (active_v.shape,
+0000f620: 206e 6e65 7772 6f6f 7473 2c20 7365 6c66   nnewroots, self
+0000f630: 2e6e 756d 5f70 6172 616d 732c 206e 756d  .num_params, num
+0000f640: 5f6c 6976 655f 706f 696e 7473 5f6d 6973  _live_points_mis
+0000f650: 7369 6e67 2c20 6c65 6e28 7072 6576 5f75  sing, len(prev_u
+0000f660: 2929 0a20 2020 2020 2020 2020 2020 2061  )).            a
+0000f670: 7373 6572 7420 6163 7469 7665 5f6c 6f67  ssert active_log
+0000f680: 6c2e 7368 6170 6520 3d3d 2028 6e6e 6577  l.shape == (nnew
+0000f690: 726f 6f74 732c 292c 2028 6163 7469 7665  roots,), (active
+0000f6a0: 5f6c 6f67 6c2e 7368 6170 652c 206e 6e65  _logl.shape, nne
+0000f6b0: 7772 6f6f 7473 290a 2020 2020 2020 2020  wroots).        
+0000f6c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000f6d0: 2020 6163 7469 7665 5f75 203d 2070 7265    active_u = pre
+0000f6e0: 765f 750a 2020 2020 2020 2020 2020 2020  v_u.            
+0000f6f0: 6163 7469 7665 5f76 203d 2070 7265 765f  active_v = prev_
+0000f700: 760a 2020 2020 2020 2020 2020 2020 6163  v.            ac
+0000f710: 7469 7665 5f6c 6f67 6c20 3d20 7072 6576  tive_logl = prev
+0000f720: 5f6c 6f67 6c0a 0a20 2020 2020 2020 2072  _logl..        r
+0000f730: 6f6f 7473 203d 205b 7365 6c66 2e70 6f69  oots = [self.poi
+0000f740: 6e74 7069 6c65 2e6d 616b 655f 6e6f 6465  ntpile.make_node
+0000f750: 286c 6f67 6c2c 2075 2c20 7029 2066 6f72  (logl, u, p) for
+0000f760: 2075 2c20 702c 206c 6f67 6c20 696e 207a   u, p, logl in z
+0000f770: 6970 2861 6374 6976 655f 752c 2061 6374  ip(active_u, act
+0000f780: 6976 655f 762c 2061 6374 6976 655f 6c6f  ive_v, active_lo
+0000f790: 676c 295d 0a20 2020 2020 2020 2069 6620  gl)].        if 
+0000f7a0: 6c65 6e28 6163 7469 7665 5f75 2920 3e20  len(active_u) > 
+0000f7b0: 343a 0a20 2020 2020 2020 2020 2020 2073  4:.            s
+0000f7c0: 656c 662e 6275 696c 645f 7472 6567 696f  elf.build_tregio
+0000f7d0: 6e20 3d20 6e6f 7420 6973 5f61 6666 696e  n = not is_affin
+0000f7e0: 655f 7472 616e 7366 6f72 6d28 6163 7469  e_transform(acti
+0000f7f0: 7665 5f75 2c20 6163 7469 7665 5f76 290a  ve_u, active_v).
+0000f800: 2020 2020 2020 2020 7365 6c66 2e72 6f6f          self.roo
+0000f810: 742e 6368 696c 6472 656e 202b 3d20 726f  t.children += ro
+0000f820: 6f74 730a 0a20 2020 2064 6566 205f 6164  ots..    def _ad
+0000f830: 6170 7469 7665 5f73 7472 6174 6567 795f  aptive_strategy_
+0000f840: 6164 7669 6365 2873 656c 662c 204c 6d69  advice(self, Lmi
+0000f850: 6e2c 2070 6172 616c 6c65 6c5f 7661 6c75  n, parallel_valu
+0000f860: 6573 2c20 6d61 696e 5f69 7465 7261 746f  es, main_iterato
+0000f870: 722c 206d 696e 696d 616c 5f77 6964 7468  r, minimal_width
+0000f880: 732c 2066 7261 635f 7265 6d61 696e 2c20  s, frac_remain, 
+0000f890: 4c65 7073 696c 6f6e 293a 0a20 2020 2020  Lepsilon):.     
+0000f8a0: 2020 2022 2222 4368 6563 6b20 6966 2069     """Check if i
+0000f8b0: 6e74 6567 7261 7469 6f6e 2069 7320 646f  ntegration is do
+0000f8c0: 6e65 2e0a 0a20 2020 2020 2020 2052 6574  ne...        Ret
+0000f8d0: 7572 6e73 2072 616e 6765 2077 6865 7265  urns range where
+0000f8e0: 206d 6f72 6520 7361 6d70 6c69 6e67 2069   more sampling i
+0000f8f0: 7320 6e65 6564 6564 0a0a 2020 2020 2020  s needed..      
+0000f900: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+0000f910: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+0000f920: 2020 204c 6c6f 3a20 666c 6f61 740a 2020     Llo: float.  
+0000f930: 2020 2020 2020 2020 2020 6c6f 7765 7220            lower 
+0000f940: 6c6f 672d 6c69 6b65 6c69 686f 6f64 2062  log-likelihood b
+0000f950: 6f75 6e64 2c20 6e61 6e20 6966 2064 6f6e  ound, nan if don
+0000f960: 650a 2020 2020 2020 2020 4c68 693a 2066  e.        Lhi: f
+0000f970: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+0000f980: 206c 6f77 6572 206c 6f67 2d6c 696b 656c   lower log-likel
+0000f990: 6968 6f6f 6420 626f 756e 642c 206e 616e  ihood bound, nan
+0000f9a0: 2069 6620 646f 6e65 0a0a 2020 2020 2020   if done..      
+0000f9b0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+0000f9c0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d       -----------
+0000f9d0: 0a20 2020 2020 2020 204c 6d69 6e3a 2066  .        Lmin: f
+0000f9e0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+0000f9f0: 2063 7572 7265 6e74 206c 6f67 6c69 6b65   current loglike
+0000fa00: 6c69 686f 6f64 2074 6872 6573 686f 6c64  lihood threshold
+0000fa10: 0a20 2020 2020 2020 2070 6172 616c 6c65  .        paralle
+0000fa20: 6c5f 7661 6c75 6573 3a20 6172 7261 7920  l_values: array 
+0000fa30: 6f66 2066 6c6f 6174 730a 2020 2020 2020  of floats.      
+0000fa40: 2020 2020 2020 6c6f 676c 696b 656c 6968        loglikelih
+0000fa50: 6f6f 6473 206f 6620 6c69 7665 2070 6f69  oods of live poi
+0000fa60: 6e74 730a 2020 2020 2020 2020 6d61 696e  nts.        main
+0000fa70: 5f69 7465 7261 746f 723a 2042 7265 6164  _iterator: Bread
+0000fa80: 7468 4669 7273 7449 7465 7261 746f 720a  thFirstIterator.
+0000fa90: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0000faa0: 656e 7420 7472 6565 2065 7870 6c6f 7261  ent tree explora
+0000fab0: 7469 6f6e 2069 7465 7261 746f 720a 2020  tion iterator.  
+0000fac0: 2020 2020 2020 6d69 6e69 6d61 6c5f 7769        minimal_wi
+0000fad0: 6474 6873 3a20 6c69 7374 0a20 2020 2020  dths: list.     
+0000fae0: 2020 2020 2020 2063 7572 7265 6e74 2077         current w
+0000faf0: 6964 7468 2072 6571 7569 7265 640a 2020  idth required.  
+0000fb00: 2020 2020 2020 6672 6163 5f72 656d 6169        frac_remai
+0000fb10: 6e3a 2066 6c6f 6174 0a20 2020 2020 2020  n: float.       
+0000fb20: 2020 2020 206d 6178 696d 756d 2066 7261       maximum fra
+0000fb30: 6374 696f 6e20 6f66 2069 6e74 6567 7261  ction of integra
+0000fb40: 6c20 696e 2072 656d 6169 6e64 6572 2066  l in remainder f
+0000fb50: 6f72 2074 6572 6d69 6e61 7469 6f6e 0a20  or termination. 
+0000fb60: 2020 2020 2020 204c 6570 7369 6c6f 6e3a         Lepsilon:
+0000fb70: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+0000fb80: 2020 206c 6f67 6c69 6b65 6c69 686f 6f64     loglikelihood
+0000fb90: 2061 6363 7572 6163 7920 7468 7265 7368   accuracy thresh
+0000fba0: 6f6c 640a 2020 2020 2020 2020 2222 220a  old.        """.
+0000fbb0: 2020 2020 2020 2020 4c73 203d 2070 6172          Ls = par
+0000fbc0: 616c 6c65 6c5f 7661 6c75 6573 2e63 6f70  allel_values.cop
+0000fbd0: 7928 290a 2020 2020 2020 2020 4c73 2e73  y().        Ls.s
+0000fbe0: 6f72 7428 290a 2020 2020 2020 2020 2320  ort().        # 
+0000fbf0: 4c73 203d 205b 6e6f 6465 2e76 616c 7565  Ls = [node.value
+0000fc00: 5d20 2b20 5b6e 2e76 616c 7565 2066 6f72  ] + [n.value for
+0000fc10: 2072 6f6f 7469 6432 2c20 6e20 696e 2070   rootid2, n in p
+0000fc20: 6172 616c 6c65 6c5f 6e6f 6465 735d 0a20  arallel_nodes]. 
+0000fc30: 2020 2020 2020 204c 6d61 7820 3d20 4c73         Lmax = Ls
+0000fc40: 5b2d 315d 0a20 2020 2020 2020 204c 6d69  [-1].        Lmi
+0000fc50: 6e20 3d20 4c73 5b30 5d0a 0a20 2020 2020  n = Ls[0]..     
+0000fc60: 2020 2023 2061 6c6c 2070 6f69 6e74 7320     # all points 
+0000fc70: 7468 6520 7361 6d65 2c20 7374 6f70 0a20  the same, stop. 
+0000fc80: 2020 2020 2020 2069 6620 4c6d 6178 202d         if Lmax -
+0000fc90: 204c 6d69 6e20 3c20 4c65 7073 696c 6f6e   Lmin < Lepsilon
+0000fca0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000fcb0: 7475 726e 206e 702e 6e61 6e2c 206e 702e  turn np.nan, np.
+0000fcc0: 6e61 6e0a 0a20 2020 2020 2020 2023 206d  nan..        # m
+0000fcd0: 6178 2072 656d 6169 6e64 6572 2063 6f6e  ax remainder con
+0000fce0: 7472 6962 7574 696f 6e20 6973 204c 6d61  tribution is Lma
+0000fcf0: 7820 2b20 7765 6967 6874 2c20 746f 2062  x + weight, to b
+0000fd00: 6520 6164 6465 6420 746f 206d 6169 6e5f  e added to main_
+0000fd10: 6974 6572 6174 6f72 2e6c 6f67 5a0a 2020  iterator.logZ.  
+0000fd20: 2020 2020 2020 2320 7468 6520 6c69 6b65        # the like
+0000fd30: 6c69 686f 6f64 2074 6861 7420 776f 756c  lihood that woul
+0000fd40: 6420 6164 6420 616e 2065 7175 616c 2061  d add an equal a
+0000fd50: 6d6f 756e 7420 6173 206d 6169 6e5f 6974  mount as main_it
+0000fd60: 6572 6174 6f72 2e6c 6f67 5a20 6973 3a0a  erator.logZ is:.
+0000fd70: 2020 2020 2020 2020 6c6f 675a 6d61 7820          logZmax 
+0000fd80: 3d20 6d61 696e 5f69 7465 7261 746f 722e  = main_iterator.
+0000fd90: 6c6f 675a 7265 6d61 696e 0a20 2020 2020  logZremain.     
+0000fda0: 2020 204c 6e65 7874 203d 206c 6f67 5a6d     Lnext = logZm
+0000fdb0: 6178 202d 2028 6d61 696e 5f69 7465 7261  ax - (main_itera
+0000fdc0: 746f 722e 6c6f 6756 6f6c 7265 6d61 696e  tor.logVolremain
+0000fdd0: 696e 6720 2b20 6c6f 6728 6672 6163 5f72  ing + log(frac_r
+0000fde0: 656d 6169 6e29 2920 2d20 6c6f 6728 6c65  emain)) - log(le
+0000fdf0: 6e28 4c73 2929 0a20 2020 2020 2020 204c  n(Ls)).        L
+0000fe00: 3120 3d20 4c73 5b31 5d20 6966 206c 656e  1 = Ls[1] if len
+0000fe10: 284c 7329 203e 2031 2065 6c73 6520 4c73  (Ls) > 1 else Ls
+0000fe20: 5b30 5d0a 2020 2020 2020 2020 4c6d 6178  [0].        Lmax
+0000fe30: 3120 3d20 6e70 2e6d 6564 6961 6e28 4c73  1 = np.median(Ls
+0000fe40: 290a 2020 2020 2020 2020 4c6e 6578 7420  ).        Lnext 
+0000fe50: 3d20 6d61 7828 6d69 6e28 4c6e 6578 742c  = max(min(Lnext,
+0000fe60: 204c 6d61 7831 292c 204c 3129 0a0a 2020   Lmax1), L1)..  
+0000fe70: 2020 2020 2020 2320 6966 2074 6865 2072        # if the r
+0000fe80: 656d 6169 6e64 6572 2064 6f6d 696e 6174  emainder dominat
+0000fe90: 6573 2c20 7265 7475 726e 2074 6861 7420  es, return that 
+0000fea0: 7261 6e67 650a 2020 2020 2020 2020 6966  range.        if
+0000feb0: 206d 6169 6e5f 6974 6572 6174 6f72 2e6c   main_iterator.l
+0000fec0: 6f67 5a72 656d 6169 6e20 3e20 6d61 696e  ogZremain > main
+0000fed0: 5f69 7465 7261 746f 722e 6c6f 675a 3a0a  _iterator.logZ:.
+0000fee0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000fef0: 726e 204c 6d69 6e2c 204c 6e65 7874 0a0a  rn Lmin, Lnext..
+0000ff00: 2020 2020 2020 2020 6966 206d 6169 6e5f          if main_
+0000ff10: 6974 6572 6174 6f72 2e72 656d 6169 6e64  iterator.remaind
+0000ff20: 6572 5f66 7261 6374 696f 6e20 3e20 6672  er_fraction > fr
+0000ff30: 6163 5f72 656d 6169 6e3a 0a20 2020 2020  ac_remain:.     
+0000ff40: 2020 2020 2020 2072 6574 7572 6e20 4c6d         return Lm
+0000ff50: 696e 2c20 4c6e 6578 740a 0a20 2020 2020  in, Lnext..     
+0000ff60: 2020 2072 6574 7572 6e20 6e70 2e6e 616e     return np.nan
+0000ff70: 2c20 6e70 2e6e 616e 0a0a 2020 2020 6465  , np.nan..    de
+0000ff80: 6620 5f66 696e 645f 7374 7261 7465 6779  f _find_strategy
+0000ff90: 2873 656c 662c 2073 6176 6564 5f6c 6f67  (self, saved_log
+0000ffa0: 6c2c 206d 6169 6e5f 6974 6572 6174 6f72  l, main_iterator
+0000ffb0: 2c20 646c 6f67 7a2c 2064 4b4c 2c20 6d69  , dlogz, dKL, mi
+0000ffc0: 6e5f 6573 7329 3a0a 2020 2020 2020 2020  n_ess):.        
+0000ffd0: 2222 2241 736b 2065 6163 6820 7374 7261  """Ask each stra
+0000ffe0: 7465 6779 2077 6869 6368 206c 6f67 2d6c  tegy which log-l
+0000fff0: 696b 656c 6968 6f6f 6420 696e 7465 7276  ikelihood interv
+00010000: 616c 206e 6565 6473 206d 6f72 6520 6578  al needs more ex
+00010010: 706c 6f72 6174 696f 6e2e 0a0a 2020 2020  ploration...    
+00010020: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
+00010030: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
+00010040: 2020 2020 284c 6c6f 5f5a 2c20 4c68 695f      (Llo_Z, Lhi_
+00010050: 5a29 3a20 666c 6f61 7473 0a20 2020 2020  Z): floats.     
+00010060: 2020 2020 2020 2069 6e74 6572 7661 6c20         interval 
+00010070: 7768 6572 6520 646c 6f67 7a20 7374 7261  where dlogz stra
+00010080: 7465 6779 2072 6571 7569 7265 7320 6d6f  tegy requires mo
+00010090: 7265 2073 616d 706c 6573 2e0a 2020 2020  re samples..    
+000100a0: 2020 2020 284c 6c6f 5f4b 4c2c 204c 6869      (Llo_KL, Lhi
+000100b0: 5f4b 4c29 3a20 666c 6f61 7473 0a20 2020  _KL): floats.   
+000100c0: 2020 2020 2020 2020 2069 6e74 6572 7661           interva
+000100d0: 6c20 7768 6572 6520 706f 7374 6572 696f  l where posterio
+000100e0: 7220 756e 6365 7274 6169 6e74 7920 7374  r uncertainty st
+000100f0: 7261 7465 6779 2072 6571 7569 7265 7320  rategy requires 
+00010100: 6d6f 7265 2073 616d 706c 6573 2e0a 2020  more samples..  
+00010110: 2020 2020 2020 284c 6c6f 5f65 7373 2c20        (Llo_ess, 
+00010120: 4c68 695f 6573 7329 3a20 666c 6f61 7473  Lhi_ess): floats
+00010130: 0a20 2020 2020 2020 2020 2020 2069 6e74  .            int
+00010140: 6572 7661 6c20 7768 6572 6520 6566 6665  erval where effe
+00010150: 6374 6976 6520 7361 6d70 6c65 2073 7472  ctive sample str
+00010160: 6174 6567 7920 7265 7175 6972 6573 206d  ategy requires m
+00010170: 6f72 6520 7361 6d70 6c65 732e 0a0a 2020  ore samples...  
+00010180: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
+00010190: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000101a0: 2d2d 2d0a 2020 2020 2020 2020 7361 7665  ---.        save
+000101b0: 645f 6c6f 676c 3a20 6172 7261 7920 6f66  d_logl: array of
+000101c0: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+000101d0: 2020 206c 6f67 6c69 6b65 6c69 686f 6f64     loglikelihood
+000101e0: 2076 616c 7565 7320 696e 2069 6e74 6567   values in integ
+000101f0: 7261 7469 6f6e 0a20 2020 2020 2020 206d  ration.        m
+00010200: 6169 6e5f 6974 6572 6174 6f72 3a20 4272  ain_iterator: Br
+00010210: 6561 6474 6846 6972 7374 4974 6572 6174  eadthFirstIterat
+00010220: 6f72 0a20 2020 2020 2020 2020 2020 2063  or.            c
+00010230: 7572 7265 6e74 2074 7265 6520 6578 706c  urrent tree expl
+00010240: 6f72 6174 696f 6e20 6974 6572 6174 6f72  oration iterator
+00010250: 0a20 2020 2020 2020 2064 6c6f 677a 3a20  .        dlogz: 
+00010260: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
+00010270: 2020 7265 7175 6972 6564 206c 6f67 5a20    required logZ 
+00010280: 6163 6375 7261 6379 2028 736d 616c 6c65  accuracy (smalle
+00010290: 7220 6973 2073 7472 6963 7465 7229 0a20  r is stricter). 
+000102a0: 2020 2020 2020 2064 4b4c 3a20 666c 6f61         dKL: floa
+000102b0: 740a 2020 2020 2020 2020 2020 2020 7265  t.            re
+000102c0: 7175 6972 6564 204b 756c 6261 636b 2d4c  quired Kulback-L
+000102d0: 6569 626c 6572 2069 6e66 6f72 6d61 7469  eibler informati
+000102e0: 6f6e 2067 6169 6e20 6265 7477 6565 6e20  on gain between 
+000102f0: 626f 6f74 7374 7261 7070 6564 0a20 2020  bootstrapped.   
+00010300: 2020 2020 2020 2020 206e 6573 7465 6420           nested 
+00010310: 7361 6d70 6c69 6e67 2069 6e63 6172 6e61  sampling incarna
+00010320: 7469 6f6e 7320 2873 6d61 6c6c 6572 2069  tions (smaller i
+00010330: 7320 7374 7269 6374 6572 292e 0a20 2020  s stricter)..   
+00010340: 2020 2020 206d 696e 5f65 7373 3a20 666c       min_ess: fl
+00010350: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00010360: 7265 7175 6972 6564 206e 756d 6265 7220  required number 
+00010370: 6f66 2065 6666 6563 7469 7665 2073 616d  of effective sam
+00010380: 706c 6573 2028 6869 6768 6572 2069 7320  ples (higher is 
+00010390: 7374 7269 6374 6572 292e 0a0a 2020 2020  stricter)...    
+000103a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000103b0: 7361 7665 645f 6c6f 676c 203d 206e 702e  saved_logl = np.
+000103c0: 6173 6172 7261 7928 7361 7665 645f 6c6f  asarray(saved_lo
+000103d0: 676c 290a 2020 2020 2020 2020 6c6f 6777  gl).        logw
+000103e0: 203d 206e 702e 6173 6172 7261 7928 6d61   = np.asarray(ma
+000103f0: 696e 5f69 7465 7261 746f 722e 6c6f 6777  in_iterator.logw
+00010400: 6569 6768 7473 2920 2b20 7361 7665 645f  eights) + saved_
+00010410: 6c6f 676c 2e72 6573 6861 7065 2828 2d31  logl.reshape((-1
+00010420: 2c31 2929 202d 206d 6169 6e5f 6974 6572  ,1)) - main_iter
+00010430: 6174 6f72 2e61 6c6c 5f6c 6f67 5a0a 2020  ator.all_logZ.  
+00010440: 2020 2020 2020 7265 665f 6c6f 6777 203d        ref_logw =
+00010450: 206c 6f67 775b 3a2c 305d 2e72 6573 6861   logw[:,0].resha
+00010460: 7065 2828 2d31 2c31 2929 0a20 2020 2020  pe((-1,1)).     
+00010470: 2020 206f 7468 6572 5f6c 6f67 7720 3d20     other_logw = 
+00010480: 6c6f 6777 5b3a 2c31 3a5d 0a0a 2020 2020  logw[:,1:]..    
+00010490: 2020 2020 4c6c 6f5f 6573 7320 3d20 6e70      Llo_ess = np
+000104a0: 2e69 6e66 0a20 2020 2020 2020 204c 6869  .inf.        Lhi
+000104b0: 5f65 7373 203d 202d 6e70 2e69 6e66 0a20  _ess = -np.inf. 
+000104c0: 2020 2020 2020 2077 203d 2065 7870 2872         w = exp(r
+000104d0: 6566 5f6c 6f67 772e 666c 6174 7465 6e28  ef_logw.flatten(
+000104e0: 2929 0a20 2020 2020 2020 2077 202f 3d20  )).        w /= 
+000104f0: 772e 7375 6d28 290a 2020 2020 2020 2020  w.sum().        
+00010500: 6573 7320 3d20 6c65 6e28 7729 202f 2028  ess = len(w) / (
+00010510: 312e 3020 2b20 2828 6c65 6e28 7729 202a  1.0 + ((len(w) *
+00010520: 2077 202d 2031 292a 2a32 292e 7375 6d28   w - 1)**2).sum(
+00010530: 2920 2f20 6c65 6e28 7729 290a 2020 2020  ) / len(w)).    
+00010540: 2020 2020 6966 2065 7373 203c 206d 696e      if ess < min
+00010550: 5f65 7373 3a0a 2020 2020 2020 2020 2020  _ess:.          
+00010560: 2020 7361 6d70 6c65 7320 3d20 6e70 2e72    samples = np.r
+00010570: 616e 646f 6d2e 6368 6f69 6365 286c 656e  andom.choice(len
+00010580: 2877 292c 2070 3d77 2c20 7369 7a65 3d6d  (w), p=w, size=m
+00010590: 696e 5f65 7373 290a 2020 2020 2020 2020  in_ess).        
+000105a0: 2020 2020 4c6c 6f5f 6573 7320 3d20 7361      Llo_ess = sa
+000105b0: 7665 645f 6c6f 676c 5b73 616d 706c 6573  ved_logl[samples
+000105c0: 5d2e 6d69 6e28 290a 2020 2020 2020 2020  ].min().        
+000105d0: 2020 2020 4c68 695f 6573 7320 3d20 7361      Lhi_ess = sa
+000105e0: 7665 645f 6c6f 676c 5b73 616d 706c 6573  ved_logl[samples
+000105f0: 5d2e 6d61 7828 290a 2020 2020 2020 2020  ].max().        
+00010600: 6966 2073 656c 662e 6c6f 6720 616e 6420  if self.log and 
+00010610: 4c68 695f 6573 7320 3e20 4c6c 6f5f 6573  Lhi_ess > Llo_es
+00010620: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+00010630: 656c 662e 6c6f 6767 6572 2e69 6e66 6f28  elf.logger.info(
+00010640: 2245 6666 6563 7469 7665 2073 616d 706c  "Effective sampl
+00010650: 6573 2073 7472 6174 6567 7920 7761 6e74  es strategy want
+00010660: 7320 746f 2069 6d70 726f 7665 3a20 252e  s to improve: %.
+00010670: 3266 2e2e 252e 3266 2028 4553 5320 3d20  2f..%.2f (ESS = 
+00010680: 252e 3166 2c20 6e65 6564 203e 2564 2922  %.1f, need >%d)"
+00010690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000106a0: 2020 2020 2020 2020 2020 2020 2020 204c                 L
+000106b0: 6c6f 5f65 7373 2c20 4c68 695f 6573 732c  lo_ess, Lhi_ess,
+000106c0: 2065 7373 2c20 6d69 6e5f 6573 7329 0a20   ess, min_ess). 
+000106d0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+000106e0: 2e6c 6f67 2061 6e64 206d 696e 5f65 7373  .log and min_ess
+000106f0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00010700: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
+00010710: 666f 2822 4566 6665 6374 6976 6520 7361  fo("Effective sa
+00010720: 6d70 6c65 7320 7374 7261 7465 6779 2073  mples strategy s
+00010730: 6174 6973 6669 6564 2028 4553 5320 3d20  atisfied (ESS = 
+00010740: 252e 3166 2c20 6e65 6564 203e 2564 2922  %.1f, need >%d)"
+00010750: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010760: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00010770: 7373 2c20 6d69 6e5f 6573 7329 0a0a 2020  ss, min_ess)..  
+00010780: 2020 2020 2020 2320 636f 6d70 7574 6520        # compute 
+00010790: 4b4c 2064 6976 6572 6765 6e63 650a 2020  KL divergence.  
+000107a0: 2020 2020 2020 7769 7468 206e 702e 6572        with np.er
+000107b0: 7273 7461 7465 2869 6e76 616c 6964 3d27  rstate(invalid='
+000107c0: 6967 6e6f 7265 2729 3a0a 2020 2020 2020  ignore'):.      
+000107d0: 2020 2020 2020 4b4c 203d 206e 702e 7768        KL = np.wh
+000107e0: 6572 6528 6e70 2e69 7366 696e 6974 6528  ere(np.isfinite(
+000107f0: 6f74 6865 725f 6c6f 6777 292c 2065 7870  other_logw), exp
+00010800: 286f 7468 6572 5f6c 6f67 7729 202a 2028  (other_logw) * (
+00010810: 6f74 6865 725f 6c6f 6777 202d 2072 6566  other_logw - ref
+00010820: 5f6c 6f67 7729 2c20 3029 0a20 2020 2020  _logw), 0).     
+00010830: 2020 204b 4c74 6f74 203d 204b 4c2e 7375     KLtot = KL.su
+00010840: 6d28 6178 6973 3d30 290a 2020 2020 2020  m(axis=0).      
+00010850: 2020 644b 4c74 6f74 203d 206e 702e 6162    dKLtot = np.ab
+00010860: 7328 4b4c 746f 7420 2d20 4b4c 746f 742e  s(KLtot - KLtot.
+00010870: 6d65 616e 2829 290a 2020 2020 2020 2020  mean()).        
+00010880: 7020 3d20 6e70 2e77 6865 7265 284b 4c20  p = np.where(KL 
+00010890: 3e20 302c 204b 4c2c 2030 290a 2020 2020  > 0, KL, 0).    
+000108a0: 2020 2020 7020 2f3d 2070 2e73 756d 2861      p /= p.sum(a
+000108b0: 7869 733d 3029 2e72 6573 6861 7065 2828  xis=0).reshape((
+000108c0: 312c 202d 3129 290a 0a20 2020 2020 2020  1, -1))..       
+000108d0: 204c 6c6f 5f4b 4c20 3d20 6e70 2e69 6e66   Llo_KL = np.inf
+000108e0: 0a20 2020 2020 2020 204c 6869 5f4b 4c20  .        Lhi_KL 
+000108f0: 3d20 2d6e 702e 696e 660a 2020 2020 2020  = -np.inf.      
+00010900: 2020 666f 7220 692c 2028 7069 2c20 644b    for i, (pi, dK
+00010910: 4c69 2c20 6c6f 6777 6929 2069 6e20 656e  Li, logwi) in en
+00010920: 756d 6572 6174 6528 7a69 7028 702e 7472  umerate(zip(p.tr
+00010930: 616e 7370 6f73 6528 292c 2064 4b4c 746f  anspose(), dKLto
+00010940: 742c 206f 7468 6572 5f6c 6f67 7729 293a  t, other_logw)):
+00010950: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00010960: 644b 4c69 203e 2064 4b4c 3a0a 2020 2020  dKLi > dKL:.    
+00010970: 2020 2020 2020 2020 2020 2020 696c 6f2c              ilo,
+00010980: 2069 6869 203d 205f 6765 745f 6375 6d73   ihi = _get_cums
+00010990: 756d 5f72 616e 6765 2870 692c 2031 2e20  um_range(pi, 1. 
+000109a0: 2f20 3430 3029 0a20 2020 2020 2020 2020  / 400).         
+000109b0: 2020 2020 2020 2023 2069 6c6f 2061 6e64         # ilo and
+000109c0: 2069 6869 2061 7265 206d 6f73 7420 6c69   ihi are most li
+000109d0: 6b65 6c79 206d 6973 7369 6e67 2069 6e20  kely missing in 
+000109e0: 7468 6973 2069 7465 7261 746f 720a 2020  this iterator.  
+000109f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00010a00: 2d2d 3e20 7365 6c65 6374 2074 6865 206f  --> select the o
+00010a10: 6e65 2062 6566 6f72 652f 6166 7465 7220  ne before/after 
+00010a20: 696e 2074 6869 7320 6974 6572 6174 6f72  in this iterator
+00010a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010a40: 2069 6c6f 7320 3d20 6e70 2e77 6865 7265   ilos = np.where
+00010a50: 286e 702e 6973 6669 6e69 7465 286c 6f67  (np.isfinite(log
+00010a60: 7769 5b3a 696c 6f5d 2929 5b30 5d0a 2020  wi[:ilo]))[0].  
+00010a70: 2020 2020 2020 2020 2020 2020 2020 6968                ih
+00010a80: 6973 203d 206e 702e 7768 6572 6528 6e70  is = np.where(np
+00010a90: 2e69 7366 696e 6974 6528 6c6f 6777 695b  .isfinite(logwi[
+00010aa0: 6968 693a 5d29 295b 305d 0a20 2020 2020  ihi:]))[0].     
+00010ab0: 2020 2020 2020 2020 2020 2069 6c6f 3220             ilo2 
+00010ac0: 3d20 696c 6f73 5b2d 315d 2069 6620 6c65  = ilos[-1] if le
+00010ad0: 6e28 696c 6f73 2920 3e20 3020 656c 7365  n(ilos) > 0 else
+00010ae0: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+00010af0: 2020 2069 6869 3220 3d20 2869 6869 202b     ihi2 = (ihi +
+00010b00: 2069 6869 735b 305d 2920 6966 206c 656e   ihis[0]) if len
+00010b10: 2869 6869 7329 203e 2030 2065 6c73 6520  (ihis) > 0 else 
+00010b20: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
+00010b30: 2020 2023 2073 656c 662e 6c6f 6767 6572     # self.logger
+00010b40: 2e69 6e66 6f28 2720 2020 2d20 4b4c 5b25  .info('   - KL[%
+00010b50: 645d 203d 2025 2e32 663a 206e 6565 6420  d] = %.2f: need 
+00010b60: 746f 2069 6d70 726f 7665 206e 6561 7220  to improve near 
+00010b70: 252e 3266 2e2e 252e 3266 202d 2d3e 2025  %.2f..%.2f --> %
+00010b80: 2e32 662e 2e25 2e32 6627 2025 2028 0a20  .2f..%.2f' % (. 
+00010b90: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00010ba0: 2020 692c 2064 4b4c 692c 2073 6176 6564    i, dKLi, saved
+00010bb0: 5f6c 6f67 6c5b 696c 6f5d 2c20 7361 7665  _logl[ilo], save
+00010bc0: 645f 6c6f 676c 5b69 6869 5d2c 2073 6176  d_logl[ihi], sav
+00010bd0: 6564 5f6c 6f67 6c5b 696c 6f32 5d2c 2073  ed_logl[ilo2], s
+00010be0: 6176 6564 5f6c 6f67 6c5b 6968 6932 5d29  aved_logl[ihi2])
+00010bf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010c00: 2020 4c6c 6f5f 4b4c 203d 206d 696e 284c    Llo_KL = min(L
+00010c10: 6c6f 5f4b 4c2c 2073 6176 6564 5f6c 6f67  lo_KL, saved_log
+00010c20: 6c5b 696c 6f32 5d29 0a20 2020 2020 2020  l[ilo2]).       
+00010c30: 2020 2020 2020 2020 204c 6869 5f4b 4c20           Lhi_KL 
+00010c40: 3d20 6d61 7828 4c68 695f 4b4c 2c20 7361  = max(Lhi_KL, sa
+00010c50: 7665 645f 6c6f 676c 5b69 6869 325d 290a  ved_logl[ihi2]).
+00010c60: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00010c70: 2e6c 6f67 2061 6e64 204c 6869 5f4b 4c20  .log and Lhi_KL 
+00010c80: 3e20 4c6c 6f5f 4b4c 3a0a 2020 2020 2020  > Llo_KL:.      
+00010c90: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+00010ca0: 722e 696e 666f 2822 506f 7374 6572 696f  r.info("Posterio
+00010cb0: 7220 756e 6365 7274 6169 6e74 7920 7374  r uncertainty st
+00010cc0: 7261 7465 6779 2077 616e 7473 2074 6f20  rategy wants to 
+00010cd0: 696d 7072 6f76 653a 2025 2e32 662e 2e25  improve: %.2f..%
+00010ce0: 2e32 6620 284b 4c3a 2025 2e32 662b 2d25  .2f (KL: %.2f+-%
+00010cf0: 2e32 6620 6e61 742c 206e 6565 6420 3c25  .2f nat, need <%
+00010d00: 2e32 6620 6e61 7429 222c 0a20 2020 2020  .2f nat)",.     
+00010d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d20: 2020 2020 2020 2020 4c6c 6f5f 4b4c 2c20          Llo_KL, 
+00010d30: 4c68 695f 4b4c 2c20 4b4c 746f 742e 6d65  Lhi_KL, KLtot.me
+00010d40: 616e 2829 2c20 644b 4c74 6f74 2e6d 6178  an(), dKLtot.max
+00010d50: 2829 2c20 644b 4c29 0a20 2020 2020 2020  (), dKL).       
+00010d60: 2065 6c69 6620 7365 6c66 2e6c 6f67 3a0a   elif self.log:.
+00010d70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00010d80: 2e6c 6f67 6765 722e 696e 666f 2822 506f  .logger.info("Po
+00010d90: 7374 6572 696f 7220 756e 6365 7274 6169  sterior uncertai
+00010da0: 6e74 7920 7374 7261 7465 6779 2069 7320  nty strategy is 
+00010db0: 7361 7469 7366 6965 6420 284b 4c3a 2025  satisfied (KL: %
+00010dc0: 2e32 662b 2d25 2e32 6620 6e61 742c 206e  .2f+-%.2f nat, n
+00010dd0: 6565 6420 3c25 2e32 6620 6e61 7429 222c  eed <%.2f nat)",
+00010de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010df0: 2020 2020 2020 2020 2020 2020 2020 4b4c                KL
+00010e00: 746f 742e 6d65 616e 2829 2c20 644b 4c74  tot.mean(), dKLt
+00010e10: 6f74 2e6d 6178 2829 2c20 644b 4c29 0a0a  ot.max(), dKL)..
+00010e20: 2020 2020 2020 2020 4e6c 6976 655f 6d69          Nlive_mi
+00010e30: 6e20 3d20 300a 2020 2020 2020 2020 7020  n = 0.        p 
+00010e40: 3d20 6578 7028 6c6f 6777 290a 2020 2020  = exp(logw).    
+00010e50: 2020 2020 7020 2f3d 2070 2e73 756d 2861      p /= p.sum(a
+00010e60: 7869 733d 3029 2e72 6573 6861 7065 2828  xis=0).reshape((
+00010e70: 312c 202d 3129 290a 2020 2020 2020 2020  1, -1)).        
+00010e80: 6465 6c74 616c 6f67 5a20 3d20 6e70 2e61  deltalogZ = np.a
+00010e90: 6273 286d 6169 6e5f 6974 6572 6174 6f72  bs(main_iterator
+00010ea0: 2e61 6c6c 5f6c 6f67 5a5b 313a 5d20 2d20  .all_logZ[1:] - 
+00010eb0: 6d61 696e 5f69 7465 7261 746f 722e 6c6f  main_iterator.lo
+00010ec0: 675a 290a 0a20 2020 2020 2020 2074 6169  gZ)..        tai
+00010ed0: 6c5f 6672 6163 7469 6f6e 203d 2077 5b6e  l_fraction = w[n
+00010ee0: 702e 6173 6172 7261 7928 6d61 696e 5f69  p.asarray(main_i
+00010ef0: 7465 7261 746f 722e 6973 7461 696c 295d  terator.istail)]
+00010f00: 2e73 756d 2829 202f 2077 2e73 756d 2829  .sum() / w.sum()
+00010f10: 0a20 2020 2020 2020 206c 6f67 7a65 7272  .        logzerr
+00010f20: 5f74 6169 6c20 3d20 6c6f 6761 6464 6578  _tail = logaddex
+00010f30: 7028 6c6f 6728 7461 696c 5f66 7261 6374  p(log(tail_fract
+00010f40: 696f 6e29 202b 206d 6169 6e5f 6974 6572  ion) + main_iter
+00010f50: 6174 6f72 2e6c 6f67 5a2c 206d 6169 6e5f  ator.logZ, main_
+00010f60: 6974 6572 6174 6f72 2e6c 6f67 5a29 202d  iterator.logZ) -
+00010f70: 206d 6169 6e5f 6974 6572 6174 6f72 2e6c   main_iterator.l
+00010f80: 6f67 5a0a 2020 2020 2020 2020 6d61 786c  ogZ.        maxl
+00010f90: 6f67 7a65 7272 203d 206d 6178 286d 6169  ogzerr = max(mai
+00010fa0: 6e5f 6974 6572 6174 6f72 2e6c 6f67 5a65  n_iterator.logZe
+00010fb0: 7272 2c20 6465 6c74 616c 6f67 5a2e 6d61  rr, deltalogZ.ma
+00010fc0: 7828 292c 206d 6169 6e5f 6974 6572 6174  x(), main_iterat
+00010fd0: 6f72 2e6c 6f67 5a65 7272 5f62 7329 0a20  or.logZerr_bs). 
+00010fe0: 2020 2020 2020 2069 6620 6d61 786c 6f67         if maxlog
+00010ff0: 7a65 7272 203e 2064 6c6f 677a 3a0a 2020  zerr > dlogz:.  
+00011000: 2020 2020 2020 2020 2020 6966 206c 6f67            if log
+00011010: 7a65 7272 5f74 6169 6c20 3e20 6d61 786c  zerr_tail > maxl
+00011020: 6f67 7a65 7272 3a0a 2020 2020 2020 2020  ogzerr:.        
+00011030: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00011040: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
+00011050: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00011060: 6767 6572 2e69 6e66 6f28 226c 6f67 7a20  gger.info("logz 
+00011070: 6572 726f 7220 6973 2064 6f6d 696e 6174  error is dominat
+00011080: 6564 2062 7920 7461 696c 2e20 4465 6372  ed by tail. Decr
+00011090: 6561 7365 2066 7261 635f 7265 6d61 696e  ease frac_remain
+000110a0: 2074 6f20 6d61 6b65 2070 726f 6772 6573   to make progres
+000110b0: 732e 2229 0a20 2020 2020 2020 2020 2020  s.").           
+000110c0: 2023 2076 6572 7920 636f 6e76 6572 7661   # very converva
+000110d0: 7469 7665 2065 7374 696d 6174 696f 6e20  tive estimation 
+000110e0: 7573 696e 6720 616c 6c20 6974 6572 6174  using all iterat
+000110f0: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+00011100: 2023 2074 6869 7320 7075 6e69 7368 6573   # this punishes
+00011110: 2073 686f 7274 2069 6e74 6572 7661 6c73   short intervals
+00011120: 2077 6974 6820 6d61 6e79 206c 6976 6520   with many live 
+00011130: 706f 696e 7473 0a20 2020 2020 2020 2020  points.         
+00011140: 2020 206e 6974 6572 5f6d 6178 203d 206c     niter_max = l
+00011150: 656e 2873 6176 6564 5f6c 6f67 6c29 0a20  en(saved_logl). 
+00011160: 2020 2020 2020 2020 2020 204e 6c69 7665             Nlive
+00011170: 5f6d 696e 203d 2069 6e74 286e 702e 6365  _min = int(np.ce
+00011180: 696c 286e 6974 6572 5f6d 6178 2a2a 302e  il(niter_max**0.
+00011190: 3520 2f20 646c 6f67 7a29 290a 2020 2020  5 / dlogz)).    
+000111a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000111b0: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
+000111c0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+000111d0: 2e64 6562 7567 2822 2020 636f 6e73 6572  .debug("  conser
+000111e0: 7661 7469 7665 2065 7374 696d 6174 6520  vative estimate 
+000111f0: 7361 7973 2061 7420 6c65 6173 7420 2564  says at least %d
+00011200: 206c 6976 6520 706f 696e 7473 2061 7265   live points are
+00011210: 206e 6565 6465 6420 746f 2072 6561 6368   needed to reach
+00011220: 2064 6c6f 677a 2067 6f61 6c22 2c20 4e6c   dlogz goal", Nl
+00011230: 6976 655f 6d69 6e29 0a0a 2020 2020 2020  ive_min)..      
+00011240: 2020 2020 2020 2320 6265 7474 6572 2065        # better e
+00011250: 7374 696d 6174 696f 6e3a 0a0a 2020 2020  stimation:..    
+00011260: 2020 2020 2020 2020 2320 6765 7420 6f6e          # get on
+00011270: 6c79 2075 6e74 696c 2077 6865 7265 206c  ly until where l
+00011280: 6f67 7a20 6275 6c6b 2069 7320 2872 616e  ogz bulk is (ran
+00011290: 646f 6d20 7361 6d70 6c65 2068 6572 6529  dom sample here)
+000112a0: 0a20 2020 2020 2020 2020 2020 2069 746d  .            itm
+000112b0: 6178 203d 206e 702e 7261 6e64 6f6d 2e63  ax = np.random.c
+000112c0: 686f 6963 6528 6c65 6e28 7729 2c20 703d  hoice(len(w), p=
+000112d0: 7729 0a20 2020 2020 2020 2020 2020 2023  w).            #
+000112e0: 2062 6163 6b20 6f75 7420 6e6c 6976 6520   back out nlive 
+000112f0: 7365 7175 656e 6365 2028 7769 6474 6820  sequence (width 
+00011300: 6368 616e 6765 6420 6279 2028 3120 2d20  changed by (1 - 
+00011310: 6578 7028 2d31 2f4e 2929 2a28 6578 7028  exp(-1/N))*(exp(
+00011320: 2d31 2f4e 2929 2029 0a20 2020 2020 2020  -1/N)) ).       
+00011330: 2020 2020 206c 6f67 7765 6967 6874 7320       logweights 
+00011340: 3d20 6e70 2e61 7272 6179 286d 6169 6e5f  = np.array(main_
+00011350: 6974 6572 6174 6f72 2e6c 6f67 7765 6967  iterator.logweig
+00011360: 6874 735b 3a69 746d 6178 5d29 0a20 2020  hts[:itmax]).   
+00011370: 2020 2020 2020 2020 2077 6974 6820 6e70           with np
+00011380: 2e65 7272 7374 6174 6528 6469 7669 6465  .errstate(divide
+00011390: 3d27 6967 6e6f 7265 272c 2069 6e76 616c  ='ignore', inval
+000113a0: 6964 3d27 6967 6e6f 7265 2729 3a0a 2020  id='ignore'):.  
+000113b0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+000113c0: 6474 6872 6174 696f 203d 2031 202d 206e  dthratio = 1 - n
+000113d0: 702e 6578 7028 6c6f 6777 6569 6768 7473  p.exp(logweights
+000113e0: 5b31 3a2c 305d 202d 206c 6f67 7765 6967  [1:,0] - logweig
+000113f0: 6874 735b 3a2d 312c 305d 290a 2020 2020  hts[:-1,0]).    
+00011400: 2020 2020 2020 2020 2020 2020 6e6c 6976              nliv
+00011410: 6520 3d20 312e 202f 206e 702e 6c6f 6728  e = 1. / np.log(
+00011420: 2831 202d 206e 702e 7371 7274 2831 202d  (1 - np.sqrt(1 -
+00011430: 2034 202a 2077 6964 7468 7261 7469 6f29   4 * widthratio)
+00011440: 2920 2f20 2832 202a 2077 6964 7468 7261  ) / (2 * widthra
+00011450: 7469 6f29 290a 2020 2020 2020 2020 2020  tio)).          
+00011460: 2020 2020 2020 6e6c 6976 655b 7e6e 702e        nlive[~np.
+00011470: 6c6f 6769 6361 6c5f 616e 6428 6e70 2e69  logical_and(np.i
+00011480: 7366 696e 6974 6528 6e6c 6976 6529 2c20  sfinite(nlive), 
+00011490: 6e6c 6976 6520 3e20 3129 5d20 3d20 310a  nlive > 1)] = 1.
+000114a0: 0a20 2020 2020 2020 2020 2020 2023 2062  .            # b
+000114b0: 7569 6c64 2069 7465 7261 7469 6f6e 2067  uild iteration g
+000114c0: 726f 7570 730a 2020 2020 2020 2020 2020  roups.          
+000114d0: 2020 6e6c 6976 655f 7365 7473 2c20 6e69    nlive_sets, ni
+000114e0: 7465 7220 3d20 6e70 2e75 6e69 7175 6528  ter = np.unique(
+000114f0: 6e6c 6976 652e 6173 7479 7065 2869 6e74  nlive.astype(int
+00011500: 292c 2072 6574 7572 6e5f 636f 756e 7473  ), return_counts
+00011510: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00011520: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
 00011530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011540: 2020 2220 206e 756d 6265 7220 6f66 206c    "  number of l
-00011550: 6976 6520 706f 696e 7473 2076 6172 7920  ive points vary 
-00011560: 6265 7477 6565 6e20 252e 3066 2061 6e64  between %.0f and
-00011570: 2025 2e30 662c 206d 6f73 7420 2825 642f   %.0f, most (%d/
-00011580: 2564 2069 7465 7261 7469 6f6e 7329 2068  %d iterations) h
-00011590: 6176 6520 2564 222c 0a20 2020 2020 2020  ave %d",.       
-000115a0: 2020 2020 2020 2020 2020 2020 206e 6c69               nli
-000115b0: 7665 2e6d 696e 2829 2c20 6e6c 6976 652e  ve.min(), nlive.
-000115c0: 6d61 7828 292c 206e 6974 6572 2e6d 6178  max(), niter.max
-000115d0: 2829 2c20 6974 6d61 782c 206e 6c69 7665  (), itmax, nlive
-000115e0: 5f73 6574 735b 6e69 7465 722e 6172 676d  _sets[niter.argm
-000115f0: 6178 2829 5d29 0a20 2020 2020 2020 2020  ax()]).         
-00011600: 2020 2066 6f72 206e 6c69 7665 5f66 6c6f     for nlive_flo
-00011610: 6f72 2069 6e20 6e6c 6976 655f 7365 7473  or in nlive_sets
-00011620: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011630: 2020 2320 6573 7469 6d61 7465 2065 7272    # estimate err
-00011640: 6f72 2069 6620 7468 6973 2077 6173 2074  or if this was t
-00011650: 6865 206d 696e 696d 756d 206e 6c69 7665  he minimum nlive
-00011660: 2061 7070 6c69 6564 0a20 2020 2020 2020   applied.       
-00011670: 2020 2020 2020 2020 206e 6c69 7665 5f61           nlive_a
-00011680: 646a 7573 7465 6420 3d20 6e70 2e77 6865  djusted = np.whe
-00011690: 7265 286e 6c69 7665 5f73 6574 7320 3c20  re(nlive_sets < 
-000116a0: 6e6c 6976 655f 666c 6f6f 722c 206e 6c69  nlive_floor, nli
-000116b0: 7665 5f66 6c6f 6f72 2c20 6e6c 6976 655f  ve_floor, nlive_
-000116c0: 7365 7473 290a 2020 2020 2020 2020 2020  sets).          
-000116d0: 2020 2020 2020 6465 6c74 616c 6f67 5a5f        deltalogZ_
-000116e0: 6578 7065 6374 6564 203d 2028 6e69 7465  expected = (nite
-000116f0: 7220 2f20 6e6c 6976 655f 6164 6a75 7374  r / nlive_adjust
-00011700: 6564 2a2a 322e 3029 2e73 756d 2829 2a2a  ed**2.0).sum()**
-00011710: 302e 350a 2020 2020 2020 2020 2020 2020  0.5.            
-00011720: 2020 2020 6966 2064 656c 7461 6c6f 675a      if deltalogZ
-00011730: 5f65 7870 6563 7465 6420 3c20 646c 6f67  _expected < dlog
-00011740: 7a3a 0a20 2020 2020 2020 2020 2020 2020  z:.             
-00011750: 2020 2020 2020 2023 2061 6368 6965 7661         # achieva
-00011760: 626c 6520 7769 7468 204e 6c69 7665 5f6d  ble with Nlive_m
-00011770: 696e 0a20 2020 2020 2020 2020 2020 2020  in.             
-00011780: 2020 2020 2020 204e 6c69 7665 5f6d 696e         Nlive_min
-00011790: 203d 2069 6e74 286e 6c69 7665 5f66 6c6f   = int(nlive_flo
-000117a0: 6f72 290a 2020 2020 2020 2020 2020 2020  or).            
-000117b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000117c0: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
-000117d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000117e0: 662e 6c6f 6767 6572 2e64 6562 7567 2822  f.logger.debug("
-000117f0: 2020 6174 206c 6561 7374 2025 6420 6c69    at least %d li
-00011800: 7665 2070 6f69 6e74 7320 6172 6520 6e65  ve points are ne
-00011810: 6564 6564 2074 6f20 7265 6163 6820 646c  eded to reach dl
-00011820: 6f67 7a20 676f 616c 222c 204e 6c69 7665  ogz goal", Nlive
-00011830: 5f6d 696e 290a 2020 2020 2020 2020 2020  _min).          
-00011840: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00011850: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00011860: 2e6c 6f67 2061 6e64 204e 6c69 7665 5f6d  .log and Nlive_m
-00011870: 696e 203e 2030 3a0a 2020 2020 2020 2020  in > 0:.        
-00011880: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-00011890: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
-000118a0: 2020 2020 2020 2245 7669 6465 6e63 7920        "Evidency 
-000118b0: 756e 6365 7274 6169 6e74 7920 7374 7261  uncertainty stra
-000118c0: 7465 6779 2077 616e 7473 2025 6420 6d69  tegy wants %d mi
-000118d0: 6e69 6d75 6d20 6c69 7665 2070 6f69 6e74  nimum live point
-000118e0: 7320 2864 6c6f 677a 2066 726f 6d20 252e  s (dlogz from %.
-000118f0: 3266 2074 6f20 252e 3266 2c20 6e65 6564  2f to %.2f, need
-00011900: 203c 2573 2922 2c0a 2020 2020 2020 2020   <%s)",.        
-00011910: 2020 2020 2020 2020 4e6c 6976 655f 6d69          Nlive_mi
-00011920: 6e2c 2064 656c 7461 6c6f 675a 2e6d 6561  n, deltalogZ.mea
-00011930: 6e28 292c 2064 656c 7461 6c6f 675a 2e6d  n(), deltalogZ.m
-00011940: 6178 2829 2c20 646c 6f67 7a29 0a20 2020  ax(), dlogz).   
-00011950: 2020 2020 2065 6c69 6620 7365 6c66 2e6c       elif self.l
-00011960: 6f67 3a0a 2020 2020 2020 2020 2020 2020  og:.            
-00011970: 7365 6c66 2e6c 6f67 6765 722e 696e 666f  self.logger.info
-00011980: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00011990: 2020 2245 7669 6465 6e63 7920 756e 6365    "Evidency unce
-000119a0: 7274 6169 6e74 7920 7374 7261 7465 6779  rtainty strategy
-000119b0: 2069 7320 7361 7469 7366 6965 6420 2864   is satisfied (d
-000119c0: 6c6f 677a 3d25 2e32 662c 206e 6565 6420  logz=%.2f, need 
-000119d0: 3c25 7329 222c 0a20 2020 2020 2020 2020  <%s)",.         
-000119e0: 2020 2020 2020 2028 6d61 696e 5f69 7465         (main_ite
-000119f0: 7261 746f 722e 6c6f 675a 6572 725f 6273  rator.logZerr_bs
-00011a00: 2a2a 3220 2b20 6c6f 677a 6572 725f 7461  **2 + logzerr_ta
-00011a10: 696c 2a2a 3229 2a2a 302e 352c 2064 6c6f  il**2)**0.5, dlo
-00011a20: 677a 290a 2020 2020 2020 2020 6966 2073  gz).        if s
-00011a30: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
-00011a40: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00011a50: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
-00011a60: 2020 2020 2020 2027 2020 6c6f 675a 2065         '  logZ e
-00011a70: 7272 6f72 2062 7564 6765 743a 2073 696e  rror budget: sin
-00011a80: 676c 653a 2025 2e32 6620 6273 3a25 2e32  gle: %.2f bs:%.2
-00011a90: 6620 7461 696c 3a25 2e32 6620 746f 7461  f tail:%.2f tota
-00011aa0: 6c3a 252e 3266 2072 6571 7569 7265 643a  l:%.2f required:
-00011ab0: 3c25 2e32 6627 2c0a 2020 2020 2020 2020  <%.2f',.        
-00011ac0: 2020 2020 2020 2020 6d61 696e 5f69 7465          main_ite
-00011ad0: 7261 746f 722e 6c6f 675a 6572 722c 206d  rator.logZerr, m
-00011ae0: 6169 6e5f 6974 6572 6174 6f72 2e6c 6f67  ain_iterator.log
-00011af0: 5a65 7272 5f62 732c 206c 6f67 7a65 7272  Zerr_bs, logzerr
-00011b00: 5f74 6169 6c2c 0a20 2020 2020 2020 2020  _tail,.         
-00011b10: 2020 2020 2020 2028 6d61 696e 5f69 7465         (main_ite
-00011b20: 7261 746f 722e 6c6f 675a 6572 725f 6273  rator.logZerr_bs
-00011b30: 2a2a 3220 2b20 6c6f 677a 6572 725f 7461  **2 + logzerr_ta
-00011b40: 696c 2a2a 3229 2a2a 302e 352c 2064 6c6f  il**2)**0.5, dlo
-00011b50: 677a 290a 0a20 2020 2020 2020 2072 6574  gz)..        ret
-00011b60: 7572 6e20 4e6c 6976 655f 6d69 6e2c 2028  urn Nlive_min, (
-00011b70: 4c6c 6f5f 4b4c 2c20 4c68 695f 4b4c 292c  Llo_KL, Lhi_KL),
-00011b80: 2028 4c6c 6f5f 6573 732c 204c 6869 5f65   (Llo_ess, Lhi_e
-00011b90: 7373 290a 0a20 2020 2064 6566 205f 7265  ss)..    def _re
-00011ba0: 6669 6c6c 5f73 616d 706c 6573 2873 656c  fill_samples(sel
-00011bb0: 662c 204c 6d69 6e2c 206e 6472 6177 2c20  f, Lmin, ndraw, 
-00011bc0: 6e69 7429 3a0a 2020 2020 2020 2020 2222  nit):.        ""
-00011bd0: 2247 6574 206e 6577 2073 616d 706c 6573  "Get new samples
-00011be0: 2066 726f 6d20 7265 6769 6f6e 2e22 2222   from region."""
-00011bf0: 0a20 2020 2020 2020 206e 6320 3d20 300a  .        nc = 0.
-00011c00: 2020 2020 2020 2020 7520 3d20 7365 6c66          u = self
-00011c10: 2e72 6567 696f 6e2e 7361 6d70 6c65 286e  .region.sample(n
-00011c20: 7361 6d70 6c65 733d 6e64 7261 7729 0a20  samples=ndraw). 
-00011c30: 2020 2020 2020 2061 7373 6572 7420 6e70         assert np
-00011c40: 2e6c 6f67 6963 616c 5f61 6e64 2875 203e  .logical_and(u >
-00011c50: 2030 2c20 7520 3c20 3129 2e61 6c6c 2829   0, u < 1).all()
-00011c60: 2c20 2875 290a 2020 2020 2020 2020 6e75  , (u).        nu
-00011c70: 203d 2075 2e73 6861 7065 5b30 5d0a 2020   = u.shape[0].  
-00011c80: 2020 2020 2020 6966 206e 7520 3d3d 2030        if nu == 0
-00011c90: 3a0a 2020 2020 2020 2020 2020 2020 7620  :.            v 
-00011ca0: 3d20 6e70 2e65 6d70 7479 2828 302c 2073  = np.empty((0, s
-00011cb0: 656c 662e 6e75 6d5f 7061 7261 6d73 2929  elf.num_params))
-00011cc0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00011cd0: 6c20 3d20 6e70 2e65 6d70 7479 2828 302c  l = np.empty((0,
-00011ce0: 2929 0a20 2020 2020 2020 2020 2020 2061  )).            a
-00011cf0: 6363 6570 7465 6420 3d20 6e70 2e65 6d70  ccepted = np.emp
-00011d00: 7479 2830 2c20 6474 7970 653d 626f 6f6c  ty(0, dtype=bool
-00011d10: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00011d20: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00011d30: 7520 3e20 3120 616e 6420 6e6f 7420 7365  u > 1 and not se
-00011d40: 6c66 2e64 7261 775f 6d75 6c74 6970 6c65  lf.draw_multiple
-00011d50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011d60: 2020 2320 7065 656c 206f 6666 2066 6972    # peel off fir
-00011d70: 7374 2069 6620 6d75 6c74 6970 6c65 2065  st if multiple e
-00011d80: 7661 6c75 6174 696f 6e20 6973 206e 6f74  valuation is not
-00011d90: 2073 7570 706f 7274 6564 0a20 2020 2020   supported.     
-00011da0: 2020 2020 2020 2020 2020 206e 7520 3d20             nu = 
-00011db0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00011dc0: 2020 7520 3d20 755b 3a31 2c3a 5d0a 0a20    u = u[:1,:].. 
-00011dd0: 2020 2020 2020 2020 2020 2076 203d 2073             v = s
-00011de0: 656c 662e 7472 616e 7366 6f72 6d28 7529  elf.transform(u)
-00011df0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00011e00: 6c20 3d20 6e70 2e6f 6e65 7328 6e75 2920  l = np.ones(nu) 
-00011e10: 2a20 2d6e 702e 696e 660a 0a20 2020 2020  * -np.inf..     
-00011e20: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-00011e30: 7265 6769 6f6e 2069 7320 6e6f 7420 4e6f  region is not No
-00011e40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00011e50: 2020 2020 2320 6368 6563 6b20 7772 6170      # check wrap
-00011e60: 7069 6e67 2065 6c6c 6970 736f 6964 2069  ping ellipsoid i
-00011e70: 6e20 7472 616e 7366 6f72 6d65 6420 7370  n transformed sp
-00011e80: 6163 650a 2020 2020 2020 2020 2020 2020  ace.            
-00011e90: 2020 2020 6163 6365 7074 6564 203d 2073      accepted = s
-00011ea0: 656c 662e 7472 6567 696f 6e2e 696e 7369  elf.tregion.insi
-00011eb0: 6465 2876 290a 2020 2020 2020 2020 2020  de(v).          
-00011ec0: 2020 2020 2020 6e74 203d 2061 6363 6570        nt = accep
-00011ed0: 7465 642e 7375 6d28 290a 2020 2020 2020  ted.sum().      
-00011ee0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00011ef0: 2020 2020 2020 2020 2020 2020 2320 6966              # if
-00011f00: 2075 6e64 6566 696e 6564 2c20 616c 6c20   undefined, all 
-00011f10: 7061 7373 3b20 7261 7265 7220 6272 616e  pass; rarer bran
-00011f20: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
-00011f30: 2020 2061 6363 6570 7465 6420 3d20 6e70     accepted = np
-00011f40: 2e6f 6e65 7328 6e75 2c20 6474 7970 653d  .ones(nu, dtype=
-00011f50: 626f 6f6c 290a 2020 2020 2020 2020 2020  bool).          
-00011f60: 2020 2020 2020 6e74 203d 206e 750a 0a20        nt = nu.. 
-00011f70: 2020 2020 2020 2020 2020 2069 6620 6e74             if nt
-00011f80: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-00011f90: 2020 2020 2020 6c6f 676c 5b61 6363 6570        logl[accep
-00011fa0: 7465 645d 203d 2073 656c 662e 6c6f 676c  ted] = self.logl
-00011fb0: 696b 6528 765b 6163 6365 7074 6564 2c20  ike(v[accepted, 
-00011fc0: 3a5d 290a 2020 2020 2020 2020 2020 2020  :]).            
-00011fd0: 2020 2020 6e63 202b 3d20 6e74 0a20 2020      nc += nt.   
-00011fe0: 2020 2020 2020 2020 2061 6363 6570 7465           accepte
-00011ff0: 6420 3d20 6c6f 676c 203e 204c 6d69 6e0a  d = logl > Lmin.
-00012000: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-00012010: 7269 6e74 2822 6974 3a20 2534 6420 6e64  rint("it: %4d nd
-00012020: 7261 773a 2025 6420 2d3e 2025 6420 2d3e  raw: %d -> %d ->
-00012030: 2025 6420 2d3e 2025 6420 2220 2520 286e   %d -> %d " % (n
-00012040: 6974 2c20 6e64 7261 772c 206e 752c 206e  it, ndraw, nu, n
-00012050: 742c 2061 6363 6570 7465 642e 7375 6d28  t, accepted.sum(
-00012060: 2929 290a 0a20 2020 2020 2020 2069 6620  )))..        if 
-00012070: 6e6f 7420 7365 6c66 2e73 616d 706c 696e  not self.samplin
-00012080: 675f 736c 6f77 5f77 6172 6e65 6420 616e  g_slow_warned an
-00012090: 6420 6e69 7420 2a20 6e64 7261 7720 3e3d  d nit * ndraw >=
-000120a0: 2031 3030 3030 3020 616e 6420 6e69 7420   100000 and nit 
-000120b0: 3e20 3230 3a0a 2020 2020 2020 2020 2020  > 20:.          
-000120c0: 2020 7761 726e 696e 675f 6d65 7373 6167    warning_messag
-000120d0: 6531 203d 2028 2253 616d 706c 696e 6720  e1 = ("Sampling 
-000120e0: 6672 6f6d 2072 6567 696f 6e20 7365 656d  from region seem
-000120f0: 7320 696e 6566 6669 6369 656e 7420 2825  s inefficient (%
-00012100: 642f 2564 2061 6363 6570 7465 6420 696e  d/%d accepted in
-00012110: 2069 7465 7261 7469 6f6e 2025 6429 2e20   iteration %d). 
-00012120: 2220 2520 2861 6363 6570 7465 642e 7375  " % (accepted.su
-00012130: 6d28 292c 206e 6472 6177 2c20 6e69 7429  m(), ndraw, nit)
-00012140: 290a 2020 2020 2020 2020 2020 2020 7761  ).            wa
-00012150: 726e 696e 675f 6d65 7373 6167 6532 203d  rning_message2 =
-00012160: 2022 546f 2069 6d70 726f 7665 2065 6666   "To improve eff
-00012170: 6963 6965 6e63 792c 206d 6f64 6966 7920  iciency, modify 
-00012180: 7468 6520 7472 616e 7366 6f72 6d61 7469  the transformati
-00012190: 6f6e 2073 6f20 7468 6174 2074 6865 2063  on so that the c
-000121a0: 7572 7265 6e74 206c 6976 6520 706f 696e  urrent live poin
-000121b0: 7473 2573 2061 7265 2065 6c6c 6970 736f  ts%s are ellipso
-000121c0: 6964 616c 2c20 2220 2b20 5c0a 2020 2020  idal, " + \.    
-000121d0: 2020 2020 2020 2020 2020 2020 226f 7220              "or 
-000121e0: 7573 6520 6120 7374 6570 7361 6d70 6c65  use a stepsample
-000121f0: 722c 206f 7220 7365 7420 6672 6163 5f72  r, or set frac_r
-00012200: 656d 6169 6e20 746f 2061 206c 6f77 6572  emain to a lower
-00012210: 206e 756d 6265 7220 2865 2e67 2e2c 2030   number (e.g., 0
-00012220: 2e35 2920 746f 2074 6572 6d69 6e61 7465  .5) to terminate
-00012230: 2065 6172 6c69 6572 2e22 0a20 2020 2020   earlier.".     
-00012240: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-00012250: 6f67 5f74 6f5f 6469 736b 3a0a 2020 2020  og_to_disk:.    
-00012260: 2020 2020 2020 2020 2020 2020 6465 6275              debu
-00012270: 675f 6669 6c65 6e61 6d65 203d 206f 732e  g_filename = os.
-00012280: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e6c  path.join(self.l
-00012290: 6f67 735b 2765 7874 7261 275d 2c20 2773  ogs['extra'], 's
-000122a0: 616d 706c 696e 672d 7374 7563 6b2d 6974  ampling-stuck-it
-000122b0: 2564 2729 0a20 2020 2020 2020 2020 2020  %d').           
-000122c0: 2020 2020 206e 702e 7361 7665 7a28 0a20       np.savez(. 
-000122d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122e0: 2020 2064 6562 7567 5f66 696c 656e 616d     debug_filenam
-000122f0: 6520 2b20 272e 6e70 7a27 2c0a 2020 2020  e + '.npz',.    
-00012300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012310: 753d 7365 6c66 2e72 6567 696f 6e2e 752c  u=self.region.u,
-00012320: 2075 6e6f 726d 6564 3d73 656c 662e 7265   unormed=self.re
-00012330: 6769 6f6e 2e75 6e6f 726d 6564 2c0a 2020  gion.unormed,.  
-00012340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012350: 2020 6d61 7872 6164 6975 7373 713d 7365    maxradiussq=se
-00012360: 6c66 2e72 6567 696f 6e2e 6d61 7872 6164  lf.region.maxrad
-00012370: 6975 7373 712c 0a20 2020 2020 2020 2020  iussq,.         
-00012380: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
-00012390: 655f 753d 752c 2073 616d 706c 655f 763d  e_u=u, sample_v=
-000123a0: 762c 2073 616d 706c 655f 6c6f 676c 3d6c  v, sample_logl=l
-000123b0: 6f67 6c29 0a20 2020 2020 2020 2020 2020  ogl).           
-000123c0: 2020 2020 206e 702e 7361 7665 7478 7428       np.savetxt(
-000123d0: 6465 6275 675f 6669 6c65 6e61 6d65 202b  debug_filename +
-000123e0: 2027 2e63 7376 272c 2073 656c 662e 7265   '.csv', self.re
-000123f0: 6769 6f6e 2e75 2c20 6465 6c69 6d69 7465  gion.u, delimite
-00012400: 723d 272c 2729 0a20 2020 2020 2020 2020  r=',').         
-00012410: 2020 2020 2020 2077 6172 6e69 6e67 5f6d         warning_m
-00012420: 6573 7361 6765 203d 2077 6172 6e69 6e67  essage = warning
-00012430: 5f6d 6573 7361 6765 3120 2b20 2877 6172  _message1 + (war
-00012440: 6e69 6e67 5f6d 6573 7361 6765 3220 2520  ning_message2 % 
-00012450: 2827 2028 7374 6f72 6564 2066 6f72 2079  (' (stored for y
-00012460: 6f75 2069 6e20 2573 2e63 7376 2927 2025  ou in %s.csv)' %
-00012470: 2064 6562 7567 5f66 696c 656e 616d 6529   debug_filename)
-00012480: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00012490: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000124a0: 2020 2020 7761 726e 696e 675f 6d65 7373      warning_mess
-000124b0: 6167 6520 3d20 7761 726e 696e 675f 6d65  age = warning_me
-000124c0: 7373 6167 6531 202b 2077 6172 6e69 6e67  ssage1 + warning
-000124d0: 5f6d 6573 7361 6765 3220 2520 2727 0a20  _message2 % ''. 
-000124e0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-000124f0: 6e67 732e 7761 726e 2877 6172 6e69 6e67  ngs.warn(warning
-00012500: 5f6d 6573 7361 6765 290a 2020 2020 2020  _message).      
-00012510: 2020 2020 2020 6c6f 676c 5f72 6567 696f        logl_regio
-00012520: 6e20 3d20 7365 6c66 2e6c 6f67 6c69 6b65  n = self.loglike
-00012530: 2873 656c 662e 7472 616e 7366 6f72 6d28  (self.transform(
-00012540: 7365 6c66 2e72 6567 696f 6e2e 7529 290a  self.region.u)).
-00012550: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00012560: 6c6f 676c 5f72 6567 696f 6e20 3d3d 204c  logl_region == L
-00012570: 6d69 6e29 2e61 6c6c 2829 3a0a 2020 2020  min).all():.    
-00012580: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00012590: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-000125a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125b0: 2020 2252 6567 696f 6e20 6361 6e6e 6f74    "Region cannot
-000125c0: 2073 616d 706c 6520 6120 6869 6768 6572   sample a higher
-000125d0: 2070 6f69 6e74 2e20 220a 2020 2020 2020   point. ".      
-000125e0: 2020 2020 2020 2020 2020 2020 2020 2241                "A
-000125f0: 6c6c 2072 656d 6169 6e69 6e67 206c 6976  ll remaining liv
-00012600: 6520 706f 696e 7473 2068 6176 6520 7468  e points have th
-00012610: 6520 7361 6d65 2076 616c 7565 2e22 290a  e same value.").
-00012620: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00012630: 6f74 2028 6c6f 676c 5f72 6567 696f 6e20  ot (logl_region 
-00012640: 3e20 4c6d 696e 292e 616e 7928 293a 0a20  > Lmin).any():. 
-00012650: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00012660: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00012670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012680: 2020 2020 2022 5265 6769 6f6e 2063 616e       "Region can
-00012690: 6e6f 7420 7361 6d70 6c65 2061 2068 6967  not sample a hig
-000126a0: 6865 7220 706f 696e 742e 2022 0a20 2020  her point. ".   
-000126b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126c0: 2022 5065 7268 6170 7320 796f 7520 6172   "Perhaps you ar
-000126d0: 6520 7265 7375 6d69 6e67 2066 726f 6d20  e resuming from 
-000126e0: 6120 6469 6666 6572 656e 7420 7072 6f62  a different prob
-000126f0: 6c65 6d3f 220a 2020 2020 2020 2020 2020  lem?".          
-00012700: 2020 2020 2020 2020 2020 2244 656c 6574            "Delet
-00012710: 6520 7468 6520 6f75 7470 7574 2066 696c  e the output fil
-00012720: 6573 2061 6e64 2073 7461 7274 2061 6761  es and start aga
-00012730: 696e 2e22 290a 2020 2020 2020 2020 2020  in.").          
-00012740: 2020 7365 6c66 2e73 616d 706c 696e 675f    self.sampling_
-00012750: 736c 6f77 5f77 6172 6e65 6420 3d20 5472  slow_warned = Tr
-00012760: 7565 0a0a 2020 2020 2020 2020 7365 6c66  ue..        self
-00012770: 2e6e 6361 6c6c 5f72 6567 696f 6e20 2b3d  .ncall_region +=
-00012780: 206e 6472 6177 0a20 2020 2020 2020 2072   ndraw.        r
-00012790: 6574 7572 6e20 755b 6163 6365 7074 6564  eturn u[accepted
-000127a0: 2c3a 5d2c 2076 5b61 6363 6570 7465 642c  ,:], v[accepted,
-000127b0: 3a5d 2c20 6c6f 676c 5b61 6363 6570 7465  :], logl[accepte
-000127c0: 645d 2c20 6e63 2c20 300a 0a20 2020 2064  d], nc, 0..    d
-000127d0: 6566 205f 6372 6561 7465 5f70 6f69 6e74  ef _create_point
-000127e0: 2873 656c 662c 204c 6d69 6e2c 206e 6472  (self, Lmin, ndr
-000127f0: 6177 2c20 6163 7469 7665 5f75 2c20 6163  aw, active_u, ac
-00012800: 7469 7665 5f76 616c 7565 7329 3a0a 2020  tive_values):.  
-00012810: 2020 2020 2020 2222 2244 7261 7720 6120        """Draw a 
-00012820: 6e65 7720 706f 696e 7420 6162 6f76 6520  new point above 
-00012830: 6c69 6b65 6c69 686f 6f64 2074 6872 6573  likelihood thres
-00012840: 686f 6c64 2060 4c6d 696e 602e 0a0a 2020  hold `Lmin`...  
-00012850: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-00012860: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00012870: 2d2d 2d2d 0a20 2020 2020 2020 204c 6d69  ----.        Lmi
-00012880: 6e3a 2066 6c6f 6174 0a20 2020 2020 2020  n: float.       
-00012890: 2020 2020 206c 6f67 6c69 6b65 6c69 686f       loglikeliho
-000128a0: 6f64 2074 6872 6573 686f 6c64 2074 6f20  od threshold to 
-000128b0: 6472 6177 2061 626f 7665 0a20 2020 2020  draw above.     
-000128c0: 2020 206e 6472 6177 3a20 666c 6f61 740a     ndraw: float.
-000128d0: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
-000128e0: 6572 206f 6620 706f 696e 7473 2074 6f20  er of points to 
-000128f0: 7472 7920 746f 2073 616d 706c 6520 6174  try to sample at
-00012900: 206f 6e63 650a 2020 2020 2020 2020 6163   once.        ac
-00012910: 7469 7665 5f75 3a20 6172 7261 7920 6f66  tive_u: array of
-00012920: 2066 6c6f 6174 730a 2020 2020 2020 2020   floats.        
-00012930: 2020 2020 6375 7272 656e 7420 6c69 7665      current live
-00012940: 2070 6f69 6e74 730a 2020 2020 2020 2020   points.        
-00012950: 6163 7469 7665 5f76 616c 7565 733a 2061  active_values: a
-00012960: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
-00012970: 206c 6f67 6c69 6b65 6c69 686f 6f64 7320   loglikelihoods 
-00012980: 6f66 2063 7572 7265 6e74 206c 6976 6520  of current live 
-00012990: 706f 696e 7473 0a0a 2020 2020 2020 2020  points..        
-000129a0: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-000129b0: 656c 662e 7374 6570 7361 6d70 6c65 7220  elf.stepsampler 
-000129c0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000129d0: 2020 2020 2061 7373 6572 7420 7365 6c66       assert self
-000129e0: 2e72 6567 696f 6e2e 696e 7369 6465 2861  .region.inside(a
-000129f0: 6374 6976 655f 7529 2e61 6e79 2829 2c20  ctive_u).any(), 
-00012a00: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00012a10: 2020 2822 4e6f 6e65 206f 6620 7468 6520    ("None of the 
-00012a20: 6c69 7665 2070 6f69 6e74 7320 7361 7469  live points sati
-00012a30: 7366 6965 7320 7468 6520 6375 7272 656e  sfies the curren
-00012a40: 7420 7265 6769 6f6e 2122 2c0a 2020 2020  t region!",.    
-00012a50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012a60: 662e 7265 6769 6f6e 2e6d 6178 7261 6469  f.region.maxradi
-00012a70: 7573 7371 2c20 7365 6c66 2e72 6567 696f  ussq, self.regio
-00012a80: 6e2e 752c 2073 656c 662e 7265 6769 6f6e  n.u, self.region
-00012a90: 2e75 6e6f 726d 6564 2c20 6163 7469 7665  .unormed, active
-00012aa0: 5f75 2c0a 2020 2020 2020 2020 2020 2020  _u,.            
-00012ab0: 2020 2020 2067 6574 6174 7472 2873 656c       getattr(sel
-00012ac0: 662e 7265 6769 6f6e 2c20 2762 626f 785f  f.region, 'bbox_
-00012ad0: 6c6f 2729 2c0a 2020 2020 2020 2020 2020  lo'),.          
-00012ae0: 2020 2020 2020 2067 6574 6174 7472 2873         getattr(s
-00012af0: 656c 662e 7265 6769 6f6e 2c20 2762 626f  elf.region, 'bbo
-00012b00: 785f 6869 2729 2c0a 2020 2020 2020 2020  x_hi'),.        
-00012b10: 2020 2020 2020 2020 2067 6574 6174 7472           getattr
-00012b20: 2873 656c 662e 7265 6769 6f6e 2c20 2765  (self.region, 'e
-00012b30: 6c6c 6970 736f 6964 5f63 6f76 2729 2c0a  llipsoid_cov'),.
-00012b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b50: 2067 6574 6174 7472 2873 656c 662e 7265   getattr(self.re
-00012b60: 6769 6f6e 2c20 2765 6c6c 6970 736f 6964  gion, 'ellipsoid
-00012b70: 5f63 656e 7465 7227 292c 0a20 2020 2020  _center'),.     
-00012b80: 2020 2020 2020 2020 2020 2020 6765 7461              geta
-00012b90: 7474 7228 7365 6c66 2e72 6567 696f 6e2c  ttr(self.region,
-00012ba0: 2027 656c 6c69 7073 6f69 645f 696e 7663   'ellipsoid_invc
-00012bb0: 6f76 2729 2c0a 2020 2020 2020 2020 2020  ov'),.          
-00012bc0: 2020 2020 2020 2067 6574 6174 7472 2873         getattr(s
-00012bd0: 656c 662e 7265 6769 6f6e 2c20 2765 6c6c  elf.region, 'ell
-00012be0: 6970 736f 6964 5f63 6f76 2729 2c0a 2020  ipsoid_cov'),.  
-00012bf0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00012c00: 0a0a 2020 2020 2020 2020 6e69 7420 3d20  ..        nit = 
-00012c10: 300a 2020 2020 2020 2020 7768 696c 6520  0.        while 
-00012c20: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
-00012c30: 2020 6962 203d 2073 656c 662e 6962 0a20    ib = self.ib. 
-00012c40: 2020 2020 2020 2020 2020 2069 6620 6962             if ib
-00012c50: 203e 3d20 6c65 6e28 7365 6c66 2e73 616d   >= len(self.sam
-00012c60: 706c 6573 2920 616e 6420 7365 6c66 2e75  ples) and self.u
-00012c70: 7365 5f70 6f69 6e74 5f73 7461 636b 3a0a  se_point_stack:.
-00012c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c90: 2320 726f 6f74 2063 6865 636b 7320 7468  # root checks th
-00012ca0: 6520 706f 696e 7420 7374 6f72 650a 2020  e point store.  
-00012cb0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00012cc0: 7874 5f70 6f69 6e74 203d 206e 702e 7a65  xt_point = np.ze
-00012cd0: 726f 7328 2831 2c20 3320 2b20 7365 6c66  ros((1, 3 + self
-00012ce0: 2e78 5f64 696d 202b 2073 656c 662e 6e75  .x_dim + self.nu
-00012cf0: 6d5f 7061 7261 6d73 2929 202a 206e 702e  m_params)) * np.
-00012d00: 6e61 6e0a 0a20 2020 2020 2020 2020 2020  nan..           
-00012d10: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
-00012d20: 5f74 6f5f 706f 696e 7473 746f 7265 3a0a  _to_pointstore:.
-00012d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d40: 2020 2020 5f2c 2073 746f 7265 645f 706f      _, stored_po
-00012d50: 696e 7420 3d20 7365 6c66 2e70 6f69 6e74  int = self.point
-00012d60: 7374 6f72 652e 706f 7028 4c6d 696e 290a  store.pop(Lmin).
-00012d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012d80: 2020 2020 6966 2073 746f 7265 645f 706f      if stored_po
-00012d90: 696e 7420 6973 206e 6f74 204e 6f6e 653a  int is not None:
-00012da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012db0: 2020 2020 2020 2020 206e 6578 745f 706f           next_po
-00012dc0: 696e 745b 302c 3a5d 203d 2073 746f 7265  int[0,:] = store
-00012dd0: 645f 706f 696e 740a 2020 2020 2020 2020  d_point.        
-00012de0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00012df0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012e00: 2020 2020 2020 2020 2020 6e65 7874 5f70            next_p
-00012e10: 6f69 6e74 5b30 2c3a 5d20 3d20 2d6e 702e  oint[0,:] = -np.
-00012e20: 696e 660a 2020 2020 2020 2020 2020 2020  inf.            
-00012e30: 2020 2020 2020 2020 7365 6c66 2e75 7365          self.use
-00012e40: 5f70 6f69 6e74 5f73 7461 636b 203d 206e  _point_stack = n
-00012e50: 6f74 2073 656c 662e 706f 696e 7473 746f  ot self.pointsto
-00012e60: 7265 2e73 7461 636b 5f65 6d70 7479 0a0a  re.stack_empty..
-00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e80: 6966 2073 656c 662e 7573 655f 6d70 693a  if self.use_mpi:
-00012e90: 2020 2320 616e 6420 696e 666f 726d 7320    # and informs 
-00012ea0: 6576 6572 796f 6e65 0a20 2020 2020 2020  everyone.       
-00012eb0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012ec0: 662e 7573 655f 706f 696e 745f 7374 6163  f.use_point_stac
-00012ed0: 6b20 3d20 7365 6c66 2e63 6f6d 6d2e 6263  k = self.comm.bc
-00012ee0: 6173 7428 7365 6c66 2e75 7365 5f70 6f69  ast(self.use_poi
-00012ef0: 6e74 5f73 7461 636b 2c20 726f 6f74 3d30  nt_stack, root=0
-00012f00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012f10: 2020 2020 2020 6e65 7874 5f70 6f69 6e74        next_point
-00012f20: 203d 2073 656c 662e 636f 6d6d 2e62 6361   = self.comm.bca
-00012f30: 7374 286e 6578 745f 706f 696e 742c 2072  st(next_point, r
-00012f40: 6f6f 743d 3029 0a0a 2020 2020 2020 2020  oot=0)..        
-00012f50: 2020 2020 2020 2020 2320 756e 7061 636b          # unpack
-00012f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012f70: 2073 656c 662e 6c69 6b65 7320 3d20 6e65   self.likes = ne
-00012f80: 7874 5f70 6f69 6e74 5b3a 2c31 5d0a 2020  xt_point[:,1].  
-00012f90: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00012fa0: 6c66 2e73 616d 706c 6573 203d 206e 6578  lf.samples = nex
-00012fb0: 745f 706f 696e 745b 3a2c 333a 3320 2b20  t_point[:,3:3 + 
-00012fc0: 7365 6c66 2e78 5f64 696d 5d0a 2020 2020  self.x_dim].    
-00012fd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00012fe0: 2e73 616d 706c 6573 7620 3d20 6e65 7874  .samplesv = next
-00012ff0: 5f70 6f69 6e74 5b3a 2c33 202b 2073 656c  _point[:,3 + sel
-00013000: 662e 785f 6469 6d3a 3320 2b20 7365 6c66  f.x_dim:3 + self
-00013010: 2e78 5f64 696d 202b 2073 656c 662e 6e75  .x_dim + self.nu
-00013020: 6d5f 7061 7261 6d73 5d0a 2020 2020 2020  m_params].      
-00013030: 2020 2020 2020 2020 2020 2320 736b 6970            # skip
-00013040: 2069 6620 7765 2061 6c72 6561 6479 206b   if we already k
-00013050: 6e6f 7720 6974 2069 7320 6e6f 7420 7573  now it is not us
-00013060: 6566 756c 0a20 2020 2020 2020 2020 2020  eful.           
-00013070: 2020 2020 2069 6220 3d20 3020 6966 206e       ib = 0 if n
-00013080: 702e 6973 6669 6e69 7465 2873 656c 662e  p.isfinite(self.
-00013090: 6c69 6b65 735b 305d 2920 656c 7365 2031  likes[0]) else 1
-000130a0: 0a0a 2020 2020 2020 2020 2020 2020 7573  ..            us
-000130b0: 655f 7374 6570 7361 6d70 6c65 7220 3d20  e_stepsampler = 
-000130c0: 7365 6c66 2e73 7465 7073 616d 706c 6572  self.stepsampler
-000130d0: 2069 7320 6e6f 7420 4e6f 6e65 0a20 2020   is not None.   
-000130e0: 2020 2020 2020 2020 2077 6869 6c65 2069           while i
-000130f0: 6220 3e3d 206c 656e 2873 656c 662e 7361  b >= len(self.sa
-00013100: 6d70 6c65 7329 3a0a 2020 2020 2020 2020  mples):.        
-00013110: 2020 2020 2020 2020 6962 203d 2030 0a20          ib = 0. 
-00013120: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013130: 6620 7573 655f 7374 6570 7361 6d70 6c65  f use_stepsample
-00013140: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00013150: 2020 2020 2020 2075 2c20 762c 206c 6f67         u, v, log
-00013160: 6c2c 206e 6320 3d20 7365 6c66 2e73 7465  l, nc = self.ste
-00013170: 7073 616d 706c 6572 2e5f 5f6e 6578 745f  psampler.__next_
-00013180: 5f28 0a20 2020 2020 2020 2020 2020 2020  _(.             
-00013190: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000131a0: 7265 6769 6f6e 2c0a 2020 2020 2020 2020  region,.        
+00011540: 7365 6c66 2e6c 6f67 6765 722e 6465 6275  self.logger.debu
+00011550: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+00011560: 2020 2020 2020 2022 2020 6e75 6d62 6572         "  number
+00011570: 206f 6620 6c69 7665 2070 6f69 6e74 7320   of live points 
+00011580: 7661 7279 2062 6574 7765 656e 2025 2e30  vary between %.0
+00011590: 6620 616e 6420 252e 3066 2c20 6d6f 7374  f and %.0f, most
+000115a0: 2028 2564 2f25 6420 6974 6572 6174 696f   (%d/%d iteratio
+000115b0: 6e73 2920 6861 7665 2025 6422 2c0a 2020  ns) have %d",.  
+000115c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115d0: 2020 6e6c 6976 652e 6d69 6e28 292c 206e    nlive.min(), n
+000115e0: 6c69 7665 2e6d 6178 2829 2c20 6e69 7465  live.max(), nite
+000115f0: 722e 6d61 7828 292c 2069 746d 6178 2c20  r.max(), itmax, 
+00011600: 6e6c 6976 655f 7365 7473 5b6e 6974 6572  nlive_sets[niter
+00011610: 2e61 7267 6d61 7828 295d 290a 2020 2020  .argmax()]).    
+00011620: 2020 2020 2020 2020 666f 7220 6e6c 6976          for nliv
+00011630: 655f 666c 6f6f 7220 696e 206e 6c69 7665  e_floor in nlive
+00011640: 5f73 6574 733a 0a20 2020 2020 2020 2020  _sets:.         
+00011650: 2020 2020 2020 2023 2065 7374 696d 6174         # estimat
+00011660: 6520 6572 726f 7220 6966 2074 6869 7320  e error if this 
+00011670: 7761 7320 7468 6520 6d69 6e69 6d75 6d20  was the minimum 
+00011680: 6e6c 6976 6520 6170 706c 6965 640a 2020  nlive applied.  
+00011690: 2020 2020 2020 2020 2020 2020 2020 6e6c                nl
+000116a0: 6976 655f 6164 6a75 7374 6564 203d 206e  ive_adjusted = n
+000116b0: 702e 7768 6572 6528 6e6c 6976 655f 7365  p.where(nlive_se
+000116c0: 7473 203c 206e 6c69 7665 5f66 6c6f 6f72  ts < nlive_floor
+000116d0: 2c20 6e6c 6976 655f 666c 6f6f 722c 206e  , nlive_floor, n
+000116e0: 6c69 7665 5f73 6574 7329 0a20 2020 2020  live_sets).     
+000116f0: 2020 2020 2020 2020 2020 2064 656c 7461             delta
+00011700: 6c6f 675a 5f65 7870 6563 7465 6420 3d20  logZ_expected = 
+00011710: 286e 6974 6572 202f 206e 6c69 7665 5f61  (niter / nlive_a
+00011720: 646a 7573 7465 642a 2a32 2e30 292e 7375  djusted**2.0).su
+00011730: 6d28 292a 2a30 2e35 0a20 2020 2020 2020  m()**0.5.       
+00011740: 2020 2020 2020 2020 2069 6620 6465 6c74           if delt
+00011750: 616c 6f67 5a5f 6578 7065 6374 6564 203c  alogZ_expected <
+00011760: 2064 6c6f 677a 3a0a 2020 2020 2020 2020   dlogz:.        
+00011770: 2020 2020 2020 2020 2020 2020 2320 6163              # ac
+00011780: 6869 6576 6162 6c65 2077 6974 6820 4e6c  hievable with Nl
+00011790: 6976 655f 6d69 6e0a 2020 2020 2020 2020  ive_min.        
+000117a0: 2020 2020 2020 2020 2020 2020 4e6c 6976              Nliv
+000117b0: 655f 6d69 6e20 3d20 696e 7428 6e6c 6976  e_min = int(nliv
+000117c0: 655f 666c 6f6f 7229 0a20 2020 2020 2020  e_floor).       
+000117d0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000117e0: 7365 6c66 2e6c 6f67 3a0a 2020 2020 2020  self.log:.      
+000117f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011800: 2020 7365 6c66 2e6c 6f67 6765 722e 6465    self.logger.de
+00011810: 6275 6728 2220 2061 7420 6c65 6173 7420  bug("  at least 
+00011820: 2564 206c 6976 6520 706f 696e 7473 2061  %d live points a
+00011830: 7265 206e 6565 6465 6420 746f 2072 6561  re needed to rea
+00011840: 6368 2064 6c6f 677a 2067 6f61 6c22 2c20  ch dlogz goal", 
+00011850: 4e6c 6976 655f 6d69 6e29 0a20 2020 2020  Nlive_min).     
+00011860: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00011870: 7265 616b 0a0a 2020 2020 2020 2020 6966  reak..        if
+00011880: 2073 656c 662e 6c6f 6720 616e 6420 4e6c   self.log and Nl
+00011890: 6976 655f 6d69 6e20 3e20 303a 0a20 2020  ive_min > 0:.   
+000118a0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+000118b0: 6767 6572 2e69 6e66 6f28 0a20 2020 2020  gger.info(.     
+000118c0: 2020 2020 2020 2020 2020 2022 4576 6964             "Evid
+000118d0: 656e 6379 2075 6e63 6572 7461 696e 7479  ency uncertainty
+000118e0: 2073 7472 6174 6567 7920 7761 6e74 7320   strategy wants 
+000118f0: 2564 206d 696e 696d 756d 206c 6976 6520  %d minimum live 
+00011900: 706f 696e 7473 2028 646c 6f67 7a20 6672  points (dlogz fr
+00011910: 6f6d 2025 2e32 6620 746f 2025 2e32 662c  om %.2f to %.2f,
+00011920: 206e 6565 6420 3c25 7329 222c 0a20 2020   need <%s)",.   
+00011930: 2020 2020 2020 2020 2020 2020 204e 6c69               Nli
+00011940: 7665 5f6d 696e 2c20 6465 6c74 616c 6f67  ve_min, deltalog
+00011950: 5a2e 6d65 616e 2829 2c20 6465 6c74 616c  Z.mean(), deltal
+00011960: 6f67 5a2e 6d61 7828 292c 2064 6c6f 677a  ogZ.max(), dlogz
+00011970: 290a 2020 2020 2020 2020 656c 6966 2073  ).        elif s
+00011980: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
+00011990: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+000119a0: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+000119b0: 2020 2020 2020 2022 4576 6964 656e 6379         "Evidency
+000119c0: 2075 6e63 6572 7461 696e 7479 2073 7472   uncertainty str
+000119d0: 6174 6567 7920 6973 2073 6174 6973 6669  ategy is satisfi
+000119e0: 6564 2028 646c 6f67 7a3d 252e 3266 2c20  ed (dlogz=%.2f, 
+000119f0: 6e65 6564 203c 2573 2922 2c0a 2020 2020  need <%s)",.    
+00011a00: 2020 2020 2020 2020 2020 2020 286d 6169              (mai
+00011a10: 6e5f 6974 6572 6174 6f72 2e6c 6f67 5a65  n_iterator.logZe
+00011a20: 7272 5f62 732a 2a32 202b 206c 6f67 7a65  rr_bs**2 + logze
+00011a30: 7272 5f74 6169 6c2a 2a32 292a 2a30 2e35  rr_tail**2)**0.5
+00011a40: 2c20 646c 6f67 7a29 0a20 2020 2020 2020  , dlogz).       
+00011a50: 2069 6620 7365 6c66 2e6c 6f67 3a0a 2020   if self.log:.  
+00011a60: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00011a70: 6f67 6765 722e 696e 666f 280a 2020 2020  ogger.info(.    
+00011a80: 2020 2020 2020 2020 2020 2020 2720 206c              '  l
+00011a90: 6f67 5a20 6572 726f 7220 6275 6467 6574  ogZ error budget
+00011aa0: 3a20 7369 6e67 6c65 3a20 252e 3266 2062  : single: %.2f b
+00011ab0: 733a 252e 3266 2074 6169 6c3a 252e 3266  s:%.2f tail:%.2f
+00011ac0: 2074 6f74 616c 3a25 2e32 6620 7265 7175   total:%.2f requ
+00011ad0: 6972 6564 3a3c 252e 3266 272c 0a20 2020  ired:<%.2f',.   
+00011ae0: 2020 2020 2020 2020 2020 2020 206d 6169               mai
+00011af0: 6e5f 6974 6572 6174 6f72 2e6c 6f67 5a65  n_iterator.logZe
+00011b00: 7272 2c20 6d61 696e 5f69 7465 7261 746f  rr, main_iterato
+00011b10: 722e 6c6f 675a 6572 725f 6273 2c20 6c6f  r.logZerr_bs, lo
+00011b20: 677a 6572 725f 7461 696c 2c0a 2020 2020  gzerr_tail,.    
+00011b30: 2020 2020 2020 2020 2020 2020 286d 6169              (mai
+00011b40: 6e5f 6974 6572 6174 6f72 2e6c 6f67 5a65  n_iterator.logZe
+00011b50: 7272 5f62 732a 2a32 202b 206c 6f67 7a65  rr_bs**2 + logze
+00011b60: 7272 5f74 6169 6c2a 2a32 292a 2a30 2e35  rr_tail**2)**0.5
+00011b70: 2c20 646c 6f67 7a29 0a0a 2020 2020 2020  , dlogz)..      
+00011b80: 2020 7265 7475 726e 204e 6c69 7665 5f6d    return Nlive_m
+00011b90: 696e 2c20 284c 6c6f 5f4b 4c2c 204c 6869  in, (Llo_KL, Lhi
+00011ba0: 5f4b 4c29 2c20 284c 6c6f 5f65 7373 2c20  _KL), (Llo_ess, 
+00011bb0: 4c68 695f 6573 7329 0a0a 2020 2020 6465  Lhi_ess)..    de
+00011bc0: 6620 5f72 6566 696c 6c5f 7361 6d70 6c65  f _refill_sample
+00011bd0: 7328 7365 6c66 2c20 4c6d 696e 2c20 6e64  s(self, Lmin, nd
+00011be0: 7261 772c 206e 6974 293a 0a20 2020 2020  raw, nit):.     
+00011bf0: 2020 2022 2222 4765 7420 6e65 7720 7361     """Get new sa
+00011c00: 6d70 6c65 7320 6672 6f6d 2072 6567 696f  mples from regio
+00011c10: 6e2e 2222 220a 2020 2020 2020 2020 6e63  n.""".        nc
+00011c20: 203d 2030 0a20 2020 2020 2020 2075 203d   = 0.        u =
+00011c30: 2073 656c 662e 7265 6769 6f6e 2e73 616d   self.region.sam
+00011c40: 706c 6528 6e73 616d 706c 6573 3d6e 6472  ple(nsamples=ndr
+00011c50: 6177 290a 2020 2020 2020 2020 6173 7365  aw).        asse
+00011c60: 7274 206e 702e 6c6f 6769 6361 6c5f 616e  rt np.logical_an
+00011c70: 6428 7520 3e20 302c 2075 203c 2031 292e  d(u > 0, u < 1).
+00011c80: 616c 6c28 292c 2028 7529 0a20 2020 2020  all(), (u).     
+00011c90: 2020 206e 7520 3d20 752e 7368 6170 655b     nu = u.shape[
+00011ca0: 305d 0a20 2020 2020 2020 2069 6620 6e75  0].        if nu
+00011cb0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00011cc0: 2020 2076 203d 206e 702e 656d 7074 7928     v = np.empty(
+00011cd0: 2830 2c20 7365 6c66 2e6e 756d 5f70 6172  (0, self.num_par
+00011ce0: 616d 7329 290a 2020 2020 2020 2020 2020  ams)).          
+00011cf0: 2020 6c6f 676c 203d 206e 702e 656d 7074    logl = np.empt
+00011d00: 7928 2830 2c29 290a 2020 2020 2020 2020  y((0,)).        
+00011d10: 2020 2020 6163 6365 7074 6564 203d 206e      accepted = n
+00011d20: 702e 656d 7074 7928 302c 2064 7479 7065  p.empty(0, dtype
+00011d30: 3d62 6f6f 6c29 0a20 2020 2020 2020 2065  =bool).        e
+00011d40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00011d50: 2069 6620 6e75 203e 2031 2061 6e64 206e   if nu > 1 and n
+00011d60: 6f74 2073 656c 662e 6472 6177 5f6d 756c  ot self.draw_mul
+00011d70: 7469 706c 653a 0a20 2020 2020 2020 2020  tiple:.         
+00011d80: 2020 2020 2020 2023 2070 6565 6c20 6f66         # peel of
+00011d90: 6620 6669 7273 7420 6966 206d 756c 7469  f first if multi
+00011da0: 706c 6520 6576 616c 7561 7469 6f6e 2069  ple evaluation i
+00011db0: 7320 6e6f 7420 7375 7070 6f72 7465 640a  s not supported.
+00011dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011dd0: 6e75 203d 2031 0a20 2020 2020 2020 2020  nu = 1.         
+00011de0: 2020 2020 2020 2075 203d 2075 5b3a 312c         u = u[:1,
+00011df0: 3a5d 0a0a 2020 2020 2020 2020 2020 2020  :]..            
+00011e00: 7620 3d20 7365 6c66 2e74 7261 6e73 666f  v = self.transfo
+00011e10: 726d 2875 290a 2020 2020 2020 2020 2020  rm(u).          
+00011e20: 2020 6c6f 676c 203d 206e 702e 6f6e 6573    logl = np.ones
+00011e30: 286e 7529 202a 202d 6e70 2e69 6e66 0a0a  (nu) * -np.inf..
+00011e40: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00011e50: 656c 662e 7472 6567 696f 6e20 6973 206e  elf.tregion is n
+00011e60: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00011e70: 2020 2020 2020 2020 2023 2063 6865 636b           # check
+00011e80: 2077 7261 7070 696e 6720 656c 6c69 7073   wrapping ellips
+00011e90: 6f69 6420 696e 2074 7261 6e73 666f 726d  oid in transform
+00011ea0: 6564 2073 7061 6365 0a20 2020 2020 2020  ed space.       
+00011eb0: 2020 2020 2020 2020 2061 6363 6570 7465           accepte
+00011ec0: 6420 3d20 7365 6c66 2e74 7265 6769 6f6e  d = self.tregion
+00011ed0: 2e69 6e73 6964 6528 7629 0a20 2020 2020  .inside(v).     
+00011ee0: 2020 2020 2020 2020 2020 206e 7420 3d20             nt = 
+00011ef0: 6163 6365 7074 6564 2e73 756d 2829 0a20  accepted.sum(). 
+00011f00: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00011f10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011f20: 2023 2069 6620 756e 6465 6669 6e65 642c   # if undefined,
+00011f30: 2061 6c6c 2070 6173 733b 2072 6172 6572   all pass; rarer
+00011f40: 2062 7261 6e63 680a 2020 2020 2020 2020   branch.        
+00011f50: 2020 2020 2020 2020 6163 6365 7074 6564          accepted
+00011f60: 203d 206e 702e 6f6e 6573 286e 752c 2064   = np.ones(nu, d
+00011f70: 7479 7065 3d62 6f6f 6c29 0a20 2020 2020  type=bool).     
+00011f80: 2020 2020 2020 2020 2020 206e 7420 3d20             nt = 
+00011f90: 6e75 0a0a 2020 2020 2020 2020 2020 2020  nu..            
+00011fa0: 6966 206e 7420 3e20 303a 0a20 2020 2020  if nt > 0:.     
+00011fb0: 2020 2020 2020 2020 2020 206c 6f67 6c5b             logl[
+00011fc0: 6163 6365 7074 6564 5d20 3d20 7365 6c66  accepted] = self
+00011fd0: 2e6c 6f67 6c69 6b65 2876 5b61 6363 6570  .loglike(v[accep
+00011fe0: 7465 642c 203a 5d29 0a20 2020 2020 2020  ted, :]).       
+00011ff0: 2020 2020 2020 2020 206e 6320 2b3d 206e           nc += n
+00012000: 740a 2020 2020 2020 2020 2020 2020 6163  t.            ac
+00012010: 6365 7074 6564 203d 206c 6f67 6c20 3e20  cepted = logl > 
+00012020: 4c6d 696e 0a0a 2020 2020 2020 2020 2020  Lmin..          
+00012030: 2020 2320 7072 696e 7428 2269 743a 2025    # print("it: %
+00012040: 3464 206e 6472 6177 3a20 2564 202d 3e20  4d ndraw: %d -> 
+00012050: 2564 202d 3e20 2564 202d 3e20 2564 2022  %d -> %d -> %d "
+00012060: 2025 2028 6e69 742c 206e 6472 6177 2c20   % (nit, ndraw, 
+00012070: 6e75 2c20 6e74 2c20 6163 6365 7074 6564  nu, nt, accepted
+00012080: 2e73 756d 2829 2929 0a0a 2020 2020 2020  .sum()))..      
+00012090: 2020 6966 206e 6f74 2073 656c 662e 7361    if not self.sa
+000120a0: 6d70 6c69 6e67 5f73 6c6f 775f 7761 726e  mpling_slow_warn
+000120b0: 6564 2061 6e64 206e 6974 202a 206e 6472  ed and nit * ndr
+000120c0: 6177 203e 3d20 3130 3030 3030 2061 6e64  aw >= 100000 and
+000120d0: 206e 6974 203e 2032 303a 0a20 2020 2020   nit > 20:.     
+000120e0: 2020 2020 2020 2077 6172 6e69 6e67 5f6d         warning_m
+000120f0: 6573 7361 6765 3120 3d20 2822 5361 6d70  essage1 = ("Samp
+00012100: 6c69 6e67 2066 726f 6d20 7265 6769 6f6e  ling from region
+00012110: 2073 6565 6d73 2069 6e65 6666 6963 6965   seems inefficie
+00012120: 6e74 2028 2564 2f25 6420 6163 6365 7074  nt (%d/%d accept
+00012130: 6564 2069 6e20 6974 6572 6174 696f 6e20  ed in iteration 
+00012140: 2564 292e 2022 2025 2028 6163 6365 7074  %d). " % (accept
+00012150: 6564 2e73 756d 2829 2c20 6e64 7261 772c  ed.sum(), ndraw,
+00012160: 206e 6974 2929 0a20 2020 2020 2020 2020   nit)).         
+00012170: 2020 2077 6172 6e69 6e67 5f6d 6573 7361     warning_messa
+00012180: 6765 3220 3d20 2254 6f20 696d 7072 6f76  ge2 = "To improv
+00012190: 6520 6566 6669 6369 656e 6379 2c20 6d6f  e efficiency, mo
+000121a0: 6469 6679 2074 6865 2074 7261 6e73 666f  dify the transfo
+000121b0: 726d 6174 696f 6e20 736f 2074 6861 7420  rmation so that 
+000121c0: 7468 6520 6375 7272 656e 7420 6c69 7665  the current live
+000121d0: 2070 6f69 6e74 7325 7320 6172 6520 656c   points%s are el
+000121e0: 6c69 7073 6f69 6461 6c2c 2022 202b 205c  lipsoidal, " + \
+000121f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012200: 2022 6f72 2075 7365 2061 2073 7465 7073   "or use a steps
+00012210: 616d 706c 6572 2c20 6f72 2073 6574 2066  ampler, or set f
+00012220: 7261 635f 7265 6d61 696e 2074 6f20 6120  rac_remain to a 
+00012230: 6c6f 7765 7220 6e75 6d62 6572 2028 652e  lower number (e.
+00012240: 672e 2c20 302e 3529 2074 6f20 7465 726d  g., 0.5) to term
+00012250: 696e 6174 6520 6561 726c 6965 722e 220a  inate earlier.".
+00012260: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00012270: 656c 662e 6c6f 675f 746f 5f64 6973 6b3a  elf.log_to_disk:
+00012280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012290: 2064 6562 7567 5f66 696c 656e 616d 6520   debug_filename 
+000122a0: 3d20 6f73 2e70 6174 682e 6a6f 696e 2873  = os.path.join(s
+000122b0: 656c 662e 6c6f 6773 5b27 6578 7472 6127  elf.logs['extra'
+000122c0: 5d2c 2027 7361 6d70 6c69 6e67 2d73 7475  ], 'sampling-stu
+000122d0: 636b 2d69 7425 6427 290a 2020 2020 2020  ck-it%d').      
+000122e0: 2020 2020 2020 2020 2020 6e70 2e73 6176            np.sav
+000122f0: 657a 280a 2020 2020 2020 2020 2020 2020  ez(.            
+00012300: 2020 2020 2020 2020 6465 6275 675f 6669          debug_fi
+00012310: 6c65 6e61 6d65 202b 2027 2e6e 707a 272c  lename + '.npz',
+00012320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012330: 2020 2020 2075 3d73 656c 662e 7265 6769       u=self.regi
+00012340: 6f6e 2e75 2c20 756e 6f72 6d65 643d 7365  on.u, unormed=se
+00012350: 6c66 2e72 6567 696f 6e2e 756e 6f72 6d65  lf.region.unorme
+00012360: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00012370: 2020 2020 2020 206d 6178 7261 6469 7573         maxradius
+00012380: 7371 3d73 656c 662e 7265 6769 6f6e 2e6d  sq=self.region.m
+00012390: 6178 7261 6469 7573 7371 2c0a 2020 2020  axradiussq,.    
+000123a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123b0: 7361 6d70 6c65 5f75 3d75 2c20 7361 6d70  sample_u=u, samp
+000123c0: 6c65 5f76 3d76 2c20 7361 6d70 6c65 5f6c  le_v=v, sample_l
+000123d0: 6f67 6c3d 6c6f 676c 290a 2020 2020 2020  ogl=logl).      
+000123e0: 2020 2020 2020 2020 2020 6e70 2e73 6176            np.sav
+000123f0: 6574 7874 2864 6562 7567 5f66 696c 656e  etxt(debug_filen
+00012400: 616d 6520 2b20 272e 6373 7627 2c20 7365  ame + '.csv', se
+00012410: 6c66 2e72 6567 696f 6e2e 752c 2064 656c  lf.region.u, del
+00012420: 696d 6974 6572 3d27 2c27 290a 2020 2020  imiter=',').    
+00012430: 2020 2020 2020 2020 2020 2020 7761 726e              warn
+00012440: 696e 675f 6d65 7373 6167 6520 3d20 7761  ing_message = wa
+00012450: 726e 696e 675f 6d65 7373 6167 6531 202b  rning_message1 +
+00012460: 2028 7761 726e 696e 675f 6d65 7373 6167   (warning_messag
+00012470: 6532 2025 2028 2720 2873 746f 7265 6420  e2 % (' (stored 
+00012480: 666f 7220 796f 7520 696e 2025 732e 6373  for you in %s.cs
+00012490: 7629 2720 2520 6465 6275 675f 6669 6c65  v)' % debug_file
+000124a0: 6e61 6d65 2929 0a20 2020 2020 2020 2020  name)).         
+000124b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000124c0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+000124d0: 5f6d 6573 7361 6765 203d 2077 6172 6e69  _message = warni
+000124e0: 6e67 5f6d 6573 7361 6765 3120 2b20 7761  ng_message1 + wa
+000124f0: 726e 696e 675f 6d65 7373 6167 6532 2025  rning_message2 %
+00012500: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
+00012510: 7761 726e 696e 6773 2e77 6172 6e28 7761  warnings.warn(wa
+00012520: 726e 696e 675f 6d65 7373 6167 6529 0a20  rning_message). 
+00012530: 2020 2020 2020 2020 2020 206c 6f67 6c5f             logl_
+00012540: 7265 6769 6f6e 203d 2073 656c 662e 6c6f  region = self.lo
+00012550: 676c 696b 6528 7365 6c66 2e74 7261 6e73  glike(self.trans
+00012560: 666f 726d 2873 656c 662e 7265 6769 6f6e  form(self.region
+00012570: 2e75 2929 0a20 2020 2020 2020 2020 2020  .u)).           
+00012580: 2069 6620 286c 6f67 6c5f 7265 6769 6f6e   if (logl_region
+00012590: 203d 3d20 4c6d 696e 292e 616c 6c28 293a   == Lmin).all():
+000125a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000125b0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000125c0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+000125d0: 2020 2020 2020 2022 5265 6769 6f6e 2063         "Region c
+000125e0: 616e 6e6f 7420 7361 6d70 6c65 2061 2068  annot sample a h
+000125f0: 6967 6865 7220 706f 696e 742e 2022 0a20  igher point. ". 
+00012600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012610: 2020 2022 416c 6c20 7265 6d61 696e 696e     "All remainin
+00012620: 6720 6c69 7665 2070 6f69 6e74 7320 6861  g live points ha
+00012630: 7665 2074 6865 2073 616d 6520 7661 6c75  ve the same valu
+00012640: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
+00012650: 2069 6620 6e6f 7420 286c 6f67 6c5f 7265   if not (logl_re
+00012660: 6769 6f6e 203e 204c 6d69 6e29 2e61 6e79  gion > Lmin).any
+00012670: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00012680: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00012690: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+000126a0: 2020 2020 2020 2020 2020 2252 6567 696f            "Regio
+000126b0: 6e20 6361 6e6e 6f74 2073 616d 706c 6520  n cannot sample 
+000126c0: 6120 6869 6768 6572 2070 6f69 6e74 2e20  a higher point. 
+000126d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000126e0: 2020 2020 2020 2250 6572 6861 7073 2079        "Perhaps y
+000126f0: 6f75 2061 7265 2072 6573 756d 696e 6720  ou are resuming 
+00012700: 6672 6f6d 2061 2064 6966 6665 7265 6e74  from a different
+00012710: 2070 726f 626c 656d 3f22 0a20 2020 2020   problem?".     
+00012720: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00012730: 4465 6c65 7465 2074 6865 206f 7574 7075  Delete the outpu
+00012740: 7420 6669 6c65 7320 616e 6420 7374 6172  t files and star
+00012750: 7420 6167 6169 6e2e 2229 0a20 2020 2020  t again.").     
+00012760: 2020 2020 2020 2073 656c 662e 7361 6d70         self.samp
+00012770: 6c69 6e67 5f73 6c6f 775f 7761 726e 6564  ling_slow_warned
+00012780: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
+00012790: 2073 656c 662e 6e63 616c 6c5f 7265 6769   self.ncall_regi
+000127a0: 6f6e 202b 3d20 6e64 7261 770a 2020 2020  on += ndraw.    
+000127b0: 2020 2020 7265 7475 726e 2075 5b61 6363      return u[acc
+000127c0: 6570 7465 642c 3a5d 2c20 765b 6163 6365  epted,:], v[acce
+000127d0: 7074 6564 2c3a 5d2c 206c 6f67 6c5b 6163  pted,:], logl[ac
+000127e0: 6365 7074 6564 5d2c 206e 632c 2030 0a0a  cepted], nc, 0..
+000127f0: 2020 2020 6465 6620 5f63 7265 6174 655f      def _create_
+00012800: 706f 696e 7428 7365 6c66 2c20 4c6d 696e  point(self, Lmin
+00012810: 2c20 6e64 7261 772c 2061 6374 6976 655f  , ndraw, active_
+00012820: 752c 2061 6374 6976 655f 7661 6c75 6573  u, active_values
+00012830: 293a 0a20 2020 2020 2020 2022 2222 4472  ):.        """Dr
+00012840: 6177 2061 206e 6577 2070 6f69 6e74 2061  aw a new point a
+00012850: 626f 7665 206c 696b 656c 6968 6f6f 6420  bove likelihood 
+00012860: 7468 7265 7368 6f6c 6420 604c 6d69 6e60  threshold `Lmin`
+00012870: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+00012880: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+00012890: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+000128a0: 2020 4c6d 696e 3a20 666c 6f61 740a 2020    Lmin: float.  
+000128b0: 2020 2020 2020 2020 2020 6c6f 676c 696b            loglik
+000128c0: 656c 6968 6f6f 6420 7468 7265 7368 6f6c  elihood threshol
+000128d0: 6420 746f 2064 7261 7720 6162 6f76 650a  d to draw above.
+000128e0: 2020 2020 2020 2020 6e64 7261 773a 2066          ndraw: f
+000128f0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00012900: 206e 756d 6265 7220 6f66 2070 6f69 6e74   number of point
+00012910: 7320 746f 2074 7279 2074 6f20 7361 6d70  s to try to samp
+00012920: 6c65 2061 7420 6f6e 6365 0a20 2020 2020  le at once.     
+00012930: 2020 2061 6374 6976 655f 753a 2061 7272     active_u: arr
+00012940: 6179 206f 6620 666c 6f61 7473 0a20 2020  ay of floats.   
+00012950: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00012960: 206c 6976 6520 706f 696e 7473 0a20 2020   live points.   
+00012970: 2020 2020 2061 6374 6976 655f 7661 6c75       active_valu
+00012980: 6573 3a20 6172 7261 790a 2020 2020 2020  es: array.      
+00012990: 2020 2020 2020 6c6f 676c 696b 656c 6968        loglikelih
+000129a0: 6f6f 6473 206f 6620 6375 7272 656e 7420  oods of current 
+000129b0: 6c69 7665 2070 6f69 6e74 730a 0a20 2020  live points..   
+000129c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000129d0: 2069 6620 7365 6c66 2e73 7465 7073 616d   if self.stepsam
+000129e0: 706c 6572 2069 7320 4e6f 6e65 3a0a 2020  pler is None:.  
+000129f0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00012a00: 2073 656c 662e 7265 6769 6f6e 2e69 6e73   self.region.ins
+00012a10: 6964 6528 6163 7469 7665 5f75 292e 616e  ide(active_u).an
+00012a20: 7928 292c 205c 0a20 2020 2020 2020 2020  y(), \.         
+00012a30: 2020 2020 2020 2028 224e 6f6e 6520 6f66         ("None of
+00012a40: 2074 6865 206c 6976 6520 706f 696e 7473   the live points
+00012a50: 2073 6174 6973 6669 6573 2074 6865 2063   satisfies the c
+00012a60: 7572 7265 6e74 2072 6567 696f 6e21 222c  urrent region!",
+00012a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012a80: 2020 7365 6c66 2e72 6567 696f 6e2e 6d61    self.region.ma
+00012a90: 7872 6164 6975 7373 712c 2073 656c 662e  xradiussq, self.
+00012aa0: 7265 6769 6f6e 2e75 2c20 7365 6c66 2e72  region.u, self.r
+00012ab0: 6567 696f 6e2e 756e 6f72 6d65 642c 2061  egion.unormed, a
+00012ac0: 6374 6976 655f 752c 0a20 2020 2020 2020  ctive_u,.       
+00012ad0: 2020 2020 2020 2020 2020 6765 7461 7474            getatt
+00012ae0: 7228 7365 6c66 2e72 6567 696f 6e2c 2027  r(self.region, '
+00012af0: 6262 6f78 5f6c 6f27 292c 0a20 2020 2020  bbox_lo'),.     
+00012b00: 2020 2020 2020 2020 2020 2020 6765 7461              geta
+00012b10: 7474 7228 7365 6c66 2e72 6567 696f 6e2c  ttr(self.region,
+00012b20: 2027 6262 6f78 5f68 6927 292c 0a20 2020   'bbox_hi'),.   
+00012b30: 2020 2020 2020 2020 2020 2020 2020 6765                ge
+00012b40: 7461 7474 7228 7365 6c66 2e72 6567 696f  tattr(self.regio
+00012b50: 6e2c 2027 656c 6c69 7073 6f69 645f 636f  n, 'ellipsoid_co
+00012b60: 7627 292c 0a20 2020 2020 2020 2020 2020  v'),.           
+00012b70: 2020 2020 2020 6765 7461 7474 7228 7365        getattr(se
+00012b80: 6c66 2e72 6567 696f 6e2c 2027 656c 6c69  lf.region, 'elli
+00012b90: 7073 6f69 645f 6365 6e74 6572 2729 2c0a  psoid_center'),.
+00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bb0: 2067 6574 6174 7472 2873 656c 662e 7265   getattr(self.re
+00012bc0: 6769 6f6e 2c20 2765 6c6c 6970 736f 6964  gion, 'ellipsoid
+00012bd0: 5f69 6e76 636f 7627 292c 0a20 2020 2020  _invcov'),.     
+00012be0: 2020 2020 2020 2020 2020 2020 6765 7461              geta
+00012bf0: 7474 7228 7365 6c66 2e72 6567 696f 6e2c  ttr(self.region,
+00012c00: 2027 656c 6c69 7073 6f69 645f 636f 7627   'ellipsoid_cov'
+00012c10: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00012c20: 2020 2020 290a 0a20 2020 2020 2020 206e      )..        n
+00012c30: 6974 203d 2030 0a20 2020 2020 2020 2077  it = 0.        w
+00012c40: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
+00012c50: 2020 2020 2020 2069 6220 3d20 7365 6c66         ib = self
+00012c60: 2e69 620a 2020 2020 2020 2020 2020 2020  .ib.            
+00012c70: 6966 2069 6220 3e3d 206c 656e 2873 656c  if ib >= len(sel
+00012c80: 662e 7361 6d70 6c65 7329 2061 6e64 2073  f.samples) and s
+00012c90: 656c 662e 7573 655f 706f 696e 745f 7374  elf.use_point_st
+00012ca0: 6163 6b3a 0a20 2020 2020 2020 2020 2020  ack:.           
+00012cb0: 2020 2020 2023 2072 6f6f 7420 6368 6563       # root chec
+00012cc0: 6b73 2074 6865 2070 6f69 6e74 2073 746f  ks the point sto
+00012cd0: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
+00012ce0: 2020 206e 6578 745f 706f 696e 7420 3d20     next_point = 
+00012cf0: 6e70 2e7a 6572 6f73 2828 312c 2033 202b  np.zeros((1, 3 +
+00012d00: 2073 656c 662e 785f 6469 6d20 2b20 7365   self.x_dim + se
+00012d10: 6c66 2e6e 756d 5f70 6172 616d 7329 2920  lf.num_params)) 
+00012d20: 2a20 6e70 2e6e 616e 0a0a 2020 2020 2020  * np.nan..      
+00012d30: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00012d40: 662e 6c6f 675f 746f 5f70 6f69 6e74 7374  f.log_to_pointst
+00012d50: 6f72 653a 0a20 2020 2020 2020 2020 2020  ore:.           
+00012d60: 2020 2020 2020 2020 205f 2c20 7374 6f72           _, stor
+00012d70: 6564 5f70 6f69 6e74 203d 2073 656c 662e  ed_point = self.
+00012d80: 706f 696e 7473 746f 7265 2e70 6f70 284c  pointstore.pop(L
+00012d90: 6d69 6e29 0a20 2020 2020 2020 2020 2020  min).           
+00012da0: 2020 2020 2020 2020 2069 6620 7374 6f72           if stor
+00012db0: 6564 5f70 6f69 6e74 2069 7320 6e6f 7420  ed_point is not 
+00012dc0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00012dd0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00012de0: 7874 5f70 6f69 6e74 5b30 2c3a 5d20 3d20  xt_point[0,:] = 
+00012df0: 7374 6f72 6564 5f70 6f69 6e74 0a20 2020  stored_point.   
+00012e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00012e20: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00012e30: 6578 745f 706f 696e 745b 302c 3a5d 203d  ext_point[0,:] =
+00012e40: 202d 6e70 2e69 6e66 0a20 2020 2020 2020   -np.inf.       
+00012e50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00012e60: 662e 7573 655f 706f 696e 745f 7374 6163  f.use_point_stac
+00012e70: 6b20 3d20 6e6f 7420 7365 6c66 2e70 6f69  k = not self.poi
+00012e80: 6e74 7374 6f72 652e 7374 6163 6b5f 656d  ntstore.stack_em
+00012e90: 7074 790a 0a20 2020 2020 2020 2020 2020  pty..           
+00012ea0: 2020 2020 2069 6620 7365 6c66 2e75 7365       if self.use
+00012eb0: 5f6d 7069 3a20 2023 2061 6e64 2069 6e66  _mpi:  # and inf
+00012ec0: 6f72 6d73 2065 7665 7279 6f6e 650a 2020  orms everyone.  
+00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ee0: 2020 7365 6c66 2e75 7365 5f70 6f69 6e74    self.use_point
+00012ef0: 5f73 7461 636b 203d 2073 656c 662e 636f  _stack = self.co
+00012f00: 6d6d 2e62 6361 7374 2873 656c 662e 7573  mm.bcast(self.us
+00012f10: 655f 706f 696e 745f 7374 6163 6b2c 2072  e_point_stack, r
+00012f20: 6f6f 743d 3029 0a20 2020 2020 2020 2020  oot=0).         
+00012f30: 2020 2020 2020 2020 2020 206e 6578 745f             next_
+00012f40: 706f 696e 7420 3d20 7365 6c66 2e63 6f6d  point = self.com
+00012f50: 6d2e 6263 6173 7428 6e65 7874 5f70 6f69  m.bcast(next_poi
+00012f60: 6e74 2c20 726f 6f74 3d30 290a 0a20 2020  nt, root=0)..   
+00012f70: 2020 2020 2020 2020 2020 2020 2023 2075               # u
+00012f80: 6e70 6163 6b0a 2020 2020 2020 2020 2020  npack.          
+00012f90: 2020 2020 2020 7365 6c66 2e6c 696b 6573        self.likes
+00012fa0: 203d 206e 6578 745f 706f 696e 745b 3a2c   = next_point[:,
+00012fb0: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+00012fc0: 2020 2073 656c 662e 7361 6d70 6c65 7320     self.samples 
+00012fd0: 3d20 6e65 7874 5f70 6f69 6e74 5b3a 2c33  = next_point[:,3
+00012fe0: 3a33 202b 2073 656c 662e 785f 6469 6d5d  :3 + self.x_dim]
+00012ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013000: 2073 656c 662e 7361 6d70 6c65 7376 203d   self.samplesv =
+00013010: 206e 6578 745f 706f 696e 745b 3a2c 3320   next_point[:,3 
+00013020: 2b20 7365 6c66 2e78 5f64 696d 3a33 202b  + self.x_dim:3 +
+00013030: 2073 656c 662e 785f 6469 6d20 2b20 7365   self.x_dim + se
+00013040: 6c66 2e6e 756d 5f70 6172 616d 735d 0a20  lf.num_params]. 
+00013050: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00013060: 2073 6b69 7020 6966 2077 6520 616c 7265   skip if we alre
+00013070: 6164 7920 6b6e 6f77 2069 7420 6973 206e  ady know it is n
+00013080: 6f74 2075 7365 6675 6c0a 2020 2020 2020  ot useful.      
+00013090: 2020 2020 2020 2020 2020 6962 203d 2030            ib = 0
+000130a0: 2069 6620 6e70 2e69 7366 696e 6974 6528   if np.isfinite(
+000130b0: 7365 6c66 2e6c 696b 6573 5b30 5d29 2065  self.likes[0]) e
+000130c0: 6c73 6520 310a 0a20 2020 2020 2020 2020  lse 1..         
+000130d0: 2020 2075 7365 5f73 7465 7073 616d 706c     use_stepsampl
+000130e0: 6572 203d 2073 656c 662e 7374 6570 7361  er = self.stepsa
+000130f0: 6d70 6c65 7220 6973 206e 6f74 204e 6f6e  mpler is not Non
+00013100: 650a 2020 2020 2020 2020 2020 2020 7768  e.            wh
+00013110: 696c 6520 6962 203e 3d20 6c65 6e28 7365  ile ib >= len(se
+00013120: 6c66 2e73 616d 706c 6573 293a 0a20 2020  lf.samples):.   
+00013130: 2020 2020 2020 2020 2020 2020 2069 6220               ib 
+00013140: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00013150: 2020 2020 6966 2075 7365 5f73 7465 7073      if use_steps
+00013160: 616d 706c 6572 3a0a 2020 2020 2020 2020  ampler:.        
+00013170: 2020 2020 2020 2020 2020 2020 752c 2076              u, v
+00013180: 2c20 6c6f 676c 2c20 6e63 203d 2073 656c  , logl, nc = sel
+00013190: 662e 7374 6570 7361 6d70 6c65 722e 5f5f  f.stepsampler.__
+000131a0: 6e65 7874 5f5f 280a 2020 2020 2020 2020  next__(.        
 000131b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131c0: 7472 616e 7366 6f72 6d3d 7365 6c66 2e74  transform=self.t
-000131d0: 7261 6e73 666f 726d 2c20 6c6f 676c 696b  ransform, loglik
-000131e0: 653d 7365 6c66 2e6c 6f67 6c69 6b65 2c0a  e=self.loglike,.
-000131f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013200: 2020 2020 2020 2020 4c6d 696e 3d4c 6d69          Lmin=Lmi
-00013210: 6e2c 2075 733d 6163 7469 7665 5f75 2c20  n, us=active_u, 
-00013220: 4c73 3d61 6374 6976 655f 7661 6c75 6573  Ls=active_values
-00013230: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013240: 2020 2020 2020 2020 2020 6e64 7261 773d            ndraw=
-00013250: 6e64 7261 772c 2074 7265 6769 6f6e 3d73  ndraw, tregion=s
-00013260: 656c 662e 7472 6567 696f 6e29 0a20 2020  elf.tregion).   
-00013270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013280: 2071 7561 6c69 7479 203d 2073 656c 662e   quality = self.
-00013290: 7374 6570 7361 6d70 6c65 722e 6e73 7465  stepsampler.nste
-000132a0: 7073 0a20 2020 2020 2020 2020 2020 2020  ps.             
-000132b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000132c0: 2020 2020 2020 2020 2020 2020 2075 2c20               u, 
-000132d0: 762c 206c 6f67 6c2c 206e 632c 2071 7561  v, logl, nc, qua
-000132e0: 6c69 7479 203d 2073 656c 662e 5f72 6566  lity = self._ref
-000132f0: 696c 6c5f 7361 6d70 6c65 7328 4c6d 696e  ill_samples(Lmin
-00013300: 2c20 6e64 7261 772c 206e 6974 290a 2020  , ndraw, nit).  
-00013310: 2020 2020 2020 2020 2020 2020 2020 6e69                ni
-00013320: 7420 2b3d 2031 0a0a 2020 2020 2020 2020  t += 1..        
-00013330: 2020 2020 2020 2020 6966 206c 6f67 6c20          if logl 
-00013340: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00013350: 2020 2020 2020 2020 2020 2020 2075 203d               u =
-00013360: 206e 702e 656d 7074 7928 2830 2c20 7365   np.empty((0, se
-00013370: 6c66 2e78 5f64 696d 2929 0a20 2020 2020  lf.x_dim)).     
-00013380: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00013390: 203d 206e 702e 656d 7074 7928 2830 2c20   = np.empty((0, 
-000133a0: 7365 6c66 2e6e 756d 5f70 6172 616d 7329  self.num_params)
-000133b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000133c0: 2020 2020 2020 6c6f 676c 203d 206e 702e        logl = np.
-000133d0: 656d 7074 7928 2830 2c29 290a 2020 2020  empty((0,)).    
-000133e0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000133f0: 2075 2e6e 6469 6d20 3d3d 2031 3a0a 2020   u.ndim == 1:.  
-00013400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013410: 2020 6173 7365 7274 206e 702e 6c6f 6769    assert np.logi
-00013420: 6361 6c5f 616e 6428 7520 3e20 302c 2075  cal_and(u > 0, u
-00013430: 203c 2031 292e 616c 6c28 292c 2028 7529   < 1).all(), (u)
-00013440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013450: 2020 2020 2075 203d 2075 2e72 6573 6861       u = u.resha
-00013460: 7065 2828 312c 2073 656c 662e 785f 6469  pe((1, self.x_di
-00013470: 6d29 290a 2020 2020 2020 2020 2020 2020  m)).            
-00013480: 2020 2020 2020 2020 7620 3d20 762e 7265          v = v.re
-00013490: 7368 6170 6528 2831 2c20 7365 6c66 2e6e  shape((1, self.n
-000134a0: 756d 5f70 6172 616d 7329 290a 2020 2020  um_params)).    
-000134b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134c0: 6c6f 676c 203d 206c 6f67 6c2e 7265 7368  logl = logl.resh
-000134d0: 6170 6528 2831 2c29 290a 0a20 2020 2020  ape((1,))..     
-000134e0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-000134f0: 6c66 2e75 7365 5f6d 7069 3a0a 2020 2020  lf.use_mpi:.    
+000131c0: 7365 6c66 2e72 6567 696f 6e2c 0a20 2020  self.region,.   
+000131d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131e0: 2020 2020 2074 7261 6e73 666f 726d 3d73       transform=s
+000131f0: 656c 662e 7472 616e 7366 6f72 6d2c 206c  elf.transform, l
+00013200: 6f67 6c69 6b65 3d73 656c 662e 6c6f 676c  oglike=self.logl
+00013210: 696b 652c 0a20 2020 2020 2020 2020 2020  ike,.           
+00013220: 2020 2020 2020 2020 2020 2020 204c 6d69               Lmi
+00013230: 6e3d 4c6d 696e 2c20 7573 3d61 6374 6976  n=Lmin, us=activ
+00013240: 655f 752c 204c 733d 6163 7469 7665 5f76  e_u, Ls=active_v
+00013250: 616c 7565 732c 0a20 2020 2020 2020 2020  alues,.         
+00013260: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00013270: 6472 6177 3d6e 6472 6177 2c20 7472 6567  draw=ndraw, treg
+00013280: 696f 6e3d 7365 6c66 2e74 7265 6769 6f6e  ion=self.tregion
+00013290: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000132a0: 2020 2020 2020 7175 616c 6974 7920 3d20        quality = 
+000132b0: 7365 6c66 2e73 7465 7073 616d 706c 6572  self.stepsampler
+000132c0: 2e6e 7374 6570 730a 2020 2020 2020 2020  .nsteps.        
+000132d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000132e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132f0: 2020 752c 2076 2c20 6c6f 676c 2c20 6e63    u, v, logl, nc
+00013300: 2c20 7175 616c 6974 7920 3d20 7365 6c66  , quality = self
+00013310: 2e5f 7265 6669 6c6c 5f73 616d 706c 6573  ._refill_samples
+00013320: 284c 6d69 6e2c 206e 6472 6177 2c20 6e69  (Lmin, ndraw, ni
+00013330: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00013340: 2020 206e 6974 202b 3d20 310a 0a20 2020     nit += 1..   
+00013350: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00013360: 6c6f 676c 2069 7320 4e6f 6e65 3a0a 2020  logl is None:.  
+00013370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013380: 2020 7520 3d20 6e70 2e65 6d70 7479 2828    u = np.empty((
+00013390: 302c 2073 656c 662e 785f 6469 6d29 290a  0, self.x_dim)).
+000133a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133b0: 2020 2020 7620 3d20 6e70 2e65 6d70 7479      v = np.empty
+000133c0: 2828 302c 2073 656c 662e 6e75 6d5f 7061  ((0, self.num_pa
+000133d0: 7261 6d73 2929 0a20 2020 2020 2020 2020  rams)).         
+000133e0: 2020 2020 2020 2020 2020 206c 6f67 6c20             logl 
+000133f0: 3d20 6e70 2e65 6d70 7479 2828 302c 2929  = np.empty((0,))
+00013400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013410: 2065 6c69 6620 752e 6e64 696d 203d 3d20   elif u.ndim == 
+00013420: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00013430: 2020 2020 2020 2061 7373 6572 7420 6e70         assert np
+00013440: 2e6c 6f67 6963 616c 5f61 6e64 2875 203e  .logical_and(u >
+00013450: 2030 2c20 7520 3c20 3129 2e61 6c6c 2829   0, u < 1).all()
+00013460: 2c20 2875 290a 2020 2020 2020 2020 2020  , (u).          
+00013470: 2020 2020 2020 2020 2020 7520 3d20 752e            u = u.
+00013480: 7265 7368 6170 6528 2831 2c20 7365 6c66  reshape((1, self
+00013490: 2e78 5f64 696d 2929 0a20 2020 2020 2020  .x_dim)).       
+000134a0: 2020 2020 2020 2020 2020 2020 2076 203d               v =
+000134b0: 2076 2e72 6573 6861 7065 2828 312c 2073   v.reshape((1, s
+000134c0: 656c 662e 6e75 6d5f 7061 7261 6d73 2929  elf.num_params))
+000134d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000134e0: 2020 2020 206c 6f67 6c20 3d20 6c6f 676c       logl = logl
+000134f0: 2e72 6573 6861 7065 2828 312c 2929 0a0a  .reshape((1,))..
 00013500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013510: 7265 6376 5f73 616d 706c 6573 203d 2073  recv_samples = s
-00013520: 656c 662e 636f 6d6d 2e67 6174 6865 7228  elf.comm.gather(
-00013530: 752c 2072 6f6f 743d 3029 0a20 2020 2020  u, root=0).     
-00013540: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00013550: 6563 765f 7361 6d70 6c65 7376 203d 2073  ecv_samplesv = s
-00013560: 656c 662e 636f 6d6d 2e67 6174 6865 7228  elf.comm.gather(
-00013570: 762c 2072 6f6f 743d 3029 0a20 2020 2020  v, root=0).     
-00013580: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00013590: 6563 765f 6c69 6b65 7320 3d20 7365 6c66  ecv_likes = self
-000135a0: 2e63 6f6d 6d2e 6761 7468 6572 286c 6f67  .comm.gather(log
-000135b0: 6c2c 2072 6f6f 743d 3029 0a20 2020 2020  l, root=0).     
-000135c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000135d0: 6563 765f 6e63 203d 2073 656c 662e 636f  ecv_nc = self.co
-000135e0: 6d6d 2e67 6174 6865 7228 6e63 2c20 726f  mm.gather(nc, ro
-000135f0: 6f74 3d30 290a 2020 2020 2020 2020 2020  ot=0).          
-00013600: 2020 2020 2020 2020 2020 7265 6376 5f73            recv_s
-00013610: 616d 706c 6573 203d 2073 656c 662e 636f  amples = self.co
-00013620: 6d6d 2e62 6361 7374 2872 6563 765f 7361  mm.bcast(recv_sa
-00013630: 6d70 6c65 732c 2072 6f6f 743d 3029 0a20  mples, root=0). 
-00013640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013650: 2020 2072 6563 765f 7361 6d70 6c65 7376     recv_samplesv
-00013660: 203d 2073 656c 662e 636f 6d6d 2e62 6361   = self.comm.bca
-00013670: 7374 2872 6563 765f 7361 6d70 6c65 7376  st(recv_samplesv
-00013680: 2c20 726f 6f74 3d30 290a 2020 2020 2020  , root=0).      
-00013690: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000136a0: 6376 5f6c 696b 6573 203d 2073 656c 662e  cv_likes = self.
-000136b0: 636f 6d6d 2e62 6361 7374 2872 6563 765f  comm.bcast(recv_
-000136c0: 6c69 6b65 732c 2072 6f6f 743d 3029 0a20  likes, root=0). 
-000136d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136e0: 2020 2072 6563 765f 6e63 203d 2073 656c     recv_nc = sel
-000136f0: 662e 636f 6d6d 2e62 6361 7374 2872 6563  f.comm.bcast(rec
-00013700: 765f 6e63 2c20 726f 6f74 3d30 290a 2020  v_nc, root=0).  
-00013710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013720: 2020 7365 6c66 2e73 616d 706c 6573 203d    self.samples =
-00013730: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
-00013740: 7265 6376 5f73 616d 706c 6573 2c20 6178  recv_samples, ax
-00013750: 6973 3d30 290a 2020 2020 2020 2020 2020  is=0).          
-00013760: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00013770: 616d 706c 6573 7620 3d20 6e70 2e63 6f6e  amplesv = np.con
-00013780: 6361 7465 6e61 7465 2872 6563 765f 7361  catenate(recv_sa
-00013790: 6d70 6c65 7376 2c20 6178 6973 3d30 290a  mplesv, axis=0).
-000137a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137b0: 2020 2020 7365 6c66 2e6c 696b 6573 203d      self.likes =
-000137c0: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
-000137d0: 7265 6376 5f6c 696b 6573 2c20 6178 6973  recv_likes, axis
-000137e0: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
-000137f0: 2020 2020 2020 2020 7365 6c66 2e6e 6361          self.nca
-00013800: 6c6c 202b 3d20 7375 6d28 7265 6376 5f6e  ll += sum(recv_n
-00013810: 6329 0a20 2020 2020 2020 2020 2020 2020  c).             
-00013820: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00013830: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00013840: 662e 7361 6d70 6c65 7320 3d20 750a 2020  f.samples = u.  
+00013510: 6966 2073 656c 662e 7573 655f 6d70 693a  if self.use_mpi:
+00013520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013530: 2020 2020 2072 6563 765f 7361 6d70 6c65       recv_sample
+00013540: 7320 3d20 7365 6c66 2e63 6f6d 6d2e 6761  s = self.comm.ga
+00013550: 7468 6572 2875 2c20 726f 6f74 3d30 290a  ther(u, root=0).
+00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013570: 2020 2020 7265 6376 5f73 616d 706c 6573      recv_samples
+00013580: 7620 3d20 7365 6c66 2e63 6f6d 6d2e 6761  v = self.comm.ga
+00013590: 7468 6572 2876 2c20 726f 6f74 3d30 290a  ther(v, root=0).
+000135a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135b0: 2020 2020 7265 6376 5f6c 696b 6573 203d      recv_likes =
+000135c0: 2073 656c 662e 636f 6d6d 2e67 6174 6865   self.comm.gathe
+000135d0: 7228 6c6f 676c 2c20 726f 6f74 3d30 290a  r(logl, root=0).
+000135e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135f0: 2020 2020 7265 6376 5f6e 6320 3d20 7365      recv_nc = se
+00013600: 6c66 2e63 6f6d 6d2e 6761 7468 6572 286e  lf.comm.gather(n
+00013610: 632c 2072 6f6f 743d 3029 0a20 2020 2020  c, root=0).     
+00013620: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00013630: 6563 765f 7361 6d70 6c65 7320 3d20 7365  ecv_samples = se
+00013640: 6c66 2e63 6f6d 6d2e 6263 6173 7428 7265  lf.comm.bcast(re
+00013650: 6376 5f73 616d 706c 6573 2c20 726f 6f74  cv_samples, root
+00013660: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
+00013670: 2020 2020 2020 2020 7265 6376 5f73 616d          recv_sam
+00013680: 706c 6573 7620 3d20 7365 6c66 2e63 6f6d  plesv = self.com
+00013690: 6d2e 6263 6173 7428 7265 6376 5f73 616d  m.bcast(recv_sam
+000136a0: 706c 6573 762c 2072 6f6f 743d 3029 0a20  plesv, root=0). 
+000136b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136c0: 2020 2072 6563 765f 6c69 6b65 7320 3d20     recv_likes = 
+000136d0: 7365 6c66 2e63 6f6d 6d2e 6263 6173 7428  self.comm.bcast(
+000136e0: 7265 6376 5f6c 696b 6573 2c20 726f 6f74  recv_likes, root
+000136f0: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
+00013700: 2020 2020 2020 2020 7265 6376 5f6e 6320          recv_nc 
+00013710: 3d20 7365 6c66 2e63 6f6d 6d2e 6263 6173  = self.comm.bcas
+00013720: 7428 7265 6376 5f6e 632c 2072 6f6f 743d  t(recv_nc, root=
+00013730: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+00013740: 2020 2020 2020 2073 656c 662e 7361 6d70         self.samp
+00013750: 6c65 7320 3d20 6e70 2e63 6f6e 6361 7465  les = np.concate
+00013760: 6e61 7465 2872 6563 765f 7361 6d70 6c65  nate(recv_sample
+00013770: 732c 2061 7869 733d 3029 0a20 2020 2020  s, axis=0).     
+00013780: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00013790: 656c 662e 7361 6d70 6c65 7376 203d 206e  elf.samplesv = n
+000137a0: 702e 636f 6e63 6174 656e 6174 6528 7265  p.concatenate(re
+000137b0: 6376 5f73 616d 706c 6573 762c 2061 7869  cv_samplesv, axi
+000137c0: 733d 3029 0a20 2020 2020 2020 2020 2020  s=0).           
+000137d0: 2020 2020 2020 2020 2073 656c 662e 6c69           self.li
+000137e0: 6b65 7320 3d20 6e70 2e63 6f6e 6361 7465  kes = np.concate
+000137f0: 6e61 7465 2872 6563 765f 6c69 6b65 732c  nate(recv_likes,
+00013800: 2061 7869 733d 3029 0a20 2020 2020 2020   axis=0).       
+00013810: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00013820: 662e 6e63 616c 6c20 2b3d 2073 756d 2872  f.ncall += sum(r
+00013830: 6563 765f 6e63 290a 2020 2020 2020 2020  ecv_nc).        
+00013840: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
 00013850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013860: 2020 7365 6c66 2e73 616d 706c 6573 7620    self.samplesv 
-00013870: 3d20 760a 2020 2020 2020 2020 2020 2020  = v.            
-00013880: 2020 2020 2020 2020 7365 6c66 2e6c 696b          self.lik
-00013890: 6573 203d 206c 6f67 6c0a 2020 2020 2020  es = logl.      
-000138a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000138b0: 6c66 2e6e 6361 6c6c 202b 3d20 6e63 0a0a  lf.ncall += nc..
+00013860: 2020 7365 6c66 2e73 616d 706c 6573 203d    self.samples =
+00013870: 2075 0a20 2020 2020 2020 2020 2020 2020   u.             
+00013880: 2020 2020 2020 2073 656c 662e 7361 6d70         self.samp
+00013890: 6c65 7376 203d 2076 0a20 2020 2020 2020  lesv = v.       
+000138a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000138b0: 662e 6c69 6b65 7320 3d20 6c6f 676c 0a20  f.likes = logl. 
 000138c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138d0: 6966 2073 656c 662e 6c6f 673a 0a20 2020  if self.log:.   
-000138e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138f0: 2066 6f72 2075 692c 2076 692c 206c 6f67   for ui, vi, log
-00013900: 6c69 2069 6e20 7a69 7028 7365 6c66 2e73  li in zip(self.s
-00013910: 616d 706c 6573 2c20 7365 6c66 2e73 616d  amples, self.sam
-00013920: 706c 6573 762c 2073 656c 662e 6c69 6b65  plesv, self.like
-00013930: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00013940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013950: 2e70 6f69 6e74 7374 6f72 652e 6164 6428  .pointstore.add(
-00013960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013970: 2020 2020 2020 2020 2020 2020 205f 6c69               _li
-00013980: 7374 6966 7928 5b4c 6d69 6e2c 206c 6f67  stify([Lmin, log
-00013990: 6c69 2c20 7175 616c 6974 795d 2c20 7569  li, quality], ui
-000139a0: 2c20 7669 292c 0a20 2020 2020 2020 2020  , vi),.         
-000139b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139c0: 2020 2073 656c 662e 6e63 616c 6c29 0a0a     self.ncall)..
-000139d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000139e0: 656c 662e 6c69 6b65 735b 6962 5d20 3e20  elf.likes[ib] > 
-000139f0: 4c6d 696e 3a0a 2020 2020 2020 2020 2020  Lmin:.          
-00013a00: 2020 2020 2020 7520 3d20 7365 6c66 2e73        u = self.s
-00013a10: 616d 706c 6573 5b69 622c 203a 5d0a 2020  amples[ib, :].  
-00013a20: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00013a30: 7365 7274 206e 702e 6c6f 6769 6361 6c5f  sert np.logical_
-00013a40: 616e 6428 7520 3e20 302c 2075 203c 2031  and(u > 0, u < 1
-00013a50: 292e 616c 6c28 292c 2028 7529 0a20 2020  ).all(), (u).   
-00013a60: 2020 2020 2020 2020 2020 2020 2070 203d               p =
-00013a70: 2073 656c 662e 7361 6d70 6c65 7376 5b69   self.samplesv[i
-00013a80: 622c 203a 5d0a 2020 2020 2020 2020 2020  b, :].          
-00013a90: 2020 2020 2020 6c6f 676c 203d 2073 656c        logl = sel
-00013aa0: 662e 6c69 6b65 735b 6962 5d0a 0a20 2020  f.likes[ib]..   
-00013ab0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00013ac0: 662e 6962 203d 2069 6220 2b20 310a 2020  f.ib = ib + 1.  
-00013ad0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013ae0: 7475 726e 2075 2c20 702c 206c 6f67 6c0a  turn u, p, logl.
-00013af0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00013b00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013b10: 2020 7365 6c66 2e69 6220 3d20 6962 202b    self.ib = ib +
-00013b20: 2031 0a0a 2020 2020 6465 6620 5f75 7064   1..    def _upd
-00013b30: 6174 655f 7265 6769 6f6e 280a 2020 2020  ate_region(.    
-00013b40: 2020 2020 7365 6c66 2c20 6163 7469 7665      self, active
-00013b50: 5f75 2c20 6163 7469 7665 5f6e 6f64 655f  _u, active_node_
-00013b60: 6964 732c 0a20 2020 2020 2020 2062 6f6f  ids,.        boo
-00013b70: 7473 7472 6170 5f72 6f6f 7469 6473 3d4e  tstrap_rootids=N
-00013b80: 6f6e 652c 2061 6374 6976 655f 726f 6f74  one, active_root
-00013b90: 6964 733d 4e6f 6e65 2c0a 2020 2020 2020  ids=None,.      
-00013ba0: 2020 6e62 6f6f 7473 7472 6170 733d 3330    nbootstraps=30
-00013bb0: 2c20 6d69 6e76 6f6c 3d30 2e2c 2061 6374  , minvol=0., act
-00013bc0: 6976 655f 703d 4e6f 6e65 0a20 2020 2029  ive_p=None.    )
-00013bd0: 3a0a 2020 2020 2020 2020 2222 2242 7569  :.        """Bui
-00013be0: 6c64 2061 206e 6577 204d 4c46 7269 656e  ld a new MLFrien
-00013bf0: 6473 2072 6567 696f 6e20 6672 6f6d 2060  ds region from `
-00013c00: 6163 7469 7665 5f75 602c 2061 6e64 2077  active_u`, and w
-00013c10: 7261 7070 696e 6720 656c 6c69 7073 6f69  rapping ellipsoi
-00013c20: 642e 0a0a 2020 2020 2020 2020 426f 7468  d...        Both
-00013c30: 2061 7265 2073 6166 656c 7920 6275 696c   are safely buil
-00013c40: 7420 7573 696e 6720 626f 6f74 7374 7261  t using bootstra
-00013c50: 7070 696e 672c 2073 6f20 7468 6174 2074  pping, so that t
-00013c60: 6865 0a20 2020 2020 2020 2072 6567 696f  he.        regio
-00013c70: 6e20 6361 6e20 6265 2075 7365 6420 666f  n can be used fo
-00013c80: 7220 7361 6d70 6c69 6e67 2061 6e64 2072  r sampling and r
-00013c90: 656a 6563 7469 6e67 2070 6f69 6e74 732e  ejecting points.
-00013ca0: 0a20 2020 2020 2020 2049 6620 4d50 4920  .        If MPI 
-00013cb0: 6973 2065 6e61 626c 6564 2c20 7468 6973  is enabled, this
-00013cc0: 2063 6f6d 7075 7461 7469 6f6e 2069 7320   computation is 
-00013cd0: 7061 7261 6c6c 656c 6973 6564 2e0a 0a20  parallelised... 
-00013ce0: 2020 2020 2020 2049 6620 6163 7469 7665         If active
-00013cf0: 5f70 2069 7320 6e6f 7420 4e6f 6e65 2c20  _p is not None, 
-00013d00: 6120 7772 6170 7069 6e67 2065 6c6c 6970  a wrapping ellip
-00013d10: 736f 6964 2069 7320 6275 696c 7420 616c  soid is built al
-00013d20: 736f 0a20 2020 2020 2020 2069 6e20 7468  so.        in th
-00013d30: 6520 7573 6572 2d74 7261 6e73 666f 726d  e user-transform
-00013d40: 6564 2070 6172 616d 6574 6572 2073 7061  ed parameter spa
-00013d50: 6365 2e0a 0a20 2020 2020 2020 2050 6172  ce...        Par
-00013d60: 616d 6574 6572 730a 2020 2020 2020 2020  ameters.        
-00013d70: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020  -----------.    
-00013d80: 2020 2020 6163 7469 7665 5f75 3a20 6172      active_u: ar
-00013d90: 7261 7920 6f66 2066 6c6f 6174 730a 2020  ray of floats.  
-00013da0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-00013db0: 7420 6c69 7665 2070 6f69 6e74 730a 2020  t live points.  
-00013dc0: 2020 2020 2020 6163 7469 7665 5f6e 6f64        active_nod
-00013dd0: 655f 6964 733a 2032 6420 6172 7261 7920  e_ids: 2d array 
-00013de0: 6f66 2069 6e74 730a 2020 2020 2020 2020  of ints.        
-00013df0: 2020 2020 7768 6963 6820 626f 6f74 7374      which bootst
-00013e00: 7261 7020 696e 6974 6961 6c69 7361 7469  rap initialisati
-00013e10: 6f6e 2074 6865 2070 6f69 6e74 7320 6265  on the points be
-00013e20: 6c6f 6e67 2074 6f2e 0a20 2020 2020 2020  long to..       
-00013e30: 2061 6374 6976 655f 726f 6f74 6964 733a   active_rootids:
-00013e40: 2032 6420 6172 7261 7920 6f66 2069 6e74   2d array of int
-00013e50: 730a 2020 2020 2020 2020 2020 2020 726f  s.            ro
-00013e60: 6f74 7320 6163 7469 7665 2069 6e20 6561  ots active in ea
-00013e70: 6368 2062 6f6f 7473 7472 6170 2069 6e69  ch bootstrap ini
-00013e80: 7469 616c 6973 6174 696f 6e0a 2020 2020  tialisation.    
-00013e90: 2020 2020 626f 6f74 7374 7261 705f 726f      bootstrap_ro
-00013ea0: 6f74 6964 733a 2061 7272 6179 206f 6620  otids: array of 
-00013eb0: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
-00013ec0: 2062 6f6f 7473 7472 6170 2073 616d 706c   bootstrap sampl
-00013ed0: 6573 2e20 6966 204e 6f6e 652c 2074 6865  es. if None, the
-00013ee0: 7920 6172 6520 6472 6177 6e20 6672 6573  y are drawn fres
-00013ef0: 682e 0a20 2020 2020 2020 206e 626f 6f74  h..        nboot
-00013f00: 7374 7261 7073 3a20 696e 740a 2020 2020  straps: int.    
-00013f10: 2020 2020 2020 2020 6e75 6d62 6572 206f          number o
-00013f20: 6620 626f 6f74 7374 7261 7020 726f 756e  f bootstrap roun
-00013f30: 6473 0a20 2020 2020 2020 2061 6374 6976  ds.        activ
-00013f40: 655f 703a 2061 7272 6179 206f 6620 666c  e_p: array of fl
-00013f50: 6f61 7473 0a20 2020 2020 2020 2020 2020  oats.           
-00013f60: 2063 7572 7265 6e74 206c 6976 6520 706f   current live po
-00013f70: 696e 7473 2c20 696e 2075 7365 722d 7472  ints, in user-tr
-00013f80: 616e 7366 6f72 6d65 6420 7370 6163 650a  ansformed space.
-00013f90: 2020 2020 2020 2020 6d69 6e76 6f6c 3a20          minvol: 
-00013fa0: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
-00013fb0: 2020 6578 7065 6374 6564 2063 7572 7265    expected curre
-00013fc0: 6e74 206d 696e 696d 756d 2076 6f6c 756d  nt minimum volum
-00013fd0: 6520 6f66 2072 6567 696f 6e2e 0a0a 2020  e of region...  
-00013fe0: 2020 2020 2020 5265 7475 726e 730a 2020        Returns.  
-00013ff0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-00014000: 2020 2020 2020 2075 7064 6174 6564 3a20         updated: 
-00014010: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
-00014020: 2054 7275 6520 6966 2075 7064 6174 6520   True if update 
-00014030: 7761 7320 6d61 6465 2c20 4661 6c73 6520  was made, False 
-00014040: 6966 2070 7265 7669 6f75 7320 7265 6769  if previous regi
-00014050: 6f6e 2072 656d 6169 6e65 642e 0a0a 2020  on remained...  
-00014060: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00014070: 2020 6173 7365 7274 206e 626f 6f74 7374    assert nbootst
-00014080: 7261 7073 203e 2030 0a20 2020 2020 2020  raps > 0.       
-00014090: 2075 7064 6174 6564 203d 2046 616c 7365   updated = False
-000140a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000140b0: 2e72 6567 696f 6e20 6973 204e 6f6e 653a  .region is None:
-000140c0: 0a20 2020 2020 2020 2020 2020 2023 2069  .            # i
-000140d0: 6620 7365 6c66 2e6c 6f67 3a0a 2020 2020  f self.log:.    
-000140e0: 2020 2020 2020 2020 2320 2020 2073 656c          #    sel
-000140f0: 662e 6c6f 6767 6572 2e64 6562 7567 2822  f.logger.debug("
-00014100: 6275 696c 6469 6e67 2066 6972 7374 2072  building first r
-00014110: 6567 696f 6e20 2e2e 2e22 290a 2020 2020  egion ...").    
-00014120: 2020 2020 2020 2020 7365 6c66 2e74 7261          self.tra
-00014130: 6e73 666f 726d 4c61 7965 7220 3d20 7365  nsformLayer = se
-00014140: 6c66 2e74 7261 6e73 666f 726d 5f6c 6179  lf.transform_lay
-00014150: 6572 5f63 6c61 7373 2877 7261 7070 6564  er_class(wrapped
-00014160: 5f64 696d 733d 7365 6c66 2e77 7261 7070  _dims=self.wrapp
-00014170: 6564 5f61 7865 7329 0a20 2020 2020 2020  ed_axes).       
-00014180: 2020 2020 2073 656c 662e 7472 616e 7366       self.transf
-00014190: 6f72 6d4c 6179 6572 2e6f 7074 696d 697a  ormLayer.optimiz
-000141a0: 6528 6163 7469 7665 5f75 2c20 6163 7469  e(active_u, acti
-000141b0: 7665 5f75 2c20 6d69 6e76 6f6c 3d6d 696e  ve_u, minvol=min
-000141c0: 766f 6c29 0a20 2020 2020 2020 2020 2020  vol).           
-000141d0: 2073 656c 662e 7265 6769 6f6e 203d 2073   self.region = s
-000141e0: 656c 662e 7265 6769 6f6e 5f63 6c61 7373  elf.region_class
-000141f0: 2861 6374 6976 655f 752c 2073 656c 662e  (active_u, self.
-00014200: 7472 616e 7366 6f72 6d4c 6179 6572 290a  transformLayer).
-00014210: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00014220: 2e72 6567 696f 6e5f 6e6f 6465 7320 3d20  .region_nodes = 
-00014230: 6163 7469 7665 5f6e 6f64 655f 6964 732e  active_node_ids.
-00014240: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-00014250: 2020 2061 7373 6572 7420 7365 6c66 2e72     assert self.r
-00014260: 6567 696f 6e2e 6d61 7872 6164 6975 7373  egion.maxradiuss
-00014270: 7120 6973 204e 6f6e 650a 0a20 2020 2020  q is None..     
-00014280: 2020 2020 2020 205f 7570 6461 7465 5f72         _update_r
-00014290: 6567 696f 6e5f 626f 6f74 7374 7261 7028  egion_bootstrap(
-000142a0: 7365 6c66 2e72 6567 696f 6e2c 206e 626f  self.region, nbo
-000142b0: 6f74 7374 7261 7073 2c20 6d69 6e76 6f6c  otstraps, minvol
-000142c0: 2c20 7365 6c66 2e63 6f6d 6d20 6966 2073  , self.comm if s
-000142d0: 656c 662e 7573 655f 6d70 6920 656c 7365  elf.use_mpi else
-000142e0: 204e 6f6e 652c 2073 656c 662e 6d70 695f   None, self.mpi_
-000142f0: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
-00014300: 2020 7365 6c66 2e72 6567 696f 6e2e 6372    self.region.cr
-00014310: 6561 7465 5f65 6c6c 6970 736f 6964 286d  eate_ellipsoid(m
-00014320: 696e 766f 6c3d 6d69 6e76 6f6c 290a 2020  invol=minvol).  
-00014330: 2020 2020 2020 2020 2020 2320 6966 2073            # if s
-00014340: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
-00014350: 2020 2020 2023 2020 2020 2073 656c 662e       #     self.
-00014360: 6c6f 6767 6572 2e64 6562 7567 2822 6275  logger.debug("bu
-00014370: 696c 6469 6e67 2066 6972 7374 2072 6567  ilding first reg
-00014380: 696f 6e20 2e2e 2e20 723d 2565 2c20 663d  ion ... r=%e, f=
-00014390: 2565 2220 2520 2872 2c20 6629 290a 2020  %e" % (r, f)).  
-000143a0: 2020 2020 2020 2020 2020 7570 6461 7465            update
-000143b0: 6420 3d20 5472 7565 0a0a 2020 2020 2020  d = True..      
-000143c0: 2020 2020 2020 2320 7665 7269 6679 2063        # verify c
-000143d0: 6f72 7265 6374 6e65 7373 3a0a 2020 2020  orrectness:.    
-000143e0: 2020 2020 2020 2020 2320 7365 6c66 2e72          # self.r
-000143f0: 6567 696f 6e2e 6372 6561 7465 5f65 6c6c  egion.create_ell
-00014400: 6970 736f 6964 286d 696e 766f 6c3d 6d69  ipsoid(minvol=mi
-00014410: 6e76 6f6c 290a 2020 2020 2020 2020 2020  nvol).          
-00014420: 2020 2320 6173 7365 7274 2073 656c 662e    # assert self.
-00014430: 7265 6769 6f6e 2e69 6e73 6964 6528 6163  region.inside(ac
-00014440: 7469 7665 5f75 292e 616c 6c28 292c 2073  tive_u).all(), s
-00014450: 656c 662e 7265 6769 6f6e 2e69 6e73 6964  elf.region.insid
-00014460: 6528 6163 7469 7665 5f75 292e 6d65 616e  e(active_u).mean
-00014470: 2829 0a0a 2020 2020 2020 2020 6173 7365  ()..        asse
-00014480: 7274 2073 656c 662e 7472 616e 7366 6f72  rt self.transfor
-00014490: 6d4c 6179 6572 2069 7320 6e6f 7420 4e6f  mLayer is not No
-000144a0: 6e65 0a20 2020 2020 2020 206e 6565 645f  ne.        need_
-000144b0: 6163 6365 7074 203d 2046 616c 7365 0a0a  accept = False..
-000144c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000144d0: 7265 6769 6f6e 2e6d 6178 7261 6469 7573  region.maxradius
-000144e0: 7371 2069 7320 4e6f 6e65 3a0a 2020 2020  sq is None:.    
-000144f0: 2020 2020 2020 2020 2320 7765 2068 6176          # we hav
-00014500: 6520 6265 656e 2074 6f6c 6420 7468 6174  e been told that
-00014510: 2072 6164 6975 7320 6973 2063 7572 7265   radius is curre
-00014520: 6e74 6c79 2069 6e76 616c 6964 0a20 2020  ntly invalid.   
-00014530: 2020 2020 2020 2020 2023 2077 6520 6e65           # we ne
-00014540: 6564 2074 6f20 626f 6f74 7374 7261 7020  ed to bootstrap 
-00014550: 6261 636b 2074 6f20 6120 7661 6c69 6420  back to a valid 
-00014560: 7374 6174 650a 0a20 2020 2020 2020 2020  state..         
-00014570: 2020 2023 2063 6f6d 7075 7465 2072 6164     # compute rad
-00014580: 6975 7320 6769 7665 6e20 6375 7272 656e  ius given curren
-00014590: 7420 7472 616e 7366 6f72 6d4c 6179 6572  t transformLayer
-000145a0: 0a20 2020 2020 2020 2020 2020 206f 6c64  .            old
-000145b0: 7520 3d20 7365 6c66 2e72 6567 696f 6e2e  u = self.region.
-000145c0: 750a 2020 2020 2020 2020 2020 2020 7365  u.            se
-000145d0: 6c66 2e72 6567 696f 6e2e 7520 3d20 6163  lf.region.u = ac
-000145e0: 7469 7665 5f75 0a20 2020 2020 2020 2020  tive_u.         
-000145f0: 2020 2073 656c 662e 7265 6769 6f6e 5f6e     self.region_n
-00014600: 6f64 6573 203d 2061 6374 6976 655f 6e6f  odes = active_no
-00014610: 6465 5f69 6473 2e63 6f70 7928 290a 2020  de_ids.copy().  
-00014620: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-00014630: 6567 696f 6e2e 7365 745f 7472 616e 7366  egion.set_transf
-00014640: 6f72 6d4c 6179 6572 2873 656c 662e 7472  ormLayer(self.tr
-00014650: 616e 7366 6f72 6d4c 6179 6572 290a 0a20  ansformLayer).. 
-00014660: 2020 2020 2020 2020 2020 205f 7570 6461             _upda
-00014670: 7465 5f72 6567 696f 6e5f 626f 6f74 7374  te_region_bootst
-00014680: 7261 7028 7365 6c66 2e72 6567 696f 6e2c  rap(self.region,
-00014690: 206e 626f 6f74 7374 7261 7073 2c20 6d69   nbootstraps, mi
-000146a0: 6e76 6f6c 2c20 7365 6c66 2e63 6f6d 6d20  nvol, self.comm 
-000146b0: 6966 2073 656c 662e 7573 655f 6d70 6920  if self.use_mpi 
-000146c0: 656c 7365 204e 6f6e 652c 2073 656c 662e  else None, self.
-000146d0: 6d70 695f 7369 7a65 290a 0a20 2020 2020  mpi_size)..     
-000146e0: 2020 2020 2020 2023 2070 7269 6e74 2822         # print("
-000146f0: 6d61 6465 2066 6972 7374 2072 6567 696f  made first regio
-00014700: 6e2c 2072 3d25 6522 2025 2028 7229 290a  n, r=%e" % (r)).
-00014710: 0a20 2020 2020 2020 2020 2020 2023 206e  .            # n
-00014720: 6f77 2074 6861 7420 7765 2068 6176 6520  ow that we have 
-00014730: 722c 2063 616e 2064 6f20 636c 7573 7465  r, can do cluste
-00014740: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-00014750: 2023 2062 7574 2073 7563 6820 7265 636c   # but such recl
-00014760: 7573 7465 7269 6e67 2077 6f75 6c64 2066  ustering would f
-00014770: 6f72 6765 7420 7468 6520 636c 7573 7465  orget the cluste
-00014780: 7220 6964 730a 0a20 2020 2020 2020 2020  r ids..         
-00014790: 2020 2023 2069 6e73 7465 6164 2c20 7472     # instead, tr
-000147a0: 6163 6b20 7468 6520 636c 7573 7465 7273  ack the clusters
-000147b0: 2066 726f 6d20 6265 666f 7265 2062 7920   from before by 
-000147c0: 6d61 7463 6869 6e67 206d 616e 7561 6c6c  matching manuall
-000147d0: 790a 2020 2020 2020 2020 2020 2020 6f6c  y.            ol
-000147e0: 6474 203d 2073 656c 662e 7472 616e 7366  dt = self.transf
-000147f0: 6f72 6d4c 6179 6572 2e74 7261 6e73 666f  ormLayer.transfo
-00014800: 726d 286f 6c64 7529 0a20 2020 2020 2020  rm(oldu).       
-00014810: 2020 2020 2063 6c75 7374 6572 6964 7320       clusterids 
-00014820: 3d20 6e70 2e7a 6572 6f73 286c 656e 2861  = np.zeros(len(a
-00014830: 6374 6976 655f 7529 2c20 6474 7970 653d  ctive_u), dtype=
-00014840: 696e 7429 0a20 2020 2020 2020 2020 2020  int).           
-00014850: 206e 6e65 6172 6279 203d 206e 702e 656d   nnearby = np.em
-00014860: 7074 7928 6c65 6e28 7365 6c66 2e72 6567  pty(len(self.reg
-00014870: 696f 6e2e 756e 6f72 6d65 6429 2c20 6474  ion.unormed), dt
-00014880: 7970 653d 696e 7429 0a20 2020 2020 2020  ype=int).       
-00014890: 2020 2020 2066 6f72 2063 6920 696e 206e       for ci in n
-000148a0: 702e 756e 6971 7565 2873 656c 662e 7472  p.unique(self.tr
-000148b0: 616e 7366 6f72 6d4c 6179 6572 2e63 6c75  ansformLayer.clu
-000148c0: 7374 6572 6964 7329 3a0a 2020 2020 2020  sterids):.      
-000148d0: 2020 2020 2020 2020 2020 6966 2063 6920            if ci 
-000148e0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-000148f0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00014900: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
-00014910: 2020 2020 2320 6669 6e64 2070 6f69 6e74      # find point
-00014920: 7320 6672 6f6d 2074 6861 7420 636c 7573  s from that clus
-00014930: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
-00014940: 2020 2020 6f6c 6474 6920 3d20 6f6c 6474      oldti = oldt
-00014950: 5b73 656c 662e 7472 616e 7366 6f72 6d4c  [self.transformL
-00014960: 6179 6572 2e63 6c75 7374 6572 6964 7320  ayer.clusterids 
-00014970: 3d3d 2063 695d 0a20 2020 2020 2020 2020  == ci].         
-00014980: 2020 2020 2020 2023 2069 6465 6e74 6966         # identif
-00014990: 7920 7768 6963 6820 6e65 7720 706f 696e  y which new poin
-000149a0: 7473 2061 7265 206e 6561 7220 7468 6973  ts are near this
-000149b0: 2063 6c75 7374 6572 0a20 2020 2020 2020   cluster.       
-000149c0: 2020 2020 2020 2020 2066 696e 645f 6e65           find_ne
-000149d0: 6172 6279 286f 6c64 7469 2c20 7365 6c66  arby(oldti, self
-000149e0: 2e72 6567 696f 6e2e 756e 6f72 6d65 642c  .region.unormed,
-000149f0: 2073 656c 662e 7265 6769 6f6e 2e6d 6178   self.region.max
-00014a00: 7261 6469 7573 7371 2c20 6e6e 6561 7262  radiussq, nnearb
-00014a10: 7929 0a20 2020 2020 2020 2020 2020 2020  y).             
-00014a20: 2020 206d 6173 6b20 3d20 6e6e 6561 7262     mask = nnearb
-00014a30: 7920 213d 2030 0a20 2020 2020 2020 2020  y != 0.         
-00014a40: 2020 2020 2020 2023 2061 7373 6967 6e20         # assign 
-00014a50: 7468 6520 6e65 6172 6279 206f 6e65 7320  the nearby ones 
-00014a60: 746f 2074 6869 7320 636c 7573 7465 720a  to this cluster.
-00014a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a80: 2320 6966 2074 6865 7920 6861 7665 206e  # if they have n
-00014a90: 6f74 2062 6565 6e20 7365 7420 7965 740a  ot been set yet.
-00014aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ab0: 2320 6966 2074 6865 7920 6861 7665 2c20  # if they have, 
-00014ac0: 7365 7420 7468 656d 2074 6f20 2d31 0a20  set them to -1. 
-00014ad0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00014ae0: 6c75 7374 6572 6964 735b 6d61 736b 5d20  lusterids[mask] 
-00014af0: 3d20 6e70 2e77 6865 7265 2863 6c75 7374  = np.where(clust
-00014b00: 6572 6964 735b 6d61 736b 5d20 3d3d 2030  erids[mask] == 0
-00014b10: 2c20 6369 2c20 2d31 290a 0a20 2020 2020  , ci, -1)..     
-00014b20: 2020 2020 2020 2023 2063 6c75 7374 6572         # cluster
-00014b30: 7320 7765 2061 7265 2075 6e73 7572 6520  s we are unsure 
-00014b40: 6162 6f75 7420 2864 6f75 626c 6520 6173  about (double as
-00014b50: 7369 676e 6d65 6e74 7329 2067 6f20 756e  signments) go un
-00014b60: 6173 7369 676e 6564 0a20 2020 2020 2020  assigned.       
-00014b70: 2020 2020 2063 6c75 7374 6572 6964 735b       clusterids[
-00014b80: 636c 7573 7465 7269 6473 203d 3d20 2d31  clusterids == -1
-00014b90: 5d20 3d20 300a 0a20 2020 2020 2020 2020  ] = 0..         
-00014ba0: 2020 2023 2074 656c 6c20 7363 616c 696e     # tell scalin
-00014bb0: 6720 6c61 7965 7220 7468 6520 636f 7272  g layer the corr
-00014bc0: 6563 7420 636c 7573 7465 7220 696e 666f  ect cluster info
-00014bd0: 726d 6174 696f 6e0a 2020 2020 2020 2020  rmation.        
-00014be0: 2020 2020 7365 6c66 2e74 7261 6e73 666f      self.transfo
-00014bf0: 726d 4c61 7965 722e 636c 7573 7465 7269  rmLayer.clusteri
-00014c00: 6473 203d 2063 6c75 7374 6572 6964 730a  ds = clusterids.
-00014c10: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
-00014c20: 6520 7761 6e74 2074 6865 2063 6c75 7374  e want the clust
-00014c30: 6572 696e 6720 746f 2072 6570 6561 7420  ering to repeat 
-00014c40: 746f 2072 656d 6f76 6520 7265 6d61 696e  to remove remain
-00014c50: 696e 6720 7a65 726f 730a 2020 2020 2020  ing zeros.      
-00014c60: 2020 2020 2020 6e65 6564 5f61 6363 6570        need_accep
-00014c70: 7420 3d20 2873 656c 662e 7472 616e 7366  t = (self.transf
-00014c80: 6f72 6d4c 6179 6572 2e63 6c75 7374 6572  ormLayer.cluster
-00014c90: 6964 7320 3d3d 2030 292e 616e 7928 290a  ids == 0).any().
-00014ca0: 0a20 2020 2020 2020 2020 2020 2075 7064  .            upd
-00014cb0: 6174 6564 203d 2054 7275 650a 2020 2020  ated = True.    
-00014cc0: 2020 2020 2020 2020 6173 7365 7274 206c          assert l
-00014cd0: 656e 2873 656c 662e 7265 6769 6f6e 2e75  en(self.region.u
-00014ce0: 2920 3d3d 206c 656e 2873 656c 662e 7472  ) == len(self.tr
-00014cf0: 616e 7366 6f72 6d4c 6179 6572 2e63 6c75  ansformLayer.clu
-00014d00: 7374 6572 6964 7329 0a0a 2020 2020 2020  sterids)..      
-00014d10: 2020 2020 2020 2320 7665 7269 6679 2063        # verify c
-00014d20: 6f72 7265 6374 6e65 7373 3a0a 2020 2020  orrectness:.    
-00014d30: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
-00014d40: 696f 6e2e 6372 6561 7465 5f65 6c6c 6970  ion.create_ellip
-00014d50: 736f 6964 286d 696e 766f 6c3d 6d69 6e76  soid(minvol=minv
-00014d60: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
-00014d70: 2320 6173 7365 7274 2073 656c 662e 7265  # assert self.re
-00014d80: 6769 6f6e 2e69 6e73 6964 6528 6163 7469  gion.inside(acti
-00014d90: 7665 5f75 292e 616c 6c28 292c 2073 656c  ve_u).all(), sel
-00014da0: 662e 7265 6769 6f6e 2e69 6e73 6964 6528  f.region.inside(
-00014db0: 6163 7469 7665 5f75 292e 6d65 616e 2829  active_u).mean()
-00014dc0: 0a0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
-00014dd0: 206c 656e 2873 656c 662e 7265 6769 6f6e   len(self.region
-00014de0: 2e75 2920 3d3d 206c 656e 2873 656c 662e  .u) == len(self.
-00014df0: 7472 616e 7366 6f72 6d4c 6179 6572 2e63  transformLayer.c
-00014e00: 6c75 7374 6572 6964 7329 0a20 2020 2020  lusterids).     
-00014e10: 2020 2023 2072 6562 7569 6c64 2073 7061     # rebuild spa
-00014e20: 6365 0a20 2020 2020 2020 2077 6974 6820  ce.        with 
-00014e30: 7761 726e 696e 6773 2e63 6174 6368 5f77  warnings.catch_w
-00014e40: 6172 6e69 6e67 7328 292c 206e 702e 6572  arnings(), np.er
-00014e50: 7273 7461 7465 2861 6c6c 3d27 7261 6973  rstate(all='rais
-00014e60: 6527 293a 0a20 2020 2020 2020 2020 2020  e'):.           
-00014e70: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00014e80: 2020 2020 2020 6e65 7874 5472 616e 7366        nextTransf
-00014e90: 6f72 6d4c 6179 6572 203d 2073 656c 662e  ormLayer = self.
-00014ea0: 7472 616e 7366 6f72 6d4c 6179 6572 2e63  transformLayer.c
-00014eb0: 7265 6174 655f 6e65 7728 6163 7469 7665  reate_new(active
-00014ec0: 5f75 2c20 7365 6c66 2e72 6567 696f 6e2e  _u, self.region.
-00014ed0: 6d61 7872 6164 6975 7373 712c 206d 696e  maxradiussq, min
-00014ee0: 766f 6c3d 6d69 6e76 6f6c 290a 2020 2020  vol=minvol).    
-00014ef0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00014f00: 7274 206e 6f74 2028 6e65 7874 5472 616e  rt not (nextTran
-00014f10: 7366 6f72 6d4c 6179 6572 2e63 6c75 7374  sformLayer.clust
-00014f20: 6572 6964 7320 3d3d 2030 292e 616e 7928  erids == 0).any(
-00014f30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014f40: 2020 5f2c 2063 6c75 7374 6572 5f73 697a    _, cluster_siz
-00014f50: 6573 203d 206e 702e 756e 6971 7565 286e  es = np.unique(n
-00014f60: 6578 7454 7261 6e73 666f 726d 4c61 7965  extTransformLaye
-00014f70: 722e 636c 7573 7465 7269 6473 2c20 7265  r.clusterids, re
-00014f80: 7475 726e 5f63 6f75 6e74 733d 5472 7565  turn_counts=True
-00014f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014fa0: 2020 736d 616c 6c65 7374 5f63 6c75 7374    smallest_clust
-00014fb0: 6572 203d 2063 6c75 7374 6572 5f73 697a  er = cluster_siz
-00014fc0: 6573 2e6d 696e 2829 0a20 2020 2020 2020  es.min().       
-00014fd0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00014fe0: 2e6c 6f67 2061 6e64 2073 6d61 6c6c 6573  .log and smalles
-00014ff0: 745f 636c 7573 7465 7220 3d3d 2031 3a0a  t_cluster == 1:.
-00015000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015010: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
-00015020: 6465 6275 6728 0a20 2020 2020 2020 2020  debug(.         
-00015030: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00015040: 636c 7573 7465 7269 6e67 2066 6f75 6e64  clustering found
-00015050: 2073 6f6d 6520 7374 7261 7920 706f 696e   some stray poin
-00015060: 7473 205b 6e65 6564 5f61 6363 6570 743d  ts [need_accept=
-00015070: 2573 5d20 2573 222c 0a20 2020 2020 2020  %s] %s",.       
-00015080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015090: 206e 6565 645f 6163 6365 7074 2c0a 2020   need_accept,.  
-000150a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150b0: 2020 2020 2020 6e70 2e75 6e69 7175 6528        np.unique(
-000150c0: 6e65 7874 5472 616e 7366 6f72 6d4c 6179  nextTransformLay
-000150d0: 6572 2e63 6c75 7374 6572 6964 732c 2072  er.clusterids, r
-000150e0: 6574 7572 6e5f 636f 756e 7473 3d54 7275  eturn_counts=Tru
-000150f0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00015100: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00015110: 2020 2020 2020 2020 2020 6e65 7874 7265            nextre
-00015120: 6769 6f6e 203d 2073 656c 662e 7265 6769  gion = self.regi
-00015130: 6f6e 5f63 6c61 7373 2861 6374 6976 655f  on_class(active_
-00015140: 752c 206e 6578 7454 7261 6e73 666f 726d  u, nextTransform
-00015150: 4c61 7965 7229 0a20 2020 2020 2020 2020  Layer).         
-00015160: 2020 2020 2020 2061 7373 6572 7420 6e70         assert np
-00015170: 2e69 7366 696e 6974 6528 6e65 7874 7265  .isfinite(nextre
-00015180: 6769 6f6e 2e75 6e6f 726d 6564 292e 616c  gion.unormed).al
-00015190: 6c28 290a 0a20 2020 2020 2020 2020 2020  l()..           
-000151a0: 2020 2020 2069 6620 6e6f 7420 6e65 7874       if not next
-000151b0: 5472 616e 7366 6f72 6d4c 6179 6572 2e6e  TransformLayer.n
-000151c0: 636c 7573 7465 7273 203c 2032 303a 0a20  clusters < 20:. 
-000151d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151e0: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
-000151f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015200: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00015210: 6765 722e 696e 666f 280a 2020 2020 2020  ger.info(.      
+000138d0: 2020 2073 656c 662e 6e63 616c 6c20 2b3d     self.ncall +=
+000138e0: 206e 630a 0a20 2020 2020 2020 2020 2020   nc..           
+000138f0: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
+00013900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013910: 2020 2020 2020 666f 7220 7569 2c20 7669        for ui, vi
+00013920: 2c20 6c6f 676c 6920 696e 207a 6970 2873  , logli in zip(s
+00013930: 656c 662e 7361 6d70 6c65 732c 2073 656c  elf.samples, sel
+00013940: 662e 7361 6d70 6c65 7376 2c20 7365 6c66  f.samplesv, self
+00013950: 2e6c 696b 6573 293a 0a20 2020 2020 2020  .likes):.       
+00013960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013970: 2073 656c 662e 706f 696e 7473 746f 7265   self.pointstore
+00013980: 2e61 6464 280a 2020 2020 2020 2020 2020  .add(.          
+00013990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139a0: 2020 5f6c 6973 7469 6679 285b 4c6d 696e    _listify([Lmin
+000139b0: 2c20 6c6f 676c 692c 2071 7561 6c69 7479  , logli, quality
+000139c0: 5d2c 2075 692c 2076 6929 2c0a 2020 2020  ], ui, vi),.    
+000139d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139e0: 2020 2020 2020 2020 7365 6c66 2e6e 6361          self.nca
+000139f0: 6c6c 290a 0a20 2020 2020 2020 2020 2020  ll)..           
+00013a00: 2069 6620 7365 6c66 2e6c 696b 6573 5b69   if self.likes[i
+00013a10: 625d 203e 204c 6d69 6e3a 0a20 2020 2020  b] > Lmin:.     
+00013a20: 2020 2020 2020 2020 2020 2075 203d 2073             u = s
+00013a30: 656c 662e 7361 6d70 6c65 735b 6962 2c20  elf.samples[ib, 
+00013a40: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+00013a50: 2020 2061 7373 6572 7420 6e70 2e6c 6f67     assert np.log
+00013a60: 6963 616c 5f61 6e64 2875 203e 2030 2c20  ical_and(u > 0, 
+00013a70: 7520 3c20 3129 2e61 6c6c 2829 2c20 2875  u < 1).all(), (u
+00013a80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00013a90: 2020 7020 3d20 7365 6c66 2e73 616d 706c    p = self.sampl
+00013aa0: 6573 765b 6962 2c20 3a5d 0a20 2020 2020  esv[ib, :].     
+00013ab0: 2020 2020 2020 2020 2020 206c 6f67 6c20             logl 
+00013ac0: 3d20 7365 6c66 2e6c 696b 6573 5b69 625d  = self.likes[ib]
+00013ad0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013ae0: 2020 7365 6c66 2e69 6220 3d20 6962 202b    self.ib = ib +
+00013af0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+00013b00: 2020 2072 6574 7572 6e20 752c 2070 2c20     return u, p, 
+00013b10: 6c6f 676c 0a20 2020 2020 2020 2020 2020  logl.           
+00013b20: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00013b30: 2020 2020 2020 2073 656c 662e 6962 203d         self.ib =
+00013b40: 2069 6220 2b20 310a 0a20 2020 2064 6566   ib + 1..    def
+00013b50: 205f 7570 6461 7465 5f72 6567 696f 6e28   _update_region(
+00013b60: 0a20 2020 2020 2020 2073 656c 662c 2061  .        self, a
+00013b70: 6374 6976 655f 752c 2061 6374 6976 655f  ctive_u, active_
+00013b80: 6e6f 6465 5f69 6473 2c0a 2020 2020 2020  node_ids,.      
+00013b90: 2020 626f 6f74 7374 7261 705f 726f 6f74    bootstrap_root
+00013ba0: 6964 733d 4e6f 6e65 2c20 6163 7469 7665  ids=None, active
+00013bb0: 5f72 6f6f 7469 6473 3d4e 6f6e 652c 0a20  _rootids=None,. 
+00013bc0: 2020 2020 2020 206e 626f 6f74 7374 7261         nbootstra
+00013bd0: 7073 3d33 302c 206d 696e 766f 6c3d 302e  ps=30, minvol=0.
+00013be0: 2c20 6163 7469 7665 5f70 3d4e 6f6e 650a  , active_p=None.
+00013bf0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+00013c00: 2222 4275 696c 6420 6120 6e65 7720 4d4c  ""Build a new ML
+00013c10: 4672 6965 6e64 7320 7265 6769 6f6e 2066  Friends region f
+00013c20: 726f 6d20 6061 6374 6976 655f 7560 2c20  rom `active_u`, 
+00013c30: 616e 6420 7772 6170 7069 6e67 2065 6c6c  and wrapping ell
+00013c40: 6970 736f 6964 2e0a 0a20 2020 2020 2020  ipsoid...       
+00013c50: 2042 6f74 6820 6172 6520 7361 6665 6c79   Both are safely
+00013c60: 2062 7569 6c74 2075 7369 6e67 2062 6f6f   built using boo
+00013c70: 7473 7472 6170 7069 6e67 2c20 736f 2074  tstrapping, so t
+00013c80: 6861 7420 7468 650a 2020 2020 2020 2020  hat the.        
+00013c90: 7265 6769 6f6e 2063 616e 2062 6520 7573  region can be us
+00013ca0: 6564 2066 6f72 2073 616d 706c 696e 6720  ed for sampling 
+00013cb0: 616e 6420 7265 6a65 6374 696e 6720 706f  and rejecting po
+00013cc0: 696e 7473 2e0a 2020 2020 2020 2020 4966  ints..        If
+00013cd0: 204d 5049 2069 7320 656e 6162 6c65 642c   MPI is enabled,
+00013ce0: 2074 6869 7320 636f 6d70 7574 6174 696f   this computatio
+00013cf0: 6e20 6973 2070 6172 616c 6c65 6c69 7365  n is parallelise
+00013d00: 642e 0a0a 2020 2020 2020 2020 4966 2061  d...        If a
+00013d10: 6374 6976 655f 7020 6973 206e 6f74 204e  ctive_p is not N
+00013d20: 6f6e 652c 2061 2077 7261 7070 696e 6720  one, a wrapping 
+00013d30: 656c 6c69 7073 6f69 6420 6973 2062 7569  ellipsoid is bui
+00013d40: 6c74 2061 6c73 6f0a 2020 2020 2020 2020  lt also.        
+00013d50: 696e 2074 6865 2075 7365 722d 7472 616e  in the user-tran
+00013d60: 7366 6f72 6d65 6420 7061 7261 6d65 7465  sformed paramete
+00013d70: 7220 7370 6163 652e 0a0a 2020 2020 2020  r space...      
+00013d80: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00013d90: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d2d       -----------
+00013da0: 0a20 2020 2020 2020 2061 6374 6976 655f  .        active_
+00013db0: 753a 2061 7272 6179 206f 6620 666c 6f61  u: array of floa
+00013dc0: 7473 0a20 2020 2020 2020 2020 2020 2063  ts.            c
+00013dd0: 7572 7265 6e74 206c 6976 6520 706f 696e  urrent live poin
+00013de0: 7473 0a20 2020 2020 2020 2061 6374 6976  ts.        activ
+00013df0: 655f 6e6f 6465 5f69 6473 3a20 3264 2061  e_node_ids: 2d a
+00013e00: 7272 6179 206f 6620 696e 7473 0a20 2020  rray of ints.   
+00013e10: 2020 2020 2020 2020 2077 6869 6368 2062           which b
+00013e20: 6f6f 7473 7472 6170 2069 6e69 7469 616c  ootstrap initial
+00013e30: 6973 6174 696f 6e20 7468 6520 706f 696e  isation the poin
+00013e40: 7473 2062 656c 6f6e 6720 746f 2e0a 2020  ts belong to..  
+00013e50: 2020 2020 2020 6163 7469 7665 5f72 6f6f        active_roo
+00013e60: 7469 6473 3a20 3264 2061 7272 6179 206f  tids: 2d array o
+00013e70: 6620 696e 7473 0a20 2020 2020 2020 2020  f ints.         
+00013e80: 2020 2072 6f6f 7473 2061 6374 6976 6520     roots active 
+00013e90: 696e 2065 6163 6820 626f 6f74 7374 7261  in each bootstra
+00013ea0: 7020 696e 6974 6961 6c69 7361 7469 6f6e  p initialisation
+00013eb0: 0a20 2020 2020 2020 2062 6f6f 7473 7472  .        bootstr
+00013ec0: 6170 5f72 6f6f 7469 6473 3a20 6172 7261  ap_rootids: arra
+00013ed0: 7920 6f66 2069 6e74 730a 2020 2020 2020  y of ints.      
+00013ee0: 2020 2020 2020 626f 6f74 7374 7261 7020        bootstrap 
+00013ef0: 7361 6d70 6c65 732e 2069 6620 4e6f 6e65  samples. if None
+00013f00: 2c20 7468 6579 2061 7265 2064 7261 776e  , they are drawn
+00013f10: 2066 7265 7368 2e0a 2020 2020 2020 2020   fresh..        
+00013f20: 6e62 6f6f 7473 7472 6170 733a 2069 6e74  nbootstraps: int
+00013f30: 0a20 2020 2020 2020 2020 2020 206e 756d  .            num
+00013f40: 6265 7220 6f66 2062 6f6f 7473 7472 6170  ber of bootstrap
+00013f50: 2072 6f75 6e64 730a 2020 2020 2020 2020   rounds.        
+00013f60: 6163 7469 7665 5f70 3a20 6172 7261 7920  active_p: array 
+00013f70: 6f66 2066 6c6f 6174 730a 2020 2020 2020  of floats.      
+00013f80: 2020 2020 2020 6375 7272 656e 7420 6c69        current li
+00013f90: 7665 2070 6f69 6e74 732c 2069 6e20 7573  ve points, in us
+00013fa0: 6572 2d74 7261 6e73 666f 726d 6564 2073  er-transformed s
+00013fb0: 7061 6365 0a20 2020 2020 2020 206d 696e  pace.        min
+00013fc0: 766f 6c3a 2066 6c6f 6174 0a20 2020 2020  vol: float.     
+00013fd0: 2020 2020 2020 2065 7870 6563 7465 6420         expected 
+00013fe0: 6375 7272 656e 7420 6d69 6e69 6d75 6d20  current minimum 
+00013ff0: 766f 6c75 6d65 206f 6620 7265 6769 6f6e  volume of region
+00014000: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00014010: 6e73 0a20 2020 2020 2020 202d 2d2d 2d2d  ns.        -----
+00014020: 2d2d 2d0a 2020 2020 2020 2020 7570 6461  ---.        upda
+00014030: 7465 643a 2062 6f6f 6c0a 2020 2020 2020  ted: bool.      
+00014040: 2020 2020 2020 5472 7565 2069 6620 7570        True if up
+00014050: 6461 7465 2077 6173 206d 6164 652c 2046  date was made, F
+00014060: 616c 7365 2069 6620 7072 6576 696f 7573  alse if previous
+00014070: 2072 6567 696f 6e20 7265 6d61 696e 6564   region remained
+00014080: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
+00014090: 2020 2020 2020 2061 7373 6572 7420 6e62         assert nb
+000140a0: 6f6f 7473 7472 6170 7320 3e20 300a 2020  ootstraps > 0.  
+000140b0: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
+000140c0: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+000140d0: 2073 656c 662e 7265 6769 6f6e 2069 7320   self.region is 
+000140e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000140f0: 2020 2320 6966 2073 656c 662e 6c6f 673a    # if self.log:
+00014100: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00014110: 2020 7365 6c66 2e6c 6f67 6765 722e 6465    self.logger.de
+00014120: 6275 6728 2262 7569 6c64 696e 6720 6669  bug("building fi
+00014130: 7273 7420 7265 6769 6f6e 202e 2e2e 2229  rst region ...")
+00014140: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014150: 662e 7472 616e 7366 6f72 6d4c 6179 6572  f.transformLayer
+00014160: 203d 2073 656c 662e 7472 616e 7366 6f72   = self.transfor
+00014170: 6d5f 6c61 7965 725f 636c 6173 7328 7772  m_layer_class(wr
+00014180: 6170 7065 645f 6469 6d73 3d73 656c 662e  apped_dims=self.
+00014190: 7772 6170 7065 645f 6178 6573 290a 2020  wrapped_axes).  
+000141a0: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+000141b0: 7261 6e73 666f 726d 4c61 7965 722e 6f70  ransformLayer.op
+000141c0: 7469 6d69 7a65 2861 6374 6976 655f 752c  timize(active_u,
+000141d0: 2061 6374 6976 655f 752c 206d 696e 766f   active_u, minvo
+000141e0: 6c3d 6d69 6e76 6f6c 290a 2020 2020 2020  l=minvol).      
+000141f0: 2020 2020 2020 7365 6c66 2e72 6567 696f        self.regio
+00014200: 6e20 3d20 7365 6c66 2e72 6567 696f 6e5f  n = self.region_
+00014210: 636c 6173 7328 6163 7469 7665 5f75 2c20  class(active_u, 
+00014220: 7365 6c66 2e74 7261 6e73 666f 726d 4c61  self.transformLa
+00014230: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
+00014240: 2073 656c 662e 7265 6769 6f6e 5f6e 6f64   self.region_nod
+00014250: 6573 203d 2061 6374 6976 655f 6e6f 6465  es = active_node
+00014260: 5f69 6473 2e63 6f70 7928 290a 2020 2020  _ids.copy().    
+00014270: 2020 2020 2020 2020 6173 7365 7274 2073          assert s
+00014280: 656c 662e 7265 6769 6f6e 2e6d 6178 7261  elf.region.maxra
+00014290: 6469 7573 7371 2069 7320 4e6f 6e65 0a0a  diussq is None..
+000142a0: 2020 2020 2020 2020 2020 2020 5f75 7064              _upd
+000142b0: 6174 655f 7265 6769 6f6e 5f62 6f6f 7473  ate_region_boots
+000142c0: 7472 6170 2873 656c 662e 7265 6769 6f6e  trap(self.region
+000142d0: 2c20 6e62 6f6f 7473 7472 6170 732c 206d  , nbootstraps, m
+000142e0: 696e 766f 6c2c 2073 656c 662e 636f 6d6d  invol, self.comm
+000142f0: 2069 6620 7365 6c66 2e75 7365 5f6d 7069   if self.use_mpi
+00014300: 2065 6c73 6520 4e6f 6e65 2c20 7365 6c66   else None, self
+00014310: 2e6d 7069 5f73 697a 6529 0a20 2020 2020  .mpi_size).     
+00014320: 2020 2020 2020 2073 656c 662e 7265 6769         self.regi
+00014330: 6f6e 2e63 7265 6174 655f 656c 6c69 7073  on.create_ellips
+00014340: 6f69 6428 6d69 6e76 6f6c 3d6d 696e 766f  oid(minvol=minvo
+00014350: 6c29 0a20 2020 2020 2020 2020 2020 2023  l).            #
+00014360: 2069 6620 7365 6c66 2e6c 6f67 3a0a 2020   if self.log:.  
+00014370: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+00014380: 7365 6c66 2e6c 6f67 6765 722e 6465 6275  self.logger.debu
+00014390: 6728 2262 7569 6c64 696e 6720 6669 7273  g("building firs
+000143a0: 7420 7265 6769 6f6e 202e 2e2e 2072 3d25  t region ... r=%
+000143b0: 652c 2066 3d25 6522 2025 2028 722c 2066  e, f=%e" % (r, f
+000143c0: 2929 0a20 2020 2020 2020 2020 2020 2075  )).            u
+000143d0: 7064 6174 6564 203d 2054 7275 650a 0a20  pdated = True.. 
+000143e0: 2020 2020 2020 2020 2020 2023 2076 6572             # ver
+000143f0: 6966 7920 636f 7272 6563 746e 6573 733a  ify correctness:
+00014400: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+00014410: 656c 662e 7265 6769 6f6e 2e63 7265 6174  elf.region.creat
+00014420: 655f 656c 6c69 7073 6f69 6428 6d69 6e76  e_ellipsoid(minv
+00014430: 6f6c 3d6d 696e 766f 6c29 0a20 2020 2020  ol=minvol).     
+00014440: 2020 2020 2020 2023 2061 7373 6572 7420         # assert 
+00014450: 7365 6c66 2e72 6567 696f 6e2e 696e 7369  self.region.insi
+00014460: 6465 2861 6374 6976 655f 7529 2e61 6c6c  de(active_u).all
+00014470: 2829 2c20 7365 6c66 2e72 6567 696f 6e2e  (), self.region.
+00014480: 696e 7369 6465 2861 6374 6976 655f 7529  inside(active_u)
+00014490: 2e6d 6561 6e28 290a 0a20 2020 2020 2020  .mean()..       
+000144a0: 2061 7373 6572 7420 7365 6c66 2e74 7261   assert self.tra
+000144b0: 6e73 666f 726d 4c61 7965 7220 6973 206e  nsformLayer is n
+000144c0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+000144d0: 6e65 6564 5f61 6363 6570 7420 3d20 4661  need_accept = Fa
+000144e0: 6c73 650a 0a20 2020 2020 2020 2069 6620  lse..        if 
+000144f0: 7365 6c66 2e72 6567 696f 6e2e 6d61 7872  self.region.maxr
+00014500: 6164 6975 7373 7120 6973 204e 6f6e 653a  adiussq is None:
+00014510: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
+00014520: 6520 6861 7665 2062 6565 6e20 746f 6c64  e have been told
+00014530: 2074 6861 7420 7261 6469 7573 2069 7320   that radius is 
+00014540: 6375 7272 656e 746c 7920 696e 7661 6c69  currently invali
+00014550: 640a 2020 2020 2020 2020 2020 2020 2320  d.            # 
+00014560: 7765 206e 6565 6420 746f 2062 6f6f 7473  we need to boots
+00014570: 7472 6170 2062 6163 6b20 746f 2061 2076  trap back to a v
+00014580: 616c 6964 2073 7461 7465 0a0a 2020 2020  alid state..    
+00014590: 2020 2020 2020 2020 2320 636f 6d70 7574          # comput
+000145a0: 6520 7261 6469 7573 2067 6976 656e 2063  e radius given c
+000145b0: 7572 7265 6e74 2074 7261 6e73 666f 726d  urrent transform
+000145c0: 4c61 7965 720a 2020 2020 2020 2020 2020  Layer.          
+000145d0: 2020 6f6c 6475 203d 2073 656c 662e 7265    oldu = self.re
+000145e0: 6769 6f6e 2e75 0a20 2020 2020 2020 2020  gion.u.         
+000145f0: 2020 2073 656c 662e 7265 6769 6f6e 2e75     self.region.u
+00014600: 203d 2061 6374 6976 655f 750a 2020 2020   = active_u.    
+00014610: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+00014620: 696f 6e5f 6e6f 6465 7320 3d20 6163 7469  ion_nodes = acti
+00014630: 7665 5f6e 6f64 655f 6964 732e 636f 7079  ve_node_ids.copy
+00014640: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
+00014650: 656c 662e 7265 6769 6f6e 2e73 6574 5f74  elf.region.set_t
+00014660: 7261 6e73 666f 726d 4c61 7965 7228 7365  ransformLayer(se
+00014670: 6c66 2e74 7261 6e73 666f 726d 4c61 7965  lf.transformLaye
+00014680: 7229 0a0a 2020 2020 2020 2020 2020 2020  r)..            
+00014690: 5f75 7064 6174 655f 7265 6769 6f6e 5f62  _update_region_b
+000146a0: 6f6f 7473 7472 6170 2873 656c 662e 7265  ootstrap(self.re
+000146b0: 6769 6f6e 2c20 6e62 6f6f 7473 7472 6170  gion, nbootstrap
+000146c0: 732c 206d 696e 766f 6c2c 2073 656c 662e  s, minvol, self.
+000146d0: 636f 6d6d 2069 6620 7365 6c66 2e75 7365  comm if self.use
+000146e0: 5f6d 7069 2065 6c73 6520 4e6f 6e65 2c20  _mpi else None, 
+000146f0: 7365 6c66 2e6d 7069 5f73 697a 6529 0a0a  self.mpi_size)..
+00014700: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+00014710: 696e 7428 226d 6164 6520 6669 7273 7420  int("made first 
+00014720: 7265 6769 6f6e 2c20 723d 2565 2220 2520  region, r=%e" % 
+00014730: 2872 2929 0a0a 2020 2020 2020 2020 2020  (r))..          
+00014740: 2020 2320 6e6f 7720 7468 6174 2077 6520    # now that we 
+00014750: 6861 7665 2072 2c20 6361 6e20 646f 2063  have r, can do c
+00014760: 6c75 7374 6572 696e 670a 2020 2020 2020  lustering.      
+00014770: 2020 2020 2020 2320 6275 7420 7375 6368        # but such
+00014780: 2072 6563 6c75 7374 6572 696e 6720 776f   reclustering wo
+00014790: 756c 6420 666f 7267 6574 2074 6865 2063  uld forget the c
+000147a0: 6c75 7374 6572 2069 6473 0a0a 2020 2020  luster ids..    
+000147b0: 2020 2020 2020 2020 2320 696e 7374 6561          # instea
+000147c0: 642c 2074 7261 636b 2074 6865 2063 6c75  d, track the clu
+000147d0: 7374 6572 7320 6672 6f6d 2062 6566 6f72  sters from befor
+000147e0: 6520 6279 206d 6174 6368 696e 6720 6d61  e by matching ma
+000147f0: 6e75 616c 6c79 0a20 2020 2020 2020 2020  nually.         
+00014800: 2020 206f 6c64 7420 3d20 7365 6c66 2e74     oldt = self.t
+00014810: 7261 6e73 666f 726d 4c61 7965 722e 7472  ransformLayer.tr
+00014820: 616e 7366 6f72 6d28 6f6c 6475 290a 2020  ansform(oldu).  
+00014830: 2020 2020 2020 2020 2020 636c 7573 7465            cluste
+00014840: 7269 6473 203d 206e 702e 7a65 726f 7328  rids = np.zeros(
+00014850: 6c65 6e28 6163 7469 7665 5f75 292c 2064  len(active_u), d
+00014860: 7479 7065 3d69 6e74 5f74 290a 2020 2020  type=int_t).    
+00014870: 2020 2020 2020 2020 6e6e 6561 7262 7920          nnearby 
+00014880: 3d20 6e70 2e65 6d70 7479 286c 656e 2873  = np.empty(len(s
+00014890: 656c 662e 7265 6769 6f6e 2e75 6e6f 726d  elf.region.unorm
+000148a0: 6564 292c 2064 7479 7065 3d69 6e74 5f74  ed), dtype=int_t
+000148b0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+000148c0: 7220 6369 2069 6e20 6e70 2e75 6e69 7175  r ci in np.uniqu
+000148d0: 6528 7365 6c66 2e74 7261 6e73 666f 726d  e(self.transform
+000148e0: 4c61 7965 722e 636c 7573 7465 7269 6473  Layer.clusterids
+000148f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00014900: 2020 2069 6620 6369 203d 3d20 303a 0a20     if ci == 0:. 
+00014910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014920: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+00014930: 2020 2020 2020 2020 2020 2020 2023 2066               # f
+00014940: 696e 6420 706f 696e 7473 2066 726f 6d20  ind points from 
+00014950: 7468 6174 2063 6c75 7374 6572 0a20 2020  that cluster.   
+00014960: 2020 2020 2020 2020 2020 2020 206f 6c64               old
+00014970: 7469 203d 206f 6c64 745b 7365 6c66 2e74  ti = oldt[self.t
+00014980: 7261 6e73 666f 726d 4c61 7965 722e 636c  ransformLayer.cl
+00014990: 7573 7465 7269 6473 203d 3d20 6369 5d0a  usterids == ci].
+000149a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149b0: 2320 6964 656e 7469 6679 2077 6869 6368  # identify which
+000149c0: 206e 6577 2070 6f69 6e74 7320 6172 6520   new points are 
+000149d0: 6e65 6172 2074 6869 7320 636c 7573 7465  near this cluste
+000149e0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+000149f0: 2020 6669 6e64 5f6e 6561 7262 7928 6f6c    find_nearby(ol
+00014a00: 6474 692c 2073 656c 662e 7265 6769 6f6e  dti, self.region
+00014a10: 2e75 6e6f 726d 6564 2c20 7365 6c66 2e72  .unormed, self.r
+00014a20: 6567 696f 6e2e 6d61 7872 6164 6975 7373  egion.maxradiuss
+00014a30: 712c 206e 6e65 6172 6279 290a 2020 2020  q, nnearby).    
+00014a40: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00014a50: 203d 206e 6e65 6172 6279 2021 3d20 300a   = nnearby != 0.
+00014a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a70: 2320 6173 7369 676e 2074 6865 206e 6561  # assign the nea
+00014a80: 7262 7920 6f6e 6573 2074 6f20 7468 6973  rby ones to this
+00014a90: 2063 6c75 7374 6572 0a20 2020 2020 2020   cluster.       
+00014aa0: 2020 2020 2020 2020 2023 2069 6620 7468           # if th
+00014ab0: 6579 2068 6176 6520 6e6f 7420 6265 656e  ey have not been
+00014ac0: 2073 6574 2079 6574 0a20 2020 2020 2020   set yet.       
+00014ad0: 2020 2020 2020 2020 2023 2069 6620 7468           # if th
+00014ae0: 6579 2068 6176 652c 2073 6574 2074 6865  ey have, set the
+00014af0: 6d20 746f 202d 310a 2020 2020 2020 2020  m to -1.        
+00014b00: 2020 2020 2020 2020 636c 7573 7465 7269          clusteri
+00014b10: 6473 5b6d 6173 6b5d 203d 206e 702e 7768  ds[mask] = np.wh
+00014b20: 6572 6528 636c 7573 7465 7269 6473 5b6d  ere(clusterids[m
+00014b30: 6173 6b5d 203d 3d20 302c 2063 692c 202d  ask] == 0, ci, -
+00014b40: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
+00014b50: 2320 636c 7573 7465 7273 2077 6520 6172  # clusters we ar
+00014b60: 6520 756e 7375 7265 2061 626f 7574 2028  e unsure about (
+00014b70: 646f 7562 6c65 2061 7373 6967 6e6d 656e  double assignmen
+00014b80: 7473 2920 676f 2075 6e61 7373 6967 6e65  ts) go unassigne
+00014b90: 640a 2020 2020 2020 2020 2020 2020 636c  d.            cl
+00014ba0: 7573 7465 7269 6473 5b63 6c75 7374 6572  usterids[cluster
+00014bb0: 6964 7320 3d3d 202d 315d 203d 2030 0a0a  ids == -1] = 0..
+00014bc0: 2020 2020 2020 2020 2020 2020 2320 7465              # te
+00014bd0: 6c6c 2073 6361 6c69 6e67 206c 6179 6572  ll scaling layer
+00014be0: 2074 6865 2063 6f72 7265 6374 2063 6c75   the correct clu
+00014bf0: 7374 6572 2069 6e66 6f72 6d61 7469 6f6e  ster information
+00014c00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014c10: 662e 7472 616e 7366 6f72 6d4c 6179 6572  f.transformLayer
+00014c20: 2e63 6c75 7374 6572 6964 7320 3d20 636c  .clusterids = cl
+00014c30: 7573 7465 7269 6473 0a0a 2020 2020 2020  usterids..      
+00014c40: 2020 2020 2020 2320 7765 2077 616e 7420        # we want 
+00014c50: 7468 6520 636c 7573 7465 7269 6e67 2074  the clustering t
+00014c60: 6f20 7265 7065 6174 2074 6f20 7265 6d6f  o repeat to remo
+00014c70: 7665 2072 656d 6169 6e69 6e67 207a 6572  ve remaining zer
+00014c80: 6f73 0a20 2020 2020 2020 2020 2020 206e  os.            n
+00014c90: 6565 645f 6163 6365 7074 203d 2028 7365  eed_accept = (se
+00014ca0: 6c66 2e74 7261 6e73 666f 726d 4c61 7965  lf.transformLaye
+00014cb0: 722e 636c 7573 7465 7269 6473 203d 3d20  r.clusterids == 
+00014cc0: 3029 2e61 6e79 2829 0a0a 2020 2020 2020  0).any()..      
+00014cd0: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
+00014ce0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00014cf0: 2061 7373 6572 7420 6c65 6e28 7365 6c66   assert len(self
+00014d00: 2e72 6567 696f 6e2e 7529 203d 3d20 6c65  .region.u) == le
+00014d10: 6e28 7365 6c66 2e74 7261 6e73 666f 726d  n(self.transform
+00014d20: 4c61 7965 722e 636c 7573 7465 7269 6473  Layer.clusterids
+00014d30: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00014d40: 2076 6572 6966 7920 636f 7272 6563 746e   verify correctn
+00014d50: 6573 733a 0a20 2020 2020 2020 2020 2020  ess:.           
+00014d60: 2073 656c 662e 7265 6769 6f6e 2e63 7265   self.region.cre
+00014d70: 6174 655f 656c 6c69 7073 6f69 6428 6d69  ate_ellipsoid(mi
+00014d80: 6e76 6f6c 3d6d 696e 766f 6c29 0a20 2020  nvol=minvol).   
+00014d90: 2020 2020 2020 2020 2023 2061 7373 6572           # asser
+00014da0: 7420 7365 6c66 2e72 6567 696f 6e2e 696e  t self.region.in
+00014db0: 7369 6465 2861 6374 6976 655f 7529 2e61  side(active_u).a
+00014dc0: 6c6c 2829 2c20 7365 6c66 2e72 6567 696f  ll(), self.regio
+00014dd0: 6e2e 696e 7369 6465 2861 6374 6976 655f  n.inside(active_
+00014de0: 7529 2e6d 6561 6e28 290a 0a20 2020 2020  u).mean()..     
+00014df0: 2020 2061 7373 6572 7420 6c65 6e28 7365     assert len(se
+00014e00: 6c66 2e72 6567 696f 6e2e 7529 203d 3d20  lf.region.u) == 
+00014e10: 6c65 6e28 7365 6c66 2e74 7261 6e73 666f  len(self.transfo
+00014e20: 726d 4c61 7965 722e 636c 7573 7465 7269  rmLayer.clusteri
+00014e30: 6473 290a 2020 2020 2020 2020 2320 7265  ds).        # re
+00014e40: 6275 696c 6420 7370 6163 650a 2020 2020  build space.    
+00014e50: 2020 2020 7769 7468 2077 6172 6e69 6e67      with warning
+00014e60: 732e 6361 7463 685f 7761 726e 696e 6773  s.catch_warnings
+00014e70: 2829 2c20 6e70 2e65 7272 7374 6174 6528  (), np.errstate(
+00014e80: 616c 6c3d 2772 6169 7365 2729 3a0a 2020  all='raise'):.  
+00014e90: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00014ea0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00014eb0: 6578 7454 7261 6e73 666f 726d 4c61 7965  extTransformLaye
+00014ec0: 7220 3d20 7365 6c66 2e74 7261 6e73 666f  r = self.transfo
+00014ed0: 726d 4c61 7965 722e 6372 6561 7465 5f6e  rmLayer.create_n
+00014ee0: 6577 2861 6374 6976 655f 752c 2073 656c  ew(active_u, sel
+00014ef0: 662e 7265 6769 6f6e 2e6d 6178 7261 6469  f.region.maxradi
+00014f00: 7573 7371 2c20 6d69 6e76 6f6c 3d6d 696e  ussq, minvol=min
+00014f10: 766f 6c29 0a20 2020 2020 2020 2020 2020  vol).           
+00014f20: 2020 2020 2061 7373 6572 7420 6e6f 7420       assert not 
+00014f30: 286e 6578 7454 7261 6e73 666f 726d 4c61  (nextTransformLa
+00014f40: 7965 722e 636c 7573 7465 7269 6473 203d  yer.clusterids =
+00014f50: 3d20 3029 2e61 6e79 2829 0a20 2020 2020  = 0).any().     
+00014f60: 2020 2020 2020 2020 2020 205f 2c20 636c             _, cl
+00014f70: 7573 7465 725f 7369 7a65 7320 3d20 6e70  uster_sizes = np
+00014f80: 2e75 6e69 7175 6528 6e65 7874 5472 616e  .unique(nextTran
+00014f90: 7366 6f72 6d4c 6179 6572 2e63 6c75 7374  sformLayer.clust
+00014fa0: 6572 6964 732c 2072 6574 7572 6e5f 636f  erids, return_co
+00014fb0: 756e 7473 3d54 7275 6529 0a20 2020 2020  unts=True).     
+00014fc0: 2020 2020 2020 2020 2020 2073 6d61 6c6c             small
+00014fd0: 6573 745f 636c 7573 7465 7220 3d20 636c  est_cluster = cl
+00014fe0: 7573 7465 725f 7369 7a65 732e 6d69 6e28  uster_sizes.min(
+00014ff0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015000: 2020 6966 2073 656c 662e 6c6f 6720 616e    if self.log an
+00015010: 6420 736d 616c 6c65 7374 5f63 6c75 7374  d smallest_clust
+00015020: 6572 203d 3d20 313a 0a20 2020 2020 2020  er == 1:.       
+00015030: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00015040: 662e 6c6f 6767 6572 2e64 6562 7567 280a  f.logger.debug(.
+00015050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015060: 2020 2020 2020 2020 2263 6c75 7374 6572          "cluster
+00015070: 696e 6720 666f 756e 6420 736f 6d65 2073  ing found some s
+00015080: 7472 6179 2070 6f69 6e74 7320 5b6e 6565  tray points [nee
+00015090: 645f 6163 6365 7074 3d25 735d 2025 7322  d_accept=%s] %s"
+000150a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000150b0: 2020 2020 2020 2020 2020 6e65 6564 5f61            need_a
+000150c0: 6363 6570 742c 0a20 2020 2020 2020 2020  ccept,.         
+000150d0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000150e0: 702e 756e 6971 7565 286e 6578 7454 7261  p.unique(nextTra
+000150f0: 6e73 666f 726d 4c61 7965 722e 636c 7573  nsformLayer.clus
+00015100: 7465 7269 6473 2c20 7265 7475 726e 5f63  terids, return_c
+00015110: 6f75 6e74 733d 5472 7565 290a 2020 2020  ounts=True).    
+00015120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015130: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00015140: 2020 206e 6578 7472 6567 696f 6e20 3d20     nextregion = 
+00015150: 7365 6c66 2e72 6567 696f 6e5f 636c 6173  self.region_clas
+00015160: 7328 6163 7469 7665 5f75 2c20 6e65 7874  s(active_u, next
+00015170: 5472 616e 7366 6f72 6d4c 6179 6572 290a  TransformLayer).
+00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015190: 6173 7365 7274 206e 702e 6973 6669 6e69  assert np.isfini
+000151a0: 7465 286e 6578 7472 6567 696f 6e2e 756e  te(nextregion.un
+000151b0: 6f72 6d65 6429 2e61 6c6c 2829 0a0a 2020  ormed).all()..  
+000151c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000151d0: 206e 6f74 206e 6578 7454 7261 6e73 666f   not nextTransfo
+000151e0: 726d 4c61 7965 722e 6e63 6c75 7374 6572  rmLayer.ncluster
+000151f0: 7320 3c20 3230 3a0a 2020 2020 2020 2020  s < 20:.        
+00015200: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00015210: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
 00015220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015230: 2020 2020 2020 2246 6f75 6e64 2061 206c        "Found a l
-00015240: 6f74 206f 6620 636c 7573 7465 7273 3a20  ot of clusters: 
-00015250: 2564 2028 2564 2077 6974 6820 3e31 206d  %d (%d with >1 m
-00015260: 656d 6265 7273 2922 2c0a 2020 2020 2020  embers)",.      
-00015270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015280: 2020 2020 2020 6e65 7874 5472 616e 7366        nextTransf
-00015290: 6f72 6d4c 6179 6572 2e6e 636c 7573 7465  ormLayer.ncluste
-000152a0: 7273 2c20 2863 6c75 7374 6572 5f73 697a  rs, (cluster_siz
-000152b0: 6573 203e 2031 292e 7375 6d28 2929 0a0a  es > 1).sum())..
-000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152d0: 2320 6966 2073 656c 662e 6c6f 673a 0a20  # if self.log:. 
-000152e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000152f0: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00015300: 2e69 6e66 6f28 2263 6f6d 7075 7469 6e67  .info("computing
-00015310: 206d 6178 7261 6469 7573 2e2e 2e22 290a   maxradius...").
-00015320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015330: 722c 2066 203d 205f 7570 6461 7465 5f72  r, f = _update_r
-00015340: 6567 696f 6e5f 626f 6f74 7374 7261 7028  egion_bootstrap(
-00015350: 6e65 7874 7265 6769 6f6e 2c20 6e62 6f6f  nextregion, nboo
-00015360: 7473 7472 6170 732c 206d 696e 766f 6c2c  tstraps, minvol,
-00015370: 2073 656c 662e 636f 6d6d 2069 6620 7365   self.comm if se
-00015380: 6c66 2e75 7365 5f6d 7069 2065 6c73 6520  lf.use_mpi else 
-00015390: 4e6f 6e65 2c20 7365 6c66 2e6d 7069 5f73  None, self.mpi_s
-000153a0: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-000153b0: 2020 2020 2023 2076 6572 6966 7920 636f       # verify co
-000153c0: 7272 6563 746e 6573 733a 0a20 2020 2020  rrectness:.     
-000153d0: 2020 2020 2020 2020 2020 206e 6578 7472             nextr
-000153e0: 6567 696f 6e2e 6372 6561 7465 5f65 6c6c  egion.create_ell
-000153f0: 6970 736f 6964 286d 696e 766f 6c3d 6d69  ipsoid(minvol=mi
-00015400: 6e76 6f6c 290a 0a20 2020 2020 2020 2020  nvol)..         
-00015410: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
-00015420: 6620 6c69 7665 2070 6f69 6e74 7320 6172  f live points ar
-00015430: 6520 6e75 6d65 7269 6361 6c6c 7920 636f  e numerically co
-00015440: 6c6c 6964 696e 6720 6f72 206c 696e 6561  lliding or linea
-00015450: 726c 7920 6465 7065 6e64 656e 740a 2020  rly dependent.  
-00015460: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00015470: 6c66 2e6c 6976 655f 706f 696e 7473 5f68  lf.live_points_h
-00015480: 6561 6c74 6879 203d 206c 656e 2861 6374  ealthy = len(act
-00015490: 6976 655f 7529 203e 2073 656c 662e 785f  ive_u) > self.x_
-000154a0: 6469 6d20 616e 6420 5c0a 2020 2020 2020  dim and \.      
-000154b0: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-000154c0: 2e61 6c6c 286e 702e 7375 6d28 6163 7469  .all(np.sum(acti
-000154d0: 7665 5f75 5b31 3a5d 2021 3d20 6163 7469  ve_u[1:] != acti
-000154e0: 7665 5f75 5b30 5d2c 2061 7869 733d 3029  ve_u[0], axis=0)
-000154f0: 203e 2073 656c 662e 785f 6469 6d29 2061   > self.x_dim) a
-00015500: 6e64 205c 0a20 2020 2020 2020 2020 2020  nd \.           
-00015510: 2020 2020 2020 2020 206e 702e 6c69 6e61           np.lina
-00015520: 6c67 2e6d 6174 7269 785f 7261 6e6b 286e  lg.matrix_rank(n
-00015530: 6578 7472 6567 696f 6e2e 656c 6c69 7073  extregion.ellips
-00015540: 6f69 645f 636f 7629 203d 3d20 7365 6c66  oid_cov) == self
-00015550: 2e78 5f64 696d 0a0a 2020 2020 2020 2020  .x_dim..        
-00015560: 2020 2020 2020 2020 6173 7365 7274 2028          assert (
-00015570: 6e65 7874 7265 6769 6f6e 2e75 203d 3d20  nextregion.u == 
-00015580: 6163 7469 7665 5f75 292e 616c 6c28 290a  active_u).all().
-00015590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155a0: 6173 7365 7274 206e 702e 616c 6c63 6c6f  assert np.allclo
-000155b0: 7365 286e 6578 7472 6567 696f 6e2e 756e  se(nextregion.un
-000155c0: 6f72 6d65 642c 206e 6578 7472 6567 696f  ormed, nextregio
-000155d0: 6e2e 7472 616e 7366 6f72 6d4c 6179 6572  n.transformLayer
-000155e0: 2e74 7261 6e73 666f 726d 2861 6374 6976  .transform(activ
-000155f0: 655f 7529 290a 2020 2020 2020 2020 2020  e_u)).          
-00015600: 2020 2020 2020 2320 6173 7365 7274 206e        # assert n
-00015610: 6578 7472 6567 696f 6e2e 696e 7369 6465  extregion.inside
-00015620: 2861 6374 6976 655f 7529 2e61 6c6c 2829  (active_u).all()
-00015630: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015640: 2020 2320 2028 226c 6976 6520 706f 696e    #  ("live poin
-00015650: 7473 2073 686f 756c 6420 6c69 7665 2069  ts should live i
-00015660: 6e20 6e65 7720 7265 6769 6f6e 2c20 6275  n new region, bu
-00015670: 7420 6f6e 6c79 2025 2e33 6625 2520 646f  t only %.3f%% do
-00015680: 2e22 2025 2028 3130 3020 2a20 6e65 7874  ." % (100 * next
-00015690: 7265 6769 6f6e 2e69 6e73 6964 6528 6163  region.inside(ac
-000156a0: 7469 7665 5f75 292e 6d65 616e 2829 292c  tive_u).mean()),
-000156b0: 2061 6374 6976 655f 7529 0a20 2020 2020   active_u).     
-000156c0: 2020 2020 2020 2020 2020 2067 6f6f 645f             good_
-000156d0: 7265 6769 6f6e 203d 206e 6578 7472 6567  region = nextreg
-000156e0: 696f 6e2e 696e 7369 6465 2861 6374 6976  ion.inside(activ
-000156f0: 655f 7529 2e61 6c6c 2829 0a20 2020 2020  e_u).all().     
-00015700: 2020 2020 2020 2020 2020 2023 2061 7373             # ass
-00015710: 6572 7420 676f 6f64 5f72 6567 696f 6e0a  ert good_region.
-00015720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015730: 6966 206e 6f74 2067 6f6f 645f 7265 6769  if not good_regi
-00015740: 6f6e 2061 6e64 2073 656c 662e 6c6f 673a  on and self.log:
-00015750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015760: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00015770: 2e64 6562 7567 2822 5072 6f70 6f73 6564  .debug("Proposed
-00015780: 2072 6567 696f 6e20 6973 2069 6e63 6f6e   region is incon
-00015790: 7369 7374 656e 7420 286d 6178 723d 2567  sistent (maxr=%g
-000157a0: 2c65 6e6c 6172 6765 3d25 6729 2061 6e64  ,enlarge=%g) and
-000157b0: 2077 696c 6c20 6265 2073 6b69 7070 6564   will be skipped
-000157c0: 2e22 2c20 722c 2066 290a 0a20 2020 2020  .", r, f)..     
-000157d0: 2020 2020 2020 2020 2020 2023 2061 766f             # avo
-000157e0: 6964 2063 6173 6573 2077 6865 7265 2065  id cases where e
-000157f0: 7665 7279 2070 6f69 6e74 2069 7320 6974  very point is it
-00015800: 7320 6f77 6e20 636c 7573 7465 722c 0a20  s own cluster,. 
-00015810: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00015820: 2061 6e64 2065 7665 6e20 7468 6520 6c61   and even the la
-00015830: 7267 6573 7420 636c 7573 7465 7220 6861  rgest cluster ha
-00015840: 7320 6665 7765 7220 7468 616e 2078 5f64  s fewer than x_d
-00015850: 696d 2070 6f69 6e74 730a 2020 2020 2020  im points.      
-00015860: 2020 2020 2020 2020 2020 7365 6e73 6962            sensib
-00015870: 6c65 5f63 6c75 7374 6572 696e 6720 3d20  le_clustering = 
-00015880: 6e65 7874 5472 616e 7366 6f72 6d4c 6179  nextTransformLay
-00015890: 6572 2e6e 636c 7573 7465 7273 203c 206c  er.nclusters < l
-000158a0: 656e 286e 6578 7472 6567 696f 6e2e 7529  en(nextregion.u)
-000158b0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-000158c0: 2020 2020 2020 2061 6e64 2063 6c75 7374         and clust
-000158d0: 6572 5f73 697a 6573 2e6d 6178 2829 203e  er_sizes.max() >
-000158e0: 3d20 6e65 7874 7265 6769 6f6e 2e75 2e73  = nextregion.u.s
-000158f0: 6861 7065 5b31 5d0a 0a20 2020 2020 2020  hape[1]..       
-00015900: 2020 2020 2020 2020 2023 2066 6f72 6365           # force
-00015910: 2073 6872 696e 6b61 6765 206f 6620 766f   shrinkage of vo
-00015920: 6c75 6d65 2e20 6176 6f69 6473 2072 6563  lume. avoids rec
-00015930: 6f6e 6e65 6374 696e 6720 6479 696e 6720  onnecting dying 
-00015940: 6d6f 6465 730a 2020 2020 2020 2020 2020  modes.          
-00015950: 2020 2020 2020 6966 2067 6f6f 645f 7265        if good_re
-00015960: 6769 6f6e 2061 6e64 205c 0a20 2020 2020  gion and \.     
-00015970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015980: 2020 2028 6e65 6564 5f61 6363 6570 7420     (need_accept 
-00015990: 6f72 206e 6578 7472 6567 696f 6e2e 6573  or nextregion.es
-000159a0: 7469 6d61 7465 5f76 6f6c 756d 6528 2920  timate_volume() 
-000159b0: 3c3d 2073 656c 662e 7265 6769 6f6e 2e65  <= self.region.e
-000159c0: 7374 696d 6174 655f 766f 6c75 6d65 2829  stimate_volume()
-000159d0: 2920 5c0a 2020 2020 2020 2020 2020 2020  ) \.            
-000159e0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-000159f0: 7365 6e73 6962 6c65 5f63 6c75 7374 6572  sensible_cluster
-00015a00: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
-00015a10: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-00015a20: 6769 6f6e 203d 206e 6578 7472 6567 696f  gion = nextregio
-00015a30: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00015a40: 2020 2020 2020 7365 6c66 2e74 7261 6e73        self.trans
-00015a50: 666f 726d 4c61 7965 7220 3d20 7365 6c66  formLayer = self
-00015a60: 2e72 6567 696f 6e2e 7472 616e 7366 6f72  .region.transfor
-00015a70: 6d4c 6179 6572 0a20 2020 2020 2020 2020  mLayer.         
-00015a80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015a90: 7265 6769 6f6e 5f6e 6f64 6573 203d 2061  region_nodes = a
-00015aa0: 6374 6976 655f 6e6f 6465 5f69 6473 2e63  ctive_node_ids.c
-00015ab0: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00015ac0: 2020 2020 2020 2020 2020 7570 6461 7465            update
-00015ad0: 6420 3d20 5472 7565 0a0a 2020 2020 2020  d = True..      
-00015ae0: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00015af0: 7365 7274 206e 6f74 2028 7365 6c66 2e74  sert not (self.t
-00015b00: 7261 6e73 666f 726d 4c61 7965 722e 636c  ransformLayer.cl
-00015b10: 7573 7465 7269 6473 203d 3d20 3029 2e61  usterids == 0).a
-00015b20: 6e79 2829 2c20 2873 656c 662e 7472 616e  ny(), (self.tran
-00015b30: 7366 6f72 6d4c 6179 6572 2e63 6c75 7374  sformLayer.clust
-00015b40: 6572 6964 732c 206e 6565 645f 6163 6365  erids, need_acce
-00015b50: 7074 2c20 7570 6461 7465 6429 0a0a 2020  pt, updated)..  
-00015b60: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00015b70: 2057 6172 6e69 6e67 3a0a 2020 2020 2020   Warning:.      
-00015b80: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00015b90: 662e 6c6f 673a 0a20 2020 2020 2020 2020  f.log:.         
-00015ba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015bb0: 6c6f 6767 6572 2e64 6562 7567 2822 6e6f  logger.debug("no
-00015bc0: 7420 7570 6461 7469 6e67 2072 6567 696f  t updating regio
-00015bd0: 6e22 2c20 6578 635f 696e 666f 3d54 7275  n", exc_info=Tru
-00015be0: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
-00015bf0: 7863 6570 7420 466c 6f61 7469 6e67 506f  xcept FloatingPo
-00015c00: 696e 7445 7272 6f72 3a0a 2020 2020 2020  intError:.      
-00015c10: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00015c20: 662e 6c6f 673a 0a20 2020 2020 2020 2020  f.log:.         
-00015c30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00015c40: 6c6f 6767 6572 2e64 6562 7567 2822 6e6f  logger.debug("no
-00015c50: 7420 7570 6461 7469 6e67 2072 6567 696f  t updating regio
-00015c60: 6e22 2c20 6578 635f 696e 666f 3d54 7275  n", exc_info=Tru
-00015c70: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
-00015c80: 7863 6570 7420 6e70 2e6c 696e 616c 672e  xcept np.linalg.
-00015c90: 4c69 6e41 6c67 4572 726f 723a 0a20 2020  LinAlgError:.   
-00015ca0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015cb0: 7365 6c66 2e6c 6f67 3a0a 2020 2020 2020  self.log:.      
-00015cc0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00015cd0: 6c66 2e6c 6f67 6765 722e 6465 6275 6728  lf.logger.debug(
-00015ce0: 226e 6f74 2075 7064 6174 696e 6720 7265  "not updating re
-00015cf0: 6769 6f6e 222c 2065 7863 5f69 6e66 6f3d  gion", exc_info=
-00015d00: 5472 7565 290a 0a20 2020 2020 2020 2061  True)..        a
-00015d10: 7373 6572 7420 6c65 6e28 7365 6c66 2e72  ssert len(self.r
-00015d20: 6567 696f 6e2e 7529 203d 3d20 6c65 6e28  egion.u) == len(
-00015d30: 7365 6c66 2e74 7261 6e73 666f 726d 4c61  self.transformLa
-00015d40: 7965 722e 636c 7573 7465 7269 6473 290a  yer.clusterids).
-00015d50: 0a20 2020 2020 2020 2069 6620 6163 7469  .        if acti
-00015d60: 7665 5f70 2069 7320 4e6f 6e65 206f 7220  ve_p is None or 
-00015d70: 6e6f 7420 7365 6c66 2e62 7569 6c64 5f74  not self.build_t
-00015d80: 7265 6769 6f6e 3a0a 2020 2020 2020 2020  region:.        
-00015d90: 2020 2020 7365 6c66 2e74 7265 6769 6f6e      self.tregion
-00015da0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00015db0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00015dc0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00015dd0: 2020 2020 2020 2077 6974 6820 6e70 2e65         with np.e
-00015de0: 7272 7374 6174 6528 696e 7661 6c69 643d  rrstate(invalid=
-00015df0: 2772 6169 7365 2729 3a0a 2020 2020 2020  'raise'):.      
-00015e00: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00015e10: 6567 696f 6e20 3d20 5772 6170 7069 6e67  egion = Wrapping
-00015e20: 456c 6c69 7073 6f69 6428 6163 7469 7665  Ellipsoid(active
-00015e30: 5f70 290a 2020 2020 2020 2020 2020 2020  _p).            
-00015e40: 2020 2020 2020 2020 6620 3d20 7472 6567          f = treg
-00015e50: 696f 6e2e 636f 6d70 7574 655f 656e 6c61  ion.compute_enla
-00015e60: 7267 656d 656e 7428 0a20 2020 2020 2020  rgement(.       
-00015e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e80: 206e 626f 6f74 7374 7261 7073 3d6d 6178   nbootstraps=max
-00015e90: 2831 2c20 6e62 6f6f 7473 7472 6170 7320  (1, nbootstraps 
-00015ea0: 2f2f 2073 656c 662e 6d70 695f 7369 7a65  // self.mpi_size
-00015eb0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00015ec0: 2020 2020 2020 2069 6620 7365 6c66 2e75         if self.u
-00015ed0: 7365 5f6d 7069 3a0a 2020 2020 2020 2020  se_mpi:.        
+00015230: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
+00015240: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
+00015250: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00015260: 466f 756e 6420 6120 6c6f 7420 6f66 2063  Found a lot of c
+00015270: 6c75 7374 6572 733a 2025 6420 2825 6420  lusters: %d (%d 
+00015280: 7769 7468 203e 3120 6d65 6d62 6572 7329  with >1 members)
+00015290: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+000152a0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000152b0: 6578 7454 7261 6e73 666f 726d 4c61 7965  extTransformLaye
+000152c0: 722e 6e63 6c75 7374 6572 732c 2028 636c  r.nclusters, (cl
+000152d0: 7573 7465 725f 7369 7a65 7320 3e20 3129  uster_sizes > 1)
+000152e0: 2e73 756d 2829 290a 0a20 2020 2020 2020  .sum())..       
+000152f0: 2020 2020 2020 2020 2023 2069 6620 7365           # if se
+00015300: 6c66 2e6c 6f67 3a0a 2020 2020 2020 2020  lf.log:.        
+00015310: 2020 2020 2020 2020 2320 2020 2020 7365          #     se
+00015320: 6c66 2e6c 6f67 6765 722e 696e 666f 2822  lf.logger.info("
+00015330: 636f 6d70 7574 696e 6720 6d61 7872 6164  computing maxrad
+00015340: 6975 732e 2e2e 2229 0a20 2020 2020 2020  ius...").       
+00015350: 2020 2020 2020 2020 2072 2c20 6620 3d20           r, f = 
+00015360: 5f75 7064 6174 655f 7265 6769 6f6e 5f62  _update_region_b
+00015370: 6f6f 7473 7472 6170 286e 6578 7472 6567  ootstrap(nextreg
+00015380: 696f 6e2c 206e 626f 6f74 7374 7261 7073  ion, nbootstraps
+00015390: 2c20 6d69 6e76 6f6c 2c20 7365 6c66 2e63  , minvol, self.c
+000153a0: 6f6d 6d20 6966 2073 656c 662e 7573 655f  omm if self.use_
+000153b0: 6d70 6920 656c 7365 204e 6f6e 652c 2073  mpi else None, s
+000153c0: 656c 662e 6d70 695f 7369 7a65 290a 2020  elf.mpi_size).  
+000153d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000153e0: 7665 7269 6679 2063 6f72 7265 6374 6e65  verify correctne
+000153f0: 7373 3a0a 2020 2020 2020 2020 2020 2020  ss:.            
+00015400: 2020 2020 6e65 7874 7265 6769 6f6e 2e63      nextregion.c
+00015410: 7265 6174 655f 656c 6c69 7073 6f69 6428  reate_ellipsoid(
+00015420: 6d69 6e76 6f6c 3d6d 696e 766f 6c29 0a0a  minvol=minvol)..
+00015430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015440: 2320 6368 6563 6b20 6966 206c 6976 6520  # check if live 
+00015450: 706f 696e 7473 2061 7265 206e 756d 6572  points are numer
+00015460: 6963 616c 6c79 2063 6f6c 6c69 6469 6e67  ically colliding
+00015470: 206f 7220 6c69 6e65 6172 6c79 2064 6570   or linearly dep
+00015480: 656e 6465 6e74 0a20 2020 2020 2020 2020  endent.         
+00015490: 2020 2020 2020 2073 656c 662e 6c69 7665         self.live
+000154a0: 5f70 6f69 6e74 735f 6865 616c 7468 7920  _points_healthy 
+000154b0: 3d20 6c65 6e28 6163 7469 7665 5f75 2920  = len(active_u) 
+000154c0: 3e20 7365 6c66 2e78 5f64 696d 2061 6e64  > self.x_dim and
+000154d0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+000154e0: 2020 2020 2020 206e 702e 616c 6c28 6e70         np.all(np
+000154f0: 2e73 756d 2861 6374 6976 655f 755b 313a  .sum(active_u[1:
+00015500: 5d20 213d 2061 6374 6976 655f 755b 305d  ] != active_u[0]
+00015510: 2c20 6178 6973 3d30 2920 3e20 7365 6c66  , axis=0) > self
+00015520: 2e78 5f64 696d 2920 616e 6420 5c0a 2020  .x_dim) and \.  
+00015530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015540: 2020 6e70 2e6c 696e 616c 672e 6d61 7472    np.linalg.matr
+00015550: 6978 5f72 616e 6b28 6e65 7874 7265 6769  ix_rank(nextregi
+00015560: 6f6e 2e65 6c6c 6970 736f 6964 5f63 6f76  on.ellipsoid_cov
+00015570: 2920 3d3d 2073 656c 662e 785f 6469 6d0a  ) == self.x_dim.
+00015580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015590: 2061 7373 6572 7420 286e 6578 7472 6567   assert (nextreg
+000155a0: 696f 6e2e 7520 3d3d 2061 6374 6976 655f  ion.u == active_
+000155b0: 7529 2e61 6c6c 2829 0a20 2020 2020 2020  u).all().       
+000155c0: 2020 2020 2020 2020 2061 7373 6572 7420           assert 
+000155d0: 6e70 2e61 6c6c 636c 6f73 6528 6e65 7874  np.allclose(next
+000155e0: 7265 6769 6f6e 2e75 6e6f 726d 6564 2c20  region.unormed, 
+000155f0: 6e65 7874 7265 6769 6f6e 2e74 7261 6e73  nextregion.trans
+00015600: 666f 726d 4c61 7965 722e 7472 616e 7366  formLayer.transf
+00015610: 6f72 6d28 6163 7469 7665 5f75 2929 0a20  orm(active_u)). 
+00015620: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00015630: 2061 7373 6572 7420 6e65 7874 7265 6769   assert nextregi
+00015640: 6f6e 2e69 6e73 6964 6528 6163 7469 7665  on.inside(active
+00015650: 5f75 292e 616c 6c28 292c 0a20 2020 2020  _u).all(),.     
+00015660: 2020 2020 2020 2020 2020 2023 2020 2822             #  ("
+00015670: 6c69 7665 2070 6f69 6e74 7320 7368 6f75  live points shou
+00015680: 6c64 206c 6976 6520 696e 206e 6577 2072  ld live in new r
+00015690: 6567 696f 6e2c 2062 7574 206f 6e6c 7920  egion, but only 
+000156a0: 252e 3366 2525 2064 6f2e 2220 2520 2831  %.3f%% do." % (1
+000156b0: 3030 202a 206e 6578 7472 6567 696f 6e2e  00 * nextregion.
+000156c0: 696e 7369 6465 2861 6374 6976 655f 7529  inside(active_u)
+000156d0: 2e6d 6561 6e28 2929 2c20 6163 7469 7665  .mean()), active
+000156e0: 5f75 290a 2020 2020 2020 2020 2020 2020  _u).            
+000156f0: 2020 2020 676f 6f64 5f72 6567 696f 6e20      good_region 
+00015700: 3d20 6e65 7874 7265 6769 6f6e 2e69 6e73  = nextregion.ins
+00015710: 6964 6528 6163 7469 7665 5f75 292e 616c  ide(active_u).al
+00015720: 6c28 290a 2020 2020 2020 2020 2020 2020  l().            
+00015730: 2020 2020 2320 6173 7365 7274 2067 6f6f      # assert goo
+00015740: 645f 7265 6769 6f6e 0a20 2020 2020 2020  d_region.       
+00015750: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00015760: 676f 6f64 5f72 6567 696f 6e20 616e 6420  good_region and 
+00015770: 7365 6c66 2e6c 6f67 3a0a 2020 2020 2020  self.log:.      
+00015780: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00015790: 6c66 2e6c 6f67 6765 722e 6465 6275 6728  lf.logger.debug(
+000157a0: 2250 726f 706f 7365 6420 7265 6769 6f6e  "Proposed region
+000157b0: 2069 7320 696e 636f 6e73 6973 7465 6e74   is inconsistent
+000157c0: 2028 6d61 7872 3d25 672c 656e 6c61 7267   (maxr=%g,enlarg
+000157d0: 653d 2567 2920 616e 6420 7769 6c6c 2062  e=%g) and will b
+000157e0: 6520 736b 6970 7065 642e 222c 2072 2c20  e skipped.", r, 
+000157f0: 6629 0a0a 2020 2020 2020 2020 2020 2020  f)..            
+00015800: 2020 2020 2320 6176 6f69 6420 6361 7365      # avoid case
+00015810: 7320 7768 6572 6520 6576 6572 7920 706f  s where every po
+00015820: 696e 7420 6973 2069 7473 206f 776e 2063  int is its own c
+00015830: 6c75 7374 6572 2c0a 2020 2020 2020 2020  luster,.        
+00015840: 2020 2020 2020 2020 2320 616e 6420 6576          # and ev
+00015850: 656e 2074 6865 206c 6172 6765 7374 2063  en the largest c
+00015860: 6c75 7374 6572 2068 6173 2066 6577 6572  luster has fewer
+00015870: 2074 6861 6e20 785f 6469 6d20 706f 696e   than x_dim poin
+00015880: 7473 0a20 2020 2020 2020 2020 2020 2020  ts.             
+00015890: 2020 2073 656e 7369 626c 655f 636c 7573     sensible_clus
+000158a0: 7465 7269 6e67 203d 206e 6578 7454 7261  tering = nextTra
+000158b0: 6e73 666f 726d 4c61 7965 722e 6e63 6c75  nsformLayer.nclu
+000158c0: 7374 6572 7320 3c20 6c65 6e28 6e65 7874  sters < len(next
+000158d0: 7265 6769 6f6e 2e75 2920 5c0a 2020 2020  region.u) \.    
+000158e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158f0: 616e 6420 636c 7573 7465 725f 7369 7a65  and cluster_size
+00015900: 732e 6d61 7828 2920 3e3d 206e 6578 7472  s.max() >= nextr
+00015910: 6567 696f 6e2e 752e 7368 6170 655b 315d  egion.u.shape[1]
+00015920: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015930: 2020 2320 666f 7263 6520 7368 7269 6e6b    # force shrink
+00015940: 6167 6520 6f66 2076 6f6c 756d 652e 2061  age of volume. a
+00015950: 766f 6964 7320 7265 636f 6e6e 6563 7469  voids reconnecti
+00015960: 6e67 2064 7969 6e67 206d 6f64 6573 0a20  ng dying modes. 
+00015970: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00015980: 6620 676f 6f64 5f72 6567 696f 6e20 616e  f good_region an
+00015990: 6420 5c0a 2020 2020 2020 2020 2020 2020  d \.            
+000159a0: 2020 2020 2020 2020 2020 2020 286e 6565              (nee
+000159b0: 645f 6163 6365 7074 206f 7220 6e65 7874  d_accept or next
+000159c0: 7265 6769 6f6e 2e65 7374 696d 6174 655f  region.estimate_
+000159d0: 766f 6c75 6d65 2829 203c 3d20 7365 6c66  volume() <= self
+000159e0: 2e72 6567 696f 6e2e 6573 7469 6d61 7465  .region.estimate
+000159f0: 5f76 6f6c 756d 6528 2929 205c 0a20 2020  _volume()) \.   
+00015a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a10: 2020 2020 2061 6e64 2073 656e 7369 626c       and sensibl
+00015a20: 655f 636c 7573 7465 7269 6e67 3a0a 2020  e_clustering:.  
+00015a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a40: 2020 7365 6c66 2e72 6567 696f 6e20 3d20    self.region = 
+00015a50: 6e65 7874 7265 6769 6f6e 0a20 2020 2020  nextregion.     
+00015a60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00015a70: 656c 662e 7472 616e 7366 6f72 6d4c 6179  elf.transformLay
+00015a80: 6572 203d 2073 656c 662e 7265 6769 6f6e  er = self.region
+00015a90: 2e74 7261 6e73 666f 726d 4c61 7965 720a  .transformLayer.
+00015aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ab0: 2020 2020 7365 6c66 2e72 6567 696f 6e5f      self.region_
+00015ac0: 6e6f 6465 7320 3d20 6163 7469 7665 5f6e  nodes = active_n
+00015ad0: 6f64 655f 6964 732e 636f 7079 2829 0a20  ode_ids.copy(). 
+00015ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015af0: 2020 2075 7064 6174 6564 203d 2054 7275     updated = Tru
+00015b00: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+00015b10: 2020 2020 2020 2061 7373 6572 7420 6e6f         assert no
+00015b20: 7420 2873 656c 662e 7472 616e 7366 6f72  t (self.transfor
+00015b30: 6d4c 6179 6572 2e63 6c75 7374 6572 6964  mLayer.clusterid
+00015b40: 7320 3d3d 2030 292e 616e 7928 292c 2028  s == 0).any(), (
+00015b50: 7365 6c66 2e74 7261 6e73 666f 726d 4c61  self.transformLa
+00015b60: 7965 722e 636c 7573 7465 7269 6473 2c20  yer.clusterids, 
+00015b70: 6e65 6564 5f61 6363 6570 742c 2075 7064  need_accept, upd
+00015b80: 6174 6564 290a 0a20 2020 2020 2020 2020  ated)..         
+00015b90: 2020 2065 7863 6570 7420 5761 726e 696e     except Warnin
+00015ba0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+00015bb0: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
+00015bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bd0: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00015be0: 6465 6275 6728 226e 6f74 2075 7064 6174  debug("not updat
+00015bf0: 696e 6720 7265 6769 6f6e 222c 2065 7863  ing region", exc
+00015c00: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
+00015c10: 2020 2020 2020 2020 6578 6365 7074 2046          except F
+00015c20: 6c6f 6174 696e 6750 6f69 6e74 4572 726f  loatingPointErro
+00015c30: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00015c40: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
+00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c60: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+00015c70: 6465 6275 6728 226e 6f74 2075 7064 6174  debug("not updat
+00015c80: 696e 6720 7265 6769 6f6e 222c 2065 7863  ing region", exc
+00015c90: 5f69 6e66 6f3d 5472 7565 290a 2020 2020  _info=True).    
+00015ca0: 2020 2020 2020 2020 6578 6365 7074 206e          except n
+00015cb0: 702e 6c69 6e61 6c67 2e4c 696e 416c 6745  p.linalg.LinAlgE
+00015cc0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00015cd0: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
+00015ce0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+00015cf0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+00015d00: 6572 2e64 6562 7567 2822 6e6f 7420 7570  er.debug("not up
+00015d10: 6461 7469 6e67 2072 6567 696f 6e22 2c20  dating region", 
+00015d20: 6578 635f 696e 666f 3d54 7275 6529 0a0a  exc_info=True)..
+00015d30: 2020 2020 2020 2020 6173 7365 7274 206c          assert l
+00015d40: 656e 2873 656c 662e 7265 6769 6f6e 2e75  en(self.region.u
+00015d50: 2920 3d3d 206c 656e 2873 656c 662e 7472  ) == len(self.tr
+00015d60: 616e 7366 6f72 6d4c 6179 6572 2e63 6c75  ansformLayer.clu
+00015d70: 7374 6572 6964 7329 0a0a 2020 2020 2020  sterids)..      
+00015d80: 2020 6966 2061 6374 6976 655f 7020 6973    if active_p is
+00015d90: 204e 6f6e 6520 6f72 206e 6f74 2073 656c   None or not sel
+00015da0: 662e 6275 696c 645f 7472 6567 696f 6e3a  f.build_tregion:
+00015db0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00015dc0: 662e 7472 6567 696f 6e20 3d20 4e6f 6e65  f.tregion = None
+00015dd0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00015de0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e00: 7769 7468 206e 702e 6572 7273 7461 7465  with np.errstate
+00015e10: 2869 6e76 616c 6964 3d27 7261 6973 6527  (invalid='raise'
+00015e20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00015e30: 2020 2020 2020 2074 7265 6769 6f6e 203d         tregion =
+00015e40: 2057 7261 7070 696e 6745 6c6c 6970 736f   WrappingEllipso
+00015e50: 6964 2861 6374 6976 655f 7029 0a20 2020  id(active_p).   
+00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e70: 2066 203d 2074 7265 6769 6f6e 2e63 6f6d   f = tregion.com
+00015e80: 7075 7465 5f65 6e6c 6172 6765 6d65 6e74  pute_enlargement
+00015e90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00015ea0: 2020 2020 2020 2020 2020 6e62 6f6f 7473            nboots
+00015eb0: 7472 6170 733d 6d61 7828 312c 206e 626f  traps=max(1, nbo
+00015ec0: 6f74 7374 7261 7073 202f 2f20 7365 6c66  otstraps // self
+00015ed0: 2e6d 7069 5f73 697a 6529 290a 2020 2020  .mpi_size)).    
 00015ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ef0: 7265 6376 5f65 6e6c 6172 6765 203d 2073  recv_enlarge = s
-00015f00: 656c 662e 636f 6d6d 2e67 6174 6865 7228  elf.comm.gather(
-00015f10: 662c 2072 6f6f 743d 3029 0a20 2020 2020  f, root=0).     
-00015f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f30: 2020 2072 6563 765f 656e 6c61 7267 6520     recv_enlarge 
-00015f40: 3d20 7365 6c66 2e63 6f6d 6d2e 6263 6173  = self.comm.bcas
-00015f50: 7428 7265 6376 5f65 6e6c 6172 6765 2c20  t(recv_enlarge, 
-00015f60: 726f 6f74 3d30 290a 2020 2020 2020 2020  root=0).        
-00015f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f80: 6620 3d20 6e70 2e6d 6178 2872 6563 765f  f = np.max(recv_
-00015f90: 656e 6c61 7267 6529 0a20 2020 2020 2020  enlarge).       
-00015fa0: 2020 2020 2020 2020 2020 2020 2074 7265               tre
-00015fb0: 6769 6f6e 2e65 6e6c 6172 6765 203d 2066  gion.enlarge = f
-00015fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015fd0: 2020 2020 2074 7265 6769 6f6e 2e63 7265       tregion.cre
-00015fe0: 6174 655f 656c 6c69 7073 6f69 6428 290a  ate_ellipsoid().
-00015ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016000: 2020 2020 7365 6c66 2e74 7265 6769 6f6e      self.tregion
-00016010: 203d 2074 7265 6769 6f6e 0a20 2020 2020   = tregion.     
-00016020: 2020 2020 2020 2065 7863 6570 7420 466c         except Fl
-00016030: 6f61 7469 6e67 506f 696e 7445 7272 6f72  oatingPointError
-00016040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016050: 2020 6966 2073 656c 662e 6c6f 673a 0a20    if self.log:. 
-00016060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016070: 2020 2073 656c 662e 6c6f 6767 6572 2e64     self.logger.d
-00016080: 6562 7567 2822 6e6f 7420 7570 6461 7469  ebug("not updati
-00016090: 6e67 2074 2d65 6c6c 6970 736f 6964 222c  ng t-ellipsoid",
-000160a0: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
-000160b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160c0: 2020 2020 7365 6c66 2e74 7265 6769 6f6e      self.tregion
-000160d0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-000160e0: 2020 2020 6578 6365 7074 206e 702e 6c69      except np.li
-000160f0: 6e61 6c67 2e4c 696e 416c 6745 7272 6f72  nalg.LinAlgError
-00016100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016110: 2020 6966 2073 656c 662e 6c6f 673a 0a20    if self.log:. 
-00016120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016130: 2020 2073 656c 662e 6c6f 6767 6572 2e64     self.logger.d
-00016140: 6562 7567 2822 6e6f 7420 7570 6461 7469  ebug("not updati
-00016150: 6e67 2074 2d65 6c6c 6970 736f 6964 222c  ng t-ellipsoid",
-00016160: 2065 7863 5f69 6e66 6f3d 5472 7565 290a   exc_info=True).
-00016170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016180: 2020 2020 7365 6c66 2e74 7265 6769 6f6e      self.tregion
-00016190: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
-000161a0: 2072 6574 7572 6e20 7570 6461 7465 640a   return updated.
-000161b0: 0a20 2020 2064 6566 205f 6578 7061 6e64  .    def _expand
-000161c0: 5f6e 6f64 6573 5f62 6566 6f72 6528 7365  _nodes_before(se
-000161d0: 6c66 2c20 4c6d 696e 2c20 6e6e 6f64 6573  lf, Lmin, nnodes
-000161e0: 5f6e 6565 6465 642c 2075 7064 6174 655f  _needed, update_
-000161f0: 696e 7465 7276 616c 5f6e 6361 6c6c 293a  interval_ncall):
-00016200: 0a20 2020 2020 2020 2022 2222 4578 7061  .        """Expa
-00016210: 6e64 206e 6f64 6573 2062 6566 6f72 6520  nd nodes before 
-00016220: 604c 6d69 6e60 2074 6f20 6861 7665 2060  `Lmin` to have `
-00016230: 6e6e 6f64 6573 5f6e 6565 6465 6460 2e0a  nnodes_needed`..
-00016240: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00016250: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00016260: 2d0a 2020 2020 2020 2020 4c6c 6f3a 2066  -.        Llo: f
-00016270: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
-00016280: 206c 6f77 6573 7420 7061 7265 6e74 2073   lowest parent s
-00016290: 616d 706c 6564 2028 2d6e 702e 696e 6620  ampled (-np.inf 
-000162a0: 6966 2073 616d 706c 696e 6720 6672 6f6d  if sampling from
-000162b0: 2072 6f6f 7429 0a20 2020 2020 2020 204c   root).        L
-000162c0: 6869 3a20 666c 6f61 740a 2020 2020 2020  hi: float.      
-000162d0: 2020 2020 2020 4c6d 696e 0a20 2020 2020        Lmin.     
-000162e0: 2020 2074 6172 6765 745f 6d69 6e5f 6e75     target_min_nu
-000162f0: 6d5f 6368 696c 6472 656e 3a20 696e 740a  m_children: int.
-00016300: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
-00016310: 6572 206f 6620 6368 696c 6472 656e 2074  er of children t
-00016320: 6861 7420 6e65 6564 2074 6f20 6265 206d  hat need to be m
-00016330: 6169 6e74 6169 6e65 6420 6265 7477 6565  aintained betwee
-00016340: 6e20 4c6c 6f2c 204c 6869 0a0a 2020 2020  n Llo, Lhi..    
-00016350: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00016360: 7365 6c66 2e70 6f69 6e74 7374 6f72 652e  self.pointstore.
-00016370: 7265 7365 7428 290a 2020 2020 2020 2020  reset().        
-00016380: 7061 7265 6e74 732c 2077 6569 6768 7473  parents, weights
-00016390: 203d 2066 696e 645f 6e6f 6465 735f 6265   = find_nodes_be
-000163a0: 666f 7265 2873 656c 662e 726f 6f74 2c20  fore(self.root, 
-000163b0: 4c6d 696e 290a 2020 2020 2020 2020 7461  Lmin).        ta
-000163c0: 7267 6574 5f6d 696e 5f6e 756d 5f63 6869  rget_min_num_chi
-000163d0: 6c64 7265 6e20 3d20 7365 6c66 2e5f 7769  ldren = self._wi
-000163e0: 6465 6e5f 6e6f 6465 7328 7061 7265 6e74  den_nodes(parent
-000163f0: 732c 2077 6569 6768 7473 2c20 6e6e 6f64  s, weights, nnod
-00016400: 6573 5f6e 6565 6465 642c 2075 7064 6174  es_needed, updat
-00016410: 655f 696e 7465 7276 616c 5f6e 6361 6c6c  e_interval_ncall
-00016420: 290a 2020 2020 2020 2020 6966 206c 656e  ).        if len
-00016430: 2870 6172 656e 7473 2920 3d3d 2030 3a0a  (parents) == 0:.
-00016440: 2020 2020 2020 2020 2020 2020 4c6c 6f20              Llo 
-00016450: 3d20 2d6e 702e 696e 660a 2020 2020 2020  = -np.inf.      
-00016460: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00016470: 2020 2020 4c6c 6f20 3d20 6d69 6e28 6e2e      Llo = min(n.
-00016480: 7661 6c75 6520 666f 7220 6e20 696e 2070  value for n in p
-00016490: 6172 656e 7473 290a 2020 2020 2020 2020  arents).        
-000164a0: 4c68 6920 3d20 4c6d 696e 0a20 2020 2020  Lhi = Lmin.     
-000164b0: 2020 2072 6574 7572 6e20 4c6c 6f2c 204c     return Llo, L
-000164c0: 6869 2c20 7461 7267 6574 5f6d 696e 5f6e  hi, target_min_n
-000164d0: 756d 5f63 6869 6c64 7265 6e0a 0a20 2020  um_children..   
-000164e0: 2064 6566 205f 7368 6f75 6c64 5f6e 6f64   def _should_nod
-000164f0: 655f 6265 5f65 7870 616e 6465 6428 0a20  e_be_expanded(. 
-00016500: 2020 2020 2020 2073 656c 662c 2069 742c         self, it,
-00016510: 204c 6c6f 2c20 4c68 692c 206d 696e 696d   Llo, Lhi, minim
-00016520: 616c 5f77 6964 7468 735f 7365 7175 656e  al_widths_sequen
-00016530: 6365 2c20 7461 7267 6574 5f6d 696e 5f6e  ce, target_min_n
-00016540: 756d 5f63 6869 6c64 7265 6e2c 0a20 2020  um_children,.   
-00016550: 2020 2020 206e 6f64 652c 2070 6172 616c       node, paral
-00016560: 6c65 6c5f 7661 6c75 6573 2c20 6d61 785f  lel_values, max_
-00016570: 6e63 616c 6c73 2c20 6d61 785f 6974 6572  ncalls, max_iter
-00016580: 732c 206c 6976 655f 706f 696e 7473 5f68  s, live_points_h
-00016590: 6561 6c74 6879 0a20 2020 2029 3a0a 2020  ealthy.    ):.  
-000165a0: 2020 2020 2020 2222 2243 6865 636b 2069        """Check i
-000165b0: 6620 6e6f 6465 206e 6565 6473 206e 6577  f node needs new
-000165c0: 2063 6869 6c64 7265 6e2e 0a0a 2020 2020   children...    
-000165d0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000165e0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000165f0: 2020 2020 6578 7061 6e64 5f6e 6f64 653a      expand_node:
-00016600: 2062 6f6f 6c0a 2020 2020 2020 2020 2020   bool.          
-00016610: 2020 5472 7565 2069 6620 7368 6f75 6c64    True if should
-00016620: 2073 616d 706c 6520 6120 6e65 7720 706f   sample a new po
-00016630: 696e 740a 2020 2020 2020 2020 2020 2020  int.            
-00016640: 6261 7365 6420 6f6e 2074 6869 7320 6e6f  based on this no
-00016650: 6465 2028 6162 6f76 6520 6974 7320 6c69  de (above its li
-00016660: 6b65 6c69 686f 6f64 2076 616c 7565 204c  kelihood value L
-00016670: 6d69 6e29 2e0a 0a20 2020 2020 2020 2050  min)...        P
-00016680: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00016690: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-000166a0: 2020 2020 2069 743a 2069 6e74 0a20 2020       it: int.   
-000166b0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-000166c0: 2069 7465 7261 7469 6f6e 0a20 2020 2020   iteration.     
-000166d0: 2020 206e 6f64 653a 206e 6f64 650a 2020     node: node.  
-000166e0: 2020 2020 2020 2020 2020 5468 6520 6e6f            The no
-000166f0: 6465 2074 6f20 636f 6e73 6964 6572 0a20  de to consider. 
-00016700: 2020 2020 2020 2070 6172 616c 6c65 6c5f         parallel_
-00016710: 7661 6c75 6573 3a20 6172 7261 7920 6f66  values: array of
-00016720: 2066 6c6f 6174 730a 2020 2020 2020 2020   floats.        
-00016730: 2020 2020 6c6f 676c 696b 656c 6968 6f6f      loglikelihoo
-00016740: 6473 206f 6620 6c69 7665 2070 6f69 6e74  ds of live point
-00016750: 730a 2020 2020 2020 2020 6d61 785f 6e63  s.        max_nc
-00016760: 616c 6c73 3a20 696e 740a 2020 2020 2020  alls: int.      
-00016770: 2020 2020 2020 6d61 7869 6d75 6d20 6e75        maximum nu
-00016780: 6d62 6572 206f 6620 6c69 6b65 6c69 686f  mber of likeliho
-00016790: 6f64 2066 756e 6374 696f 6e20 6361 6c6c  od function call
-000167a0: 7320 616c 6c6f 7765 640a 2020 2020 2020  s allowed.      
-000167b0: 2020 6d61 785f 6974 6572 733a 2069 6e74    max_iters: int
-000167c0: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
-000167d0: 696d 756d 206e 756d 6265 7220 6f66 206e  imum number of n
-000167e0: 6573 7465 6420 7361 6d70 6c69 6e67 2069  ested sampling i
-000167f0: 7465 7261 7469 6f6e 2061 6c6c 6f77 6564  teration allowed
-00016800: 0a20 2020 2020 2020 204c 6c6f 3a20 666c  .        Llo: fl
-00016810: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
-00016820: 6c6f 7765 7220 6c6f 676c 696b 656c 6968  lower loglikelih
-00016830: 6f6f 6420 626f 756e 6420 666f 7220 7468  ood bound for th
-00016840: 6520 7374 7261 7465 6779 0a20 2020 2020  e strategy.     
-00016850: 2020 204c 6869 3a20 666c 6f61 740a 2020     Lhi: float.  
-00016860: 2020 2020 2020 2020 2020 7570 7065 7220            upper 
-00016870: 6c6f 676c 696b 656c 6968 6f6f 6420 626f  loglikelihood bo
-00016880: 756e 6420 666f 7220 7468 6520 7374 7261  und for the stra
-00016890: 7465 6779 0a20 2020 2020 2020 206d 696e  tegy.        min
-000168a0: 696d 616c 5f77 6964 7468 735f 7365 7175  imal_widths_sequ
-000168b0: 656e 6365 3a20 6c69 7374 0a20 2020 2020  ence: list.     
-000168c0: 2020 2020 2020 206c 6973 7420 6f66 206c         list of l
-000168d0: 696b 656c 6968 6f6f 6420 696e 7465 7276  ikelihood interv
-000168e0: 616c 7320 7769 7468 206d 696e 696d 756d  als with minimum
-000168f0: 206e 756d 6265 7220 6f66 206c 6976 6520   number of live 
-00016900: 706f 696e 7473 0a20 2020 2020 2020 2074  points.        t
-00016910: 6172 6765 745f 6d69 6e5f 6e75 6d5f 6368  arget_min_num_ch
-00016920: 696c 6472 656e 3a0a 2020 2020 2020 2020  ildren:.        
-00016930: 2020 2020 6d69 6e69 6d75 6d20 6e75 6d62      minimum numb
-00016940: 6572 206f 6620 6c69 7665 2070 6f69 6e74  er of live point
-00016950: 7320 6375 7272 656e 746c 7920 7461 7267  s currently targ
-00016960: 6574 6564 0a20 2020 2020 2020 206c 6976  eted.        liv
-00016970: 655f 706f 696e 7473 5f68 6561 6c74 6879  e_points_healthy
-00016980: 3a20 626f 6f6c 0a20 2020 2020 2020 2020  : bool.         
-00016990: 2020 2069 6e64 6963 6174 6573 2077 6865     indicates whe
-000169a0: 7468 6572 2074 6865 206c 6976 6520 706f  ther the live po
-000169b0: 696e 7473 2068 6176 6520 6265 636f 6d65  ints have become
-000169c0: 0a20 2020 2020 2020 2020 2020 206c 696e  .            lin
-000169d0: 6561 726c 7920 6465 7065 6e64 656e 7420  early dependent 
-000169e0: 2863 6f76 6172 6961 6e63 6520 6e6f 7420  (covariance not 
-000169f0: 6675 6c6c 2072 616e 6b29 0a20 2020 2020  full rank).     
-00016a00: 2020 2020 2020 206f 7220 6861 7665 2061         or have a
-00016a10: 7474 6169 6e65 6420 7468 6520 7361 6d65  ttained the same
-00016a20: 2065 7861 6374 2076 616c 7565 2069 6e20   exact value in 
-00016a30: 736f 6d65 2070 6172 616d 6574 6572 2e0a  some parameter..
-00016a40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016a50: 2020 2020 204c 6d69 6e20 3d20 6e6f 6465       Lmin = node
-00016a60: 2e76 616c 7565 0a20 2020 2020 2020 206e  .value.        n
-00016a70: 6c69 7665 203d 206c 656e 2870 6172 616c  live = len(paral
-00016a80: 6c65 6c5f 7661 6c75 6573 290a 0a20 2020  lel_values)..   
-00016a90: 2020 2020 2069 6620 6e6f 7420 284c 6d69       if not (Lmi
-00016aa0: 6e20 3c3d 204c 6869 2061 6e64 204c 6c6f  n <= Lhi and Llo
-00016ab0: 203c 3d20 4c68 6929 3a0a 2020 2020 2020   <= Lhi):.      
-00016ac0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00016ad0: 7365 0a0a 2020 2020 2020 2020 6966 206e  se..        if n
-00016ae0: 6f74 206c 6976 655f 706f 696e 7473 5f68  ot live_points_h
-00016af0: 6561 6c74 6879 3a0a 2020 2020 2020 2020  ealthy:.        
-00016b00: 2020 2020 6966 2073 656c 662e 6c6f 673a      if self.log:
-00016b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016b20: 2073 656c 662e 6c6f 6767 6572 2e64 6562   self.logger.deb
-00016b30: 7567 2822 6e6f 7420 6578 7061 6e64 696e  ug("not expandin
-00016b40: 672c 2062 6563 6175 7365 206c 6976 6520  g, because live 
-00016b50: 706f 696e 7473 2061 7265 206c 696e 6561  points are linea
-00016b60: 726c 7920 6465 7065 6e64 656e 7422 290a  rly dependent").
-00016b70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00016b80: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
-00016b90: 2020 2320 736f 6d65 2072 6561 736f 6e73    # some reasons
-00016ba0: 2074 6f20 7374 6f70 3a0a 2020 2020 2020   to stop:.      
-00016bb0: 2020 6966 2069 7420 3e20 303a 0a20 2020    if it > 0:.   
-00016bc0: 2020 2020 2020 2020 2069 6620 6d61 785f           if max_
-00016bd0: 6e63 616c 6c73 2069 7320 6e6f 7420 4e6f  ncalls is not No
-00016be0: 6e65 2061 6e64 2073 656c 662e 6e63 616c  ne and self.ncal
-00016bf0: 6c20 3e3d 206d 6178 5f6e 6361 6c6c 733a  l >= max_ncalls:
-00016c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c10: 2023 2070 7269 6e74 2822 6e6f 7420 6578   # print("not ex
-00016c20: 7061 6e64 696e 672c 2062 6563 6175 7365  panding, because
-00016c30: 2061 626f 7665 206d 6178 5f6e 6361 6c6c   above max_ncall
-00016c40: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00016c50: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-00016c60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016c70: 6d61 785f 6974 6572 7320 6973 206e 6f74  max_iters is not
-00016c80: 204e 6f6e 6520 616e 6420 6974 203e 3d20   None and it >= 
-00016c90: 6d61 785f 6974 6572 733a 0a20 2020 2020  max_iters:.     
-00016ca0: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
-00016cb0: 6e74 2822 6e6f 7420 6578 7061 6e64 696e  nt("not expandin
-00016cc0: 672c 2062 6563 6175 7365 2061 626f 7665  g, because above
-00016cd0: 206d 6178 5f69 7465 7273 2229 0a20 2020   max_iters").   
-00016ce0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00016cf0: 7572 6e20 4661 6c73 650a 0a20 2020 2020  urn False..     
-00016d00: 2020 2023 2069 6e20 6120 706c 6174 6561     # in a platea
-00016d10: 752c 206f 6e6c 7920 7368 7269 6e6b 2028  u, only shrink (
-00016d20: 466f 776c 6965 2b32 3032 3029 0a20 2020  Fowlie+2020).   
-00016d30: 2020 2020 2069 6620 284c 6d69 6e20 3d3d       if (Lmin ==
-00016d40: 2070 6172 616c 6c65 6c5f 7661 6c75 6573   parallel_values
-00016d50: 292e 7375 6d28 2920 3e20 313a 0a20 2020  ).sum() > 1:.   
-00016d60: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00016d70: 2e6c 6f67 3a0a 2020 2020 2020 2020 2020  .log:.          
-00016d80: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
-00016d90: 722e 6465 6275 6728 2250 6c61 7465 6175  r.debug("Plateau
-00016da0: 2064 6574 6563 7465 6420 6174 204c 3d25   detected at L=%
-00016db0: 652c 206e 6f74 2072 6570 6c61 6369 6e67  e, not replacing
-00016dc0: 206c 6976 6520 706f 696e 742e 2220 2520   live point." % 
-00016dd0: 4c6d 696e 290a 2020 2020 2020 2020 2020  Lmin).          
-00016de0: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-00016df0: 2020 2020 2020 2020 6578 7061 6e64 5f6e          expand_n
-00016e00: 6f64 6520 3d20 4661 6c73 650a 2020 2020  ode = False.    
-00016e10: 2020 2020 2320 7765 2073 686f 756c 6420      # we should 
-00016e20: 636f 6e74 696e 7565 2074 6f20 7072 6f67  continue to prog
-00016e30: 7265 7373 2074 6f77 6172 6473 204c 6869  ress towards Lhi
-00016e40: 0a20 2020 2020 2020 2077 6869 6c65 204c  .        while L
-00016e50: 6d69 6e20 3e20 6d69 6e69 6d61 6c5f 7769  min > minimal_wi
-00016e60: 6474 6873 5f73 6571 7565 6e63 655b 305d  dths_sequence[0]
-00016e70: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
-00016e80: 206d 696e 696d 616c 5f77 6964 7468 735f   minimal_widths_
-00016e90: 7365 7175 656e 6365 2e70 6f70 2830 290a  sequence.pop(0).
-00016ea0: 0a20 2020 2020 2020 2023 2067 6574 2063  .        # get c
-00016eb0: 7572 7265 6e74 6c79 2064 6573 6972 6564  urrently desired
-00016ec0: 2077 6964 7468 0a20 2020 2020 2020 2069   width.        i
-00016ed0: 6620 7365 6c66 2e72 6567 696f 6e20 6973  f self.region is
-00016ee0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00016ef0: 2020 206d 696e 696d 616c 5f77 6964 7468     minimal_width
-00016f00: 5f63 6c75 7374 6572 7320 3d20 300a 2020  _clusters = 0.  
-00016f10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00016f20: 2020 2020 2020 2020 2320 636f 6d70 7574          # comput
-00016f30: 6520 6e75 6d62 6572 206f 6620 636c 7573  e number of clus
-00016f40: 7465 7273 2077 6974 6820 6d6f 7265 2074  ters with more t
-00016f50: 6861 6e20 3120 656c 656d 656e 740a 2020  han 1 element.  
-00016f60: 2020 2020 2020 2020 2020 5f2c 2063 6c75            _, clu
-00016f70: 7374 6572 5f73 697a 6573 203d 206e 702e  ster_sizes = np.
-00016f80: 756e 6971 7565 2873 656c 662e 7265 6769  unique(self.regi
-00016f90: 6f6e 2e74 7261 6e73 666f 726d 4c61 7965  on.transformLaye
-00016fa0: 722e 636c 7573 7465 7269 6473 2c20 7265  r.clusterids, re
-00016fb0: 7475 726e 5f63 6f75 6e74 733d 5472 7565  turn_counts=True
-00016fc0: 290a 2020 2020 2020 2020 2020 2020 6e63  ).            nc
-00016fd0: 6c75 7374 6572 7320 3d20 2863 6c75 7374  lusters = (clust
-00016fe0: 6572 5f73 697a 6573 203e 2031 292e 7375  er_sizes > 1).su
-00016ff0: 6d28 290a 2020 2020 2020 2020 2020 2020  m().            
-00017000: 6d69 6e69 6d61 6c5f 7769 6474 685f 636c  minimal_width_cl
-00017010: 7573 7465 7273 203d 2073 656c 662e 636c  usters = self.cl
-00017020: 7573 7465 725f 6e75 6d5f 6c69 7665 5f70  uster_num_live_p
-00017030: 6f69 6e74 7320 2a20 6e63 6c75 7374 6572  oints * ncluster
-00017040: 730a 0a20 2020 2020 2020 206d 696e 696d  s..        minim
-00017050: 616c 5f77 6964 7468 203d 206d 6178 286d  al_width = max(m
-00017060: 696e 696d 616c 5f77 6964 7468 735f 7365  inimal_widths_se
-00017070: 7175 656e 6365 5b30 5d5b 315d 2c20 6d69  quence[0][1], mi
-00017080: 6e69 6d61 6c5f 7769 6474 685f 636c 7573  nimal_width_clus
-00017090: 7465 7273 290a 0a20 2020 2020 2020 2023  ters)..        #
-000170a0: 2069 6620 616c 7265 6164 7920 6861 7320   if already has 
-000170b0: 6368 696c 6472 656e 2c20 6e6f 206e 6565  children, no nee
-000170c0: 6420 746f 2065 7870 616e 640a 2020 2020  d to expand.    
-000170d0: 2020 2020 2320 6966 2077 6520 6172 6520      # if we are 
-000170e0: 7769 6465 7220 7468 616e 2074 6865 2077  wider than the w
-000170f0: 6964 7468 2072 6571 7569 7265 640a 2020  idth required.  
-00017100: 2020 2020 2020 2320 7765 2064 6f20 6e6f        # we do no
-00017110: 7420 6e65 6564 2074 6f20 6578 7061 6e64  t need to expand
-00017120: 2074 6869 7320 6f6e 650a 2020 2020 2020   this one.      
-00017130: 2020 2320 6578 7061 6e64 5f6e 6f64 6520    # expand_node 
-00017140: 3d20 6c65 6e28 6e6f 6465 2e63 6869 6c64  = len(node.child
-00017150: 7265 6e29 203d 3d20 300a 2020 2020 2020  ren) == 0.      
-00017160: 2020 2320 7072 6566 6572 2031 2063 6869    # prefer 1 chi
-00017170: 6c64 2c20 6f72 2074 6865 206e 756d 6265  ld, or the numbe
-00017180: 7220 7265 7175 6972 6564 2c20 6966 2073  r required, if s
-00017190: 7065 6369 6669 6564 0a20 2020 2020 2020  pecified.       
-000171a0: 206e 6d69 6e20 3d20 7461 7267 6574 5f6d   nmin = target_m
-000171b0: 696e 5f6e 756d 5f63 6869 6c64 7265 6e2e  in_num_children.
-000171c0: 6765 7428 6e6f 6465 2e69 642c 2031 2920  get(node.id, 1) 
-000171d0: 6966 2074 6172 6765 745f 6d69 6e5f 6e75  if target_min_nu
-000171e0: 6d5f 6368 696c 6472 656e 2065 6c73 6520  m_children else 
-000171f0: 310a 2020 2020 2020 2020 6578 7061 6e64  1.        expand
-00017200: 5f6e 6f64 6520 3d20 6c65 6e28 6e6f 6465  _node = len(node
-00017210: 2e63 6869 6c64 7265 6e29 203c 206e 6d69  .children) < nmi
-00017220: 6e0a 2020 2020 2020 2020 2320 7072 696e  n.        # prin
-00017230: 7428 226e 6f74 2065 7870 616e 6469 6e67  t("not expanding
-00017240: 2c20 6265 6361 7573 6520 7765 2061 7265  , because we are
-00017250: 2071 7569 7465 2077 6964 6522 2c20 6e6c   quite wide", nl
-00017260: 6976 652c 206d 696e 696d 616c 5f77 6964  ive, minimal_wid
-00017270: 7468 2c20 6d69 6e69 6d61 6c5f 7769 6474  th, minimal_widt
-00017280: 6873 5f73 6571 7565 6e63 6529 0a20 2020  hs_sequence).   
-00017290: 2020 2020 2023 2062 7574 2077 6520 6861       # but we ha
-000172a0: 7665 2074 6f20 6578 7061 6e64 2074 6865  ve to expand the
-000172b0: 2066 6972 7374 2069 7465 7261 7469 6f6e   first iteration
-000172c0: 2c0a 2020 2020 2020 2020 2320 6f74 6865  ,.        # othe
-000172d0: 7277 6973 6520 7468 6520 696e 7465 6772  rwise the integr
-000172e0: 6174 6f72 206e 6576 6572 2073 6574 7320  ator never sets 
-000172f0: 480a 2020 2020 2020 2020 746f 6f5f 7769  H.        too_wi
-00017300: 6465 203d 206e 6c69 7665 203e 206d 696e  de = nlive > min
-00017310: 696d 616c 5f77 6964 7468 2061 6e64 2069  imal_width and i
-00017320: 7420 3e20 300a 0a20 2020 2020 2020 2072  t > 0..        r
-00017330: 6574 7572 6e20 6578 7061 6e64 5f6e 6f64  eturn expand_nod
-00017340: 6520 616e 6420 6e6f 7420 746f 6f5f 7769  e and not too_wi
-00017350: 6465 0a0a 2020 2020 6465 6620 7275 6e28  de..    def run(
-00017360: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00017370: 662c 0a20 2020 2020 2020 2020 2020 2075  f,.            u
-00017380: 7064 6174 655f 696e 7465 7276 616c 5f76  pdate_interval_v
-00017390: 6f6c 756d 655f 6672 6163 7469 6f6e 3d30  olume_fraction=0
-000173a0: 2e38 2c0a 2020 2020 2020 2020 2020 2020  .8,.            
-000173b0: 7570 6461 7465 5f69 6e74 6572 7661 6c5f  update_interval_
-000173c0: 6e63 616c 6c3d 4e6f 6e65 2c0a 2020 2020  ncall=None,.    
-000173d0: 2020 2020 2020 2020 6c6f 675f 696e 7465          log_inte
-000173e0: 7276 616c 3d4e 6f6e 652c 0a20 2020 2020  rval=None,.     
-000173f0: 2020 2020 2020 2073 686f 775f 7374 6174         show_stat
-00017400: 7573 3d54 7275 652c 0a20 2020 2020 2020  us=True,.       
-00017410: 2020 2020 2076 697a 5f63 616c 6c62 6163       viz_callbac
-00017420: 6b3d 2761 7574 6f27 2c0a 2020 2020 2020  k='auto',.      
-00017430: 2020 2020 2020 646c 6f67 7a3d 302e 352c        dlogz=0.5,
-00017440: 0a20 2020 2020 2020 2020 2020 2064 4b4c  .            dKL
-00017450: 3d30 2e35 2c0a 2020 2020 2020 2020 2020  =0.5,.          
-00017460: 2020 6672 6163 5f72 656d 6169 6e3d 302e    frac_remain=0.
-00017470: 3031 2c0a 2020 2020 2020 2020 2020 2020  01,.            
-00017480: 4c65 7073 696c 6f6e 3d30 2e30 3031 2c0a  Lepsilon=0.001,.
-00017490: 2020 2020 2020 2020 2020 2020 6d69 6e5f              min_
-000174a0: 6573 733d 3430 302c 0a20 2020 2020 2020  ess=400,.       
-000174b0: 2020 2020 206d 6178 5f69 7465 7273 3d4e       max_iters=N
-000174c0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-000174d0: 206d 6178 5f6e 6361 6c6c 733d 4e6f 6e65   max_ncalls=None
-000174e0: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
-000174f0: 785f 6e75 6d5f 696d 7072 6f76 656d 656e  x_num_improvemen
-00017500: 745f 6c6f 6f70 733d 2d31 2c0a 2020 2020  t_loops=-1,.    
-00017510: 2020 2020 2020 2020 6d69 6e5f 6e75 6d5f          min_num_
-00017520: 6c69 7665 5f70 6f69 6e74 733d 3430 302c  live_points=400,
-00017530: 0a20 2020 2020 2020 2020 2020 2063 6c75  .            clu
-00017540: 7374 6572 5f6e 756d 5f6c 6976 655f 706f  ster_num_live_po
-00017550: 696e 7473 3d34 302c 0a20 2020 2020 2020  ints=40,.       
-00017560: 2020 2020 2069 6e73 6572 7469 6f6e 5f74       insertion_t
-00017570: 6573 745f 7769 6e64 6f77 3d31 302c 0a20  est_window=10,. 
-00017580: 2020 2020 2020 2020 2020 2069 6e73 6572             inser
-00017590: 7469 6f6e 5f74 6573 745f 7a73 636f 7265  tion_test_zscore
-000175a0: 5f74 6872 6573 686f 6c64 3d34 2c0a 2020  _threshold=4,.  
-000175b0: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
-000175c0: 5f63 6c61 7373 3d4d 4c46 7269 656e 6473  _class=MLFriends
-000175d0: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
-000175e0: 6465 6e5f 6265 666f 7265 5f69 6e69 7469  den_before_initi
-000175f0: 616c 5f70 6c61 7465 6175 5f6e 756d 5f77  al_plateau_num_w
-00017600: 6172 6e3d 3130 3030 302c 0a20 2020 2020  arn=10000,.     
-00017610: 2020 2020 2020 2077 6964 656e 5f62 6566         widen_bef
-00017620: 6f72 655f 696e 6974 6961 6c5f 706c 6174  ore_initial_plat
-00017630: 6561 755f 6e75 6d5f 6d61 783d 3530 3030  eau_num_max=5000
-00017640: 302c 0a20 2020 2029 3a0a 2020 2020 2020  0,.    ):.      
-00017650: 2020 2222 2252 756e 2075 6e74 696c 2074    """Run until t
-00017660: 6172 6765 7420 636f 6e76 6572 6765 6e63  arget convergenc
-00017670: 6520 6372 6974 6572 6961 2061 7265 2066  e criteria are f
-00017680: 756c 6669 6c6c 6564 2e0a 0a20 2020 2020  ulfilled...     
-00017690: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-000176a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-000176b0: 0a20 2020 2020 2020 2075 7064 6174 655f  .        update_
-000176c0: 696e 7465 7276 616c 5f76 6f6c 756d 655f  interval_volume_
-000176d0: 6672 6163 7469 6f6e 3a20 666c 6f61 740a  fraction: float.
-000176e0: 2020 2020 2020 2020 2020 2020 5570 6461              Upda
-000176f0: 7465 2072 6567 696f 6e20 7768 656e 2074  te region when t
-00017700: 6865 2076 6f6c 756d 6520 7368 7275 6e6b  he volume shrunk
-00017710: 2062 7920 7468 6973 2061 6d6f 756e 742e   by this amount.
-00017720: 0a0a 2020 2020 2020 2020 7570 6461 7465  ..        update
-00017730: 5f69 6e74 6572 7661 6c5f 6e63 616c 6c3a  _interval_ncall:
-00017740: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-00017750: 2055 7064 6174 6520 7265 6769 6f6e 2061   Update region a
-00017760: 6674 6572 2075 7064 6174 655f 696e 7465  fter update_inte
-00017770: 7276 616c 5f6e 6361 6c6c 206c 696b 656c  rval_ncall likel
-00017780: 6968 6f6f 6420 6361 6c6c 7320 286e 6f74  ihood calls (not
-00017790: 2075 7365 6429 2e0a 0a20 2020 2020 2020   used)...       
-000177a0: 206c 6f67 5f69 6e74 6572 7661 6c3a 2069   log_interval: i
-000177b0: 6e74 0a20 2020 2020 2020 2020 2020 2055  nt.            U
-000177c0: 7064 6174 6520 7374 646f 7574 2073 7461  pdate stdout sta
-000177d0: 7475 7320 6c69 6e65 2065 7665 7279 206c  tus line every l
-000177e0: 6f67 5f69 6e74 6572 7661 6c20 6974 6572  og_interval iter
-000177f0: 6174 696f 6e73 0a0a 2020 2020 2020 2020  ations..        
-00017800: 7368 6f77 5f73 7461 7475 733a 2062 6f6f  show_status: boo
-00017810: 6c0a 2020 2020 2020 2020 2020 2020 7368  l.            sh
-00017820: 6f77 2069 6e74 6567 7261 7469 6f6e 2070  ow integration p
-00017830: 726f 6772 6573 7320 6173 2061 2073 7461  rogress as a sta
-00017840: 7475 7320 6c69 6e65 2e0a 2020 2020 2020  tus line..      
-00017850: 2020 2020 2020 4966 206e 6f20 6f75 7470        If no outp
-00017860: 7574 2064 6573 6972 6564 2c20 7365 7420  ut desired, set 
-00017870: 746f 2046 616c 7365 2e0a 0a20 2020 2020  to False...     
-00017880: 2020 2076 697a 5f63 616c 6c62 6163 6b3a     viz_callback:
-00017890: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-000178a0: 2020 2020 2020 6361 6c6c 6261 636b 2066        callback f
-000178b0: 756e 6374 696f 6e20 7768 656e 2072 6567  unction when reg
-000178c0: 696f 6e20 7761 7320 7265 6275 696c 742e  ion was rebuilt.
-000178d0: 2041 6c6c 6f77 7320 746f 0a20 2020 2020   Allows to.     
-000178e0: 2020 2020 2020 2073 686f 7720 6375 7272         show curr
-000178f0: 656e 7420 7374 6174 6520 6f66 2074 6865  ent state of the
-00017900: 206c 6976 6520 706f 696e 7473 2e0a 2020   live points..  
-00017910: 2020 2020 2020 2020 2020 5365 6520 3a70            See :p
-00017920: 793a 6675 6e63 3a60 6e69 6365 6c6f 6767  y:func:`nicelogg
-00017930: 6572 6020 6f72 203a 7079 3a63 6c61 7373  er` or :py:class
-00017940: 3a60 4c69 7665 506f 696e 7473 5769 6467  :`LivePointsWidg
-00017950: 6574 602e 0a20 2020 2020 2020 2020 2020  et`..           
-00017960: 2049 6620 6e6f 206f 7574 7075 7420 6465   If no output de
-00017970: 7369 7265 642c 2073 6574 2074 6f20 4661  sired, set to Fa
-00017980: 6c73 652e 0a0a 2020 2020 2020 2020 646c  lse...        dl
-00017990: 6f67 7a3a 2066 6c6f 6174 0a20 2020 2020  ogz: float.     
-000179a0: 2020 2020 2020 2054 6172 6765 7420 6576         Target ev
-000179b0: 6964 656e 6365 2075 6e63 6572 7461 696e  idence uncertain
-000179c0: 7479 2e20 5468 6973 2069 7320 7468 6520  ty. This is the 
-000179d0: 7374 640a 2020 2020 2020 2020 2020 2020  std.            
-000179e0: 6265 7477 6565 6e20 626f 6f74 7374 7261  between bootstra
-000179f0: 7070 6564 206c 6f67 7a20 696e 7465 6772  pped logz integr
-00017a00: 6174 6f72 732e 0a0a 2020 2020 2020 2020  ators...        
-00017a10: 644b 4c3a 2066 6c6f 6174 0a20 2020 2020  dKL: float.     
-00017a20: 2020 2020 2020 2054 6172 6765 7420 706f         Target po
-00017a30: 7374 6572 696f 7220 756e 6365 7274 6169  sterior uncertai
-00017a40: 6e74 792e 2054 6869 7320 6973 2074 6865  nty. This is the
-00017a50: 0a20 2020 2020 2020 2020 2020 204b 756c  .            Kul
-00017a60: 6c62 6163 6b2d 4c65 6962 6c65 7220 6469  lback-Leibler di
-00017a70: 7665 7267 656e 6365 2069 6e20 6e61 7420  vergence in nat 
-00017a80: 6265 7477 6565 6e20 626f 6f74 7374 7261  between bootstra
-00017a90: 7070 6564 2069 6e74 6567 7261 746f 7273  pped integrators
-00017aa0: 2e0a 0a20 2020 2020 2020 2066 7261 635f  ...        frac_
-00017ab0: 7265 6d61 696e 3a20 666c 6f61 740a 2020  remain: float.  
-00017ac0: 2020 2020 2020 2020 2020 496e 7465 6772            Integr
-00017ad0: 6174 6520 756e 7469 6c20 7468 6973 2066  ate until this f
-00017ae0: 7261 6374 696f 6e20 6f66 2074 6865 2069  raction of the i
-00017af0: 6e74 6567 7261 6c20 6973 206c 6566 7420  ntegral is left 
-00017b00: 696e 2074 6865 2072 656d 6169 6e64 6572  in the remainder
-00017b10: 2e0a 2020 2020 2020 2020 2020 2020 5365  ..            Se
-00017b20: 7420 746f 2061 206c 6f77 206e 756d 6265  t to a low numbe
-00017b30: 7220 2831 652d 3220 2e2e 2e20 3165 2d35  r (1e-2 ... 1e-5
-00017b40: 2920 746f 206d 616b 6520 7375 7265 2070  ) to make sure p
-00017b50: 6561 6b73 2061 7265 2064 6973 636f 7665  eaks are discove
-00017b60: 7265 642e 0a20 2020 2020 2020 2020 2020  red..           
-00017b70: 2053 6574 2074 6f20 6120 6869 6768 6572   Set to a higher
-00017b80: 206e 756d 6265 7220 2830 2e35 2920 6966   number (0.5) if
-00017b90: 2079 6f75 206b 6e6f 7720 7468 6520 706f   you know the po
-00017ba0: 7374 6572 696f 7220 6973 2073 696d 706c  sterior is simpl
-00017bb0: 652e 0a0a 2020 2020 2020 2020 4c65 7073  e...        Leps
-00017bc0: 696c 6f6e 3a20 666c 6f61 740a 2020 2020  ilon: float.    
-00017bd0: 2020 2020 2020 2020 5465 726d 696e 6174          Terminat
-00017be0: 6520 7768 656e 206c 6976 6520 706f 696e  e when live poin
-00017bf0: 7420 6c69 6b65 6c69 686f 6f64 7320 6172  t likelihoods ar
-00017c00: 6520 616c 6c20 7468 6520 7361 6d65 2c0a  e all the same,.
-00017c10: 2020 2020 2020 2020 2020 2020 7769 7468              with
-00017c20: 696e 204c 6570 7369 6c6f 6e20 746f 6c65  in Lepsilon tole
-00017c30: 7261 6e63 652e 2049 6e63 7265 6173 6520  rance. Increase 
-00017c40: 7468 6973 2077 6865 6e20 796f 7572 206c  this when your l
-00017c50: 696b 656c 6968 6f6f 640a 2020 2020 2020  ikelihood.      
-00017c60: 2020 2020 2020 6675 6e63 7469 6f6e 2069        function i
-00017c70: 7320 696e 6163 6375 7261 7465 2c20 746f  s inaccurate, to
-00017c80: 2061 766f 6964 2075 6e6e 6563 6573 7361   avoid unnecessa
-00017c90: 7279 2073 6561 7263 682e 0a0a 2020 2020  ry search...    
-00017ca0: 2020 2020 6d69 6e5f 6573 733a 2069 6e74      min_ess: int
-00017cb0: 0a20 2020 2020 2020 2020 2020 2054 6172  .            Tar
-00017cc0: 6765 7420 6e75 6d62 6572 206f 6620 6566  get number of ef
-00017cd0: 6665 6374 6976 6520 706f 7374 6572 696f  fective posterio
-00017ce0: 7220 7361 6d70 6c65 732e 0a0a 2020 2020  r samples...    
-00017cf0: 2020 2020 6d61 785f 6974 6572 733a 2069      max_iters: i
-00017d00: 6e74 0a20 2020 2020 2020 2020 2020 206d  nt.            m
-00017d10: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
-00017d20: 2069 6e74 6567 7261 7469 6f6e 2069 7465   integration ite
-00017d30: 7261 7469 6f6e 732e 0a0a 2020 2020 2020  rations...      
-00017d40: 2020 6d61 785f 6e63 616c 6c73 3a20 696e    max_ncalls: in
-00017d50: 740a 2020 2020 2020 2020 2020 2020 7374  t.            st
-00017d60: 6f70 2061 6674 6572 2074 6869 7320 6d61  op after this ma
-00017d70: 6e79 206c 696b 656c 6968 6f6f 6420 6576  ny likelihood ev
-00017d80: 616c 7561 7469 6f6e 732e 0a0a 2020 2020  aluations...    
-00017d90: 2020 2020 6d61 785f 6e75 6d5f 696d 7072      max_num_impr
-00017da0: 6f76 656d 656e 745f 6c6f 6f70 733a 2069  ovement_loops: i
-00017db0: 6e74 0a20 2020 2020 2020 2020 2020 2072  nt.            r
-00017dc0: 756e 2829 2074 7269 6573 2074 6f20 6173  un() tries to as
-00017dd0: 7365 7373 2069 7465 7261 7469 7665 6c79  sess iteratively
-00017de0: 2077 6865 7265 206d 6f72 6520 7361 6d70   where more samp
-00017df0: 6c65 7320 6172 6520 6e65 6564 6564 2e0a  les are needed..
-00017e00: 2020 2020 2020 2020 2020 2020 5468 6973              This
-00017e10: 206e 756d 6265 7220 6c69 6d69 7473 2074   number limits t
-00017e20: 6865 206e 756d 6265 7220 6f66 2069 6d70  he number of imp
-00017e30: 726f 7665 6d65 6e74 206c 6f6f 7073 2e0a  rovement loops..
-00017e40: 0a20 2020 2020 2020 206d 696e 5f6e 756d  .        min_num
-00017e50: 5f6c 6976 655f 706f 696e 7473 3a20 696e  _live_points: in
-00017e60: 740a 2020 2020 2020 2020 2020 2020 6d69  t.            mi
-00017e70: 6e69 6d75 6d20 6e75 6d62 6572 206f 6620  nimum number of 
-00017e80: 6c69 7665 2070 6f69 6e74 7320 7468 726f  live points thro
-00017e90: 7567 686f 7574 2074 6865 2072 756e 0a0a  ughout the run..
-00017ea0: 2020 2020 2020 2020 636c 7573 7465 725f          cluster_
-00017eb0: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 733a  num_live_points:
-00017ec0: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-00017ed0: 2072 6571 7569 7265 2061 7420 6c65 6173   require at leas
-00017ee0: 7420 7468 6973 206d 616e 7920 6c69 7665  t this many live
-00017ef0: 2070 6f69 6e74 7320 7065 7220 6465 7465   points per dete
-00017f00: 6374 6564 2063 6c75 7374 6572 0a0a 2020  cted cluster..  
-00017f10: 2020 2020 2020 696e 7365 7274 696f 6e5f        insertion_
-00017f20: 7465 7374 5f7a 7363 6f72 655f 7468 7265  test_zscore_thre
-00017f30: 7368 6f6c 643a 2066 6c6f 6174 0a20 2020  shold: float.   
-00017f40: 2020 2020 2020 2020 207a 2d73 636f 7265           z-score
-00017f50: 2075 7365 6420 6173 2061 2074 6872 6573   used as a thres
-00017f60: 686f 6c64 2066 6f72 2074 6865 2069 6e73  hold for the ins
-00017f70: 6572 7469 6f6e 206f 7264 6572 2074 6573  ertion order tes
-00017f80: 742e 0a20 2020 2020 2020 2020 2020 2053  t..            S
-00017f90: 6574 2074 6f20 696e 6669 6e69 7479 2074  et to infinity t
-00017fa0: 6f20 6469 7361 626c 652e 0a0a 2020 2020  o disable...    
-00017fb0: 2020 2020 696e 7365 7274 696f 6e5f 7465      insertion_te
-00017fc0: 7374 5f77 696e 646f 773a 2069 6e74 0a20  st_window: int. 
-00017fd0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
-00017fe0: 7220 6f66 2069 7465 7261 7469 6f6e 7320  r of iterations 
-00017ff0: 6166 7465 7220 7768 6963 6820 7468 6520  after which the 
-00018000: 696e 7365 7274 696f 6e20 6f72 6465 7220  insertion order 
-00018010: 7465 7374 2069 7320 7265 7365 742e 0a0a  test is reset...
-00018020: 2020 2020 2020 2020 7265 6769 6f6e 5f63          region_c
-00018030: 6c61 7373 3a20 3a70 793a 636c 6173 733a  lass: :py:class:
-00018040: 604d 4c46 7269 656e 6473 6020 6f72 203a  `MLFriends` or :
-00018050: 7079 3a63 6c61 7373 3a60 526f 6275 7374  py:class:`Robust
-00018060: 456c 6c69 7073 6f69 6452 6567 696f 6e60  EllipsoidRegion`
-00018070: 206f 7220 3a70 793a 636c 6173 733a 6053   or :py:class:`S
-00018080: 696d 706c 6552 6567 696f 6e60 0a20 2020  impleRegion`.   
-00018090: 2020 2020 2020 2020 2057 6865 7468 6572           Whether
-000180a0: 2074 6f20 7573 6520 4d4c 4672 6965 6e64   to use MLFriend
-000180b0: 732b 656c 6c69 7073 6f69 6461 6c2b 7465  s+ellipsoidal+te
-000180c0: 6c6c 6970 736f 6964 616c 2072 6567 696f  llipsoidal regio
-000180d0: 6e20 2862 6574 7465 7220 666f 7220 6d75  n (better for mu
-000180e0: 6c74 692d 6d6f 6461 6c20 7072 6f62 6c65  lti-modal proble
-000180f0: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-00018100: 6f72 206a 7573 7420 656c 6c69 7073 6f69  or just ellipsoi
-00018110: 6461 6c20 7361 6d70 6c69 6e67 2028 6661  dal sampling (fa
-00018120: 7374 6572 2066 6f72 2068 6967 682d 6469  ster for high-di
-00018130: 6d65 6e73 696f 6e61 6c2c 2067 6175 7373  mensional, gauss
-00018140: 6961 6e2d 6c69 6b65 2070 726f 626c 656d  ian-like problem
-00018150: 7329 0a20 2020 2020 2020 2020 2020 206f  s).            o
-00018160: 7220 6120 6178 6973 2d61 6c69 676e 6564  r a axis-aligned
-00018170: 2065 6c6c 6970 736f 6964 2028 6661 7374   ellipsoid (fast
-00018180: 6573 742c 2074 6f20 6265 2063 6f6d 6269  est, to be combi
-00018190: 6e65 6420 7769 7468 2073 6c69 6365 2073  ned with slice s
-000181a0: 616d 706c 696e 6729 2e0a 0a20 2020 2020  ampling)...     
-000181b0: 2020 2077 6964 656e 5f62 6566 6f72 655f     widen_before_
-000181c0: 696e 6974 6961 6c5f 706c 6174 6561 755f  initial_plateau_
-000181d0: 6e75 6d5f 7761 726e 3a20 696e 740a 2020  num_warn: int.  
-000181e0: 2020 2020 2020 2020 2020 4966 2061 206c            If a l
-000181f0: 696b 656c 6968 6f6f 6420 706c 6174 6561  ikelihood platea
-00018200: 7520 6973 2065 6e63 6f75 6e74 6572 6564  u is encountered
-00018210: 2c20 696e 6372 6561 7365 2074 6865 206e  , increase the n
-00018220: 756d 6265 720a 2020 2020 2020 2020 2020  umber.          
-00018230: 2020 6f66 2069 6e69 7469 616c 206c 6976    of initial liv
-00018240: 6520 706f 696e 7473 2073 6f20 7468 6174  e points so that
-00018250: 206f 6e63 6520 7468 6520 706c 6174 6561   once the platea
-00018260: 7520 6973 2074 7261 7665 7273 6564 2c0a  u is traversed,.
-00018270: 2020 2020 2020 2020 2020 2020 2a6d 696e              *min
-00018280: 5f6e 756d 5f6c 6976 655f 706f 696e 7473  _num_live_points
-00018290: 2a20 6c69 7665 2070 6f69 6e74 7320 7265  * live points re
-000182a0: 6d61 696e 2e0a 2020 2020 2020 2020 2020  main..          
-000182b0: 2020 4966 2074 6865 206e 756d 6265 7220    If the number 
-000182c0: 6578 6365 6564 7320 2a77 6964 656e 5f62  exceeds *widen_b
-000182d0: 6566 6f72 655f 696e 6974 6961 6c5f 706c  efore_initial_pl
-000182e0: 6174 6561 755f 6e75 6d5f 7761 726e 2a2c  ateau_num_warn*,
-000182f0: 0a20 2020 2020 2020 2020 2020 2061 2077  .            a w
-00018300: 6172 6e69 6e67 2069 7320 7261 6973 6564  arning is raised
-00018310: 2e0a 0a20 2020 2020 2020 2077 6964 656e  ...        widen
-00018320: 5f62 6566 6f72 655f 696e 6974 6961 6c5f  _before_initial_
-00018330: 706c 6174 6561 755f 6e75 6d5f 6d61 783a  plateau_num_max:
-00018340: 2069 6e74 0a20 2020 2020 2020 2020 2020   int.           
-00018350: 2049 6620 6120 6c69 6b65 6c69 686f 6f64   If a likelihood
-00018360: 2070 6c61 7465 6175 2069 7320 656e 636f   plateau is enco
-00018370: 756e 7465 7265 642c 2069 6e63 7265 6173  untered, increas
-00018380: 6520 7468 6520 6e75 6d62 6572 0a20 2020  e the number.   
-00018390: 2020 2020 2020 2020 206f 6620 696e 6974           of init
-000183a0: 6961 6c20 6c69 7665 2070 6f69 6e74 7320  ial live points 
-000183b0: 736f 2074 6861 7420 6f6e 6365 2074 6865  so that once the
-000183c0: 2070 6c61 7465 6175 2069 7320 7472 6176   plateau is trav
-000183d0: 6572 7365 642c 0a20 2020 2020 2020 2020  ersed,.         
-000183e0: 2020 202a 6d69 6e5f 6e75 6d5f 6c69 7665     *min_num_live
-000183f0: 5f70 6f69 6e74 732a 206c 6976 6520 706f  _points* live po
-00018400: 696e 7473 2072 656d 6169 6e2c 2062 7574  ints remain, but
-00018410: 206e 6f74 206d 6f72 6520 7468 616e 0a20   not more than. 
-00018420: 2020 2020 2020 2020 2020 202a 7769 6465             *wide
-00018430: 6e5f 6265 666f 7265 5f69 6e69 7469 616c  n_before_initial
-00018440: 5f70 6c61 7465 6175 5f6e 756d 5f77 6172  _plateau_num_war
-00018450: 6e2a 2e0a 2020 2020 2020 2020 2222 220a  n*..        """.
-00018460: 2020 2020 2020 2020 666f 7220 7265 7375          for resu
-00018470: 6c74 2069 6e20 7365 6c66 2e72 756e 5f69  lt in self.run_i
-00018480: 7465 7228 0a20 2020 2020 2020 2020 2020  ter(.           
-00018490: 2075 7064 6174 655f 696e 7465 7276 616c   update_interval
-000184a0: 5f76 6f6c 756d 655f 6672 6163 7469 6f6e  _volume_fraction
-000184b0: 3d75 7064 6174 655f 696e 7465 7276 616c  =update_interval
-000184c0: 5f76 6f6c 756d 655f 6672 6163 7469 6f6e  _volume_fraction
-000184d0: 2c0a 2020 2020 2020 2020 2020 2020 7570  ,.            up
-000184e0: 6461 7465 5f69 6e74 6572 7661 6c5f 6e63  date_interval_nc
-000184f0: 616c 6c3d 7570 6461 7465 5f69 6e74 6572  all=update_inter
-00018500: 7661 6c5f 6e63 616c 6c2c 0a20 2020 2020  val_ncall,.     
-00018510: 2020 2020 2020 206c 6f67 5f69 6e74 6572         log_inter
-00018520: 7661 6c3d 6c6f 675f 696e 7465 7276 616c  val=log_interval
-00018530: 2c0a 2020 2020 2020 2020 2020 2020 646c  ,.            dl
-00018540: 6f67 7a3d 646c 6f67 7a2c 2064 4b4c 3d64  ogz=dlogz, dKL=d
-00018550: 4b4c 2c0a 2020 2020 2020 2020 2020 2020  KL,.            
-00018560: 4c65 7073 696c 6f6e 3d4c 6570 7369 6c6f  Lepsilon=Lepsilo
-00018570: 6e2c 2066 7261 635f 7265 6d61 696e 3d66  n, frac_remain=f
-00018580: 7261 635f 7265 6d61 696e 2c0a 2020 2020  rac_remain,.    
-00018590: 2020 2020 2020 2020 6d69 6e5f 6573 733d          min_ess=
-000185a0: 6d69 6e5f 6573 732c 206d 6178 5f69 7465  min_ess, max_ite
-000185b0: 7273 3d6d 6178 5f69 7465 7273 2c0a 2020  rs=max_iters,.  
-000185c0: 2020 2020 2020 2020 2020 6d61 785f 6e63            max_nc
-000185d0: 616c 6c73 3d6d 6178 5f6e 6361 6c6c 732c  alls=max_ncalls,
-000185e0: 206d 6178 5f6e 756d 5f69 6d70 726f 7665   max_num_improve
-000185f0: 6d65 6e74 5f6c 6f6f 7073 3d6d 6178 5f6e  ment_loops=max_n
-00018600: 756d 5f69 6d70 726f 7665 6d65 6e74 5f6c  um_improvement_l
-00018610: 6f6f 7073 2c0a 2020 2020 2020 2020 2020  oops,.          
-00018620: 2020 6d69 6e5f 6e75 6d5f 6c69 7665 5f70    min_num_live_p
-00018630: 6f69 6e74 733d 6d69 6e5f 6e75 6d5f 6c69  oints=min_num_li
-00018640: 7665 5f70 6f69 6e74 732c 0a20 2020 2020  ve_points,.     
-00018650: 2020 2020 2020 2063 6c75 7374 6572 5f6e         cluster_n
-00018660: 756d 5f6c 6976 655f 706f 696e 7473 3d63  um_live_points=c
-00018670: 6c75 7374 6572 5f6e 756d 5f6c 6976 655f  luster_num_live_
-00018680: 706f 696e 7473 2c0a 2020 2020 2020 2020  points,.        
-00018690: 2020 2020 7368 6f77 5f73 7461 7475 733d      show_status=
-000186a0: 7368 6f77 5f73 7461 7475 732c 0a20 2020  show_status,.   
-000186b0: 2020 2020 2020 2020 2076 697a 5f63 616c           viz_cal
-000186c0: 6c62 6163 6b3d 7669 7a5f 6361 6c6c 6261  lback=viz_callba
-000186d0: 636b 2c0a 2020 2020 2020 2020 2020 2020  ck,.            
-000186e0: 696e 7365 7274 696f 6e5f 7465 7374 5f77  insertion_test_w
-000186f0: 696e 646f 773d 696e 7365 7274 696f 6e5f  indow=insertion_
-00018700: 7465 7374 5f77 696e 646f 772c 0a20 2020  test_window,.   
-00018710: 2020 2020 2020 2020 2069 6e73 6572 7469           inserti
-00018720: 6f6e 5f74 6573 745f 7a73 636f 7265 5f74  on_test_zscore_t
-00018730: 6872 6573 686f 6c64 3d69 6e73 6572 7469  hreshold=inserti
-00018740: 6f6e 5f74 6573 745f 7a73 636f 7265 5f74  on_test_zscore_t
-00018750: 6872 6573 686f 6c64 2c0a 2020 2020 2020  hreshold,.      
-00018760: 2020 2020 2020 7265 6769 6f6e 5f63 6c61        region_cla
-00018770: 7373 3d72 6567 696f 6e5f 636c 6173 732c  ss=region_class,
-00018780: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
-00018790: 656e 5f62 6566 6f72 655f 696e 6974 6961  en_before_initia
-000187a0: 6c5f 706c 6174 6561 755f 6e75 6d5f 7761  l_plateau_num_wa
-000187b0: 726e 3d77 6964 656e 5f62 6566 6f72 655f  rn=widen_before_
-000187c0: 696e 6974 6961 6c5f 706c 6174 6561 755f  initial_plateau_
-000187d0: 6e75 6d5f 7761 726e 2c0a 2020 2020 2020  num_warn,.      
-000187e0: 2020 2020 2020 7769 6465 6e5f 6265 666f        widen_befo
-000187f0: 7265 5f69 6e69 7469 616c 5f70 6c61 7465  re_initial_plate
-00018800: 6175 5f6e 756d 5f6d 6178 3d77 6964 656e  au_num_max=widen
-00018810: 5f62 6566 6f72 655f 696e 6974 6961 6c5f  _before_initial_
-00018820: 706c 6174 6561 755f 6e75 6d5f 6d61 782c  plateau_num_max,
-00018830: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
-00018840: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00018850: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
-00018860: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00018870: 2e64 6562 7567 2822 6469 6420 6120 7275  .debug("did a ru
-00018880: 6e5f 6974 6572 2070 6173 7321 2229 0a20  n_iter pass!"). 
-00018890: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-000188a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000188b0: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
-000188c0: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
-000188d0: 6f28 2264 6f6e 6520 6974 6572 6174 696e  o("done iteratin
-000188e0: 672e 2229 0a0a 2020 2020 2020 2020 7265  g.")..        re
-000188f0: 7475 726e 2073 656c 662e 7265 7375 6c74  turn self.result
-00018900: 730a 0a20 2020 2064 6566 2072 756e 5f69  s..    def run_i
-00018910: 7465 7228 0a20 2020 2020 2020 2020 2020  ter(.           
-00018920: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-00018930: 2020 2075 7064 6174 655f 696e 7465 7276     update_interv
-00018940: 616c 5f76 6f6c 756d 655f 6672 6163 7469  al_volume_fracti
-00018950: 6f6e 3d30 2e38 2c0a 2020 2020 2020 2020  on=0.8,.        
-00018960: 2020 2020 7570 6461 7465 5f69 6e74 6572      update_inter
-00018970: 7661 6c5f 6e63 616c 6c3d 4e6f 6e65 2c0a  val_ncall=None,.
-00018980: 2020 2020 2020 2020 2020 2020 6c6f 675f              log_
-00018990: 696e 7465 7276 616c 3d4e 6f6e 652c 0a20  interval=None,. 
-000189a0: 2020 2020 2020 2020 2020 2064 6c6f 677a             dlogz
-000189b0: 3d30 2e35 2c0a 2020 2020 2020 2020 2020  =0.5,.          
-000189c0: 2020 644b 4c3d 302e 352c 0a20 2020 2020    dKL=0.5,.     
-000189d0: 2020 2020 2020 2066 7261 635f 7265 6d61         frac_rema
-000189e0: 696e 3d30 2e30 312c 0a20 2020 2020 2020  in=0.01,.       
-000189f0: 2020 2020 204c 6570 7369 6c6f 6e3d 302e       Lepsilon=0.
-00018a00: 3030 312c 0a20 2020 2020 2020 2020 2020  001,.           
-00018a10: 206d 696e 5f65 7373 3d34 3030 2c0a 2020   min_ess=400,.  
-00018a20: 2020 2020 2020 2020 2020 6d61 785f 6974            max_it
-00018a30: 6572 733d 4e6f 6e65 2c0a 2020 2020 2020  ers=None,.      
-00018a40: 2020 2020 2020 6d61 785f 6e63 616c 6c73        max_ncalls
-00018a50: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00018a60: 2020 206d 6178 5f6e 756d 5f69 6d70 726f     max_num_impro
-00018a70: 7665 6d65 6e74 5f6c 6f6f 7073 3d2d 312c  vement_loops=-1,
-00018a80: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
-00018a90: 5f6e 756d 5f6c 6976 655f 706f 696e 7473  _num_live_points
-00018aa0: 3d34 3030 2c0a 2020 2020 2020 2020 2020  =400,.          
-00018ab0: 2020 636c 7573 7465 725f 6e75 6d5f 6c69    cluster_num_li
-00018ac0: 7665 5f70 6f69 6e74 733d 3430 2c0a 2020  ve_points=40,.  
-00018ad0: 2020 2020 2020 2020 2020 7368 6f77 5f73            show_s
-00018ae0: 7461 7475 733d 5472 7565 2c0a 2020 2020  tatus=True,.    
-00018af0: 2020 2020 2020 2020 7669 7a5f 6361 6c6c          viz_call
-00018b00: 6261 636b 3d27 6175 746f 272c 0a20 2020  back='auto',.   
-00018b10: 2020 2020 2020 2020 2069 6e73 6572 7469           inserti
-00018b20: 6f6e 5f74 6573 745f 7769 6e64 6f77 3d31  on_test_window=1
-00018b30: 3030 3030 2c0a 2020 2020 2020 2020 2020  0000,.          
+00015ef0: 6966 2073 656c 662e 7573 655f 6d70 693a  if self.use_mpi:
+00015f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015f10: 2020 2020 2020 2020 2072 6563 765f 656e           recv_en
+00015f20: 6c61 7267 6520 3d20 7365 6c66 2e63 6f6d  large = self.com
+00015f30: 6d2e 6761 7468 6572 2866 2c20 726f 6f74  m.gather(f, root
+00015f40: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
+00015f50: 2020 2020 2020 2020 2020 2020 7265 6376              recv
+00015f60: 5f65 6e6c 6172 6765 203d 2073 656c 662e  _enlarge = self.
+00015f70: 636f 6d6d 2e62 6361 7374 2872 6563 765f  comm.bcast(recv_
+00015f80: 656e 6c61 7267 652c 2072 6f6f 743d 3029  enlarge, root=0)
+00015f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015fa0: 2020 2020 2020 2020 2066 203d 206e 702e           f = np.
+00015fb0: 6d61 7828 7265 6376 5f65 6e6c 6172 6765  max(recv_enlarge
+00015fc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015fd0: 2020 2020 2020 7472 6567 696f 6e2e 656e        tregion.en
+00015fe0: 6c61 7267 6520 3d20 660a 2020 2020 2020  large = f.      
+00015ff0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00016000: 6567 696f 6e2e 6372 6561 7465 5f65 6c6c  egion.create_ell
+00016010: 6970 736f 6964 2829 0a20 2020 2020 2020  ipsoid().       
+00016020: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00016030: 662e 7472 6567 696f 6e20 3d20 7472 6567  f.tregion = treg
+00016040: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00016050: 6578 6365 7074 2046 6c6f 6174 696e 6750  except FloatingP
+00016060: 6f69 6e74 4572 726f 723a 0a20 2020 2020  ointError:.     
+00016070: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00016080: 6c66 2e6c 6f67 3a0a 2020 2020 2020 2020  lf.log:.        
+00016090: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000160a0: 2e6c 6f67 6765 722e 6465 6275 6728 226e  .logger.debug("n
+000160b0: 6f74 2075 7064 6174 696e 6720 742d 656c  ot updating t-el
+000160c0: 6c69 7073 6f69 6422 2c20 6578 635f 696e  lipsoid", exc_in
+000160d0: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
+000160e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000160f0: 662e 7472 6567 696f 6e20 3d20 4e6f 6e65  f.tregion = None
+00016100: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00016110: 6570 7420 6e70 2e6c 696e 616c 672e 4c69  ept np.linalg.Li
+00016120: 6e41 6c67 4572 726f 723a 0a20 2020 2020  nAlgError:.     
+00016130: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00016140: 6c66 2e6c 6f67 3a0a 2020 2020 2020 2020  lf.log:.        
+00016150: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016160: 2e6c 6f67 6765 722e 6465 6275 6728 226e  .logger.debug("n
+00016170: 6f74 2075 7064 6174 696e 6720 742d 656c  ot updating t-el
+00016180: 6c69 7073 6f69 6422 2c20 6578 635f 696e  lipsoid", exc_in
+00016190: 666f 3d54 7275 6529 0a20 2020 2020 2020  fo=True).       
+000161a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000161b0: 662e 7472 6567 696f 6e20 3d20 4e6f 6e65  f.tregion = None
+000161c0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000161d0: 2075 7064 6174 6564 0a0a 2020 2020 6465   updated..    de
+000161e0: 6620 5f65 7870 616e 645f 6e6f 6465 735f  f _expand_nodes_
+000161f0: 6265 666f 7265 2873 656c 662c 204c 6d69  before(self, Lmi
+00016200: 6e2c 206e 6e6f 6465 735f 6e65 6564 6564  n, nnodes_needed
+00016210: 2c20 7570 6461 7465 5f69 6e74 6572 7661  , update_interva
+00016220: 6c5f 6e63 616c 6c29 3a0a 2020 2020 2020  l_ncall):.      
+00016230: 2020 2222 2245 7870 616e 6420 6e6f 6465    """Expand node
+00016240: 7320 6265 666f 7265 2060 4c6d 696e 6020  s before `Lmin` 
+00016250: 746f 2068 6176 6520 606e 6e6f 6465 735f  to have `nnodes_
+00016260: 6e65 6564 6564 602e 0a0a 2020 2020 2020  needed`...      
+00016270: 2020 5265 7475 726e 730a 2020 2020 2020    Returns.      
+00016280: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+00016290: 2020 204c 6c6f 3a20 666c 6f61 740a 2020     Llo: float.  
+000162a0: 2020 2020 2020 2020 2020 6c6f 7765 7374            lowest
+000162b0: 2070 6172 656e 7420 7361 6d70 6c65 6420   parent sampled 
+000162c0: 282d 6e70 2e69 6e66 2069 6620 7361 6d70  (-np.inf if samp
+000162d0: 6c69 6e67 2066 726f 6d20 726f 6f74 290a  ling from root).
+000162e0: 2020 2020 2020 2020 4c68 693a 2066 6c6f          Lhi: flo
+000162f0: 6174 0a20 2020 2020 2020 2020 2020 204c  at.            L
+00016300: 6d69 6e0a 2020 2020 2020 2020 7461 7267  min.        targ
+00016310: 6574 5f6d 696e 5f6e 756d 5f63 6869 6c64  et_min_num_child
+00016320: 7265 6e3a 2069 6e74 0a20 2020 2020 2020  ren: int.       
+00016330: 2020 2020 206e 756d 6265 7220 6f66 2063       number of c
+00016340: 6869 6c64 7265 6e20 7468 6174 206e 6565  hildren that nee
+00016350: 6420 746f 2062 6520 6d61 696e 7461 696e  d to be maintain
+00016360: 6564 2062 6574 7765 656e 204c 6c6f 2c20  ed between Llo, 
+00016370: 4c68 690a 0a20 2020 2020 2020 2022 2222  Lhi..        """
+00016380: 0a20 2020 2020 2020 2073 656c 662e 706f  .        self.po
+00016390: 696e 7473 746f 7265 2e72 6573 6574 2829  intstore.reset()
+000163a0: 0a20 2020 2020 2020 2070 6172 656e 7473  .        parents
+000163b0: 2c20 7765 6967 6874 7320 3d20 6669 6e64  , weights = find
+000163c0: 5f6e 6f64 6573 5f62 6566 6f72 6528 7365  _nodes_before(se
+000163d0: 6c66 2e72 6f6f 742c 204c 6d69 6e29 0a20  lf.root, Lmin). 
+000163e0: 2020 2020 2020 2074 6172 6765 745f 6d69         target_mi
+000163f0: 6e5f 6e75 6d5f 6368 696c 6472 656e 203d  n_num_children =
+00016400: 2073 656c 662e 5f77 6964 656e 5f6e 6f64   self._widen_nod
+00016410: 6573 2870 6172 656e 7473 2c20 7765 6967  es(parents, weig
+00016420: 6874 732c 206e 6e6f 6465 735f 6e65 6564  hts, nnodes_need
+00016430: 6564 2c20 7570 6461 7465 5f69 6e74 6572  ed, update_inter
+00016440: 7661 6c5f 6e63 616c 6c29 0a20 2020 2020  val_ncall).     
+00016450: 2020 2069 6620 6c65 6e28 7061 7265 6e74     if len(parent
+00016460: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+00016470: 2020 2020 204c 6c6f 203d 202d 6e70 2e69       Llo = -np.i
+00016480: 6e66 0a20 2020 2020 2020 2065 6c73 653a  nf.        else:
+00016490: 0a20 2020 2020 2020 2020 2020 204c 6c6f  .            Llo
+000164a0: 203d 206d 696e 286e 2e76 616c 7565 2066   = min(n.value f
+000164b0: 6f72 206e 2069 6e20 7061 7265 6e74 7329  or n in parents)
+000164c0: 0a20 2020 2020 2020 204c 6869 203d 204c  .        Lhi = L
+000164d0: 6d69 6e0a 2020 2020 2020 2020 7265 7475  min.        retu
+000164e0: 726e 204c 6c6f 2c20 4c68 692c 2074 6172  rn Llo, Lhi, tar
+000164f0: 6765 745f 6d69 6e5f 6e75 6d5f 6368 696c  get_min_num_chil
+00016500: 6472 656e 0a0a 2020 2020 6465 6620 5f73  dren..    def _s
+00016510: 686f 756c 645f 6e6f 6465 5f62 655f 6578  hould_node_be_ex
+00016520: 7061 6e64 6564 280a 2020 2020 2020 2020  panded(.        
+00016530: 7365 6c66 2c20 6974 2c20 4c6c 6f2c 204c  self, it, Llo, L
+00016540: 6869 2c20 6d69 6e69 6d61 6c5f 7769 6474  hi, minimal_widt
+00016550: 6873 5f73 6571 7565 6e63 652c 2074 6172  hs_sequence, tar
+00016560: 6765 745f 6d69 6e5f 6e75 6d5f 6368 696c  get_min_num_chil
+00016570: 6472 656e 2c0a 2020 2020 2020 2020 6e6f  dren,.        no
+00016580: 6465 2c20 7061 7261 6c6c 656c 5f76 616c  de, parallel_val
+00016590: 7565 732c 206d 6178 5f6e 6361 6c6c 732c  ues, max_ncalls,
+000165a0: 206d 6178 5f69 7465 7273 2c20 6c69 7665   max_iters, live
+000165b0: 5f70 6f69 6e74 735f 6865 616c 7468 790a  _points_healthy.
+000165c0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+000165d0: 2222 4368 6563 6b20 6966 206e 6f64 6520  ""Check if node 
+000165e0: 6e65 6564 7320 6e65 7720 6368 696c 6472  needs new childr
+000165f0: 656e 2e0a 0a20 2020 2020 2020 2052 6574  en...        Ret
+00016600: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+00016610: 2d2d 2d2d 0a20 2020 2020 2020 2065 7870  ----.        exp
+00016620: 616e 645f 6e6f 6465 3a20 626f 6f6c 0a20  and_node: bool. 
+00016630: 2020 2020 2020 2020 2020 2054 7275 6520             True 
+00016640: 6966 2073 686f 756c 6420 7361 6d70 6c65  if should sample
+00016650: 2061 206e 6577 2070 6f69 6e74 0a20 2020   a new point.   
+00016660: 2020 2020 2020 2020 2062 6173 6564 206f           based o
+00016670: 6e20 7468 6973 206e 6f64 6520 2861 626f  n this node (abo
+00016680: 7665 2069 7473 206c 696b 656c 6968 6f6f  ve its likelihoo
+00016690: 6420 7661 6c75 6520 4c6d 696e 292e 0a0a  d value Lmin)...
+000166a0: 2020 2020 2020 2020 5061 7261 6d65 7465          Paramete
+000166b0: 7273 0a20 2020 2020 2020 202d 2d2d 2d2d  rs.        -----
+000166c0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6974  -----.        it
+000166d0: 3a20 696e 740a 2020 2020 2020 2020 2020  : int.          
+000166e0: 2020 6375 7272 656e 7420 6974 6572 6174    current iterat
+000166f0: 696f 6e0a 2020 2020 2020 2020 6e6f 6465  ion.        node
+00016700: 3a20 6e6f 6465 0a20 2020 2020 2020 2020  : node.         
+00016710: 2020 2054 6865 206e 6f64 6520 746f 2063     The node to c
+00016720: 6f6e 7369 6465 720a 2020 2020 2020 2020  onsider.        
+00016730: 7061 7261 6c6c 656c 5f76 616c 7565 733a  parallel_values:
+00016740: 2061 7272 6179 206f 6620 666c 6f61 7473   array of floats
+00016750: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00016760: 6c69 6b65 6c69 686f 6f64 7320 6f66 206c  likelihoods of l
+00016770: 6976 6520 706f 696e 7473 0a20 2020 2020  ive points.     
+00016780: 2020 206d 6178 5f6e 6361 6c6c 733a 2069     max_ncalls: i
+00016790: 6e74 0a20 2020 2020 2020 2020 2020 206d  nt.            m
+000167a0: 6178 696d 756d 206e 756d 6265 7220 6f66  aximum number of
+000167b0: 206c 696b 656c 6968 6f6f 6420 6675 6e63   likelihood func
+000167c0: 7469 6f6e 2063 616c 6c73 2061 6c6c 6f77  tion calls allow
+000167d0: 6564 0a20 2020 2020 2020 206d 6178 5f69  ed.        max_i
+000167e0: 7465 7273 3a20 696e 740a 2020 2020 2020  ters: int.      
+000167f0: 2020 2020 2020 6d61 7869 6d75 6d20 6e75        maximum nu
+00016800: 6d62 6572 206f 6620 6e65 7374 6564 2073  mber of nested s
+00016810: 616d 706c 696e 6720 6974 6572 6174 696f  ampling iteratio
+00016820: 6e20 616c 6c6f 7765 640a 2020 2020 2020  n allowed.      
+00016830: 2020 4c6c 6f3a 2066 6c6f 6174 0a20 2020    Llo: float.   
+00016840: 2020 2020 2020 2020 206c 6f77 6572 206c           lower l
+00016850: 6f67 6c69 6b65 6c69 686f 6f64 2062 6f75  oglikelihood bou
+00016860: 6e64 2066 6f72 2074 6865 2073 7472 6174  nd for the strat
+00016870: 6567 790a 2020 2020 2020 2020 4c68 693a  egy.        Lhi:
+00016880: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00016890: 2020 2075 7070 6572 206c 6f67 6c69 6b65     upper loglike
+000168a0: 6c69 686f 6f64 2062 6f75 6e64 2066 6f72  lihood bound for
+000168b0: 2074 6865 2073 7472 6174 6567 790a 2020   the strategy.  
+000168c0: 2020 2020 2020 6d69 6e69 6d61 6c5f 7769        minimal_wi
+000168d0: 6474 6873 5f73 6571 7565 6e63 653a 206c  dths_sequence: l
+000168e0: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+000168f0: 6c69 7374 206f 6620 6c69 6b65 6c69 686f  list of likeliho
+00016900: 6f64 2069 6e74 6572 7661 6c73 2077 6974  od intervals wit
+00016910: 6820 6d69 6e69 6d75 6d20 6e75 6d62 6572  h minimum number
+00016920: 206f 6620 6c69 7665 2070 6f69 6e74 730a   of live points.
+00016930: 2020 2020 2020 2020 7461 7267 6574 5f6d          target_m
+00016940: 696e 5f6e 756d 5f63 6869 6c64 7265 6e3a  in_num_children:
+00016950: 0a20 2020 2020 2020 2020 2020 206d 696e  .            min
+00016960: 696d 756d 206e 756d 6265 7220 6f66 206c  imum number of l
+00016970: 6976 6520 706f 696e 7473 2063 7572 7265  ive points curre
+00016980: 6e74 6c79 2074 6172 6765 7465 640a 2020  ntly targeted.  
+00016990: 2020 2020 2020 6c69 7665 5f70 6f69 6e74        live_point
+000169a0: 735f 6865 616c 7468 793a 2062 6f6f 6c0a  s_healthy: bool.
+000169b0: 2020 2020 2020 2020 2020 2020 696e 6469              indi
+000169c0: 6361 7465 7320 7768 6574 6865 7220 7468  cates whether th
+000169d0: 6520 6c69 7665 2070 6f69 6e74 7320 6861  e live points ha
+000169e0: 7665 2062 6563 6f6d 650a 2020 2020 2020  ve become.      
+000169f0: 2020 2020 2020 6c69 6e65 6172 6c79 2064        linearly d
+00016a00: 6570 656e 6465 6e74 2028 636f 7661 7269  ependent (covari
+00016a10: 616e 6365 206e 6f74 2066 756c 6c20 7261  ance not full ra
+00016a20: 6e6b 290a 2020 2020 2020 2020 2020 2020  nk).            
+00016a30: 6f72 2068 6176 6520 6174 7461 696e 6564  or have attained
+00016a40: 2074 6865 2073 616d 6520 6578 6163 7420   the same exact 
+00016a50: 7661 6c75 6520 696e 2073 6f6d 6520 7061  value in some pa
+00016a60: 7261 6d65 7465 722e 0a0a 2020 2020 2020  rameter...      
+00016a70: 2020 2222 220a 2020 2020 2020 2020 4c6d    """.        Lm
+00016a80: 696e 203d 206e 6f64 652e 7661 6c75 650a  in = node.value.
+00016a90: 2020 2020 2020 2020 6e6c 6976 6520 3d20          nlive = 
+00016aa0: 6c65 6e28 7061 7261 6c6c 656c 5f76 616c  len(parallel_val
+00016ab0: 7565 7329 0a0a 2020 2020 2020 2020 6966  ues)..        if
+00016ac0: 206e 6f74 2028 4c6d 696e 203c 3d20 4c68   not (Lmin <= Lh
+00016ad0: 6920 616e 6420 4c6c 6f20 3c3d 204c 6869  i and Llo <= Lhi
+00016ae0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00016af0: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
+00016b00: 2020 2020 2069 6620 6e6f 7420 6c69 7665       if not live
+00016b10: 5f70 6f69 6e74 735f 6865 616c 7468 793a  _points_healthy:
+00016b20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016b30: 7365 6c66 2e6c 6f67 3a0a 2020 2020 2020  self.log:.      
+00016b40: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00016b50: 6f67 6765 722e 6465 6275 6728 226e 6f74  ogger.debug("not
+00016b60: 2065 7870 616e 6469 6e67 2c20 6265 6361   expanding, beca
+00016b70: 7573 6520 6c69 7665 2070 6f69 6e74 7320  use live points 
+00016b80: 6172 6520 6c69 6e65 6172 6c79 2064 6570  are linearly dep
+00016b90: 656e 6465 6e74 2229 0a20 2020 2020 2020  endent").       
+00016ba0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00016bb0: 650a 0a20 2020 2020 2020 2023 2073 6f6d  e..        # som
+00016bc0: 6520 7265 6173 6f6e 7320 746f 2073 746f  e reasons to sto
+00016bd0: 703a 0a20 2020 2020 2020 2069 6620 6974  p:.        if it
+00016be0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00016bf0: 2020 6966 206d 6178 5f6e 6361 6c6c 7320    if max_ncalls 
+00016c00: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00016c10: 7365 6c66 2e6e 6361 6c6c 203e 3d20 6d61  self.ncall >= ma
+00016c20: 785f 6e63 616c 6c73 3a0a 2020 2020 2020  x_ncalls:.      
+00016c30: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
+00016c40: 7428 226e 6f74 2065 7870 616e 6469 6e67  t("not expanding
+00016c50: 2c20 6265 6361 7573 6520 6162 6f76 6520  , because above 
+00016c60: 6d61 785f 6e63 616c 6c22 290a 2020 2020  max_ncall").    
+00016c70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016c80: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
+00016c90: 2020 2020 2020 6966 206d 6178 5f69 7465        if max_ite
+00016ca0: 7273 2069 7320 6e6f 7420 4e6f 6e65 2061  rs is not None a
+00016cb0: 6e64 2069 7420 3e3d 206d 6178 5f69 7465  nd it >= max_ite
+00016cc0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00016cd0: 2020 2020 2320 7072 696e 7428 226e 6f74      # print("not
+00016ce0: 2065 7870 616e 6469 6e67 2c20 6265 6361   expanding, beca
+00016cf0: 7573 6520 6162 6f76 6520 6d61 785f 6974  use above max_it
+00016d00: 6572 7322 290a 2020 2020 2020 2020 2020  ers").          
+00016d10: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00016d20: 7365 0a0a 2020 2020 2020 2020 2320 696e  se..        # in
+00016d30: 2061 2070 6c61 7465 6175 2c20 6f6e 6c79   a plateau, only
+00016d40: 2073 6872 696e 6b20 2846 6f77 6c69 652b   shrink (Fowlie+
+00016d50: 3230 3230 290a 2020 2020 2020 2020 6966  2020).        if
+00016d60: 2028 4c6d 696e 203d 3d20 7061 7261 6c6c   (Lmin == parall
+00016d70: 656c 5f76 616c 7565 7329 2e73 756d 2829  el_values).sum()
+00016d80: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
+00016d90: 2020 6966 2073 656c 662e 6c6f 673a 0a20    if self.log:. 
+00016da0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00016db0: 656c 662e 6c6f 6767 6572 2e64 6562 7567  elf.logger.debug
+00016dc0: 2822 506c 6174 6561 7520 6465 7465 6374  ("Plateau detect
+00016dd0: 6564 2061 7420 4c3d 2565 2c20 6e6f 7420  ed at L=%e, not 
+00016de0: 7265 706c 6163 696e 6720 6c69 7665 2070  replacing live p
+00016df0: 6f69 6e74 2e22 2025 204c 6d69 6e29 0a20  oint." % Lmin). 
+00016e00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016e10: 6e20 4661 6c73 650a 0a20 2020 2020 2020  n False..       
+00016e20: 2065 7870 616e 645f 6e6f 6465 203d 2046   expand_node = F
+00016e30: 616c 7365 0a20 2020 2020 2020 2023 2077  alse.        # w
+00016e40: 6520 7368 6f75 6c64 2063 6f6e 7469 6e75  e should continu
+00016e50: 6520 746f 2070 726f 6772 6573 7320 746f  e to progress to
+00016e60: 7761 7264 7320 4c68 690a 2020 2020 2020  wards Lhi.      
+00016e70: 2020 7768 696c 6520 4c6d 696e 203e 206d    while Lmin > m
+00016e80: 696e 696d 616c 5f77 6964 7468 735f 7365  inimal_widths_se
+00016e90: 7175 656e 6365 5b30 5d5b 305d 3a0a 2020  quence[0][0]:.  
+00016ea0: 2020 2020 2020 2020 2020 6d69 6e69 6d61            minima
+00016eb0: 6c5f 7769 6474 6873 5f73 6571 7565 6e63  l_widths_sequenc
+00016ec0: 652e 706f 7028 3029 0a0a 2020 2020 2020  e.pop(0)..      
+00016ed0: 2020 2320 6765 7420 6375 7272 656e 746c    # get currentl
+00016ee0: 7920 6465 7369 7265 6420 7769 6474 680a  y desired width.
+00016ef0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00016f00: 7265 6769 6f6e 2069 7320 4e6f 6e65 3a0a  region is None:.
+00016f10: 2020 2020 2020 2020 2020 2020 6d69 6e69              mini
+00016f20: 6d61 6c5f 7769 6474 685f 636c 7573 7465  mal_width_cluste
+00016f30: 7273 203d 2030 0a20 2020 2020 2020 2065  rs = 0.        e
+00016f40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00016f50: 2023 2063 6f6d 7075 7465 206e 756d 6265   # compute numbe
+00016f60: 7220 6f66 2063 6c75 7374 6572 7320 7769  r of clusters wi
+00016f70: 7468 206d 6f72 6520 7468 616e 2031 2065  th more than 1 e
+00016f80: 6c65 6d65 6e74 0a20 2020 2020 2020 2020  lement.         
+00016f90: 2020 205f 2c20 636c 7573 7465 725f 7369     _, cluster_si
+00016fa0: 7a65 7320 3d20 6e70 2e75 6e69 7175 6528  zes = np.unique(
+00016fb0: 7365 6c66 2e72 6567 696f 6e2e 7472 616e  self.region.tran
+00016fc0: 7366 6f72 6d4c 6179 6572 2e63 6c75 7374  sformLayer.clust
+00016fd0: 6572 6964 732c 2072 6574 7572 6e5f 636f  erids, return_co
+00016fe0: 756e 7473 3d54 7275 6529 0a20 2020 2020  unts=True).     
+00016ff0: 2020 2020 2020 206e 636c 7573 7465 7273         nclusters
+00017000: 203d 2028 636c 7573 7465 725f 7369 7a65   = (cluster_size
+00017010: 7320 3e20 3129 2e73 756d 2829 0a20 2020  s > 1).sum().   
+00017020: 2020 2020 2020 2020 206d 696e 696d 616c           minimal
+00017030: 5f77 6964 7468 5f63 6c75 7374 6572 7320  _width_clusters 
+00017040: 3d20 7365 6c66 2e63 6c75 7374 6572 5f6e  = self.cluster_n
+00017050: 756d 5f6c 6976 655f 706f 696e 7473 202a  um_live_points *
+00017060: 206e 636c 7573 7465 7273 0a0a 2020 2020   nclusters..    
+00017070: 2020 2020 6d69 6e69 6d61 6c5f 7769 6474      minimal_widt
+00017080: 6820 3d20 6d61 7828 6d69 6e69 6d61 6c5f  h = max(minimal_
+00017090: 7769 6474 6873 5f73 6571 7565 6e63 655b  widths_sequence[
+000170a0: 305d 5b31 5d2c 206d 696e 696d 616c 5f77  0][1], minimal_w
+000170b0: 6964 7468 5f63 6c75 7374 6572 7329 0a0a  idth_clusters)..
+000170c0: 2020 2020 2020 2020 2320 6966 2061 6c72          # if alr
+000170d0: 6561 6479 2068 6173 2063 6869 6c64 7265  eady has childre
+000170e0: 6e2c 206e 6f20 6e65 6564 2074 6f20 6578  n, no need to ex
+000170f0: 7061 6e64 0a20 2020 2020 2020 2023 2069  pand.        # i
+00017100: 6620 7765 2061 7265 2077 6964 6572 2074  f we are wider t
+00017110: 6861 6e20 7468 6520 7769 6474 6820 7265  han the width re
+00017120: 7175 6972 6564 0a20 2020 2020 2020 2023  quired.        #
+00017130: 2077 6520 646f 206e 6f74 206e 6565 6420   we do not need 
+00017140: 746f 2065 7870 616e 6420 7468 6973 206f  to expand this o
+00017150: 6e65 0a20 2020 2020 2020 2023 2065 7870  ne.        # exp
+00017160: 616e 645f 6e6f 6465 203d 206c 656e 286e  and_node = len(n
+00017170: 6f64 652e 6368 696c 6472 656e 2920 3d3d  ode.children) ==
+00017180: 2030 0a20 2020 2020 2020 2023 2070 7265   0.        # pre
+00017190: 6665 7220 3120 6368 696c 642c 206f 7220  fer 1 child, or 
+000171a0: 7468 6520 6e75 6d62 6572 2072 6571 7569  the number requi
+000171b0: 7265 642c 2069 6620 7370 6563 6966 6965  red, if specifie
+000171c0: 640a 2020 2020 2020 2020 6e6d 696e 203d  d.        nmin =
+000171d0: 2074 6172 6765 745f 6d69 6e5f 6e75 6d5f   target_min_num_
+000171e0: 6368 696c 6472 656e 2e67 6574 286e 6f64  children.get(nod
+000171f0: 652e 6964 2c20 3129 2069 6620 7461 7267  e.id, 1) if targ
+00017200: 6574 5f6d 696e 5f6e 756d 5f63 6869 6c64  et_min_num_child
+00017210: 7265 6e20 656c 7365 2031 0a20 2020 2020  ren else 1.     
+00017220: 2020 2065 7870 616e 645f 6e6f 6465 203d     expand_node =
+00017230: 206c 656e 286e 6f64 652e 6368 696c 6472   len(node.childr
+00017240: 656e 2920 3c20 6e6d 696e 0a20 2020 2020  en) < nmin.     
+00017250: 2020 2023 2070 7269 6e74 2822 6e6f 7420     # print("not 
+00017260: 6578 7061 6e64 696e 672c 2062 6563 6175  expanding, becau
+00017270: 7365 2077 6520 6172 6520 7175 6974 6520  se we are quite 
+00017280: 7769 6465 222c 206e 6c69 7665 2c20 6d69  wide", nlive, mi
+00017290: 6e69 6d61 6c5f 7769 6474 682c 206d 696e  nimal_width, min
+000172a0: 696d 616c 5f77 6964 7468 735f 7365 7175  imal_widths_sequ
+000172b0: 656e 6365 290a 2020 2020 2020 2020 2320  ence).        # 
+000172c0: 6275 7420 7765 2068 6176 6520 746f 2065  but we have to e
+000172d0: 7870 616e 6420 7468 6520 6669 7273 7420  xpand the first 
+000172e0: 6974 6572 6174 696f 6e2c 0a20 2020 2020  iteration,.     
+000172f0: 2020 2023 206f 7468 6572 7769 7365 2074     # otherwise t
+00017300: 6865 2069 6e74 6567 7261 746f 7220 6e65  he integrator ne
+00017310: 7665 7220 7365 7473 2048 0a20 2020 2020  ver sets H.     
+00017320: 2020 2074 6f6f 5f77 6964 6520 3d20 6e6c     too_wide = nl
+00017330: 6976 6520 3e20 6d69 6e69 6d61 6c5f 7769  ive > minimal_wi
+00017340: 6474 6820 616e 6420 6974 203e 2030 0a0a  dth and it > 0..
+00017350: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00017360: 7870 616e 645f 6e6f 6465 2061 6e64 206e  xpand_node and n
+00017370: 6f74 2074 6f6f 5f77 6964 650a 0a20 2020  ot too_wide..   
+00017380: 2064 6566 2072 756e 280a 2020 2020 2020   def run(.      
+00017390: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000173a0: 2020 2020 2020 2020 7570 6461 7465 5f69          update_i
+000173b0: 6e74 6572 7661 6c5f 766f 6c75 6d65 5f66  nterval_volume_f
+000173c0: 7261 6374 696f 6e3d 302e 382c 0a20 2020  raction=0.8,.   
+000173d0: 2020 2020 2020 2020 2075 7064 6174 655f           update_
+000173e0: 696e 7465 7276 616c 5f6e 6361 6c6c 3d4e  interval_ncall=N
+000173f0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00017400: 206c 6f67 5f69 6e74 6572 7661 6c3d 4e6f   log_interval=No
+00017410: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00017420: 7368 6f77 5f73 7461 7475 733d 5472 7565  show_status=True
+00017430: 2c0a 2020 2020 2020 2020 2020 2020 7669  ,.            vi
+00017440: 7a5f 6361 6c6c 6261 636b 3d27 6175 746f  z_callback='auto
+00017450: 272c 0a20 2020 2020 2020 2020 2020 2064  ',.            d
+00017460: 6c6f 677a 3d30 2e35 2c0a 2020 2020 2020  logz=0.5,.      
+00017470: 2020 2020 2020 644b 4c3d 302e 352c 0a20        dKL=0.5,. 
+00017480: 2020 2020 2020 2020 2020 2066 7261 635f             frac_
+00017490: 7265 6d61 696e 3d30 2e30 312c 0a20 2020  remain=0.01,.   
+000174a0: 2020 2020 2020 2020 204c 6570 7369 6c6f           Lepsilo
+000174b0: 6e3d 302e 3030 312c 0a20 2020 2020 2020  n=0.001,.       
+000174c0: 2020 2020 206d 696e 5f65 7373 3d34 3030       min_ess=400
+000174d0: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
+000174e0: 785f 6974 6572 733d 4e6f 6e65 2c0a 2020  x_iters=None,.  
+000174f0: 2020 2020 2020 2020 2020 6d61 785f 6e63            max_nc
+00017500: 616c 6c73 3d4e 6f6e 652c 0a20 2020 2020  alls=None,.     
+00017510: 2020 2020 2020 206d 6178 5f6e 756d 5f69         max_num_i
+00017520: 6d70 726f 7665 6d65 6e74 5f6c 6f6f 7073  mprovement_loops
+00017530: 3d2d 312c 0a20 2020 2020 2020 2020 2020  =-1,.           
+00017540: 206d 696e 5f6e 756d 5f6c 6976 655f 706f   min_num_live_po
+00017550: 696e 7473 3d34 3030 2c0a 2020 2020 2020  ints=400,.      
+00017560: 2020 2020 2020 636c 7573 7465 725f 6e75        cluster_nu
+00017570: 6d5f 6c69 7665 5f70 6f69 6e74 733d 3430  m_live_points=40
+00017580: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+00017590: 7365 7274 696f 6e5f 7465 7374 5f77 696e  sertion_test_win
+000175a0: 646f 773d 3130 2c0a 2020 2020 2020 2020  dow=10,.        
+000175b0: 2020 2020 696e 7365 7274 696f 6e5f 7465      insertion_te
+000175c0: 7374 5f7a 7363 6f72 655f 7468 7265 7368  st_zscore_thresh
+000175d0: 6f6c 643d 342c 0a20 2020 2020 2020 2020  old=4,.         
+000175e0: 2020 2072 6567 696f 6e5f 636c 6173 733d     region_class=
+000175f0: 4d4c 4672 6965 6e64 732c 0a20 2020 2020  MLFriends,.     
+00017600: 2020 2020 2020 2077 6964 656e 5f62 6566         widen_bef
+00017610: 6f72 655f 696e 6974 6961 6c5f 706c 6174  ore_initial_plat
+00017620: 6561 755f 6e75 6d5f 7761 726e 3d31 3030  eau_num_warn=100
+00017630: 3030 2c0a 2020 2020 2020 2020 2020 2020  00,.            
+00017640: 7769 6465 6e5f 6265 666f 7265 5f69 6e69  widen_before_ini
+00017650: 7469 616c 5f70 6c61 7465 6175 5f6e 756d  tial_plateau_num
+00017660: 5f6d 6178 3d35 3030 3030 2c0a 2020 2020  _max=50000,.    
+00017670: 293a 0a20 2020 2020 2020 2022 2222 5275  ):.        """Ru
+00017680: 6e20 756e 7469 6c20 7461 7267 6574 2063  n until target c
+00017690: 6f6e 7665 7267 656e 6365 2063 7269 7465  onvergence crite
+000176a0: 7269 6120 6172 6520 6675 6c66 696c 6c65  ria are fulfille
+000176b0: 642e 0a0a 2020 2020 2020 2020 5061 7261  d...        Para
+000176c0: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+000176d0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+000176e0: 2020 7570 6461 7465 5f69 6e74 6572 7661    update_interva
+000176f0: 6c5f 766f 6c75 6d65 5f66 7261 6374 696f  l_volume_fractio
+00017700: 6e3a 2066 6c6f 6174 0a20 2020 2020 2020  n: float.       
+00017710: 2020 2020 2055 7064 6174 6520 7265 6769       Update regi
+00017720: 6f6e 2077 6865 6e20 7468 6520 766f 6c75  on when the volu
+00017730: 6d65 2073 6872 756e 6b20 6279 2074 6869  me shrunk by thi
+00017740: 7320 616d 6f75 6e74 2e0a 0a20 2020 2020  s amount...     
+00017750: 2020 2075 7064 6174 655f 696e 7465 7276     update_interv
+00017760: 616c 5f6e 6361 6c6c 3a20 696e 740a 2020  al_ncall: int.  
+00017770: 2020 2020 2020 2020 2020 5570 6461 7465            Update
+00017780: 2072 6567 696f 6e20 6166 7465 7220 7570   region after up
+00017790: 6461 7465 5f69 6e74 6572 7661 6c5f 6e63  date_interval_nc
+000177a0: 616c 6c20 6c69 6b65 6c69 686f 6f64 2063  all likelihood c
+000177b0: 616c 6c73 2028 6e6f 7420 7573 6564 292e  alls (not used).
+000177c0: 0a0a 2020 2020 2020 2020 6c6f 675f 696e  ..        log_in
+000177d0: 7465 7276 616c 3a20 696e 740a 2020 2020  terval: int.    
+000177e0: 2020 2020 2020 2020 5570 6461 7465 2073          Update s
+000177f0: 7464 6f75 7420 7374 6174 7573 206c 696e  tdout status lin
+00017800: 6520 6576 6572 7920 6c6f 675f 696e 7465  e every log_inte
+00017810: 7276 616c 2069 7465 7261 7469 6f6e 730a  rval iterations.
+00017820: 0a20 2020 2020 2020 2073 686f 775f 7374  .        show_st
+00017830: 6174 7573 3a20 626f 6f6c 0a20 2020 2020  atus: bool.     
+00017840: 2020 2020 2020 2073 686f 7720 696e 7465         show inte
+00017850: 6772 6174 696f 6e20 7072 6f67 7265 7373  gration progress
+00017860: 2061 7320 6120 7374 6174 7573 206c 696e   as a status lin
+00017870: 652e 0a20 2020 2020 2020 2020 2020 2049  e..            I
+00017880: 6620 6e6f 206f 7574 7075 7420 6465 7369  f no output desi
+00017890: 7265 642c 2073 6574 2074 6f20 4661 6c73  red, set to Fals
+000178a0: 652e 0a0a 2020 2020 2020 2020 7669 7a5f  e...        viz_
+000178b0: 6361 6c6c 6261 636b 3a20 6675 6e63 7469  callback: functi
+000178c0: 6f6e 0a20 2020 2020 2020 2020 2020 2063  on.            c
+000178d0: 616c 6c62 6163 6b20 6675 6e63 7469 6f6e  allback function
+000178e0: 2077 6865 6e20 7265 6769 6f6e 2077 6173   when region was
+000178f0: 2072 6562 7569 6c74 2e20 416c 6c6f 7773   rebuilt. Allows
+00017900: 2074 6f0a 2020 2020 2020 2020 2020 2020   to.            
+00017910: 7368 6f77 2063 7572 7265 6e74 2073 7461  show current sta
+00017920: 7465 206f 6620 7468 6520 6c69 7665 2070  te of the live p
+00017930: 6f69 6e74 732e 0a20 2020 2020 2020 2020  oints..         
+00017940: 2020 2053 6565 203a 7079 3a66 756e 633a     See :py:func:
+00017950: 606e 6963 656c 6f67 6765 7260 206f 7220  `nicelogger` or 
+00017960: 3a70 793a 636c 6173 733a 604c 6976 6550  :py:class:`LiveP
+00017970: 6f69 6e74 7357 6964 6765 7460 2e0a 2020  ointsWidget`..  
+00017980: 2020 2020 2020 2020 2020 4966 206e 6f20            If no 
+00017990: 6f75 7470 7574 2064 6573 6972 6564 2c20  output desired, 
+000179a0: 7365 7420 746f 2046 616c 7365 2e0a 0a20  set to False... 
+000179b0: 2020 2020 2020 2064 6c6f 677a 3a20 666c         dlogz: fl
+000179c0: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+000179d0: 5461 7267 6574 2065 7669 6465 6e63 6520  Target evidence 
+000179e0: 756e 6365 7274 6169 6e74 792e 2054 6869  uncertainty. Thi
+000179f0: 7320 6973 2074 6865 2073 7464 0a20 2020  s is the std.   
+00017a00: 2020 2020 2020 2020 2062 6574 7765 656e           between
+00017a10: 2062 6f6f 7473 7472 6170 7065 6420 6c6f   bootstrapped lo
+00017a20: 677a 2069 6e74 6567 7261 746f 7273 2e0a  gz integrators..
+00017a30: 0a20 2020 2020 2020 2064 4b4c 3a20 666c  .        dKL: fl
+00017a40: 6f61 740a 2020 2020 2020 2020 2020 2020  oat.            
+00017a50: 5461 7267 6574 2070 6f73 7465 7269 6f72  Target posterior
+00017a60: 2075 6e63 6572 7461 696e 7479 2e20 5468   uncertainty. Th
+00017a70: 6973 2069 7320 7468 650a 2020 2020 2020  is is the.      
+00017a80: 2020 2020 2020 4b75 6c6c 6261 636b 2d4c        Kullback-L
+00017a90: 6569 626c 6572 2064 6976 6572 6765 6e63  eibler divergenc
+00017aa0: 6520 696e 206e 6174 2062 6574 7765 656e  e in nat between
+00017ab0: 2062 6f6f 7473 7472 6170 7065 6420 696e   bootstrapped in
+00017ac0: 7465 6772 6174 6f72 732e 0a0a 2020 2020  tegrators...    
+00017ad0: 2020 2020 6672 6163 5f72 656d 6169 6e3a      frac_remain:
+00017ae0: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+00017af0: 2020 2049 6e74 6567 7261 7465 2075 6e74     Integrate unt
+00017b00: 696c 2074 6869 7320 6672 6163 7469 6f6e  il this fraction
+00017b10: 206f 6620 7468 6520 696e 7465 6772 616c   of the integral
+00017b20: 2069 7320 6c65 6674 2069 6e20 7468 6520   is left in the 
+00017b30: 7265 6d61 696e 6465 722e 0a20 2020 2020  remainder..     
+00017b40: 2020 2020 2020 2053 6574 2074 6f20 6120         Set to a 
+00017b50: 6c6f 7720 6e75 6d62 6572 2028 3165 2d32  low number (1e-2
+00017b60: 202e 2e2e 2031 652d 3529 2074 6f20 6d61   ... 1e-5) to ma
+00017b70: 6b65 2073 7572 6520 7065 616b 7320 6172  ke sure peaks ar
+00017b80: 6520 6469 7363 6f76 6572 6564 2e0a 2020  e discovered..  
+00017b90: 2020 2020 2020 2020 2020 5365 7420 746f            Set to
+00017ba0: 2061 2068 6967 6865 7220 6e75 6d62 6572   a higher number
+00017bb0: 2028 302e 3529 2069 6620 796f 7520 6b6e   (0.5) if you kn
+00017bc0: 6f77 2074 6865 2070 6f73 7465 7269 6f72  ow the posterior
+00017bd0: 2069 7320 7369 6d70 6c65 2e0a 0a20 2020   is simple...   
+00017be0: 2020 2020 204c 6570 7369 6c6f 6e3a 2066       Lepsilon: f
+00017bf0: 6c6f 6174 0a20 2020 2020 2020 2020 2020  loat.           
+00017c00: 2054 6572 6d69 6e61 7465 2077 6865 6e20   Terminate when 
+00017c10: 6c69 7665 2070 6f69 6e74 206c 696b 656c  live point likel
+00017c20: 6968 6f6f 6473 2061 7265 2061 6c6c 2074  ihoods are all t
+00017c30: 6865 2073 616d 652c 0a20 2020 2020 2020  he same,.       
+00017c40: 2020 2020 2077 6974 6869 6e20 4c65 7073       within Leps
+00017c50: 696c 6f6e 2074 6f6c 6572 616e 6365 2e20  ilon tolerance. 
+00017c60: 496e 6372 6561 7365 2074 6869 7320 7768  Increase this wh
+00017c70: 656e 2079 6f75 7220 6c69 6b65 6c69 686f  en your likeliho
+00017c80: 6f64 0a20 2020 2020 2020 2020 2020 2066  od.            f
+00017c90: 756e 6374 696f 6e20 6973 2069 6e61 6363  unction is inacc
+00017ca0: 7572 6174 652c 2074 6f20 6176 6f69 6420  urate, to avoid 
+00017cb0: 756e 6e65 6365 7373 6172 7920 7365 6172  unnecessary sear
+00017cc0: 6368 2e0a 0a20 2020 2020 2020 206d 696e  ch...        min
+00017cd0: 5f65 7373 3a20 696e 740a 2020 2020 2020  _ess: int.      
+00017ce0: 2020 2020 2020 5461 7267 6574 206e 756d        Target num
+00017cf0: 6265 7220 6f66 2065 6666 6563 7469 7665  ber of effective
+00017d00: 2070 6f73 7465 7269 6f72 2073 616d 706c   posterior sampl
+00017d10: 6573 2e0a 0a20 2020 2020 2020 206d 6178  es...        max
+00017d20: 5f69 7465 7273 3a20 696e 740a 2020 2020  _iters: int.    
+00017d30: 2020 2020 2020 2020 6d61 7869 6d75 6d20          maximum 
+00017d40: 6e75 6d62 6572 206f 6620 696e 7465 6772  number of integr
+00017d50: 6174 696f 6e20 6974 6572 6174 696f 6e73  ation iterations
+00017d60: 2e0a 0a20 2020 2020 2020 206d 6178 5f6e  ...        max_n
+00017d70: 6361 6c6c 733a 2069 6e74 0a20 2020 2020  calls: int.     
+00017d80: 2020 2020 2020 2073 746f 7020 6166 7465         stop afte
+00017d90: 7220 7468 6973 206d 616e 7920 6c69 6b65  r this many like
+00017da0: 6c69 686f 6f64 2065 7661 6c75 6174 696f  lihood evaluatio
+00017db0: 6e73 2e0a 0a20 2020 2020 2020 206d 6178  ns...        max
+00017dc0: 5f6e 756d 5f69 6d70 726f 7665 6d65 6e74  _num_improvement
+00017dd0: 5f6c 6f6f 7073 3a20 696e 740a 2020 2020  _loops: int.    
+00017de0: 2020 2020 2020 2020 7275 6e28 2920 7472          run() tr
+00017df0: 6965 7320 746f 2061 7373 6573 7320 6974  ies to assess it
+00017e00: 6572 6174 6976 656c 7920 7768 6572 6520  eratively where 
+00017e10: 6d6f 7265 2073 616d 706c 6573 2061 7265  more samples are
+00017e20: 206e 6565 6465 642e 0a20 2020 2020 2020   needed..       
+00017e30: 2020 2020 2054 6869 7320 6e75 6d62 6572       This number
+00017e40: 206c 696d 6974 7320 7468 6520 6e75 6d62   limits the numb
+00017e50: 6572 206f 6620 696d 7072 6f76 656d 656e  er of improvemen
+00017e60: 7420 6c6f 6f70 732e 0a0a 2020 2020 2020  t loops...      
+00017e70: 2020 6d69 6e5f 6e75 6d5f 6c69 7665 5f70    min_num_live_p
+00017e80: 6f69 6e74 733a 2069 6e74 0a20 2020 2020  oints: int.     
+00017e90: 2020 2020 2020 206d 696e 696d 756d 206e         minimum n
+00017ea0: 756d 6265 7220 6f66 206c 6976 6520 706f  umber of live po
+00017eb0: 696e 7473 2074 6872 6f75 6768 6f75 7420  ints throughout 
+00017ec0: 7468 6520 7275 6e0a 0a20 2020 2020 2020  the run..       
+00017ed0: 2063 6c75 7374 6572 5f6e 756d 5f6c 6976   cluster_num_liv
+00017ee0: 655f 706f 696e 7473 3a20 696e 740a 2020  e_points: int.  
+00017ef0: 2020 2020 2020 2020 2020 7265 7175 6972            requir
+00017f00: 6520 6174 206c 6561 7374 2074 6869 7320  e at least this 
+00017f10: 6d61 6e79 206c 6976 6520 706f 696e 7473  many live points
+00017f20: 2070 6572 2064 6574 6563 7465 6420 636c   per detected cl
+00017f30: 7573 7465 720a 0a20 2020 2020 2020 2069  uster..        i
+00017f40: 6e73 6572 7469 6f6e 5f74 6573 745f 7a73  nsertion_test_zs
+00017f50: 636f 7265 5f74 6872 6573 686f 6c64 3a20  core_threshold: 
+00017f60: 666c 6f61 740a 2020 2020 2020 2020 2020  float.          
+00017f70: 2020 7a2d 7363 6f72 6520 7573 6564 2061    z-score used a
+00017f80: 7320 6120 7468 7265 7368 6f6c 6420 666f  s a threshold fo
+00017f90: 7220 7468 6520 696e 7365 7274 696f 6e20  r the insertion 
+00017fa0: 6f72 6465 7220 7465 7374 2e0a 2020 2020  order test..    
+00017fb0: 2020 2020 2020 2020 5365 7420 746f 2069          Set to i
+00017fc0: 6e66 696e 6974 7920 746f 2064 6973 6162  nfinity to disab
+00017fd0: 6c65 2e0a 0a20 2020 2020 2020 2069 6e73  le...        ins
+00017fe0: 6572 7469 6f6e 5f74 6573 745f 7769 6e64  ertion_test_wind
+00017ff0: 6f77 3a20 696e 740a 2020 2020 2020 2020  ow: int.        
+00018000: 2020 2020 4e75 6d62 6572 206f 6620 6974      Number of it
+00018010: 6572 6174 696f 6e73 2061 6674 6572 2077  erations after w
+00018020: 6869 6368 2074 6865 2069 6e73 6572 7469  hich the inserti
+00018030: 6f6e 206f 7264 6572 2074 6573 7420 6973  on order test is
+00018040: 2072 6573 6574 2e0a 0a20 2020 2020 2020   reset...       
+00018050: 2072 6567 696f 6e5f 636c 6173 733a 203a   region_class: :
+00018060: 7079 3a63 6c61 7373 3a60 4d4c 4672 6965  py:class:`MLFrie
+00018070: 6e64 7360 206f 7220 3a70 793a 636c 6173  nds` or :py:clas
+00018080: 733a 6052 6f62 7573 7445 6c6c 6970 736f  s:`RobustEllipso
+00018090: 6964 5265 6769 6f6e 6020 6f72 203a 7079  idRegion` or :py
+000180a0: 3a63 6c61 7373 3a60 5369 6d70 6c65 5265  :class:`SimpleRe
+000180b0: 6769 6f6e 600a 2020 2020 2020 2020 2020  gion`.          
+000180c0: 2020 5768 6574 6865 7220 746f 2075 7365    Whether to use
+000180d0: 204d 4c46 7269 656e 6473 2b65 6c6c 6970   MLFriends+ellip
+000180e0: 736f 6964 616c 2b74 656c 6c69 7073 6f69  soidal+tellipsoi
+000180f0: 6461 6c20 7265 6769 6f6e 2028 6265 7474  dal region (bett
+00018100: 6572 2066 6f72 206d 756c 7469 2d6d 6f64  er for multi-mod
+00018110: 616c 2070 726f 626c 656d 7329 0a20 2020  al problems).   
+00018120: 2020 2020 2020 2020 206f 7220 6a75 7374           or just
+00018130: 2065 6c6c 6970 736f 6964 616c 2073 616d   ellipsoidal sam
+00018140: 706c 696e 6720 2866 6173 7465 7220 666f  pling (faster fo
+00018150: 7220 6869 6768 2d64 696d 656e 7369 6f6e  r high-dimension
+00018160: 616c 2c20 6761 7573 7369 616e 2d6c 696b  al, gaussian-lik
+00018170: 6520 7072 6f62 6c65 6d73 290a 2020 2020  e problems).    
+00018180: 2020 2020 2020 2020 6f72 2061 2061 7869          or a axi
+00018190: 732d 616c 6967 6e65 6420 656c 6c69 7073  s-aligned ellips
+000181a0: 6f69 6420 2866 6173 7465 7374 2c20 746f  oid (fastest, to
+000181b0: 2062 6520 636f 6d62 696e 6564 2077 6974   be combined wit
+000181c0: 6820 736c 6963 6520 7361 6d70 6c69 6e67  h slice sampling
+000181d0: 292e 0a0a 2020 2020 2020 2020 7769 6465  )...        wide
+000181e0: 6e5f 6265 666f 7265 5f69 6e69 7469 616c  n_before_initial
+000181f0: 5f70 6c61 7465 6175 5f6e 756d 5f77 6172  _plateau_num_war
+00018200: 6e3a 2069 6e74 0a20 2020 2020 2020 2020  n: int.         
+00018210: 2020 2049 6620 6120 6c69 6b65 6c69 686f     If a likeliho
+00018220: 6f64 2070 6c61 7465 6175 2069 7320 656e  od plateau is en
+00018230: 636f 756e 7465 7265 642c 2069 6e63 7265  countered, incre
+00018240: 6173 6520 7468 6520 6e75 6d62 6572 0a20  ase the number. 
+00018250: 2020 2020 2020 2020 2020 206f 6620 696e             of in
+00018260: 6974 6961 6c20 6c69 7665 2070 6f69 6e74  itial live point
+00018270: 7320 736f 2074 6861 7420 6f6e 6365 2074  s so that once t
+00018280: 6865 2070 6c61 7465 6175 2069 7320 7472  he plateau is tr
+00018290: 6176 6572 7365 642c 0a20 2020 2020 2020  aversed,.       
+000182a0: 2020 2020 202a 6d69 6e5f 6e75 6d5f 6c69       *min_num_li
+000182b0: 7665 5f70 6f69 6e74 732a 206c 6976 6520  ve_points* live 
+000182c0: 706f 696e 7473 2072 656d 6169 6e2e 0a20  points remain.. 
+000182d0: 2020 2020 2020 2020 2020 2049 6620 7468             If th
+000182e0: 6520 6e75 6d62 6572 2065 7863 6565 6473  e number exceeds
+000182f0: 202a 7769 6465 6e5f 6265 666f 7265 5f69   *widen_before_i
+00018300: 6e69 7469 616c 5f70 6c61 7465 6175 5f6e  nitial_plateau_n
+00018310: 756d 5f77 6172 6e2a 2c0a 2020 2020 2020  um_warn*,.      
+00018320: 2020 2020 2020 6120 7761 726e 696e 6720        a warning 
+00018330: 6973 2072 6169 7365 642e 0a0a 2020 2020  is raised...    
+00018340: 2020 2020 7769 6465 6e5f 6265 666f 7265      widen_before
+00018350: 5f69 6e69 7469 616c 5f70 6c61 7465 6175  _initial_plateau
+00018360: 5f6e 756d 5f6d 6178 3a20 696e 740a 2020  _num_max: int.  
+00018370: 2020 2020 2020 2020 2020 4966 2061 206c            If a l
+00018380: 696b 656c 6968 6f6f 6420 706c 6174 6561  ikelihood platea
+00018390: 7520 6973 2065 6e63 6f75 6e74 6572 6564  u is encountered
+000183a0: 2c20 696e 6372 6561 7365 2074 6865 206e  , increase the n
+000183b0: 756d 6265 720a 2020 2020 2020 2020 2020  umber.          
+000183c0: 2020 6f66 2069 6e69 7469 616c 206c 6976    of initial liv
+000183d0: 6520 706f 696e 7473 2073 6f20 7468 6174  e points so that
+000183e0: 206f 6e63 6520 7468 6520 706c 6174 6561   once the platea
+000183f0: 7520 6973 2074 7261 7665 7273 6564 2c0a  u is traversed,.
+00018400: 2020 2020 2020 2020 2020 2020 2a6d 696e              *min
+00018410: 5f6e 756d 5f6c 6976 655f 706f 696e 7473  _num_live_points
+00018420: 2a20 6c69 7665 2070 6f69 6e74 7320 7265  * live points re
+00018430: 6d61 696e 2c20 6275 7420 6e6f 7420 6d6f  main, but not mo
+00018440: 7265 2074 6861 6e0a 2020 2020 2020 2020  re than.        
+00018450: 2020 2020 2a77 6964 656e 5f62 6566 6f72      *widen_befor
+00018460: 655f 696e 6974 6961 6c5f 706c 6174 6561  e_initial_platea
+00018470: 755f 6e75 6d5f 7761 726e 2a2e 0a20 2020  u_num_warn*..   
+00018480: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00018490: 2066 6f72 2072 6573 756c 7420 696e 2073   for result in s
+000184a0: 656c 662e 7275 6e5f 6974 6572 280a 2020  elf.run_iter(.  
+000184b0: 2020 2020 2020 2020 2020 7570 6461 7465            update
+000184c0: 5f69 6e74 6572 7661 6c5f 766f 6c75 6d65  _interval_volume
+000184d0: 5f66 7261 6374 696f 6e3d 7570 6461 7465  _fraction=update
+000184e0: 5f69 6e74 6572 7661 6c5f 766f 6c75 6d65  _interval_volume
+000184f0: 5f66 7261 6374 696f 6e2c 0a20 2020 2020  _fraction,.     
+00018500: 2020 2020 2020 2075 7064 6174 655f 696e         update_in
+00018510: 7465 7276 616c 5f6e 6361 6c6c 3d75 7064  terval_ncall=upd
+00018520: 6174 655f 696e 7465 7276 616c 5f6e 6361  ate_interval_nca
+00018530: 6c6c 2c0a 2020 2020 2020 2020 2020 2020  ll,.            
+00018540: 6c6f 675f 696e 7465 7276 616c 3d6c 6f67  log_interval=log
+00018550: 5f69 6e74 6572 7661 6c2c 0a20 2020 2020  _interval,.     
+00018560: 2020 2020 2020 2064 6c6f 677a 3d64 6c6f         dlogz=dlo
+00018570: 677a 2c20 644b 4c3d 644b 4c2c 0a20 2020  gz, dKL=dKL,.   
+00018580: 2020 2020 2020 2020 204c 6570 7369 6c6f           Lepsilo
+00018590: 6e3d 4c65 7073 696c 6f6e 2c20 6672 6163  n=Lepsilon, frac
+000185a0: 5f72 656d 6169 6e3d 6672 6163 5f72 656d  _remain=frac_rem
+000185b0: 6169 6e2c 0a20 2020 2020 2020 2020 2020  ain,.           
+000185c0: 206d 696e 5f65 7373 3d6d 696e 5f65 7373   min_ess=min_ess
+000185d0: 2c20 6d61 785f 6974 6572 733d 6d61 785f  , max_iters=max_
+000185e0: 6974 6572 732c 0a20 2020 2020 2020 2020  iters,.         
+000185f0: 2020 206d 6178 5f6e 6361 6c6c 733d 6d61     max_ncalls=ma
+00018600: 785f 6e63 616c 6c73 2c20 6d61 785f 6e75  x_ncalls, max_nu
+00018610: 6d5f 696d 7072 6f76 656d 656e 745f 6c6f  m_improvement_lo
+00018620: 6f70 733d 6d61 785f 6e75 6d5f 696d 7072  ops=max_num_impr
+00018630: 6f76 656d 656e 745f 6c6f 6f70 732c 0a20  ovement_loops,. 
+00018640: 2020 2020 2020 2020 2020 206d 696e 5f6e             min_n
+00018650: 756d 5f6c 6976 655f 706f 696e 7473 3d6d  um_live_points=m
+00018660: 696e 5f6e 756d 5f6c 6976 655f 706f 696e  in_num_live_poin
+00018670: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00018680: 636c 7573 7465 725f 6e75 6d5f 6c69 7665  cluster_num_live
+00018690: 5f70 6f69 6e74 733d 636c 7573 7465 725f  _points=cluster_
+000186a0: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 732c  num_live_points,
+000186b0: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+000186c0: 775f 7374 6174 7573 3d73 686f 775f 7374  w_status=show_st
+000186d0: 6174 7573 2c0a 2020 2020 2020 2020 2020  atus,.          
+000186e0: 2020 7669 7a5f 6361 6c6c 6261 636b 3d76    viz_callback=v
+000186f0: 697a 5f63 616c 6c62 6163 6b2c 0a20 2020  iz_callback,.   
+00018700: 2020 2020 2020 2020 2069 6e73 6572 7469           inserti
+00018710: 6f6e 5f74 6573 745f 7769 6e64 6f77 3d69  on_test_window=i
+00018720: 6e73 6572 7469 6f6e 5f74 6573 745f 7769  nsertion_test_wi
+00018730: 6e64 6f77 2c0a 2020 2020 2020 2020 2020  ndow,.          
+00018740: 2020 696e 7365 7274 696f 6e5f 7465 7374    insertion_test
+00018750: 5f7a 7363 6f72 655f 7468 7265 7368 6f6c  _zscore_threshol
+00018760: 643d 696e 7365 7274 696f 6e5f 7465 7374  d=insertion_test
+00018770: 5f7a 7363 6f72 655f 7468 7265 7368 6f6c  _zscore_threshol
+00018780: 642c 0a20 2020 2020 2020 2020 2020 2072  d,.            r
+00018790: 6567 696f 6e5f 636c 6173 733d 7265 6769  egion_class=regi
+000187a0: 6f6e 5f63 6c61 7373 2c0a 2020 2020 2020  on_class,.      
+000187b0: 2020 2020 2020 7769 6465 6e5f 6265 666f        widen_befo
+000187c0: 7265 5f69 6e69 7469 616c 5f70 6c61 7465  re_initial_plate
+000187d0: 6175 5f6e 756d 5f77 6172 6e3d 7769 6465  au_num_warn=wide
+000187e0: 6e5f 6265 666f 7265 5f69 6e69 7469 616c  n_before_initial
+000187f0: 5f70 6c61 7465 6175 5f6e 756d 5f77 6172  _plateau_num_war
+00018800: 6e2c 0a20 2020 2020 2020 2020 2020 2077  n,.            w
+00018810: 6964 656e 5f62 6566 6f72 655f 696e 6974  iden_before_init
+00018820: 6961 6c5f 706c 6174 6561 755f 6e75 6d5f  ial_plateau_num_
+00018830: 6d61 783d 7769 6465 6e5f 6265 666f 7265  max=widen_before
+00018840: 5f69 6e69 7469 616c 5f70 6c61 7465 6175  _initial_plateau
+00018850: 5f6e 756d 5f6d 6178 2c0a 2020 2020 2020  _num_max,.      
+00018860: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00018870: 2069 6620 7365 6c66 2e6c 6f67 3a0a 2020   if self.log:.  
+00018880: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00018890: 6c66 2e6c 6f67 6765 722e 6465 6275 6728  lf.logger.debug(
+000188a0: 2264 6964 2061 2072 756e 5f69 7465 7220  "did a run_iter 
+000188b0: 7061 7373 2122 290a 2020 2020 2020 2020  pass!").        
+000188c0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+000188d0: 2069 6620 7365 6c66 2e6c 6f67 3a0a 2020   if self.log:.  
+000188e0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+000188f0: 6f67 6765 722e 696e 666f 2822 646f 6e65  ogger.info("done
+00018900: 2069 7465 7261 7469 6e67 2e22 290a 0a20   iterating.").. 
+00018910: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00018920: 6c66 2e72 6573 756c 7473 0a0a 2020 2020  lf.results..    
+00018930: 6465 6620 7275 6e5f 6974 6572 280a 2020  def run_iter(.  
+00018940: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+00018950: 2020 2020 2020 2020 2020 2020 7570 6461              upda
+00018960: 7465 5f69 6e74 6572 7661 6c5f 766f 6c75  te_interval_volu
+00018970: 6d65 5f66 7261 6374 696f 6e3d 302e 382c  me_fraction=0.8,
+00018980: 0a20 2020 2020 2020 2020 2020 2075 7064  .            upd
+00018990: 6174 655f 696e 7465 7276 616c 5f6e 6361  ate_interval_nca
+000189a0: 6c6c 3d4e 6f6e 652c 0a20 2020 2020 2020  ll=None,.       
+000189b0: 2020 2020 206c 6f67 5f69 6e74 6572 7661       log_interva
+000189c0: 6c3d 4e6f 6e65 2c0a 2020 2020 2020 2020  l=None,.        
+000189d0: 2020 2020 646c 6f67 7a3d 302e 352c 0a20      dlogz=0.5,. 
+000189e0: 2020 2020 2020 2020 2020 2064 4b4c 3d30             dKL=0
+000189f0: 2e35 2c0a 2020 2020 2020 2020 2020 2020  .5,.            
+00018a00: 6672 6163 5f72 656d 6169 6e3d 302e 3031  frac_remain=0.01
+00018a10: 2c0a 2020 2020 2020 2020 2020 2020 4c65  ,.            Le
+00018a20: 7073 696c 6f6e 3d30 2e30 3031 2c0a 2020  psilon=0.001,.  
+00018a30: 2020 2020 2020 2020 2020 6d69 6e5f 6573            min_es
+00018a40: 733d 3430 302c 0a20 2020 2020 2020 2020  s=400,.         
+00018a50: 2020 206d 6178 5f69 7465 7273 3d4e 6f6e     max_iters=Non
+00018a60: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00018a70: 6178 5f6e 6361 6c6c 733d 4e6f 6e65 2c0a  ax_ncalls=None,.
+00018a80: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+00018a90: 6e75 6d5f 696d 7072 6f76 656d 656e 745f  num_improvement_
+00018aa0: 6c6f 6f70 733d 2d31 2c0a 2020 2020 2020  loops=-1,.      
+00018ab0: 2020 2020 2020 6d69 6e5f 6e75 6d5f 6c69        min_num_li
+00018ac0: 7665 5f70 6f69 6e74 733d 3430 302c 0a20  ve_points=400,. 
+00018ad0: 2020 2020 2020 2020 2020 2063 6c75 7374             clust
+00018ae0: 6572 5f6e 756d 5f6c 6976 655f 706f 696e  er_num_live_poin
+00018af0: 7473 3d34 302c 0a20 2020 2020 2020 2020  ts=40,.         
+00018b00: 2020 2073 686f 775f 7374 6174 7573 3d54     show_status=T
+00018b10: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+00018b20: 2076 697a 5f63 616c 6c62 6163 6b3d 2761   viz_callback='a
+00018b30: 7574 6f27 2c0a 2020 2020 2020 2020 2020  uto',.          
 00018b40: 2020 696e 7365 7274 696f 6e5f 7465 7374    insertion_test
-00018b50: 5f7a 7363 6f72 655f 7468 7265 7368 6f6c  _zscore_threshol
-00018b60: 643d 322c 0a20 2020 2020 2020 2020 2020  d=2,.           
-00018b70: 2072 6567 696f 6e5f 636c 6173 733d 4d4c   region_class=ML
-00018b80: 4672 6965 6e64 732c 0a20 2020 2020 2020  Friends,.       
-00018b90: 2020 2020 2077 6964 656e 5f62 6566 6f72       widen_befor
-00018ba0: 655f 696e 6974 6961 6c5f 706c 6174 6561  e_initial_platea
-00018bb0: 755f 6e75 6d5f 7761 726e 3d31 3030 3030  u_num_warn=10000
-00018bc0: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
-00018bd0: 6465 6e5f 6265 666f 7265 5f69 6e69 7469  den_before_initi
-00018be0: 616c 5f70 6c61 7465 6175 5f6e 756d 5f6d  al_plateau_num_m
-00018bf0: 6178 3d35 3030 3030 2c0a 2020 2020 293a  ax=50000,.    ):
-00018c00: 0a20 2020 2020 2020 2022 2222 4974 6572  .        """Iter
-00018c10: 6174 6520 746f 7761 7264 7320 636f 6e76  ate towards conv
-00018c20: 6572 6765 6e63 652e 0a0a 2020 2020 2020  ergence...      
-00018c30: 2020 5573 6520 6173 2061 6e20 6974 6572    Use as an iter
-00018c40: 6174 6f72 206c 696b 6520 736f 3a3a 0a0a  ator like so::..
-00018c50: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00018c60: 7265 7375 6c74 2069 6e20 7361 6d70 6c65  result in sample
-00018c70: 722e 7275 6e5f 6974 6572 282e 2e2e 293a  r.run_iter(...):
-00018c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018c90: 2070 7269 6e74 2827 6c6e 5a20 3d20 2528   print('lnZ = %(
-00018ca0: 6c6f 677a 292e 3266 202b 2d20 2528 6c6f  logz).2f +- %(lo
-00018cb0: 677a 6572 7229 2e32 6627 2025 2072 6573  gzerr).2f' % res
-00018cc0: 756c 7429 0a0a 2020 2020 2020 2020 5061  ult)..        Pa
-00018cd0: 7261 6d65 7465 7273 2061 7320 6465 7363  rameters as desc
-00018ce0: 7269 6265 6420 696e 2072 756e 2829 206d  ribed in run() m
-00018cf0: 6574 686f 642e 0a0a 2020 2020 2020 2020  ethod...        
-00018d00: 5969 656c 6473 0a20 2020 2020 2020 202d  Yields.        -
-00018d10: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7265  -----.        re
-00018d20: 7375 6c74 733a 2064 6963 740a 2020 2020  sults: dict.    
-00018d30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00018d40: 2320 6672 6163 5f72 656d 6169 6e3d 3120  # frac_remain=1 
-00018d50: 206d 6561 6e73 2031 3a31 202d 3e20 646c   means 1:1 -> dl
-00018d60: 6f67 7a3d 6c6f 6728 302e 3529 0a20 2020  ogz=log(0.5).   
-00018d70: 2020 2020 2023 2066 7261 635f 7265 6d61       # frac_rema
-00018d80: 696e 3d30 2e31 206d 6561 6e73 2031 3a31  in=0.1 means 1:1
-00018d90: 3020 2d3e 2064 6c6f 677a 3d6c 6f67 2830  0 -> dlogz=log(0
-00018da0: 2e31 290a 2020 2020 2020 2020 2320 646c  .1).        # dl
-00018db0: 6f67 7a5f 6d69 6e20 3d20 6c6f 6728 312e  ogz_min = log(1.
-00018dc0: 2f28 3120 2b20 6672 6163 5f72 656d 6169  /(1 + frac_remai
-00018dd0: 6e29 290a 2020 2020 2020 2020 2320 646c  n)).        # dl
-00018de0: 6f67 7a5f 6d69 6e20 3d20 2d6c 6f67 3170  ogz_min = -log1p
-00018df0: 2866 7261 635f 7265 6d61 696e 290a 2020  (frac_remain).  
-00018e00: 2020 2020 2020 6966 202d 6e70 2e6c 6f67        if -np.log
-00018e10: 3170 2866 7261 635f 7265 6d61 696e 2920  1p(frac_remain) 
-00018e20: 3e20 646c 6f67 7a3a 0a20 2020 2020 2020  > dlogz:.       
-00018e30: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00018e40: 4572 726f 7228 2254 6f20 6163 6869 6576  Error("To achiev
-00018e50: 6520 7468 6520 6465 7369 7265 6420 6c6f  e the desired lo
-00018e60: 677a 2061 6363 7572 6163 792c 2073 6574  gz accuracy, set
-00018e70: 2066 7261 635f 7265 6d61 696e 2074 6f20   frac_remain to 
-00018e80: 6120 7661 6c75 6520 6d75 6368 2073 6d61  a value much sma
-00018e90: 6c6c 6572 2074 6861 6e20 2573 2028 6375  ller than %s (cu
-00018ea0: 7272 656e 746c 793a 2025 7329 2220 2520  rrently: %s)" % 
-00018eb0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00018ec0: 2020 6578 7028 2d64 6c6f 677a 2920 2d20    exp(-dlogz) - 
-00018ed0: 312c 2066 7261 635f 7265 6d61 696e 2929  1, frac_remain))
-00018ee0: 0a0a 2020 2020 2020 2020 2320 7468 6520  ..        # the 
-00018ef0: 6572 726f 7220 6973 2061 7070 726f 7869  error is approxi
-00018f00: 6d61 7465 6c79 2064 6c6f 677a 203d 2073  mately dlogz = s
-00018f10: 7172 7428 6974 6572 6174 696f 6e73 2920  qrt(iterations) 
-00018f20: 2f20 4e6c 6976 650a 2020 2020 2020 2020  / Nlive.        
-00018f30: 2320 736f 2077 6520 6e65 6564 2061 206d  # so we need a m
-00018f40: 696e 696d 756d 2c20 7768 6963 6820 6465  inimum, which de
-00018f50: 7065 6e64 7320 6f6e 2074 6865 206e 756d  pends on the num
-00018f60: 6265 7220 6f66 2069 7465 7261 7469 6f6e  ber of iteration
-00018f70: 730a 2020 2020 2020 2020 2320 6665 7765  s.        # fewe
-00018f80: 7220 7468 616e 2031 3030 3020 6974 6572  r than 1000 iter
-00018f90: 6174 696f 6e73 2069 7320 7175 6974 6520  ations is quite 
-00018fa0: 756e 6c69 6b65 6c79 0a20 2020 2020 2020  unlikely.       
-00018fb0: 2069 6620 6d69 6e5f 6e75 6d5f 6c69 7665   if min_num_live
-00018fc0: 5f70 6f69 6e74 7320 3c20 3130 3030 2a2a  _points < 1000**
-00018fd0: 302e 3520 2f20 646c 6f67 7a3a 0a20 2020  0.5 / dlogz:.   
-00018fe0: 2020 2020 2020 2020 206d 696e 5f6e 756d           min_num
-00018ff0: 5f6c 6976 655f 706f 696e 7473 203d 2069  _live_points = i
-00019000: 6e74 286e 702e 6365 696c 2831 3030 302a  nt(np.ceil(1000*
-00019010: 2a30 2e35 202f 2064 6c6f 677a 2929 0a20  *0.5 / dlogz)). 
-00019020: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00019030: 6c66 2e6c 6f67 3a0a 2020 2020 2020 2020  lf.log:.        
-00019040: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-00019050: 6765 722e 696e 666f 2822 546f 2061 6368  ger.info("To ach
-00019060: 6965 7665 2074 6865 2064 6573 6972 6564  ieve the desired
-00019070: 206c 6f67 7a20 6163 6375 7261 6379 2c20   logz accuracy, 
-00019080: 6d69 6e5f 6e75 6d5f 6c69 7665 5f70 6f69  min_num_live_poi
-00019090: 6e74 7320 7761 7320 696e 6372 6561 7365  nts was increase
-000190a0: 6420 746f 2025 6422 2025 2028 0a20 2020  d to %d" % (.   
-000190b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000190c0: 206d 696e 5f6e 756d 5f6c 6976 655f 706f   min_num_live_po
-000190d0: 696e 7473 2929 0a0a 2020 2020 2020 2020  ints))..        
-000190e0: 6966 2073 656c 662e 6c6f 675f 746f 5f70  if self.log_to_p
-000190f0: 6f69 6e74 7374 6f72 653a 0a20 2020 2020  ointstore:.     
-00019100: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-00019110: 6c66 2e70 6f69 6e74 7374 6f72 652e 7374  lf.pointstore.st
-00019120: 6163 6b29 203e 2030 3a0a 2020 2020 2020  ack) > 0:.      
-00019130: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-00019140: 6f67 6765 722e 696e 666f 2822 5265 7375  ogger.info("Resu
-00019150: 6d69 6e67 2066 726f 6d20 2564 2073 746f  ming from %d sto
-00019160: 7265 6420 706f 696e 7473 222c 206c 656e  red points", len
-00019170: 2873 656c 662e 706f 696e 7473 746f 7265  (self.pointstore
-00019180: 2e73 7461 636b 2929 0a20 2020 2020 2020  .stack)).       
-00019190: 2020 2020 2073 656c 662e 7573 655f 706f       self.use_po
-000191a0: 696e 745f 7374 6163 6b20 3d20 6e6f 7420  int_stack = not 
-000191b0: 7365 6c66 2e70 6f69 6e74 7374 6f72 652e  self.pointstore.
-000191c0: 7374 6163 6b5f 656d 7074 790a 2020 2020  stack_empty.    
-000191d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000191e0: 2020 2020 2020 7365 6c66 2e75 7365 5f70        self.use_p
-000191f0: 6f69 6e74 5f73 7461 636b 203d 2046 616c  oint_stack = Fal
-00019200: 7365 0a0a 2020 2020 2020 2020 6173 7365  se..        asse
-00019210: 7274 206d 696e 5f6e 756d 5f6c 6976 655f  rt min_num_live_
-00019220: 706f 696e 7473 203e 3d20 636c 7573 7465  points >= cluste
-00019230: 725f 6e75 6d5f 6c69 7665 5f70 6f69 6e74  r_num_live_point
-00019240: 732c 205c 0a20 2020 2020 2020 2020 2020  s, \.           
-00019250: 2028 276d 696e 5f6e 756d 5f6c 6976 655f   ('min_num_live_
-00019260: 706f 696e 7473 2825 6429 2063 616e 6e6f  points(%d) canno
-00019270: 7420 6265 206c 6573 7320 7468 616e 2063  t be less than c
-00019280: 6c75 7374 6572 5f6e 756d 5f6c 6976 655f  luster_num_live_
-00019290: 706f 696e 7473 2825 6429 2720 250a 2020  points(%d)' %.  
-000192a0: 2020 2020 2020 2020 2020 2020 2020 286d                (m
-000192b0: 696e 5f6e 756d 5f6c 6976 655f 706f 696e  in_num_live_poin
-000192c0: 7473 2c20 636c 7573 7465 725f 6e75 6d5f  ts, cluster_num_
-000192d0: 6c69 7665 5f70 6f69 6e74 7329 290a 2020  live_points)).  
-000192e0: 2020 2020 2020 7365 6c66 2e6d 696e 5f6e        self.min_n
-000192f0: 756d 5f6c 6976 655f 706f 696e 7473 203d  um_live_points =
-00019300: 206d 696e 5f6e 756d 5f6c 6976 655f 706f   min_num_live_po
-00019310: 696e 7473 0a20 2020 2020 2020 2073 656c  ints.        sel
-00019320: 662e 636c 7573 7465 725f 6e75 6d5f 6c69  f.cluster_num_li
-00019330: 7665 5f70 6f69 6e74 7320 3d20 636c 7573  ve_points = clus
-00019340: 7465 725f 6e75 6d5f 6c69 7665 5f70 6f69  ter_num_live_poi
-00019350: 6e74 730a 2020 2020 2020 2020 7365 6c66  nts.        self
-00019360: 2e73 616d 706c 696e 675f 736c 6f77 5f77  .sampling_slow_w
-00019370: 6172 6e65 6420 3d20 4661 6c73 650a 2020  arned = False.  
-00019380: 2020 2020 2020 7365 6c66 2e62 7569 6c64        self.build
-00019390: 5f74 7265 6769 6f6e 203d 2054 7275 650a  _tregion = True.
-000193a0: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
-000193b0: 696f 6e5f 636c 6173 7320 3d20 7265 6769  ion_class = regi
-000193c0: 6f6e 5f63 6c61 7373 0a20 2020 2020 2020  on_class.       
-000193d0: 2075 7064 6174 655f 696e 7465 7276 616c   update_interval
-000193e0: 5f76 6f6c 756d 655f 6c6f 675f 6672 6163  _volume_log_frac
-000193f0: 7469 6f6e 203d 206c 6f67 2875 7064 6174  tion = log(updat
-00019400: 655f 696e 7465 7276 616c 5f76 6f6c 756d  e_interval_volum
-00019410: 655f 6672 6163 7469 6f6e 290a 0a20 2020  e_fraction)..   
-00019420: 2020 2020 2069 6620 7669 7a5f 6361 6c6c       if viz_call
-00019430: 6261 636b 203d 3d20 2761 7574 6f27 3a0a  back == 'auto':.
-00019440: 2020 2020 2020 2020 2020 2020 7669 7a5f              viz_
-00019450: 6361 6c6c 6261 636b 203d 2067 6574 5f64  callback = get_d
-00019460: 6566 6175 6c74 5f76 697a 5f63 616c 6c62  efault_viz_callb
-00019470: 6163 6b28 290a 0a20 2020 2020 2020 2073  ack()..        s
-00019480: 656c 662e 5f77 6964 656e 5f72 6f6f 7473  elf._widen_roots
-00019490: 5f62 6579 6f6e 645f 696e 6974 6961 6c5f  _beyond_initial_
-000194a0: 706c 6174 6561 7528 0a20 2020 2020 2020  plateau(.       
-000194b0: 2020 2020 206d 696e 5f6e 756d 5f6c 6976       min_num_liv
-000194c0: 655f 706f 696e 7473 2c0a 2020 2020 2020  e_points,.      
-000194d0: 2020 2020 2020 7769 6465 6e5f 6265 666f        widen_befo
-000194e0: 7265 5f69 6e69 7469 616c 5f70 6c61 7465  re_initial_plate
-000194f0: 6175 5f6e 756d 5f77 6172 6e2c 2077 6964  au_num_warn, wid
-00019500: 656e 5f62 6566 6f72 655f 696e 6974 6961  en_before_initia
-00019510: 6c5f 706c 6174 6561 755f 6e75 6d5f 6d61  l_plateau_num_ma
-00019520: 7829 0a0a 2020 2020 2020 2020 4c6c 6f2c  x)..        Llo,
-00019530: 204c 6869 203d 202d 6e70 2e69 6e66 2c20   Lhi = -np.inf, 
-00019540: 6e70 2e69 6e66 0a20 2020 2020 2020 204c  np.inf.        L
-00019550: 6d61 7820 3d20 2d6e 702e 696e 660a 2020  max = -np.inf.  
-00019560: 2020 2020 2020 7374 7261 7465 6779 5f73        strategy_s
-00019570: 7461 6c65 203d 2054 7275 650a 2020 2020  tale = True.    
-00019580: 2020 2020 6d69 6e69 6d61 6c5f 7769 6474      minimal_widt
-00019590: 6873 203d 205b 5d0a 2020 2020 2020 2020  hs = [].        
-000195a0: 7461 7267 6574 5f6d 696e 5f6e 756d 5f63  target_min_num_c
-000195b0: 6869 6c64 7265 6e20 3d20 7b7d 0a20 2020  hildren = {}.   
-000195c0: 2020 2020 2069 6d70 726f 7665 6d65 6e74       improvement
-000195d0: 5f69 7420 3d20 300a 0a20 2020 2020 2020  _it = 0..       
-000195e0: 2061 7373 6572 7420 6d61 785f 6974 6572   assert max_iter
-000195f0: 7320 6973 204e 6f6e 6520 6f72 206d 6178  s is None or max
-00019600: 5f69 7465 7273 203e 2030 2c20 2822 496e  _iters > 0, ("In
-00019610: 7661 6c69 6420 7661 6c75 6520 666f 7220  valid value for 
-00019620: 6d61 785f 6974 6572 733a 2025 732e 2053  max_iters: %s. S
-00019630: 6574 2074 6f20 4e6f 6e65 206f 7220 706f  et to None or po
-00019640: 7369 7469 7665 206e 756d 6265 7222 2025  sitive number" %
-00019650: 206d 6178 5f69 7465 7273 290a 2020 2020   max_iters).    
-00019660: 2020 2020 6173 7365 7274 206d 6178 5f6e      assert max_n
-00019670: 6361 6c6c 7320 6973 204e 6f6e 6520 6f72  calls is None or
-00019680: 206d 6178 5f6e 6361 6c6c 7320 3e20 302c   max_ncalls > 0,
-00019690: 2028 2249 6e76 616c 6964 2076 616c 7565   ("Invalid value
-000196a0: 2066 6f72 206d 6178 5f6e 6361 6c6c 733a   for max_ncalls:
-000196b0: 2025 732e 2053 6574 2074 6f20 4e6f 6e65   %s. Set to None
-000196c0: 206f 7220 706f 7369 7469 7665 206e 756d   or positive num
-000196d0: 6265 7222 2025 206d 6178 5f6e 6361 6c6c  ber" % max_ncall
-000196e0: 7329 0a0a 2020 2020 2020 2020 6966 2073  s)..        if s
-000196f0: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
-00019700: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
-00019710: 2e64 6562 7567 280a 2020 2020 2020 2020  .debug(.        
-00019720: 2020 2020 2020 2020 2772 756e 5f69 7465          'run_ite
-00019730: 7220 646c 6f67 7a3d 252e 3166 2c20 644b  r dlogz=%.1f, dK
-00019740: 4c3d 252e 3166 2c20 6672 6163 5f72 656d  L=%.1f, frac_rem
-00019750: 6169 6e3d 252e 3266 2c20 4c65 7073 696c  ain=%.2f, Lepsil
-00019760: 6f6e 3d25 2e34 662c 206d 696e 5f65 7373  on=%.4f, min_ess
-00019770: 3d25 6427 2025 2028 0a20 2020 2020 2020  =%d' % (.       
-00019780: 2020 2020 2020 2020 2020 2020 2064 6c6f               dlo
-00019790: 677a 2c20 644b 4c2c 2066 7261 635f 7265  gz, dKL, frac_re
-000197a0: 6d61 696e 2c20 4c65 7073 696c 6f6e 2c20  main, Lepsilon, 
-000197b0: 6d69 6e5f 6573 7329 0a20 2020 2020 2020  min_ess).       
-000197c0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000197d0: 2020 2073 656c 662e 6c6f 6767 6572 2e64     self.logger.d
-000197e0: 6562 7567 280a 2020 2020 2020 2020 2020  ebug(.          
-000197f0: 2020 2020 2020 276d 6178 5f69 7465 7273        'max_iters
-00019800: 3d25 642c 206d 6178 5f6e 6361 6c6c 733d  =%d, max_ncalls=
-00019810: 2564 2c20 6d61 785f 6e75 6d5f 696d 7072  %d, max_num_impr
-00019820: 6f76 656d 656e 745f 6c6f 6f70 733d 2564  ovement_loops=%d
-00019830: 2c20 6d69 6e5f 6e75 6d5f 6c69 7665 5f70  , min_num_live_p
-00019840: 6f69 6e74 733d 2564 2c20 636c 7573 7465  oints=%d, cluste
-00019850: 725f 6e75 6d5f 6c69 7665 5f70 6f69 6e74  r_num_live_point
-00019860: 733d 2564 2720 2520 280a 2020 2020 2020  s=%d' % (.      
-00019870: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00019880: 785f 6974 6572 7320 6966 206d 6178 5f69  x_iters if max_i
-00019890: 7465 7273 2065 6c73 6520 2d31 2c20 6d61  ters else -1, ma
-000198a0: 785f 6e63 616c 6c73 2069 6620 6d61 785f  x_ncalls if max_
-000198b0: 6e63 616c 6c73 2065 6c73 6520 2d31 2c0a  ncalls else -1,.
-000198c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198d0: 2020 2020 6d61 785f 6e75 6d5f 696d 7072      max_num_impr
-000198e0: 6f76 656d 656e 745f 6c6f 6f70 732c 206d  ovement_loops, m
-000198f0: 696e 5f6e 756d 5f6c 6976 655f 706f 696e  in_num_live_poin
-00019900: 7473 2c20 636c 7573 7465 725f 6e75 6d5f  ts, cluster_num_
-00019910: 6c69 7665 5f70 6f69 6e74 7329 0a20 2020  live_points).   
-00019920: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00019930: 2020 2020 7365 6c66 2e72 6573 756c 7473      self.results
-00019940: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
-00019950: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
-00019960: 2020 2020 2020 2020 2072 6f6f 7473 203d           roots =
-00019970: 2073 656c 662e 726f 6f74 2e63 6869 6c64   self.root.child
-00019980: 7265 6e0a 0a20 2020 2020 2020 2020 2020  ren..           
-00019990: 206e 726f 6f74 7320 3d20 6c65 6e28 726f   nroots = len(ro
-000199a0: 6f74 7329 0a0a 2020 2020 2020 2020 2020  ots)..          
-000199b0: 2020 6966 2075 7064 6174 655f 696e 7465    if update_inte
-000199c0: 7276 616c 5f6e 6361 6c6c 2069 7320 4e6f  rval_ncall is No
-000199d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000199e0: 2020 2020 7570 6461 7465 5f69 6e74 6572      update_inter
-000199f0: 7661 6c5f 6e63 616c 6c20 3d20 6e72 6f6f  val_ncall = nroo
-00019a00: 7473 0a0a 2020 2020 2020 2020 2020 2020  ts..            
-00019a10: 6966 206c 6f67 5f69 6e74 6572 7661 6c20  if log_interval 
-00019a20: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00019a30: 2020 2020 2020 2020 206c 6f67 5f69 6e74           log_int
-00019a40: 6572 7661 6c20 3d20 6d61 7828 312c 2072  erval = max(1, r
-00019a50: 6f75 6e64 2830 2e31 202a 206e 726f 6f74  ound(0.1 * nroot
-00019a60: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-00019a70: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00019a80: 2020 2020 2020 6c6f 675f 696e 7465 7276        log_interv
-00019a90: 616c 203d 2072 6f75 6e64 286c 6f67 5f69  al = round(log_i
-00019aa0: 6e74 6572 7661 6c29 0a20 2020 2020 2020  nterval).       
-00019ab0: 2020 2020 2020 2020 2069 6620 6c6f 675f           if log_
-00019ac0: 696e 7465 7276 616c 203c 2031 3a0a 2020  interval < 1:.  
-00019ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ae0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00019af0: 6f72 2822 6c6f 675f 696e 7465 7276 616c  or("log_interval
-00019b00: 206d 7573 7420 6265 203e 3d20 3122 290a   must be >= 1").
-00019b10: 0a20 2020 2020 2020 2020 2020 2065 7870  .            exp
-00019b20: 6c6f 7265 7220 3d20 4272 6561 6474 6846  lorer = BreadthF
-00019b30: 6972 7374 4974 6572 6174 6f72 2872 6f6f  irstIterator(roo
-00019b40: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-00019b50: 2320 496e 7465 6772 6174 696e 6720 7468  # Integrating th
-00019b60: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00019b70: 6d61 696e 5f69 7465 7261 746f 7220 3d20  main_iterator = 
-00019b80: 4d75 6c74 6943 6f75 6e74 6572 280a 2020  MultiCounter(.  
-00019b90: 2020 2020 2020 2020 2020 2020 2020 6e72                nr
-00019ba0: 6f6f 7473 3d6c 656e 2872 6f6f 7473 292c  oots=len(roots),
-00019bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019bc0: 206e 626f 6f74 7374 7261 7073 3d6d 6178   nbootstraps=max
-00019bd0: 2831 2c20 7365 6c66 2e6e 756d 5f62 6f6f  (1, self.num_boo
-00019be0: 7473 7472 6170 7320 2f2f 2073 656c 662e  tstraps // self.
-00019bf0: 6d70 695f 7369 7a65 292c 0a20 2020 2020  mpi_size),.     
-00019c00: 2020 2020 2020 2020 2020 2072 616e 646f             rando
-00019c10: 6d3d 4661 6c73 652c 2063 6865 636b 5f69  m=False, check_i
-00019c20: 6e73 6572 7469 6f6e 5f6f 7264 6572 3d46  nsertion_order=F
-00019c30: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-00019c40: 2020 6d61 696e 5f69 7465 7261 746f 722e    main_iterator.
-00019c50: 4c6d 6178 203d 206d 6178 284c 6d61 782c  Lmax = max(Lmax,
-00019c60: 206d 6178 286e 2e76 616c 7565 2066 6f72   max(n.value for
-00019c70: 206e 2069 6e20 726f 6f74 7329 290a 2020   n in roots)).  
-00019c80: 2020 2020 2020 2020 2020 696e 7365 7274            insert
-00019c90: 696f 6e5f 7465 7374 203d 2055 6e69 666f  ion_test = Unifo
-00019ca0: 726d 4f72 6465 7241 6363 756d 756c 6174  rmOrderAccumulat
-00019cb0: 6f72 2829 0a20 2020 2020 2020 2020 2020  or().           
-00019cc0: 2069 6e73 6572 7469 6f6e 5f74 6573 745f   insertion_test_
-00019cd0: 7275 6e73 203d 205b 5d0a 2020 2020 2020  runs = [].      
-00019ce0: 2020 2020 2020 696e 7365 7274 696f 6e5f        insertion_
-00019cf0: 7465 7374 5f71 7561 6c69 7479 203d 206e  test_quality = n
-00019d00: 702e 696e 660a 2020 2020 2020 2020 2020  p.inf.          
-00019d10: 2020 696e 7365 7274 696f 6e5f 7465 7374    insertion_test
-00019d20: 5f64 6972 6563 7469 6f6e 203d 2030 0a0a  _direction = 0..
-00019d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00019d40: 2e74 7261 6e73 666f 726d 4c61 7965 7220  .transformLayer 
-00019d50: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
-00019d60: 2020 2073 656c 662e 7265 6769 6f6e 203d     self.region =
-00019d70: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00019d80: 2020 7365 6c66 2e74 7265 6769 6f6e 203d    self.tregion =
-00019d90: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00019da0: 2020 7365 6c66 2e6c 6976 655f 706f 696e    self.live_poin
-00019db0: 7473 5f68 6561 6c74 6879 203d 2054 7275  ts_healthy = Tru
-00019dc0: 650a 2020 2020 2020 2020 2020 2020 6974  e.            it
-00019dd0: 5f61 745f 6669 7273 745f 7265 6769 6f6e  _at_first_region
-00019de0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00019df0: 2073 656c 662e 6962 203d 2030 0a20 2020   self.ib = 0.   
-00019e00: 2020 2020 2020 2020 2073 656c 662e 7361           self.sa
-00019e10: 6d70 6c65 7320 3d20 5b5d 0a20 2020 2020  mples = [].     
-00019e20: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-00019e30: 7261 775f 6d75 6c74 6970 6c65 3a0a 2020  raw_multiple:.  
-00019e40: 2020 2020 2020 2020 2020 2020 2020 6e64                nd
-00019e50: 7261 7720 3d20 7365 6c66 2e6e 6472 6177  raw = self.ndraw
-00019e60: 5f6d 696e 0a20 2020 2020 2020 2020 2020  _min.           
-00019e70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00019e80: 2020 2020 2020 206e 6472 6177 203d 2034         ndraw = 4
-00019e90: 300a 2020 2020 2020 2020 2020 2020 7365  0.            se
-00019ea0: 6c66 2e70 6f69 6e74 7374 6f72 652e 7265  lf.pointstore.re
-00019eb0: 7365 7428 290a 2020 2020 2020 2020 2020  set().          
-00019ec0: 2020 6966 2073 656c 662e 6c6f 675f 746f    if self.log_to
-00019ed0: 5f70 6f69 6e74 7374 6f72 653a 0a20 2020  _pointstore:.   
-00019ee0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00019ef0: 662e 7573 655f 706f 696e 745f 7374 6163  f.use_point_stac
-00019f00: 6b20 3d20 6e6f 7420 7365 6c66 2e70 6f69  k = not self.poi
-00019f10: 6e74 7374 6f72 652e 7374 6163 6b5f 656d  ntstore.stack_em
-00019f20: 7074 790a 2020 2020 2020 2020 2020 2020  pty.            
-00019f30: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00019f40: 2020 2020 2020 7365 6c66 2e75 7365 5f70        self.use_p
-00019f50: 6f69 6e74 5f73 7461 636b 203d 2046 616c  oint_stack = Fal
-00019f60: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
-00019f70: 6620 7365 6c66 2e75 7365 5f6d 7069 3a0a  f self.use_mpi:.
-00019f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f90: 7365 6c66 2e75 7365 5f70 6f69 6e74 5f73  self.use_point_s
-00019fa0: 7461 636b 203d 2073 656c 662e 636f 6d6d  tack = self.comm
-00019fb0: 2e62 6361 7374 2873 656c 662e 7573 655f  .bcast(self.use_
-00019fc0: 706f 696e 745f 7374 6163 6b2c 2072 6f6f  point_stack, roo
-00019fd0: 743d 3029 0a0a 2020 2020 2020 2020 2020  t=0)..          
-00019fe0: 2020 6966 2073 656c 662e 6c6f 6720 616e    if self.log an
-00019ff0: 6420 286e 702e 6973 6669 6e69 7465 284c  d (np.isfinite(L
-0001a000: 6c6f 2920 6f72 206e 702e 6973 6669 6e69  lo) or np.isfini
-0001a010: 7465 284c 6869 2929 3a0a 2020 2020 2020  te(Lhi)):.      
-0001a020: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
-0001a030: 6f67 6765 722e 696e 666f 2822 4578 706c  ogger.info("Expl
-0001a040: 6f72 696e 6720 2869 6e20 7061 7274 6963  oring (in partic
-0001a050: 756c 6172 3a20 4c3d 252e 3266 2e2e 252e  ular: L=%.2f..%.
-0001a060: 3266 2920 2e2e 2e22 2c20 4c6c 6f2c 204c  2f) ...", Llo, L
-0001a070: 6869 290a 2020 2020 2020 2020 2020 2020  hi).            
-0001a080: 7265 6769 6f6e 5f73 6571 7565 6e63 6520  region_sequence 
-0001a090: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-0001a0a0: 206d 696e 696d 616c 5f77 6964 7468 735f   minimal_widths_
-0001a0b0: 7365 7175 656e 6365 203d 205f 7365 7175  sequence = _sequ
-0001a0c0: 656e 7469 616c 697a 655f 7769 6474 685f  entialize_width_
-0001a0d0: 7365 7175 656e 6365 286d 696e 696d 616c  sequence(minimal
-0001a0e0: 5f77 6964 7468 732c 2073 656c 662e 6d69  _widths, self.mi
-0001a0f0: 6e5f 6e75 6d5f 6c69 7665 5f70 6f69 6e74  n_num_live_point
-0001a100: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
-0001a110: 6620 7365 6c66 2e6c 6f67 3a0a 2020 2020  f self.log:.    
-0001a120: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001a130: 2e6c 6f67 6765 722e 6465 6275 6728 276d  .logger.debug('m
-0001a140: 696e 696d 616c 5f77 6964 7468 735f 7365  inimal_widths_se
-0001a150: 7175 656e 6365 3a20 2573 272c 206d 696e  quence: %s', min
-0001a160: 696d 616c 5f77 6964 7468 735f 7365 7175  imal_widths_sequ
-0001a170: 656e 6365 290a 0a20 2020 2020 2020 2020  ence)..         
-0001a180: 2020 2073 6176 6564 5f6e 6f64 6569 6473     saved_nodeids
-0001a190: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0001a1a0: 2020 7361 7665 645f 6c6f 676c 203d 205b    saved_logl = [
-0001a1b0: 5d0a 2020 2020 2020 2020 2020 2020 6974  ].            it
-0001a1c0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-0001a1d0: 206e 6361 6c6c 5f61 745f 7275 6e5f 7374   ncall_at_run_st
-0001a1e0: 6172 7420 3d20 7365 6c66 2e6e 6361 6c6c  art = self.ncall
-0001a1f0: 0a20 2020 2020 2020 2020 2020 206e 6361  .            nca
-0001a200: 6c6c 5f72 6567 696f 6e5f 6174 5f72 756e  ll_region_at_run
-0001a210: 5f73 7461 7274 203d 2073 656c 662e 6e63  _start = self.nc
-0001a220: 616c 6c5f 7265 6769 6f6e 0a20 2020 2020  all_region.     
-0001a230: 2020 2020 2020 206e 6578 745f 7570 6461         next_upda
-0001a240: 7465 5f69 6e74 6572 7661 6c5f 766f 6c75  te_interval_volu
-0001a250: 6d65 203d 2031 0a20 2020 2020 2020 2020  me = 1.         
-0001a260: 2020 206c 6173 745f 7374 6174 7573 203d     last_status =
-0001a270: 2074 696d 652e 7469 6d65 2829 0a0a 2020   time.time()..  
-0001a280: 2020 2020 2020 2020 2020 2320 7765 2067            # we g
-0001a290: 6f20 7468 726f 7567 6820 6561 6368 206c  o through each l
-0001a2a0: 6976 6520 706f 696e 7420 2872 6567 6172  ive point (regar
-0001a2b0: 646c 6573 7320 6f66 2072 6f6f 7429 2062  dless of root) b
-0001a2c0: 7920 6c69 6b65 6c69 686f 6f64 2076 616c  y likelihood val
-0001a2d0: 7565 0a20 2020 2020 2020 2020 2020 2077  ue.            w
-0001a2e0: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
-0001a2f0: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-0001a300: 6e6f 6465 203d 2065 7870 6c6f 7265 722e  node = explorer.
-0001a310: 6e65 7874 5f6e 6f64 6528 290a 2020 2020  next_node().    
-0001a320: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001a330: 6578 745f 6e6f 6465 2069 7320 4e6f 6e65  ext_node is None
-0001a340: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a350: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-0001a360: 2020 2020 2020 2020 2020 2020 726f 6f74              root
-0001a370: 6964 2c20 6e6f 6465 2c20 285f 2c20 6163  id, node, (_, ac
-0001a380: 7469 7665 5f72 6f6f 7469 6473 2c20 6163  tive_rootids, ac
-0001a390: 7469 7665 5f76 616c 7565 732c 2061 6374  tive_values, act
-0001a3a0: 6976 655f 6e6f 6465 5f69 6473 2920 3d20  ive_node_ids) = 
-0001a3b0: 6e65 7874 5f6e 6f64 650a 2020 2020 2020  next_node.      
-0001a3c0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-0001a3d0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0001a3e0: 726f 6f74 6964 2c20 666c 6f61 7429 0a20  rootid, float). 
-0001a3f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001a400: 2074 6869 7320 6973 2074 6865 206c 696b   this is the lik
-0001a410: 656c 6968 6f6f 6420 6c65 7665 6c20 7765  elihood level we
-0001a420: 2068 6176 6520 746f 2069 6d70 726f 7665   have to improve
-0001a430: 2075 706f 6e0a 2020 2020 2020 2020 2020   upon.          
-0001a440: 2020 2020 2020 7365 6c66 2e4c 6d69 6e20        self.Lmin 
-0001a450: 3d20 4c6d 696e 203d 206e 6f64 652e 7661  = Lmin = node.va
-0001a460: 6c75 650a 0a20 2020 2020 2020 2020 2020  lue..           
-0001a470: 2020 2020 2023 2069 6620 7769 7468 696e       # if within
-0001a480: 2073 7567 6765 7374 6564 2072 616e 6765   suggested range
-0001a490: 2c20 6578 7061 6e64 0a20 2020 2020 2020  , expand.       
-0001a4a0: 2020 2020 2020 2020 2069 6620 7374 7261           if stra
-0001a4b0: 7465 6779 5f73 7461 6c65 206f 7220 6e6f  tegy_stale or no
-0001a4c0: 7420 284c 6d69 6e20 3c3d 204c 6869 2920  t (Lmin <= Lhi) 
-0001a4d0: 6f72 206e 6f74 206e 702e 6973 6669 6e69  or not np.isfini
-0001a4e0: 7465 284c 6869 2920 6f72 2028 6163 7469  te(Lhi) or (acti
-0001a4f0: 7665 5f76 616c 7565 7320 3d3d 204c 6d69  ve_values == Lmi
-0001a500: 6e29 2e61 6c6c 2829 3a0a 2020 2020 2020  n).all():.      
-0001a510: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001a520: 6368 6563 6b20 7769 7468 2061 6476 6973  check with advis
-0001a530: 6f72 2069 6620 7765 2077 616e 7420 746f  or if we want to
-0001a540: 2065 7870 616e 6420 7468 6973 206e 6f64   expand this nod
-0001a550: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001a560: 2020 2020 2020 4c6c 6f2c 204c 6869 203d        Llo, Lhi =
-0001a570: 2073 656c 662e 5f61 6461 7074 6976 655f   self._adaptive_
-0001a580: 7374 7261 7465 6779 5f61 6476 6963 6528  strategy_advice(
-0001a590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a5a0: 2020 2020 2020 2020 204c 6d69 6e2c 2061           Lmin, a
-0001a5b0: 6374 6976 655f 7661 6c75 6573 2c20 6d61  ctive_values, ma
-0001a5c0: 696e 5f69 7465 7261 746f 722c 0a20 2020  in_iterator,.   
-0001a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5e0: 2020 2020 206d 696e 696d 616c 5f77 6964       minimal_wid
-0001a5f0: 7468 732c 2066 7261 635f 7265 6d61 696e  ths, frac_remain
-0001a600: 2c20 4c65 7073 696c 6f6e 3d4c 6570 7369  , Lepsilon=Lepsi
-0001a610: 6c6f 6e29 0a20 2020 2020 2020 2020 2020  lon).           
-0001a620: 2020 2020 2020 2020 2023 2077 6865 6e20           # when 
-0001a630: 7765 2061 7265 2067 6f69 6e67 2074 6f20  we are going to 
-0001a640: 7468 6520 7065 616b 2c20 6e75 6d65 7269  the peak, numeri
-0001a650: 6361 6c20 6163 6375 7261 6379 0a20 2020  cal accuracy.   
-0001a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a670: 2023 2063 616e 2062 6563 6f6d 6520 616e   # can become an
-0001a680: 2069 7373 7565 2e20 5765 2073 686f 756c   issue. We shoul
-0001a690: 6420 7472 7920 6e6f 7420 746f 2067 6574  d try not to get
-0001a6a0: 2073 7475 636b 2074 6865 7265 0a20 2020   stuck there.   
-0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6c0: 2073 7472 6174 6567 795f 7374 616c 6520   strategy_stale 
-0001a6d0: 3d20 4c68 6920 2d20 4c6c 6f20 3c20 6d61  = Lhi - Llo < ma
-0001a6e0: 7828 4c65 7073 696c 6f6e 2c20 302e 3031  x(Lepsilon, 0.01
-0001a6f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001a700: 2020 2065 7870 616e 645f 6e6f 6465 203d     expand_node =
-0001a710: 2073 656c 662e 5f73 686f 756c 645f 6e6f   self._should_no
-0001a720: 6465 5f62 655f 6578 7061 6e64 6564 280a  de_be_expanded(.
-0001a730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a740: 2020 2020 6974 2c20 4c6c 6f2c 204c 6869      it, Llo, Lhi
-0001a750: 2c20 6d69 6e69 6d61 6c5f 7769 6474 6873  , minimal_widths
-0001a760: 5f73 6571 7565 6e63 652c 0a20 2020 2020  _sequence,.     
-0001a770: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001a780: 6172 6765 745f 6d69 6e5f 6e75 6d5f 6368  arget_min_num_ch
-0001a790: 696c 6472 656e 2c20 6e6f 6465 2c20 6163  ildren, node, ac
-0001a7a0: 7469 7665 5f76 616c 7565 732c 0a20 2020  tive_values,.   
-0001a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7c0: 206d 6178 5f6e 6361 6c6c 732c 206d 6178   max_ncalls, max
-0001a7d0: 5f69 7465 7273 2c20 7365 6c66 2e6c 6976  _iters, self.liv
-0001a7e0: 655f 706f 696e 7473 5f68 6561 6c74 6879  e_points_healthy
-0001a7f0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001a800: 2020 2072 6567 696f 6e5f 6672 6573 6820     region_fresh 
-0001a810: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0001a820: 2020 2020 2020 2020 6966 2065 7870 616e          if expan
-0001a830: 645f 6e6f 6465 3a0a 2020 2020 2020 2020  d_node:.        
-0001a840: 2020 2020 2020 2020 2020 2020 2320 7361              # sa
-0001a850: 6d70 6c65 2061 206e 6577 2070 6f69 6e74  mple a new point
-0001a860: 2061 626f 7665 204c 6d69 6e0a 2020 2020   above Lmin.    
-0001a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a880: 6163 7469 7665 5f75 203d 2073 656c 662e  active_u = self.
-0001a890: 706f 696e 7470 696c 652e 6765 7475 2861  pointpile.getu(a
-0001a8a0: 6374 6976 655f 6e6f 6465 5f69 6473 290a  ctive_node_ids).
-0001a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8c0: 2020 2020 6163 7469 7665 5f70 203d 2073      active_p = s
-0001a8d0: 656c 662e 706f 696e 7470 696c 652e 6765  elf.pointpile.ge
-0001a8e0: 7470 2861 6374 6976 655f 6e6f 6465 5f69  tp(active_node_i
-0001a8f0: 6473 290a 2020 2020 2020 2020 2020 2020  ds).            
-0001a900: 2020 2020 2020 2020 6e6c 6976 6520 3d20          nlive = 
-0001a910: 6c65 6e28 6163 7469 7665 5f75 290a 2020  len(active_u).  
+00018b50: 5f77 696e 646f 773d 3130 3030 302c 0a20  _window=10000,. 
+00018b60: 2020 2020 2020 2020 2020 2069 6e73 6572             inser
+00018b70: 7469 6f6e 5f74 6573 745f 7a73 636f 7265  tion_test_zscore
+00018b80: 5f74 6872 6573 686f 6c64 3d32 2c0a 2020  _threshold=2,.  
+00018b90: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+00018ba0: 5f63 6c61 7373 3d4d 4c46 7269 656e 6473  _class=MLFriends
+00018bb0: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
+00018bc0: 6465 6e5f 6265 666f 7265 5f69 6e69 7469  den_before_initi
+00018bd0: 616c 5f70 6c61 7465 6175 5f6e 756d 5f77  al_plateau_num_w
+00018be0: 6172 6e3d 3130 3030 302c 0a20 2020 2020  arn=10000,.     
+00018bf0: 2020 2020 2020 2077 6964 656e 5f62 6566         widen_bef
+00018c00: 6f72 655f 696e 6974 6961 6c5f 706c 6174  ore_initial_plat
+00018c10: 6561 755f 6e75 6d5f 6d61 783d 3530 3030  eau_num_max=5000
+00018c20: 302c 0a20 2020 2029 3a0a 2020 2020 2020  0,.    ):.      
+00018c30: 2020 2222 2249 7465 7261 7465 2074 6f77    """Iterate tow
+00018c40: 6172 6473 2063 6f6e 7665 7267 656e 6365  ards convergence
+00018c50: 2e0a 0a20 2020 2020 2020 2055 7365 2061  ...        Use a
+00018c60: 7320 616e 2069 7465 7261 746f 7220 6c69  s an iterator li
+00018c70: 6b65 2073 6f3a 3a0a 0a20 2020 2020 2020  ke so::..       
+00018c80: 2020 2020 2066 6f72 2072 6573 756c 7420       for result 
+00018c90: 696e 2073 616d 706c 6572 2e72 756e 5f69  in sampler.run_i
+00018ca0: 7465 7228 2e2e 2e29 3a0a 2020 2020 2020  ter(...):.      
+00018cb0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00018cc0: 276c 6e5a 203d 2025 286c 6f67 7a29 2e32  'lnZ = %(logz).2
+00018cd0: 6620 2b2d 2025 286c 6f67 7a65 7272 292e  f +- %(logzerr).
+00018ce0: 3266 2720 2520 7265 7375 6c74 290a 0a20  2f' % result).. 
+00018cf0: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+00018d00: 7320 6173 2064 6573 6372 6962 6564 2069  s as described i
+00018d10: 6e20 7275 6e28 2920 6d65 7468 6f64 2e0a  n run() method..
+00018d20: 0a20 2020 2020 2020 2059 6965 6c64 730a  .        Yields.
+00018d30: 2020 2020 2020 2020 2d2d 2d2d 2d2d 0a20          ------. 
+00018d40: 2020 2020 2020 2072 6573 756c 7473 3a20         results: 
+00018d50: 6469 6374 0a20 2020 2020 2020 2022 2222  dict.        """
+00018d60: 0a20 2020 2020 2020 2023 2066 7261 635f  .        # frac_
+00018d70: 7265 6d61 696e 3d31 2020 6d65 616e 7320  remain=1  means 
+00018d80: 313a 3120 2d3e 2064 6c6f 677a 3d6c 6f67  1:1 -> dlogz=log
+00018d90: 2830 2e35 290a 2020 2020 2020 2020 2320  (0.5).        # 
+00018da0: 6672 6163 5f72 656d 6169 6e3d 302e 3120  frac_remain=0.1 
+00018db0: 6d65 616e 7320 313a 3130 202d 3e20 646c  means 1:10 -> dl
+00018dc0: 6f67 7a3d 6c6f 6728 302e 3129 0a20 2020  ogz=log(0.1).   
+00018dd0: 2020 2020 2023 2064 6c6f 677a 5f6d 696e       # dlogz_min
+00018de0: 203d 206c 6f67 2831 2e2f 2831 202b 2066   = log(1./(1 + f
+00018df0: 7261 635f 7265 6d61 696e 2929 0a20 2020  rac_remain)).   
+00018e00: 2020 2020 2023 2064 6c6f 677a 5f6d 696e       # dlogz_min
+00018e10: 203d 202d 6c6f 6731 7028 6672 6163 5f72   = -log1p(frac_r
+00018e20: 656d 6169 6e29 0a20 2020 2020 2020 2069  emain).        i
+00018e30: 6620 2d6e 702e 6c6f 6731 7028 6672 6163  f -np.log1p(frac
+00018e40: 5f72 656d 6169 6e29 203e 2064 6c6f 677a  _remain) > dlogz
+00018e50: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00018e60: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00018e70: 546f 2061 6368 6965 7665 2074 6865 2064  To achieve the d
+00018e80: 6573 6972 6564 206c 6f67 7a20 6163 6375  esired logz accu
+00018e90: 7261 6379 2c20 7365 7420 6672 6163 5f72  racy, set frac_r
+00018ea0: 656d 6169 6e20 746f 2061 2076 616c 7565  emain to a value
+00018eb0: 206d 7563 6820 736d 616c 6c65 7220 7468   much smaller th
+00018ec0: 616e 2025 7320 2863 7572 7265 6e74 6c79  an %s (currently
+00018ed0: 3a20 2573 2922 2025 2028 0a20 2020 2020  : %s)" % (.     
+00018ee0: 2020 2020 2020 2020 2020 2065 7870 282d             exp(-
+00018ef0: 646c 6f67 7a29 202d 2031 2c20 6672 6163  dlogz) - 1, frac
+00018f00: 5f72 656d 6169 6e29 290a 0a20 2020 2020  _remain))..     
+00018f10: 2020 2023 2074 6865 2065 7272 6f72 2069     # the error i
+00018f20: 7320 6170 7072 6f78 696d 6174 656c 7920  s approximately 
+00018f30: 646c 6f67 7a20 3d20 7371 7274 2869 7465  dlogz = sqrt(ite
+00018f40: 7261 7469 6f6e 7329 202f 204e 6c69 7665  rations) / Nlive
+00018f50: 0a20 2020 2020 2020 2023 2073 6f20 7765  .        # so we
+00018f60: 206e 6565 6420 6120 6d69 6e69 6d75 6d2c   need a minimum,
+00018f70: 2077 6869 6368 2064 6570 656e 6473 206f   which depends o
+00018f80: 6e20 7468 6520 6e75 6d62 6572 206f 6620  n the number of 
+00018f90: 6974 6572 6174 696f 6e73 0a20 2020 2020  iterations.     
+00018fa0: 2020 2023 2066 6577 6572 2074 6861 6e20     # fewer than 
+00018fb0: 3130 3030 2069 7465 7261 7469 6f6e 7320  1000 iterations 
+00018fc0: 6973 2071 7569 7465 2075 6e6c 696b 656c  is quite unlikel
+00018fd0: 790a 2020 2020 2020 2020 6966 206d 696e  y.        if min
+00018fe0: 5f6e 756d 5f6c 6976 655f 706f 696e 7473  _num_live_points
+00018ff0: 203c 2031 3030 302a 2a30 2e35 202f 2064   < 1000**0.5 / d
+00019000: 6c6f 677a 3a0a 2020 2020 2020 2020 2020  logz:.          
+00019010: 2020 6d69 6e5f 6e75 6d5f 6c69 7665 5f70    min_num_live_p
+00019020: 6f69 6e74 7320 3d20 696e 7428 6e70 2e63  oints = int(np.c
+00019030: 6569 6c28 3130 3030 2a2a 302e 3520 2f20  eil(1000**0.5 / 
+00019040: 646c 6f67 7a29 290a 2020 2020 2020 2020  dlogz)).        
+00019050: 2020 2020 6966 2073 656c 662e 6c6f 673a      if self.log:
+00019060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019070: 2073 656c 662e 6c6f 6767 6572 2e69 6e66   self.logger.inf
+00019080: 6f28 2254 6f20 6163 6869 6576 6520 7468  o("To achieve th
+00019090: 6520 6465 7369 7265 6420 6c6f 677a 2061  e desired logz a
+000190a0: 6363 7572 6163 792c 206d 696e 5f6e 756d  ccuracy, min_num
+000190b0: 5f6c 6976 655f 706f 696e 7473 2077 6173  _live_points was
+000190c0: 2069 6e63 7265 6173 6564 2074 6f20 2564   increased to %d
+000190d0: 2220 2520 280a 2020 2020 2020 2020 2020  " % (.          
+000190e0: 2020 2020 2020 2020 2020 6d69 6e5f 6e75            min_nu
+000190f0: 6d5f 6c69 7665 5f70 6f69 6e74 7329 290a  m_live_points)).
+00019100: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00019110: 2e6c 6f67 5f74 6f5f 706f 696e 7473 746f  .log_to_pointsto
+00019120: 7265 3a0a 2020 2020 2020 2020 2020 2020  re:.            
+00019130: 6966 206c 656e 2873 656c 662e 706f 696e  if len(self.poin
+00019140: 7473 746f 7265 2e73 7461 636b 2920 3e20  tstore.stack) > 
+00019150: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00019160: 2020 2073 656c 662e 6c6f 6767 6572 2e69     self.logger.i
+00019170: 6e66 6f28 2252 6573 756d 696e 6720 6672  nfo("Resuming fr
+00019180: 6f6d 2025 6420 7374 6f72 6564 2070 6f69  om %d stored poi
+00019190: 6e74 7322 2c20 6c65 6e28 7365 6c66 2e70  nts", len(self.p
+000191a0: 6f69 6e74 7374 6f72 652e 7374 6163 6b29  ointstore.stack)
+000191b0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000191c0: 6c66 2e75 7365 5f70 6f69 6e74 5f73 7461  lf.use_point_sta
+000191d0: 636b 203d 206e 6f74 2073 656c 662e 706f  ck = not self.po
+000191e0: 696e 7473 746f 7265 2e73 7461 636b 5f65  intstore.stack_e
+000191f0: 6d70 7479 0a20 2020 2020 2020 2065 6c73  mpty.        els
+00019200: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00019210: 656c 662e 7573 655f 706f 696e 745f 7374  elf.use_point_st
+00019220: 6163 6b20 3d20 4661 6c73 650a 0a20 2020  ack = False..   
+00019230: 2020 2020 2061 7373 6572 7420 6d69 6e5f       assert min_
+00019240: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7320  num_live_points 
+00019250: 3e3d 2063 6c75 7374 6572 5f6e 756d 5f6c  >= cluster_num_l
+00019260: 6976 655f 706f 696e 7473 2c20 5c0a 2020  ive_points, \.  
+00019270: 2020 2020 2020 2020 2020 2827 6d69 6e5f            ('min_
+00019280: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7328  num_live_points(
+00019290: 2564 2920 6361 6e6e 6f74 2062 6520 6c65  %d) cannot be le
+000192a0: 7373 2074 6861 6e20 636c 7573 7465 725f  ss than cluster_
+000192b0: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7328  num_live_points(
+000192c0: 2564 2927 2025 0a20 2020 2020 2020 2020  %d)' %.         
+000192d0: 2020 2020 2020 2028 6d69 6e5f 6e75 6d5f         (min_num_
+000192e0: 6c69 7665 5f70 6f69 6e74 732c 2063 6c75  live_points, clu
+000192f0: 7374 6572 5f6e 756d 5f6c 6976 655f 706f  ster_num_live_po
+00019300: 696e 7473 2929 0a20 2020 2020 2020 2073  ints)).        s
+00019310: 656c 662e 6d69 6e5f 6e75 6d5f 6c69 7665  elf.min_num_live
+00019320: 5f70 6f69 6e74 7320 3d20 6d69 6e5f 6e75  _points = min_nu
+00019330: 6d5f 6c69 7665 5f70 6f69 6e74 730a 2020  m_live_points.  
+00019340: 2020 2020 2020 7365 6c66 2e63 6c75 7374        self.clust
+00019350: 6572 5f6e 756d 5f6c 6976 655f 706f 696e  er_num_live_poin
+00019360: 7473 203d 2063 6c75 7374 6572 5f6e 756d  ts = cluster_num
+00019370: 5f6c 6976 655f 706f 696e 7473 0a20 2020  _live_points.   
+00019380: 2020 2020 2073 656c 662e 7361 6d70 6c69       self.sampli
+00019390: 6e67 5f73 6c6f 775f 7761 726e 6564 203d  ng_slow_warned =
+000193a0: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
+000193b0: 656c 662e 6275 696c 645f 7472 6567 696f  elf.build_tregio
+000193c0: 6e20 3d20 5472 7565 0a20 2020 2020 2020  n = True.       
+000193d0: 2073 656c 662e 7265 6769 6f6e 5f63 6c61   self.region_cla
+000193e0: 7373 203d 2072 6567 696f 6e5f 636c 6173  ss = region_clas
+000193f0: 730a 2020 2020 2020 2020 7570 6461 7465  s.        update
+00019400: 5f69 6e74 6572 7661 6c5f 766f 6c75 6d65  _interval_volume
+00019410: 5f6c 6f67 5f66 7261 6374 696f 6e20 3d20  _log_fraction = 
+00019420: 6c6f 6728 7570 6461 7465 5f69 6e74 6572  log(update_inter
+00019430: 7661 6c5f 766f 6c75 6d65 5f66 7261 6374  val_volume_fract
+00019440: 696f 6e29 0a0a 2020 2020 2020 2020 6966  ion)..        if
+00019450: 2076 697a 5f63 616c 6c62 6163 6b20 3d3d   viz_callback ==
+00019460: 2027 6175 746f 273a 0a20 2020 2020 2020   'auto':.       
+00019470: 2020 2020 2076 697a 5f63 616c 6c62 6163       viz_callbac
+00019480: 6b20 3d20 6765 745f 6465 6661 756c 745f  k = get_default_
+00019490: 7669 7a5f 6361 6c6c 6261 636b 2829 0a0a  viz_callback()..
+000194a0: 2020 2020 2020 2020 7365 6c66 2e5f 7769          self._wi
+000194b0: 6465 6e5f 726f 6f74 735f 6265 796f 6e64  den_roots_beyond
+000194c0: 5f69 6e69 7469 616c 5f70 6c61 7465 6175  _initial_plateau
+000194d0: 280a 2020 2020 2020 2020 2020 2020 6d69  (.            mi
+000194e0: 6e5f 6e75 6d5f 6c69 7665 5f70 6f69 6e74  n_num_live_point
+000194f0: 732c 0a20 2020 2020 2020 2020 2020 2077  s,.            w
+00019500: 6964 656e 5f62 6566 6f72 655f 696e 6974  iden_before_init
+00019510: 6961 6c5f 706c 6174 6561 755f 6e75 6d5f  ial_plateau_num_
+00019520: 7761 726e 2c20 7769 6465 6e5f 6265 666f  warn, widen_befo
+00019530: 7265 5f69 6e69 7469 616c 5f70 6c61 7465  re_initial_plate
+00019540: 6175 5f6e 756d 5f6d 6178 290a 0a20 2020  au_num_max)..   
+00019550: 2020 2020 204c 6c6f 2c20 4c68 6920 3d20       Llo, Lhi = 
+00019560: 2d6e 702e 696e 662c 206e 702e 696e 660a  -np.inf, np.inf.
+00019570: 2020 2020 2020 2020 4c6d 6178 203d 202d          Lmax = -
+00019580: 6e70 2e69 6e66 0a20 2020 2020 2020 2073  np.inf.        s
+00019590: 7472 6174 6567 795f 7374 616c 6520 3d20  trategy_stale = 
+000195a0: 5472 7565 0a20 2020 2020 2020 206d 696e  True.        min
+000195b0: 696d 616c 5f77 6964 7468 7320 3d20 5b5d  imal_widths = []
+000195c0: 0a20 2020 2020 2020 2074 6172 6765 745f  .        target_
+000195d0: 6d69 6e5f 6e75 6d5f 6368 696c 6472 656e  min_num_children
+000195e0: 203d 207b 7d0a 2020 2020 2020 2020 696d   = {}.        im
+000195f0: 7072 6f76 656d 656e 745f 6974 203d 2030  provement_it = 0
+00019600: 0a0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
+00019610: 206d 6178 5f69 7465 7273 2069 7320 4e6f   max_iters is No
+00019620: 6e65 206f 7220 6d61 785f 6974 6572 7320  ne or max_iters 
+00019630: 3e20 302c 2028 2249 6e76 616c 6964 2076  > 0, ("Invalid v
+00019640: 616c 7565 2066 6f72 206d 6178 5f69 7465  alue for max_ite
+00019650: 7273 3a20 2573 2e20 5365 7420 746f 204e  rs: %s. Set to N
+00019660: 6f6e 6520 6f72 2070 6f73 6974 6976 6520  one or positive 
+00019670: 6e75 6d62 6572 2220 2520 6d61 785f 6974  number" % max_it
+00019680: 6572 7329 0a20 2020 2020 2020 2061 7373  ers).        ass
+00019690: 6572 7420 6d61 785f 6e63 616c 6c73 2069  ert max_ncalls i
+000196a0: 7320 4e6f 6e65 206f 7220 6d61 785f 6e63  s None or max_nc
+000196b0: 616c 6c73 203e 2030 2c20 2822 496e 7661  alls > 0, ("Inva
+000196c0: 6c69 6420 7661 6c75 6520 666f 7220 6d61  lid value for ma
+000196d0: 785f 6e63 616c 6c73 3a20 2573 2e20 5365  x_ncalls: %s. Se
+000196e0: 7420 746f 204e 6f6e 6520 6f72 2070 6f73  t to None or pos
+000196f0: 6974 6976 6520 6e75 6d62 6572 2220 2520  itive number" % 
+00019700: 6d61 785f 6e63 616c 6c73 290a 0a20 2020  max_ncalls)..   
+00019710: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
+00019720: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00019730: 6c66 2e6c 6f67 6765 722e 6465 6275 6728  lf.logger.debug(
+00019740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019750: 2027 7275 6e5f 6974 6572 2064 6c6f 677a   'run_iter dlogz
+00019760: 3d25 2e31 662c 2064 4b4c 3d25 2e31 662c  =%.1f, dKL=%.1f,
+00019770: 2066 7261 635f 7265 6d61 696e 3d25 2e32   frac_remain=%.2
+00019780: 662c 204c 6570 7369 6c6f 6e3d 252e 3466  f, Lepsilon=%.4f
+00019790: 2c20 6d69 6e5f 6573 733d 2564 2720 2520  , min_ess=%d' % 
+000197a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000197b0: 2020 2020 2020 646c 6f67 7a2c 2064 4b4c        dlogz, dKL
+000197c0: 2c20 6672 6163 5f72 656d 6169 6e2c 204c  , frac_remain, L
+000197d0: 6570 7369 6c6f 6e2c 206d 696e 5f65 7373  epsilon, min_ess
+000197e0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+000197f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00019800: 2e6c 6f67 6765 722e 6465 6275 6728 0a20  .logger.debug(. 
+00019810: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00019820: 6d61 785f 6974 6572 733d 2564 2c20 6d61  max_iters=%d, ma
+00019830: 785f 6e63 616c 6c73 3d25 642c 206d 6178  x_ncalls=%d, max
+00019840: 5f6e 756d 5f69 6d70 726f 7665 6d65 6e74  _num_improvement
+00019850: 5f6c 6f6f 7073 3d25 642c 206d 696e 5f6e  _loops=%d, min_n
+00019860: 756d 5f6c 6976 655f 706f 696e 7473 3d25  um_live_points=%
+00019870: 642c 2063 6c75 7374 6572 5f6e 756d 5f6c  d, cluster_num_l
+00019880: 6976 655f 706f 696e 7473 3d25 6427 2025  ive_points=%d' %
+00019890: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+000198a0: 2020 2020 2020 206d 6178 5f69 7465 7273         max_iters
+000198b0: 2069 6620 6d61 785f 6974 6572 7320 656c   if max_iters el
+000198c0: 7365 202d 312c 206d 6178 5f6e 6361 6c6c  se -1, max_ncall
+000198d0: 7320 6966 206d 6178 5f6e 6361 6c6c 7320  s if max_ncalls 
+000198e0: 656c 7365 202d 312c 0a20 2020 2020 2020  else -1,.       
+000198f0: 2020 2020 2020 2020 2020 2020 206d 6178               max
+00019900: 5f6e 756d 5f69 6d70 726f 7665 6d65 6e74  _num_improvement
+00019910: 5f6c 6f6f 7073 2c20 6d69 6e5f 6e75 6d5f  _loops, min_num_
+00019920: 6c69 7665 5f70 6f69 6e74 732c 2063 6c75  live_points, clu
+00019930: 7374 6572 5f6e 756d 5f6c 6976 655f 706f  ster_num_live_po
+00019940: 696e 7473 290a 2020 2020 2020 2020 2020  ints).          
+00019950: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
+00019960: 662e 7265 7375 6c74 7320 3d20 4e6f 6e65  f.results = None
+00019970: 0a0a 2020 2020 2020 2020 7768 696c 6520  ..        while 
+00019980: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
+00019990: 2020 726f 6f74 7320 3d20 7365 6c66 2e72    roots = self.r
+000199a0: 6f6f 742e 6368 696c 6472 656e 0a0a 2020  oot.children..  
+000199b0: 2020 2020 2020 2020 2020 6e72 6f6f 7473            nroots
+000199c0: 203d 206c 656e 2872 6f6f 7473 290a 0a20   = len(roots).. 
+000199d0: 2020 2020 2020 2020 2020 2069 6620 7570             if up
+000199e0: 6461 7465 5f69 6e74 6572 7661 6c5f 6e63  date_interval_nc
+000199f0: 616c 6c20 6973 204e 6f6e 653a 0a20 2020  all is None:.   
+00019a00: 2020 2020 2020 2020 2020 2020 2075 7064               upd
+00019a10: 6174 655f 696e 7465 7276 616c 5f6e 6361  ate_interval_nca
+00019a20: 6c6c 203d 206e 726f 6f74 730a 0a20 2020  ll = nroots..   
+00019a30: 2020 2020 2020 2020 2069 6620 6c6f 675f           if log_
+00019a40: 696e 7465 7276 616c 2069 7320 4e6f 6e65  interval is None
+00019a50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019a60: 2020 6c6f 675f 696e 7465 7276 616c 203d    log_interval =
+00019a70: 206d 6178 2831 2c20 726f 756e 6428 302e   max(1, round(0.
+00019a80: 3120 2a20 6e72 6f6f 7473 2929 0a20 2020  1 * nroots)).   
+00019a90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00019aa0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00019ab0: 6f67 5f69 6e74 6572 7661 6c20 3d20 726f  og_interval = ro
+00019ac0: 756e 6428 6c6f 675f 696e 7465 7276 616c  und(log_interval
+00019ad0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019ae0: 2020 6966 206c 6f67 5f69 6e74 6572 7661    if log_interva
+00019af0: 6c20 3c20 313a 0a20 2020 2020 2020 2020  l < 1:.         
+00019b00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00019b10: 2056 616c 7565 4572 726f 7228 226c 6f67   ValueError("log
+00019b20: 5f69 6e74 6572 7661 6c20 6d75 7374 2062  _interval must b
+00019b30: 6520 3e3d 2031 2229 0a0a 2020 2020 2020  e >= 1")..      
+00019b40: 2020 2020 2020 6578 706c 6f72 6572 203d        explorer =
+00019b50: 2042 7265 6164 7468 4669 7273 7449 7465   BreadthFirstIte
+00019b60: 7261 746f 7228 726f 6f74 7329 0a20 2020  rator(roots).   
+00019b70: 2020 2020 2020 2020 2023 2049 6e74 6567           # Integ
+00019b80: 7261 7469 6e67 2074 6869 6e67 0a20 2020  rating thing.   
+00019b90: 2020 2020 2020 2020 206d 6169 6e5f 6974           main_it
+00019ba0: 6572 6174 6f72 203d 204d 756c 7469 436f  erator = MultiCo
+00019bb0: 756e 7465 7228 0a20 2020 2020 2020 2020  unter(.         
+00019bc0: 2020 2020 2020 206e 726f 6f74 733d 6c65         nroots=le
+00019bd0: 6e28 726f 6f74 7329 2c0a 2020 2020 2020  n(roots),.      
+00019be0: 2020 2020 2020 2020 2020 6e62 6f6f 7473            nboots
+00019bf0: 7472 6170 733d 6d61 7828 312c 2073 656c  traps=max(1, sel
+00019c00: 662e 6e75 6d5f 626f 6f74 7374 7261 7073  f.num_bootstraps
+00019c10: 202f 2f20 7365 6c66 2e6d 7069 5f73 697a   // self.mpi_siz
+00019c20: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+00019c30: 2020 2020 7261 6e64 6f6d 3d46 616c 7365      random=False
+00019c40: 2c20 6368 6563 6b5f 696e 7365 7274 696f  , check_insertio
+00019c50: 6e5f 6f72 6465 723d 4661 6c73 6529 0a20  n_order=False). 
+00019c60: 2020 2020 2020 2020 2020 206d 6169 6e5f             main_
+00019c70: 6974 6572 6174 6f72 2e4c 6d61 7820 3d20  iterator.Lmax = 
+00019c80: 6d61 7828 4c6d 6178 2c20 6d61 7828 6e2e  max(Lmax, max(n.
+00019c90: 7661 6c75 6520 666f 7220 6e20 696e 2072  value for n in r
+00019ca0: 6f6f 7473 2929 0a20 2020 2020 2020 2020  oots)).         
+00019cb0: 2020 2069 6e73 6572 7469 6f6e 5f74 6573     insertion_tes
+00019cc0: 7420 3d20 556e 6966 6f72 6d4f 7264 6572  t = UniformOrder
+00019cd0: 4163 6375 6d75 6c61 746f 7228 290a 2020  Accumulator().  
+00019ce0: 2020 2020 2020 2020 2020 696e 7365 7274            insert
+00019cf0: 696f 6e5f 7465 7374 5f72 756e 7320 3d20  ion_test_runs = 
+00019d00: 5b5d 0a20 2020 2020 2020 2020 2020 2069  [].            i
+00019d10: 6e73 6572 7469 6f6e 5f74 6573 745f 7175  nsertion_test_qu
+00019d20: 616c 6974 7920 3d20 6e70 2e69 6e66 0a20  ality = np.inf. 
+00019d30: 2020 2020 2020 2020 2020 2069 6e73 6572             inser
+00019d40: 7469 6f6e 5f74 6573 745f 6469 7265 6374  tion_test_direct
+00019d50: 696f 6e20 3d20 300a 0a20 2020 2020 2020  ion = 0..       
+00019d60: 2020 2020 2073 656c 662e 7472 616e 7366       self.transf
+00019d70: 6f72 6d4c 6179 6572 203d 204e 6f6e 650a  ormLayer = None.
+00019d80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00019d90: 2e72 6567 696f 6e20 3d20 4e6f 6e65 0a20  .region = None. 
+00019da0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00019db0: 7472 6567 696f 6e20 3d20 4e6f 6e65 0a20  tregion = None. 
+00019dc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00019dd0: 6c69 7665 5f70 6f69 6e74 735f 6865 616c  live_points_heal
+00019de0: 7468 7920 3d20 5472 7565 0a20 2020 2020  thy = True.     
+00019df0: 2020 2020 2020 2069 745f 6174 5f66 6972         it_at_fir
+00019e00: 7374 5f72 6567 696f 6e20 3d20 300a 2020  st_region = 0.  
+00019e10: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00019e20: 6220 3d20 300a 2020 2020 2020 2020 2020  b = 0.          
+00019e30: 2020 7365 6c66 2e73 616d 706c 6573 203d    self.samples =
+00019e40: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00019e50: 6966 2073 656c 662e 6472 6177 5f6d 756c  if self.draw_mul
+00019e60: 7469 706c 653a 0a20 2020 2020 2020 2020  tiple:.         
+00019e70: 2020 2020 2020 206e 6472 6177 203d 2073         ndraw = s
+00019e80: 656c 662e 6e64 7261 775f 6d69 6e0a 2020  elf.ndraw_min.  
+00019e90: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00019ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019eb0: 6e64 7261 7720 3d20 3430 0a20 2020 2020  ndraw = 40.     
+00019ec0: 2020 2020 2020 2073 656c 662e 706f 696e         self.poin
+00019ed0: 7473 746f 7265 2e72 6573 6574 2829 0a20  tstore.reset(). 
+00019ee0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00019ef0: 6c66 2e6c 6f67 5f74 6f5f 706f 696e 7473  lf.log_to_points
+00019f00: 746f 7265 3a0a 2020 2020 2020 2020 2020  tore:.          
+00019f10: 2020 2020 2020 7365 6c66 2e75 7365 5f70        self.use_p
+00019f20: 6f69 6e74 5f73 7461 636b 203d 206e 6f74  oint_stack = not
+00019f30: 2073 656c 662e 706f 696e 7473 746f 7265   self.pointstore
+00019f40: 2e73 7461 636b 5f65 6d70 7479 0a20 2020  .stack_empty.   
+00019f50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00019f60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00019f70: 656c 662e 7573 655f 706f 696e 745f 7374  elf.use_point_st
+00019f80: 6163 6b20 3d20 4661 6c73 650a 2020 2020  ack = False.    
+00019f90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00019fa0: 7573 655f 6d70 693a 0a20 2020 2020 2020  use_mpi:.       
+00019fb0: 2020 2020 2020 2020 2073 656c 662e 7573           self.us
+00019fc0: 655f 706f 696e 745f 7374 6163 6b20 3d20  e_point_stack = 
+00019fd0: 7365 6c66 2e63 6f6d 6d2e 6263 6173 7428  self.comm.bcast(
+00019fe0: 7365 6c66 2e75 7365 5f70 6f69 6e74 5f73  self.use_point_s
+00019ff0: 7461 636b 2c20 726f 6f74 3d30 290a 0a20  tack, root=0).. 
+0001a000: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0001a010: 6c66 2e6c 6f67 2061 6e64 2028 6e70 2e69  lf.log and (np.i
+0001a020: 7366 696e 6974 6528 4c6c 6f29 206f 7220  sfinite(Llo) or 
+0001a030: 6e70 2e69 7366 696e 6974 6528 4c68 6929  np.isfinite(Lhi)
+0001a040: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001a050: 2020 2073 656c 662e 6c6f 6767 6572 2e69     self.logger.i
+0001a060: 6e66 6f28 2245 7870 6c6f 7269 6e67 2028  nfo("Exploring (
+0001a070: 696e 2070 6172 7469 6375 6c61 723a 204c  in particular: L
+0001a080: 3d25 2e32 662e 2e25 2e32 6629 202e 2e2e  =%.2f..%.2f) ...
+0001a090: 222c 204c 6c6f 2c20 4c68 6929 0a20 2020  ", Llo, Lhi).   
+0001a0a0: 2020 2020 2020 2020 2072 6567 696f 6e5f           region_
+0001a0b0: 7365 7175 656e 6365 203d 205b 5d0a 2020  sequence = [].  
+0001a0c0: 2020 2020 2020 2020 2020 6d69 6e69 6d61            minima
+0001a0d0: 6c5f 7769 6474 6873 5f73 6571 7565 6e63  l_widths_sequenc
+0001a0e0: 6520 3d20 5f73 6571 7565 6e74 6961 6c69  e = _sequentiali
+0001a0f0: 7a65 5f77 6964 7468 5f73 6571 7565 6e63  ze_width_sequenc
+0001a100: 6528 6d69 6e69 6d61 6c5f 7769 6474 6873  e(minimal_widths
+0001a110: 2c20 7365 6c66 2e6d 696e 5f6e 756d 5f6c  , self.min_num_l
+0001a120: 6976 655f 706f 696e 7473 290a 2020 2020  ive_points).    
+0001a130: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001a140: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
+0001a150: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0001a160: 2e64 6562 7567 2827 6d69 6e69 6d61 6c5f  .debug('minimal_
+0001a170: 7769 6474 6873 5f73 6571 7565 6e63 653a  widths_sequence:
+0001a180: 2025 7327 2c20 6d69 6e69 6d61 6c5f 7769   %s', minimal_wi
+0001a190: 6474 6873 5f73 6571 7565 6e63 6529 0a0a  dths_sequence)..
+0001a1a0: 2020 2020 2020 2020 2020 2020 7361 7665              save
+0001a1b0: 645f 6e6f 6465 6964 7320 3d20 5b5d 0a20  d_nodeids = []. 
+0001a1c0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+0001a1d0: 5f6c 6f67 6c20 3d20 5b5d 0a20 2020 2020  _logl = [].     
+0001a1e0: 2020 2020 2020 2069 7420 3d20 300a 2020         it = 0.  
+0001a1f0: 2020 2020 2020 2020 2020 6e63 616c 6c5f            ncall_
+0001a200: 6174 5f72 756e 5f73 7461 7274 203d 2073  at_run_start = s
+0001a210: 656c 662e 6e63 616c 6c0a 2020 2020 2020  elf.ncall.      
+0001a220: 2020 2020 2020 6e63 616c 6c5f 7265 6769        ncall_regi
+0001a230: 6f6e 5f61 745f 7275 6e5f 7374 6172 7420  on_at_run_start 
+0001a240: 3d20 7365 6c66 2e6e 6361 6c6c 5f72 6567  = self.ncall_reg
+0001a250: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+0001a260: 6e65 7874 5f75 7064 6174 655f 696e 7465  next_update_inte
+0001a270: 7276 616c 5f76 6f6c 756d 6520 3d20 310a  rval_volume = 1.
+0001a280: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+0001a290: 5f73 7461 7475 7320 3d20 7469 6d65 2e74  _status = time.t
+0001a2a0: 696d 6528 290a 0a20 2020 2020 2020 2020  ime()..         
+0001a2b0: 2020 2023 2077 6520 676f 2074 6872 6f75     # we go throu
+0001a2c0: 6768 2065 6163 6820 6c69 7665 2070 6f69  gh each live poi
+0001a2d0: 6e74 2028 7265 6761 7264 6c65 7373 206f  nt (regardless o
+0001a2e0: 6620 726f 6f74 2920 6279 206c 696b 656c  f root) by likel
+0001a2f0: 6968 6f6f 6420 7661 6c75 650a 2020 2020  ihood value.    
+0001a300: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
+0001a310: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+0001a320: 2020 2020 6e65 7874 5f6e 6f64 6520 3d20      next_node = 
+0001a330: 6578 706c 6f72 6572 2e6e 6578 745f 6e6f  explorer.next_no
+0001a340: 6465 2829 0a20 2020 2020 2020 2020 2020  de().           
+0001a350: 2020 2020 2069 6620 6e65 7874 5f6e 6f64       if next_nod
+0001a360: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0001a370: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001a380: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
+0001a390: 2020 2020 2072 6f6f 7469 642c 206e 6f64       rootid, nod
+0001a3a0: 652c 2028 5f2c 2061 6374 6976 655f 726f  e, (_, active_ro
+0001a3b0: 6f74 6964 732c 2061 6374 6976 655f 7661  otids, active_va
+0001a3c0: 6c75 6573 2c20 6163 7469 7665 5f6e 6f64  lues, active_nod
+0001a3d0: 655f 6964 7329 203d 206e 6578 745f 6e6f  e_ids) = next_no
+0001a3e0: 6465 0a20 2020 2020 2020 2020 2020 2020  de.             
+0001a3f0: 2020 2061 7373 6572 7420 6e6f 7420 6973     assert not is
+0001a400: 696e 7374 616e 6365 2872 6f6f 7469 642c  instance(rootid,
+0001a410: 2066 6c6f 6174 290a 2020 2020 2020 2020   float).        
+0001a420: 2020 2020 2020 2020 2320 7468 6973 2069          # this i
+0001a430: 7320 7468 6520 6c69 6b65 6c69 686f 6f64  s the likelihood
+0001a440: 206c 6576 656c 2077 6520 6861 7665 2074   level we have t
+0001a450: 6f20 696d 7072 6f76 6520 7570 6f6e 0a20  o improve upon. 
+0001a460: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001a470: 656c 662e 4c6d 696e 203d 204c 6d69 6e20  elf.Lmin = Lmin 
+0001a480: 3d20 6e6f 6465 2e76 616c 7565 0a0a 2020  = node.value..  
+0001a490: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001a4a0: 6966 2077 6974 6869 6e20 7375 6767 6573  if within sugges
+0001a4b0: 7465 6420 7261 6e67 652c 2065 7870 616e  ted range, expan
+0001a4c0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0001a4d0: 2020 6966 2073 7472 6174 6567 795f 7374    if strategy_st
+0001a4e0: 616c 6520 6f72 206e 6f74 2028 4c6d 696e  ale or not (Lmin
+0001a4f0: 203c 3d20 4c68 6929 206f 7220 6e6f 7420   <= Lhi) or not 
+0001a500: 6e70 2e69 7366 696e 6974 6528 4c68 6929  np.isfinite(Lhi)
+0001a510: 206f 7220 2861 6374 6976 655f 7661 6c75   or (active_valu
+0001a520: 6573 203d 3d20 4c6d 696e 292e 616c 6c28  es == Lmin).all(
+0001a530: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001a540: 2020 2020 2020 2023 2063 6865 636b 2077         # check w
+0001a550: 6974 6820 6164 7669 736f 7220 6966 2077  ith advisor if w
+0001a560: 6520 7761 6e74 2074 6f20 6578 7061 6e64  e want to expand
+0001a570: 2074 6869 7320 6e6f 6465 0a20 2020 2020   this node.     
+0001a580: 2020 2020 2020 2020 2020 2020 2020 204c                 L
+0001a590: 6c6f 2c20 4c68 6920 3d20 7365 6c66 2e5f  lo, Lhi = self._
+0001a5a0: 6164 6170 7469 7665 5f73 7472 6174 6567  adaptive_strateg
+0001a5b0: 795f 6164 7669 6365 280a 2020 2020 2020  y_advice(.      
+0001a5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a5d0: 2020 4c6d 696e 2c20 6163 7469 7665 5f76    Lmin, active_v
+0001a5e0: 616c 7565 732c 206d 6169 6e5f 6974 6572  alues, main_iter
+0001a5f0: 6174 6f72 2c0a 2020 2020 2020 2020 2020  ator,.          
+0001a600: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+0001a610: 6e69 6d61 6c5f 7769 6474 6873 2c20 6672  nimal_widths, fr
+0001a620: 6163 5f72 656d 6169 6e2c 204c 6570 7369  ac_remain, Lepsi
+0001a630: 6c6f 6e3d 4c65 7073 696c 6f6e 290a 2020  lon=Lepsilon).  
+0001a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a650: 2020 2320 7768 656e 2077 6520 6172 6520    # when we are 
+0001a660: 676f 696e 6720 746f 2074 6865 2070 6561  going to the pea
+0001a670: 6b2c 206e 756d 6572 6963 616c 2061 6363  k, numerical acc
+0001a680: 7572 6163 790a 2020 2020 2020 2020 2020  uracy.          
+0001a690: 2020 2020 2020 2020 2020 2320 6361 6e20            # can 
+0001a6a0: 6265 636f 6d65 2061 6e20 6973 7375 652e  become an issue.
+0001a6b0: 2057 6520 7368 6f75 6c64 2074 7279 206e   We should try n
+0001a6c0: 6f74 2074 6f20 6765 7420 7374 7563 6b20  ot to get stuck 
+0001a6d0: 7468 6572 650a 2020 2020 2020 2020 2020  there.          
+0001a6e0: 2020 2020 2020 2020 2020 7374 7261 7465            strate
+0001a6f0: 6779 5f73 7461 6c65 203d 204c 6869 202d  gy_stale = Lhi -
+0001a700: 204c 6c6f 203c 206d 6178 284c 6570 7369   Llo < max(Lepsi
+0001a710: 6c6f 6e2c 2030 2e30 3129 0a0a 2020 2020  lon, 0.01)..    
+0001a720: 2020 2020 2020 2020 2020 2020 6578 7061              expa
+0001a730: 6e64 5f6e 6f64 6520 3d20 7365 6c66 2e5f  nd_node = self._
+0001a740: 7368 6f75 6c64 5f6e 6f64 655f 6265 5f65  should_node_be_e
+0001a750: 7870 616e 6465 6428 0a20 2020 2020 2020  xpanded(.       
+0001a760: 2020 2020 2020 2020 2020 2020 2069 742c               it,
+0001a770: 204c 6c6f 2c20 4c68 692c 206d 696e 696d   Llo, Lhi, minim
+0001a780: 616c 5f77 6964 7468 735f 7365 7175 656e  al_widths_sequen
+0001a790: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+0001a7a0: 2020 2020 2020 2020 7461 7267 6574 5f6d          target_m
+0001a7b0: 696e 5f6e 756d 5f63 6869 6c64 7265 6e2c  in_num_children,
+0001a7c0: 206e 6f64 652c 2061 6374 6976 655f 7661   node, active_va
+0001a7d0: 6c75 6573 2c0a 2020 2020 2020 2020 2020  lues,.          
+0001a7e0: 2020 2020 2020 2020 2020 6d61 785f 6e63            max_nc
+0001a7f0: 616c 6c73 2c20 6d61 785f 6974 6572 732c  alls, max_iters,
+0001a800: 2073 656c 662e 6c69 7665 5f70 6f69 6e74   self.live_point
+0001a810: 735f 6865 616c 7468 7929 0a0a 2020 2020  s_healthy)..    
+0001a820: 2020 2020 2020 2020 2020 2020 7265 6769              regi
+0001a830: 6f6e 5f66 7265 7368 203d 2046 616c 7365  on_fresh = False
+0001a840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a850: 2069 6620 6578 7061 6e64 5f6e 6f64 653a   if expand_node:
+0001a860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a870: 2020 2020 2023 2073 616d 706c 6520 6120       # sample a 
+0001a880: 6e65 7720 706f 696e 7420 6162 6f76 6520  new point above 
+0001a890: 4c6d 696e 0a20 2020 2020 2020 2020 2020  Lmin.           
+0001a8a0: 2020 2020 2020 2020 2061 6374 6976 655f           active_
+0001a8b0: 7520 3d20 7365 6c66 2e70 6f69 6e74 7069  u = self.pointpi
+0001a8c0: 6c65 2e67 6574 7528 6163 7469 7665 5f6e  le.getu(active_n
+0001a8d0: 6f64 655f 6964 7329 0a20 2020 2020 2020  ode_ids).       
+0001a8e0: 2020 2020 2020 2020 2020 2020 2061 6374               act
+0001a8f0: 6976 655f 7020 3d20 7365 6c66 2e70 6f69  ive_p = self.poi
+0001a900: 6e74 7069 6c65 2e67 6574 7028 6163 7469  ntpile.getp(acti
+0001a910: 7665 5f6e 6f64 655f 6964 7329 0a20 2020  ve_node_ids).   
 0001a920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a930: 2020 2320 6669 7273 7420 7765 2063 6865    # first we che
-0001a940: 636b 2074 6861 7420 7468 6520 7265 6769  ck that the regi
-0001a950: 6f6e 2069 7320 7570 2d74 6f2d 6461 7465  on is up-to-date
-0001a960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a970: 2020 2020 2069 6620 6d61 696e 5f69 7465       if main_ite
-0001a980: 7261 746f 722e 6c6f 6756 6f6c 7265 6d61  rator.logVolrema
-0001a990: 696e 696e 6720 3c20 6e65 7874 5f75 7064  ining < next_upd
-0001a9a0: 6174 655f 696e 7465 7276 616c 5f76 6f6c  ate_interval_vol
-0001a9b0: 756d 653a 0a20 2020 2020 2020 2020 2020  ume:.           
-0001a9c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001a9d0: 7365 6c66 2e72 6567 696f 6e20 6973 204e  self.region is N
-0001a9e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0001a9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa00: 2069 745f 6174 5f66 6972 7374 5f72 6567   it_at_first_reg
-0001aa10: 696f 6e20 3d20 6974 0a20 2020 2020 2020  ion = it.       
-0001aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa30: 2072 6567 696f 6e5f 6672 6573 6820 3d20   region_fresh = 
-0001aa40: 7365 6c66 2e5f 7570 6461 7465 5f72 6567  self._update_reg
-0001aa50: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0001aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa70: 2061 6374 6976 655f 753d 6163 7469 7665   active_u=active
-0001aa80: 5f75 2c20 6163 7469 7665 5f70 3d61 6374  _u, active_p=act
-0001aa90: 6976 655f 702c 2061 6374 6976 655f 6e6f  ive_p, active_no
-0001aaa0: 6465 5f69 6473 3d61 6374 6976 655f 6e6f  de_ids=active_no
-0001aab0: 6465 5f69 6473 2c0a 2020 2020 2020 2020  de_ids,.        
-0001aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aad0: 2020 2020 6163 7469 7665 5f72 6f6f 7469      active_rooti
-0001aae0: 6473 3d61 6374 6976 655f 726f 6f74 6964  ds=active_rootid
-0001aaf0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001ab00: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001ab10: 6f6f 7473 7472 6170 5f72 6f6f 7469 6473  ootstrap_rootids
-0001ab20: 3d6d 6169 6e5f 6974 6572 6174 6f72 2e72  =main_iterator.r
-0001ab30: 6f6f 7469 6473 5b31 3a2c 5d2c 0a20 2020  ootids[1:,],.   
-0001ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab50: 2020 2020 2020 2020 206e 626f 6f74 7374           nbootst
-0001ab60: 7261 7073 3d73 656c 662e 6e75 6d5f 626f  raps=self.num_bo
-0001ab70: 6f74 7374 7261 7073 2c0a 2020 2020 2020  otstraps,.      
-0001ab80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab90: 2020 2020 2020 6d69 6e76 6f6c 3d65 7870        minvol=exp
-0001aba0: 286d 6169 6e5f 6974 6572 6174 6f72 2e6c  (main_iterator.l
-0001abb0: 6f67 566f 6c72 656d 6169 6e69 6e67 2929  ogVolremaining))
-0001abc0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001abd0: 2020 2020 2020 2020 2020 6966 2072 6567            if reg
-0001abe0: 696f 6e5f 6672 6573 6820 616e 6420 7365  ion_fresh and se
-0001abf0: 6c66 2e73 7465 7073 616d 706c 6572 2069  lf.stepsampler i
-0001ac00: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0001ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac20: 2020 2020 2020 2020 7365 6c66 2e73 7465          self.ste
-0001ac30: 7073 616d 706c 6572 2e72 6567 696f 6e5f  psampler.region_
-0001ac40: 6368 616e 6765 6428 6163 7469 7665 5f76  changed(active_v
-0001ac50: 616c 7565 732c 2073 656c 662e 7265 6769  alues, self.regi
-0001ac60: 6f6e 290a 0a20 2020 2020 2020 2020 2020  on)..           
-0001ac70: 2020 2020 2020 2020 2020 2020 205f 2c20               _, 
-0001ac80: 636c 7573 7465 725f 7369 7a65 7320 3d20  cluster_sizes = 
-0001ac90: 6e70 2e75 6e69 7175 6528 7365 6c66 2e72  np.unique(self.r
-0001aca0: 6567 696f 6e2e 7472 616e 7366 6f72 6d4c  egion.transformL
-0001acb0: 6179 6572 2e63 6c75 7374 6572 6964 732c  ayer.clusterids,
-0001acc0: 2072 6574 7572 6e5f 636f 756e 7473 3d54   return_counts=T
-0001acd0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0001ace0: 2020 2020 2020 2020 2020 2020 206e 636c               ncl
-0001acf0: 7573 7465 7273 203d 2028 636c 7573 7465  usters = (cluste
-0001ad00: 725f 7369 7a65 7320 3e20 3129 2e73 756d  r_sizes > 1).sum
-0001ad10: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-0001ad20: 2020 2020 2020 2020 2020 2072 6567 696f             regio
-0001ad30: 6e5f 7365 7175 656e 6365 2e61 7070 656e  n_sequence.appen
-0001ad40: 6428 284c 6d69 6e2c 206e 6c69 7665 2c20  d((Lmin, nlive, 
-0001ad50: 6e63 6c75 7374 6572 732c 206e 702e 6d61  nclusters, np.ma
-0001ad60: 7828 6163 7469 7665 5f76 616c 7565 7329  x(active_values)
-0001ad70: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-0001ad80: 2020 2020 2020 2020 2020 2020 2320 6e65              # ne
-0001ad90: 7874 5f75 7064 6174 655f 696e 7465 7276  xt_update_interv
-0001ada0: 616c 5f6e 6361 6c6c 203d 2073 656c 662e  al_ncall = self.
-0001adb0: 6e63 616c 6c20 2b20 2875 7064 6174 655f  ncall + (update_
-0001adc0: 696e 7465 7276 616c 5f6e 6361 6c6c 206f  interval_ncall o
-0001add0: 7220 6e6c 6976 6529 0a20 2020 2020 2020  r nlive).       
-0001ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001adf0: 206e 6578 745f 7570 6461 7465 5f69 6e74   next_update_int
-0001ae00: 6572 7661 6c5f 766f 6c75 6d65 203d 206d  erval_volume = m
-0001ae10: 6169 6e5f 6974 6572 6174 6f72 2e6c 6f67  ain_iterator.log
-0001ae20: 566f 6c72 656d 6169 6e69 6e67 202b 2075  Volremaining + u
-0001ae30: 7064 6174 655f 696e 7465 7276 616c 5f76  pdate_interval_v
-0001ae40: 6f6c 756d 655f 6c6f 675f 6672 6163 7469  olume_log_fracti
-0001ae50: 6f6e 0a0a 2020 2020 2020 2020 2020 2020  on..            
-0001ae60: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-0001ae70: 6f76 6964 6520 6e69 6365 206f 7574 7075  ovide nice outpu
-0001ae80: 7420 746f 2066 6f6c 6c6f 7720 7768 6174  t to follow what
-0001ae90: 2069 7320 676f 696e 6720 6f6e 0a20 2020   is going on.   
-0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aeb0: 2020 2020 2023 2062 7574 2073 6b69 7020       # but skip 
-0001aec0: 6966 2077 6520 6172 6520 7265 7375 6d69  if we are resumi
-0001aed0: 6e67 0a20 2020 2020 2020 2020 2020 2020  ng.             
-0001aee0: 2020 2020 2020 2020 2020 2023 2020 616e             #  an
-0001aef0: 6420 2873 656c 662e 6e63 616c 6c20 213d  d (self.ncall !=
-0001af00: 206e 6361 6c6c 5f61 745f 7275 6e5f 7374   ncall_at_run_st
-0001af10: 6172 7420 616e 6420 6974 5f61 745f 6669  art and it_at_fi
-0001af20: 7273 745f 7265 6769 6f6e 203d 3d20 6974  rst_region == it
-0001af30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001af40: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0001af50: 662e 6c6f 6720 616e 6420 7669 7a5f 6361  f.log and viz_ca
-0001af60: 6c6c 6261 636b 3a0a 2020 2020 2020 2020  llback:.        
-0001af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af80: 2020 2020 7669 7a5f 6361 6c6c 6261 636b      viz_callback
-0001af90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afb0: 2020 706f 696e 7473 3d64 6963 7428 753d    points=dict(u=
-0001afc0: 6163 7469 7665 5f75 2c20 703d 6163 7469  active_u, p=acti
-0001afd0: 7665 5f70 2c20 6c6f 676c 3d61 6374 6976  ve_p, logl=activ
-0001afe0: 655f 7661 6c75 6573 292c 0a20 2020 2020  e_values),.     
-0001aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b000: 2020 2020 2020 2020 2020 2069 6e66 6f3d             info=
-0001b010: 6469 6374 280a 2020 2020 2020 2020 2020  dict(.          
+0001a930: 206e 6c69 7665 203d 206c 656e 2861 6374   nlive = len(act
+0001a940: 6976 655f 7529 0a20 2020 2020 2020 2020  ive_u).         
+0001a950: 2020 2020 2020 2020 2020 2023 2066 6972             # fir
+0001a960: 7374 2077 6520 6368 6563 6b20 7468 6174  st we check that
+0001a970: 2074 6865 2072 6567 696f 6e20 6973 2075   the region is u
+0001a980: 702d 746f 2d64 6174 650a 2020 2020 2020  p-to-date.      
+0001a990: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001a9a0: 206d 6169 6e5f 6974 6572 6174 6f72 2e6c   main_iterator.l
+0001a9b0: 6f67 566f 6c72 656d 6169 6e69 6e67 203c  ogVolremaining <
+0001a9c0: 206e 6578 745f 7570 6461 7465 5f69 6e74   next_update_int
+0001a9d0: 6572 7661 6c5f 766f 6c75 6d65 3a0a 2020  erval_volume:.  
+0001a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9f0: 2020 2020 2020 6966 2073 656c 662e 7265        if self.re
+0001aa00: 6769 6f6e 2069 7320 4e6f 6e65 3a0a 2020  gion is None:.  
+0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa20: 2020 2020 2020 2020 2020 6974 5f61 745f            it_at_
+0001aa30: 6669 7273 745f 7265 6769 6f6e 203d 2069  first_region = i
+0001aa40: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001aa50: 2020 2020 2020 2020 2020 7265 6769 6f6e            region
+0001aa60: 5f66 7265 7368 203d 2073 656c 662e 5f75  _fresh = self._u
+0001aa70: 7064 6174 655f 7265 6769 6f6e 280a 2020  pdate_region(.  
+0001aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa90: 2020 2020 2020 2020 2020 6163 7469 7665            active
+0001aaa0: 5f75 3d61 6374 6976 655f 752c 2061 6374  _u=active_u, act
+0001aab0: 6976 655f 703d 6163 7469 7665 5f70 2c20  ive_p=active_p, 
+0001aac0: 6163 7469 7665 5f6e 6f64 655f 6964 733d  active_node_ids=
+0001aad0: 6163 7469 7665 5f6e 6f64 655f 6964 732c  active_node_ids,
+0001aae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aaf0: 2020 2020 2020 2020 2020 2020 2061 6374               act
+0001ab00: 6976 655f 726f 6f74 6964 733d 6163 7469  ive_rootids=acti
+0001ab10: 7665 5f72 6f6f 7469 6473 2c0a 2020 2020  ve_rootids,.    
+0001ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab30: 2020 2020 2020 2020 626f 6f74 7374 7261          bootstra
+0001ab40: 705f 726f 6f74 6964 733d 6d61 696e 5f69  p_rootids=main_i
+0001ab50: 7465 7261 746f 722e 726f 6f74 6964 735b  terator.rootids[
+0001ab60: 313a 2c5d 2c0a 2020 2020 2020 2020 2020  1:,],.          
+0001ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab80: 2020 6e62 6f6f 7473 7472 6170 733d 7365    nbootstraps=se
+0001ab90: 6c66 2e6e 756d 5f62 6f6f 7473 7472 6170  lf.num_bootstrap
+0001aba0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0001abb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001abc0: 696e 766f 6c3d 6578 7028 6d61 696e 5f69  invol=exp(main_i
+0001abd0: 7465 7261 746f 722e 6c6f 6756 6f6c 7265  terator.logVolre
+0001abe0: 6d61 696e 696e 6729 290a 0a20 2020 2020  maining))..     
+0001abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac00: 2020 2069 6620 7265 6769 6f6e 5f66 7265     if region_fre
+0001ac10: 7368 2061 6e64 2073 656c 662e 7374 6570  sh and self.step
+0001ac20: 7361 6d70 6c65 7220 6973 206e 6f74 204e  sampler is not N
+0001ac30: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001ac40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac50: 2073 656c 662e 7374 6570 7361 6d70 6c65   self.stepsample
+0001ac60: 722e 7265 6769 6f6e 5f63 6861 6e67 6564  r.region_changed
+0001ac70: 2861 6374 6976 655f 7661 6c75 6573 2c20  (active_values, 
+0001ac80: 7365 6c66 2e72 6567 696f 6e29 0a0a 2020  self.region)..  
+0001ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aca0: 2020 2020 2020 5f2c 2063 6c75 7374 6572        _, cluster
+0001acb0: 5f73 697a 6573 203d 206e 702e 756e 6971  _sizes = np.uniq
+0001acc0: 7565 2873 656c 662e 7265 6769 6f6e 2e74  ue(self.region.t
+0001acd0: 7261 6e73 666f 726d 4c61 7965 722e 636c  ransformLayer.cl
+0001ace0: 7573 7465 7269 6473 2c20 7265 7475 726e  usterids, return
+0001acf0: 5f63 6f75 6e74 733d 5472 7565 290a 2020  _counts=True).  
+0001ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad10: 2020 2020 2020 6e63 6c75 7374 6572 7320        nclusters 
+0001ad20: 3d20 2863 6c75 7374 6572 5f73 697a 6573  = (cluster_sizes
+0001ad30: 203e 2031 292e 7375 6d28 290a 2020 2020   > 1).sum().    
+0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad50: 2020 2020 7265 6769 6f6e 5f73 6571 7565      region_seque
+0001ad60: 6e63 652e 6170 7065 6e64 2828 4c6d 696e  nce.append((Lmin
+0001ad70: 2c20 6e6c 6976 652c 206e 636c 7573 7465  , nlive, ncluste
+0001ad80: 7273 2c20 6e70 2e6d 6178 2861 6374 6976  rs, np.max(activ
+0001ad90: 655f 7661 6c75 6573 2929 290a 0a20 2020  e_values)))..   
+0001ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001adb0: 2020 2020 2023 206e 6578 745f 7570 6461       # next_upda
+0001adc0: 7465 5f69 6e74 6572 7661 6c5f 6e63 616c  te_interval_ncal
+0001add0: 6c20 3d20 7365 6c66 2e6e 6361 6c6c 202b  l = self.ncall +
+0001ade0: 2028 7570 6461 7465 5f69 6e74 6572 7661   (update_interva
+0001adf0: 6c5f 6e63 616c 6c20 6f72 206e 6c69 7665  l_ncall or nlive
+0001ae00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ae10: 2020 2020 2020 2020 2020 6e65 7874 5f75            next_u
+0001ae20: 7064 6174 655f 696e 7465 7276 616c 5f76  pdate_interval_v
+0001ae30: 6f6c 756d 6520 3d20 6d61 696e 5f69 7465  olume = main_ite
+0001ae40: 7261 746f 722e 6c6f 6756 6f6c 7265 6d61  rator.logVolrema
+0001ae50: 696e 696e 6720 2b20 7570 6461 7465 5f69  ining + update_i
+0001ae60: 6e74 6572 7661 6c5f 766f 6c75 6d65 5f6c  nterval_volume_l
+0001ae70: 6f67 5f66 7261 6374 696f 6e0a 0a20 2020  og_fraction..   
+0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae90: 2020 2020 2023 2070 726f 7669 6465 206e       # provide n
+0001aea0: 6963 6520 6f75 7470 7574 2074 6f20 666f  ice output to fo
+0001aeb0: 6c6c 6f77 2077 6861 7420 6973 2067 6f69  llow what is goi
+0001aec0: 6e67 206f 6e0a 2020 2020 2020 2020 2020  ng on.          
+0001aed0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001aee0: 6275 7420 736b 6970 2069 6620 7765 2061  but skip if we a
+0001aef0: 7265 2072 6573 756d 696e 670a 2020 2020  re resuming.    
+0001af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af10: 2020 2020 2320 2061 6e64 2028 7365 6c66      #  and (self
+0001af20: 2e6e 6361 6c6c 2021 3d20 6e63 616c 6c5f  .ncall != ncall_
+0001af30: 6174 5f72 756e 5f73 7461 7274 2061 6e64  at_run_start and
+0001af40: 2069 745f 6174 5f66 6972 7374 5f72 6567   it_at_first_reg
+0001af50: 696f 6e20 3d3d 2069 7429 0a20 2020 2020  ion == it).     
+0001af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af70: 2020 2069 6620 7365 6c66 2e6c 6f67 2061     if self.log a
+0001af80: 6e64 2076 697a 5f63 616c 6c62 6163 6b3a  nd viz_callback:
+0001af90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001afa0: 2020 2020 2020 2020 2020 2020 2076 697a               viz
+0001afb0: 5f63 616c 6c62 6163 6b28 0a20 2020 2020  _callback(.     
+0001afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afd0: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+0001afe0: 733d 6469 6374 2875 3d61 6374 6976 655f  s=dict(u=active_
+0001aff0: 752c 2070 3d61 6374 6976 655f 702c 206c  u, p=active_p, l
+0001b000: 6f67 6c3d 6163 7469 7665 5f76 616c 7565  ogl=active_value
+0001b010: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
 0001b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b030: 2020 2020 2020 2020 2020 6974 3d69 742c            it=it,
-0001b040: 206e 6361 6c6c 3d73 656c 662e 6e63 616c   ncall=self.ncal
-0001b050: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
-0001b060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b070: 2020 2020 2020 206c 6f67 7a3d 6d61 696e         logz=main
-0001b080: 5f69 7465 7261 746f 722e 6c6f 675a 2c0a  _iterator.logZ,.
+0001b030: 2020 2020 696e 666f 3d64 6963 7428 0a20      info=dict(. 
+0001b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b060: 2020 2069 743d 6974 2c20 6e63 616c 6c3d     it=it, ncall=
+0001b070: 7365 6c66 2e6e 6361 6c6c 2c0a 2020 2020  self.ncall,.    
+0001b080: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0b0: 2020 2020 6c6f 677a 5f72 656d 6169 6e3d      logz_remain=
-0001b0c0: 6d61 696e 5f69 7465 7261 746f 722e 6c6f  main_iterator.lo
-0001b0d0: 675a 7265 6d61 696e 2c0a 2020 2020 2020  gZremain,.      
-0001b0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0f0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001b100: 6776 6f6c 3d6d 6169 6e5f 6974 6572 6174  gvol=main_iterat
-0001b110: 6f72 2e6c 6f67 566f 6c72 656d 6169 6e69  or.logVolremaini
-0001b120: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b140: 2020 2020 2020 2020 7061 7261 6d6e 616d          paramnam
-0001b150: 6573 3d73 656c 662e 7061 7261 6d6e 616d  es=self.paramnam
-0001b160: 6573 202b 2073 656c 662e 6465 7269 7665  es + self.derive
-0001b170: 6470 6172 616d 6e61 6d65 732c 0a20 2020  dparamnames,.   
-0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1a0: 2070 6172 616d 6c69 6d73 3d73 656c 662e   paramlims=self.
-0001b1b0: 7472 616e 7366 6f72 6d5f 6c69 6d69 7473  transform_limits
-0001b1c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1e0: 2020 2020 2020 6f72 6465 725f 7465 7374        order_test
-0001b1f0: 5f63 6f72 7265 6c61 7469 6f6e 3d69 6e73  _correlation=ins
-0001b200: 6572 7469 6f6e 5f74 6573 745f 7175 616c  ertion_test_qual
-0001b210: 6974 792c 0a20 2020 2020 2020 2020 2020  ity,.           
-0001b220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b230: 2020 2020 2020 2020 206f 7264 6572 5f74           order_t
-0001b240: 6573 745f 6469 7265 6374 696f 6e3d 696e  est_direction=in
-0001b250: 7365 7274 696f 6e5f 7465 7374 5f64 6972  sertion_test_dir
-0001b260: 6563 7469 6f6e 2c0a 2020 2020 2020 2020  ection,.        
-0001b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b280: 2020 2020 2020 2020 2020 2020 7374 6570              step
-0001b290: 7361 6d70 6c65 725f 696e 666f 3d73 656c  sampler_info=sel
-0001b2a0: 662e 7374 6570 7361 6d70 6c65 722e 6765  f.stepsampler.ge
-0001b2b0: 745f 696e 666f 5f64 6963 7428 2920 6966  t_info_dict() if
-0001b2c0: 2068 6173 6174 7472 2873 656c 662e 7374   hasattr(self.st
-0001b2d0: 6570 7361 6d70 6c65 722c 2027 6765 745f  epsampler, 'get_
-0001b2e0: 696e 666f 5f64 6963 7427 2920 656c 7365  info_dict') else
-0001b2f0: 207b 7d0a 2020 2020 2020 2020 2020 2020   {}.            
-0001b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b310: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0001b0a0: 6c6f 677a 3d6d 6169 6e5f 6974 6572 6174  logz=main_iterat
+0001b0b0: 6f72 2e6c 6f67 5a2c 0a20 2020 2020 2020  or.logZ,.       
+0001b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0d0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+0001b0e0: 7a5f 7265 6d61 696e 3d6d 6169 6e5f 6974  z_remain=main_it
+0001b0f0: 6572 6174 6f72 2e6c 6f67 5a72 656d 6169  erator.logZremai
+0001b100: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0001b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b120: 2020 2020 2020 206c 6f67 766f 6c3d 6d61         logvol=ma
+0001b130: 696e 5f69 7465 7261 746f 722e 6c6f 6756  in_iterator.logV
+0001b140: 6f6c 7265 6d61 696e 696e 672c 0a20 2020  olremaining,.   
+0001b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b170: 2070 6172 616d 6e61 6d65 733d 7365 6c66   paramnames=self
+0001b180: 2e70 6172 616d 6e61 6d65 7320 2b20 7365  .paramnames + se
+0001b190: 6c66 2e64 6572 6976 6564 7061 7261 6d6e  lf.derivedparamn
+0001b1a0: 616d 6573 2c0a 2020 2020 2020 2020 2020  ames,.          
+0001b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1c0: 2020 2020 2020 2020 2020 7061 7261 6d6c            paraml
+0001b1d0: 696d 733d 7365 6c66 2e74 7261 6e73 666f  ims=self.transfo
+0001b1e0: 726d 5f6c 696d 6974 732c 0a20 2020 2020  rm_limits,.     
+0001b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b200: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0001b210: 7264 6572 5f74 6573 745f 636f 7272 656c  rder_test_correl
+0001b220: 6174 696f 6e3d 696e 7365 7274 696f 6e5f  ation=insertion_
+0001b230: 7465 7374 5f71 7561 6c69 7479 2c0a 2020  test_quality,.  
+0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b260: 2020 6f72 6465 725f 7465 7374 5f64 6972    order_test_dir
+0001b270: 6563 7469 6f6e 3d69 6e73 6572 7469 6f6e  ection=insertion
+0001b280: 5f74 6573 745f 6469 7265 6374 696f 6e2c  _test_direction,
+0001b290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2b0: 2020 2020 2073 7465 7073 616d 706c 6572       stepsampler
+0001b2c0: 5f69 6e66 6f3d 7365 6c66 2e73 7465 7073  _info=self.steps
+0001b2d0: 616d 706c 6572 2e67 6574 5f69 6e66 6f5f  ampler.get_info_
+0001b2e0: 6469 6374 2829 2069 6620 6861 7361 7474  dict() if hasatt
+0001b2f0: 7228 7365 6c66 2e73 7465 7073 616d 706c  r(self.stepsampl
+0001b300: 6572 2c20 2767 6574 5f69 6e66 6f5f 6469  er, 'get_info_di
+0001b310: 6374 2729 2065 6c73 6520 7b7d 0a20 2020  ct') else {}.   
 0001b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b330: 2020 2020 2020 2072 6567 696f 6e3d 7365         region=se
-0001b340: 6c66 2e72 6567 696f 6e2c 2074 7261 6e73  lf.region, trans
-0001b350: 666f 726d 4c61 7965 723d 7365 6c66 2e74  formLayer=self.t
-0001b360: 7261 6e73 666f 726d 4c61 7965 722c 0a20  ransformLayer,. 
-0001b370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b380: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001b390: 6567 696f 6e5f 6672 6573 683d 7265 6769  egion_fresh=regi
-0001b3a0: 6f6e 5f66 7265 7368 2c0a 2020 2020 2020  on_fresh,.      
-0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001b3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3e0: 6966 2073 656c 662e 6c6f 673a 0a20 2020  if self.log:.   
-0001b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b400: 2020 2020 2020 2020 2073 656c 662e 706f           self.po
-0001b410: 696e 7473 746f 7265 2e66 6c75 7368 2829  intstore.flush()
-0001b420: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b430: 2020 2020 2020 6966 206e 6c69 7665 203c        if nlive <
-0001b440: 2063 6c75 7374 6572 5f6e 756d 5f6c 6976   cluster_num_liv
-0001b450: 655f 706f 696e 7473 202a 206e 636c 7573  e_points * nclus
-0001b460: 7465 7273 2061 6e64 2069 6d70 726f 7665  ters and improve
-0001b470: 6d65 6e74 5f69 7420 3c20 6d61 785f 6e75  ment_it < max_nu
-0001b480: 6d5f 696d 7072 6f76 656d 656e 745f 6c6f  m_improvement_lo
-0001b490: 6f70 733a 0a20 2020 2020 2020 2020 2020  ops:.           
-0001b4a0: 2020 2020 2020 2020 2020 2020 2023 206d               # m
-0001b4b0: 616b 6520 7769 6465 7220 6865 7265 0a20  ake wider here. 
+0001b330: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
+0001b340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b360: 7265 6769 6f6e 3d73 656c 662e 7265 6769  region=self.regi
+0001b370: 6f6e 2c20 7472 616e 7366 6f72 6d4c 6179  on, transformLay
+0001b380: 6572 3d73 656c 662e 7472 616e 7366 6f72  er=self.transfor
+0001b390: 6d4c 6179 6572 2c0a 2020 2020 2020 2020  mLayer,.        
+0001b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3b0: 2020 2020 2020 2020 7265 6769 6f6e 5f66          region_f
+0001b3c0: 7265 7368 3d72 6567 696f 6e5f 6672 6573  resh=region_fres
+0001b3d0: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+0001b3e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0001b3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b400: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0001b410: 2e6c 6f67 3a0a 2020 2020 2020 2020 2020  .log:.          
+0001b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b430: 2020 7365 6c66 2e70 6f69 6e74 7374 6f72    self.pointstor
+0001b440: 652e 666c 7573 6828 290a 0a20 2020 2020  e.flush()..     
+0001b450: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b460: 6620 6e6c 6976 6520 3c20 636c 7573 7465  f nlive < cluste
+0001b470: 725f 6e75 6d5f 6c69 7665 5f70 6f69 6e74  r_num_live_point
+0001b480: 7320 2a20 6e63 6c75 7374 6572 7320 616e  s * nclusters an
+0001b490: 6420 696d 7072 6f76 656d 656e 745f 6974  d improvement_it
+0001b4a0: 203c 206d 6178 5f6e 756d 5f69 6d70 726f   < max_num_impro
+0001b4b0: 7665 6d65 6e74 5f6c 6f6f 7073 3a0a 2020  vement_loops:.  
 0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4d0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-0001b4e0: 6f67 3a0a 2020 2020 2020 2020 2020 2020  og:.            
+0001b4d0: 2020 2020 2020 2320 6d61 6b65 2077 6964        # make wid
+0001b4e0: 6572 2068 6572 650a 2020 2020 2020 2020  er here.        
 0001b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b500: 7365 6c66 2e6c 6f67 6765 722e 696e 666f  self.logger.info
-0001b510: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b530: 2020 2246 6f75 6e64 2025 6420 636c 7573    "Found %d clus
-0001b540: 7465 7273 2c20 6275 7420 6f6e 6c79 2068  ters, but only h
-0001b550: 6176 6520 2564 206c 6976 6520 706f 696e  ave %d live poin
-0001b560: 7473 2c20 7761 6e74 2025 642e 222c 0a20  ts, want %d.",. 
-0001b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b580: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001b590: 656c 662e 7265 6769 6f6e 2e74 7261 6e73  elf.region.trans
-0001b5a0: 666f 726d 4c61 7965 722e 6e63 6c75 7374  formLayer.nclust
-0001b5b0: 6572 732c 206e 6c69 7665 2c0a 2020 2020  ers, nlive,.    
-0001b5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5d0: 2020 2020 2020 2020 2020 2020 636c 7573              clus
-0001b5e0: 7465 725f 6e75 6d5f 6c69 7665 5f70 6f69  ter_num_live_poi
-0001b5f0: 6e74 7320 2a20 6e63 6c75 7374 6572 7329  nts * nclusters)
-0001b600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b610: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
-0001b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b630: 2020 2020 2320 7361 6d70 6c65 2070 6f69      # sample poi
-0001b640: 6e74 0a20 2020 2020 2020 2020 2020 2020  nt.             
-0001b650: 2020 2020 2020 2075 2c20 702c 204c 203d         u, p, L =
-0001b660: 2073 656c 662e 5f63 7265 6174 655f 706f   self._create_po
-0001b670: 696e 7428 4c6d 696e 3d4c 6d69 6e2c 206e  int(Lmin=Lmin, n
-0001b680: 6472 6177 3d6e 6472 6177 2c20 6163 7469  draw=ndraw, acti
-0001b690: 7665 5f75 3d61 6374 6976 655f 752c 2061  ve_u=active_u, a
-0001b6a0: 6374 6976 655f 7661 6c75 6573 3d61 6374  ctive_values=act
-0001b6b0: 6976 655f 7661 6c75 6573 290a 2020 2020  ive_values).    
-0001b6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b6d0: 6368 696c 6420 3d20 7365 6c66 2e70 6f69  child = self.poi
-0001b6e0: 6e74 7069 6c65 2e6d 616b 655f 6e6f 6465  ntpile.make_node
-0001b6f0: 284c 2c20 752c 2070 290a 2020 2020 2020  (L, u, p).      
-0001b700: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0001b710: 696e 5f69 7465 7261 746f 722e 4c6d 6178  in_iterator.Lmax
-0001b720: 203d 206d 6178 286d 6169 6e5f 6974 6572   = max(main_iter
-0001b730: 6174 6f72 2e4c 6d61 782c 204c 290a 2020  ator.Lmax, L).  
-0001b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b750: 2020 6966 206e 702e 6973 6669 6e69 7465    if np.isfinite
-0001b760: 2869 6e73 6572 7469 6f6e 5f74 6573 745f  (insertion_test_
-0001b770: 7a73 636f 7265 5f74 6872 6573 686f 6c64  zscore_threshold
-0001b780: 2920 616e 6420 6e6c 6976 6520 3e20 313a  ) and nlive > 1:
-0001b790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b7a0: 2020 2020 2020 2020 2069 6e73 6572 7469           inserti
-0001b7b0: 6f6e 5f74 6573 742e 6164 6428 2861 6374  on_test.add((act
-0001b7c0: 6976 655f 7661 6c75 6573 203c 204c 292e  ive_values < L).
-0001b7d0: 7375 6d28 292c 206e 6c69 7665 290a 2020  sum(), nlive).  
-0001b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b7f0: 2020 2020 2020 6966 2061 6273 2869 6e73        if abs(ins
-0001b800: 6572 7469 6f6e 5f74 6573 742e 7a73 636f  ertion_test.zsco
-0001b810: 7265 2920 3e20 696e 7365 7274 696f 6e5f  re) > insertion_
-0001b820: 7465 7374 5f7a 7363 6f72 655f 7468 7265  test_zscore_thre
-0001b830: 7368 6f6c 643a 0a20 2020 2020 2020 2020  shold:.         
-0001b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b850: 2020 2069 6e73 6572 7469 6f6e 5f74 6573     insertion_tes
-0001b860: 745f 7275 6e73 2e61 7070 656e 6428 696e  t_runs.append(in
-0001b870: 7365 7274 696f 6e5f 7465 7374 2e4e 290a  sertion_test.N).
-0001b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b890: 2020 2020 2020 2020 2020 2020 696e 7365              inse
-0001b8a0: 7274 696f 6e5f 7465 7374 5f71 7561 6c69  rtion_test_quali
-0001b8b0: 7479 203d 2069 6e73 6572 7469 6f6e 5f74  ty = insertion_t
-0001b8c0: 6573 742e 4e0a 2020 2020 2020 2020 2020  est.N.          
-0001b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b8e0: 2020 696e 7365 7274 696f 6e5f 7465 7374    insertion_test
-0001b8f0: 5f64 6972 6563 7469 6f6e 203d 206e 702e  _direction = np.
-0001b900: 7369 676e 2869 6e73 6572 7469 6f6e 5f74  sign(insertion_t
-0001b910: 6573 742e 7a73 636f 7265 290a 2020 2020  est.zscore).    
-0001b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b930: 2020 2020 2020 2020 696e 7365 7274 696f          insertio
-0001b940: 6e5f 7465 7374 2e72 6573 6574 2829 0a20  n_test.reset(). 
+0001b500: 6966 2073 656c 662e 6c6f 673a 0a20 2020  if self.log:.   
+0001b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b520: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+0001b530: 6767 6572 2e69 6e66 6f28 0a20 2020 2020  gger.info(.     
+0001b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b550: 2020 2020 2020 2020 2020 2022 466f 756e             "Foun
+0001b560: 6420 2564 2063 6c75 7374 6572 732c 2062  d %d clusters, b
+0001b570: 7574 206f 6e6c 7920 6861 7665 2025 6420  ut only have %d 
+0001b580: 6c69 7665 2070 6f69 6e74 732c 2077 616e  live points, wan
+0001b590: 7420 2564 2e22 2c0a 2020 2020 2020 2020  t %d.",.        
+0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5b0: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+0001b5c0: 696f 6e2e 7472 616e 7366 6f72 6d4c 6179  ion.transformLay
+0001b5d0: 6572 2e6e 636c 7573 7465 7273 2c20 6e6c  er.nclusters, nl
+0001b5e0: 6976 652c 0a20 2020 2020 2020 2020 2020  ive,.           
+0001b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b600: 2020 2020 2063 6c75 7374 6572 5f6e 756d       cluster_num
+0001b610: 5f6c 6976 655f 706f 696e 7473 202a 206e  _live_points * n
+0001b620: 636c 7573 7465 7273 290a 2020 2020 2020  clusters).      
+0001b630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b640: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
+0001b650: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+0001b660: 616d 706c 6520 706f 696e 740a 2020 2020  ample point.    
+0001b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b680: 752c 2070 2c20 4c20 3d20 7365 6c66 2e5f  u, p, L = self._
+0001b690: 6372 6561 7465 5f70 6f69 6e74 284c 6d69  create_point(Lmi
+0001b6a0: 6e3d 4c6d 696e 2c20 6e64 7261 773d 6e64  n=Lmin, ndraw=nd
+0001b6b0: 7261 772c 2061 6374 6976 655f 753d 6163  raw, active_u=ac
+0001b6c0: 7469 7665 5f75 2c20 6163 7469 7665 5f76  tive_u, active_v
+0001b6d0: 616c 7565 733d 6163 7469 7665 5f76 616c  alues=active_val
+0001b6e0: 7565 7329 0a20 2020 2020 2020 2020 2020  ues).           
+0001b6f0: 2020 2020 2020 2020 2063 6869 6c64 203d           child =
+0001b700: 2073 656c 662e 706f 696e 7470 696c 652e   self.pointpile.
+0001b710: 6d61 6b65 5f6e 6f64 6528 4c2c 2075 2c20  make_node(L, u, 
+0001b720: 7029 0a20 2020 2020 2020 2020 2020 2020  p).             
+0001b730: 2020 2020 2020 206d 6169 6e5f 6974 6572         main_iter
+0001b740: 6174 6f72 2e4c 6d61 7820 3d20 6d61 7828  ator.Lmax = max(
+0001b750: 6d61 696e 5f69 7465 7261 746f 722e 4c6d  main_iterator.Lm
+0001b760: 6178 2c20 4c29 0a20 2020 2020 2020 2020  ax, L).         
+0001b770: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
+0001b780: 2e69 7366 696e 6974 6528 696e 7365 7274  .isfinite(insert
+0001b790: 696f 6e5f 7465 7374 5f7a 7363 6f72 655f  ion_test_zscore_
+0001b7a0: 7468 7265 7368 6f6c 6429 2061 6e64 206e  threshold) and n
+0001b7b0: 6c69 7665 203e 2031 3a0a 2020 2020 2020  live > 1:.      
+0001b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b7d0: 2020 696e 7365 7274 696f 6e5f 7465 7374    insertion_test
+0001b7e0: 2e61 6464 2828 6163 7469 7665 5f76 616c  .add((active_val
+0001b7f0: 7565 7320 3c20 4c29 2e73 756d 2829 2c20  ues < L).sum(), 
+0001b800: 6e6c 6976 6529 0a20 2020 2020 2020 2020  nlive).         
+0001b810: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b820: 6620 6162 7328 696e 7365 7274 696f 6e5f  f abs(insertion_
+0001b830: 7465 7374 2e7a 7363 6f72 6529 203e 2069  test.zscore) > i
+0001b840: 6e73 6572 7469 6f6e 5f74 6573 745f 7a73  nsertion_test_zs
+0001b850: 636f 7265 5f74 6872 6573 686f 6c64 3a0a  core_threshold:.
+0001b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b870: 2020 2020 2020 2020 2020 2020 696e 7365              inse
+0001b880: 7274 696f 6e5f 7465 7374 5f72 756e 732e  rtion_test_runs.
+0001b890: 6170 7065 6e64 2869 6e73 6572 7469 6f6e  append(insertion
+0001b8a0: 5f74 6573 742e 4e29 0a20 2020 2020 2020  _test.N).       
+0001b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8c0: 2020 2020 2069 6e73 6572 7469 6f6e 5f74       insertion_t
+0001b8d0: 6573 745f 7175 616c 6974 7920 3d20 696e  est_quality = in
+0001b8e0: 7365 7274 696f 6e5f 7465 7374 2e4e 0a20  sertion_test.N. 
+0001b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b900: 2020 2020 2020 2020 2020 2069 6e73 6572             inser
+0001b910: 7469 6f6e 5f74 6573 745f 6469 7265 6374  tion_test_direct
+0001b920: 696f 6e20 3d20 6e70 2e73 6967 6e28 696e  ion = np.sign(in
+0001b930: 7365 7274 696f 6e5f 7465 7374 2e7a 7363  sertion_test.zsc
+0001b940: 6f72 6529 0a20 2020 2020 2020 2020 2020  ore).           
 0001b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b960: 2020 2020 2020 2065 6c69 6620 696e 7365         elif inse
-0001b970: 7274 696f 6e5f 7465 7374 2e4e 203e 2069  rtion_test.N > i
-0001b980: 6e73 6572 7469 6f6e 5f74 6573 745f 7769  nsertion_test_wi
-0001b990: 6e64 6f77 3a0a 2020 2020 2020 2020 2020  ndow:.          
-0001b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9b0: 2020 696e 7365 7274 696f 6e5f 7465 7374    insertion_test
-0001b9c0: 5f71 7561 6c69 7479 203d 206e 702e 696e  _quality = np.in
-0001b9d0: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-0001b9e0: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0001b9f0: 7365 7274 696f 6e5f 7465 7374 5f64 6972  sertion_test_dir
-0001ba00: 6563 7469 6f6e 203d 2030 0a20 2020 2020  ection = 0.     
-0001ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba20: 2020 2020 2020 2069 6e73 6572 7469 6f6e         insertion
-0001ba30: 5f74 6573 742e 7265 7365 7428 290a 0a20  _test.reset().. 
+0001b960: 2069 6e73 6572 7469 6f6e 5f74 6573 742e   insertion_test.
+0001b970: 7265 7365 7428 290a 2020 2020 2020 2020  reset().        
+0001b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b990: 656c 6966 2069 6e73 6572 7469 6f6e 5f74  elif insertion_t
+0001b9a0: 6573 742e 4e20 3e20 696e 7365 7274 696f  est.N > insertio
+0001b9b0: 6e5f 7465 7374 5f77 696e 646f 773a 0a20  n_test_window:. 
+0001b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b9d0: 2020 2020 2020 2020 2020 2069 6e73 6572             inser
+0001b9e0: 7469 6f6e 5f74 6573 745f 7175 616c 6974  tion_test_qualit
+0001b9f0: 7920 3d20 6e70 2e69 6e66 0a20 2020 2020  y = np.inf.     
+0001ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba10: 2020 2020 2020 2069 6e73 6572 7469 6f6e         insertion
+0001ba20: 5f74 6573 745f 6469 7265 6374 696f 6e20  _test_direction 
+0001ba30: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
 0001ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba50: 2020 2023 2069 6465 6e74 6966 7920 7768     # identify wh
-0001ba60: 6963 6820 706f 696e 7420 6973 2062 6569  ich point is bei
-0001ba70: 6e67 2072 6570 6c61 6365 6420 2866 726f  ng replaced (fro
-0001ba80: 6d20 7768 656e 2077 6520 6275 696c 7420  m when we built 
-0001ba90: 7468 6520 7265 6769 6f6e 290a 2020 2020  the region).    
-0001baa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bab0: 776f 7273 7420 3d20 6e70 2e77 6865 7265  worst = np.where
-0001bac0: 2873 656c 662e 7265 6769 6f6e 5f6e 6f64  (self.region_nod
-0001bad0: 6573 203d 3d20 6e6f 6465 2e69 6429 5b30  es == node.id)[0
-0001bae0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001baf0: 2020 2020 2020 7365 6c66 2e72 6567 696f        self.regio
-0001bb00: 6e5f 6e6f 6465 735b 776f 7273 745d 203d  n_nodes[worst] =
-0001bb10: 2063 6869 6c64 2e69 640a 2020 2020 2020   child.id.      
-0001bb20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001bb30: 6966 2077 6520 6b65 6570 2074 6865 2072  if we keep the r
-0001bb40: 6567 696f 6e20 696e 666f 726d 6564 2061  egion informed a
-0001bb50: 626f 7574 2074 6865 206e 6577 206c 6976  bout the new liv
-0001bb60: 6520 706f 696e 7473 0a20 2020 2020 2020  e points.       
-0001bb70: 2020 2020 2020 2020 2020 2020 2023 2074               # t
-0001bb80: 6865 6e20 7468 6520 7265 6769 6f6e 2066  hen the region f
-0001bb90: 6f6c 6c6f 7773 2074 6865 206c 6976 6520  ollows the live 
-0001bba0: 706f 696e 7473 2065 7665 6e20 6966 206d  points even if m
-0001bbb0: 6178 7261 6469 7573 2069 7320 6e6f 7420  axradius is not 
-0001bbc0: 7570 6461 7465 640a 2020 2020 2020 2020  updated.        
-0001bbd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001bbe0: 2e72 6567 696f 6e2e 755b 776f 7273 745d  .region.u[worst]
-0001bbf0: 203d 2075 0a20 2020 2020 2020 2020 2020   = u.           
-0001bc00: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-0001bc10: 6769 6f6e 2e75 6e6f 726d 6564 5b77 6f72  gion.unormed[wor
-0001bc20: 7374 5d20 3d20 7365 6c66 2e72 6567 696f  st] = self.regio
-0001bc30: 6e2e 7472 616e 7366 6f72 6d4c 6179 6572  n.transformLayer
-0001bc40: 2e74 7261 6e73 666f 726d 2875 290a 2020  .transform(u).  
-0001bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc60: 2020 2320 6d6f 7665 2061 6c73 6f20 7468    # move also th
-0001bc70: 6520 656c 6c69 7073 6f69 640a 2020 2020  e ellipsoid.    
-0001bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc90: 7365 6c66 2e72 6567 696f 6e2e 656c 6c69  self.region.elli
-0001bca0: 7073 6f69 645f 6365 6e74 6572 203d 206e  psoid_center = n
-0001bcb0: 702e 6d65 616e 2873 656c 662e 7265 6769  p.mean(self.regi
-0001bcc0: 6f6e 2e75 2c20 6178 6973 3d30 290a 2020  on.u, axis=0).  
-0001bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bce0: 2020 6966 2073 656c 662e 7472 6567 696f    if self.tregio
-0001bcf0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0001bd00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001bd10: 7472 6567 696f 6e2e 7570 6461 7465 5f63  tregion.update_c
-0001bd20: 656e 7465 7228 6e70 2e6d 6561 6e28 6163  enter(np.mean(ac
-0001bd30: 7469 7665 5f70 2c20 6178 6973 3d30 2929  tive_p, axis=0))
-0001bd40: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001bd50: 2020 2020 2020 2320 6966 2077 6520 7472        # if we tr
-0001bd60: 6163 6b20 7468 6520 636c 7573 7465 7220  ack the cluster 
-0001bd70: 6173 7369 676e 6d65 6e74 2c20 7468 656e  assignment, then
-0001bd80: 2069 6e20 7468 6520 6e65 7874 2072 6f75   in the next rou
-0001bd90: 6e64 0a20 2020 2020 2020 2020 2020 2020  nd.             
-0001bda0: 2020 2020 2020 2023 2074 6865 2069 6473         # the ids
-0001bdb0: 2077 6974 6820 7468 6520 7361 6d65 206d   with the same m
-0001bdc0: 656d 6265 7273 2061 7265 206c 696b 656c  embers are likel
-0001bdd0: 7920 746f 2068 6176 6520 7468 6520 7361  y to have the sa
-0001bde0: 6d65 2069 640a 2020 2020 2020 2020 2020  me id.          
-0001bdf0: 2020 2020 2020 2020 2020 2320 7468 6973            # this
-0001be00: 2069 7320 696d 7065 7266 6563 740a 2020   is imperfect.  
+0001ba50: 696e 7365 7274 696f 6e5f 7465 7374 2e72  insertion_test.r
+0001ba60: 6573 6574 2829 0a0a 2020 2020 2020 2020  eset()..        
+0001ba70: 2020 2020 2020 2020 2020 2020 2320 6964              # id
+0001ba80: 656e 7469 6679 2077 6869 6368 2070 6f69  entify which poi
+0001ba90: 6e74 2069 7320 6265 696e 6720 7265 706c  nt is being repl
+0001baa0: 6163 6564 2028 6672 6f6d 2077 6865 6e20  aced (from when 
+0001bab0: 7765 2062 7569 6c74 2074 6865 2072 6567  we built the reg
+0001bac0: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
+0001bad0: 2020 2020 2020 2020 2077 6f72 7374 203d           worst =
+0001bae0: 206e 702e 7768 6572 6528 7365 6c66 2e72   np.where(self.r
+0001baf0: 6567 696f 6e5f 6e6f 6465 7320 3d3d 206e  egion_nodes == n
+0001bb00: 6f64 652e 6964 295b 305d 0a20 2020 2020  ode.id)[0].     
+0001bb10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001bb20: 656c 662e 7265 6769 6f6e 5f6e 6f64 6573  elf.region_nodes
+0001bb30: 5b77 6f72 7374 5d20 3d20 6368 696c 642e  [worst] = child.
+0001bb40: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
+0001bb50: 2020 2020 2020 2023 2069 6620 7765 206b         # if we k
+0001bb60: 6565 7020 7468 6520 7265 6769 6f6e 2069  eep the region i
+0001bb70: 6e66 6f72 6d65 6420 6162 6f75 7420 7468  nformed about th
+0001bb80: 6520 6e65 7720 6c69 7665 2070 6f69 6e74  e new live point
+0001bb90: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0001bba0: 2020 2020 2020 2320 7468 656e 2074 6865        # then the
+0001bbb0: 2072 6567 696f 6e20 666f 6c6c 6f77 7320   region follows 
+0001bbc0: 7468 6520 6c69 7665 2070 6f69 6e74 7320  the live points 
+0001bbd0: 6576 656e 2069 6620 6d61 7872 6164 6975  even if maxradiu
+0001bbe0: 7320 6973 206e 6f74 2075 7064 6174 6564  s is not updated
+0001bbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bc00: 2020 2020 2073 656c 662e 7265 6769 6f6e       self.region
+0001bc10: 2e75 5b77 6f72 7374 5d20 3d20 750a 2020  .u[worst] = u.  
+0001bc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc30: 2020 7365 6c66 2e72 6567 696f 6e2e 756e    self.region.un
+0001bc40: 6f72 6d65 645b 776f 7273 745d 203d 2073  ormed[worst] = s
+0001bc50: 656c 662e 7265 6769 6f6e 2e74 7261 6e73  elf.region.trans
+0001bc60: 666f 726d 4c61 7965 722e 7472 616e 7366  formLayer.transf
+0001bc70: 6f72 6d28 7529 0a20 2020 2020 2020 2020  orm(u).         
+0001bc80: 2020 2020 2020 2020 2020 2023 206d 6f76             # mov
+0001bc90: 6520 616c 736f 2074 6865 2065 6c6c 6970  e also the ellip
+0001bca0: 736f 6964 0a20 2020 2020 2020 2020 2020  soid.           
+0001bcb0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+0001bcc0: 6769 6f6e 2e65 6c6c 6970 736f 6964 5f63  gion.ellipsoid_c
+0001bcd0: 656e 7465 7220 3d20 6e70 2e6d 6561 6e28  enter = np.mean(
+0001bce0: 7365 6c66 2e72 6567 696f 6e2e 752c 2061  self.region.u, a
+0001bcf0: 7869 733d 3029 0a20 2020 2020 2020 2020  xis=0).         
+0001bd00: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0001bd10: 6c66 2e74 7265 6769 6f6e 3a0a 2020 2020  lf.tregion:.    
+0001bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd30: 2020 2020 7365 6c66 2e74 7265 6769 6f6e      self.tregion
+0001bd40: 2e75 7064 6174 655f 6365 6e74 6572 286e  .update_center(n
+0001bd50: 702e 6d65 616e 2861 6374 6976 655f 702c  p.mean(active_p,
+0001bd60: 2061 7869 733d 3029 290a 0a20 2020 2020   axis=0))..     
+0001bd70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001bd80: 2069 6620 7765 2074 7261 636b 2074 6865   if we track the
+0001bd90: 2063 6c75 7374 6572 2061 7373 6967 6e6d   cluster assignm
+0001bda0: 656e 742c 2074 6865 6e20 696e 2074 6865  ent, then in the
+0001bdb0: 206e 6578 7420 726f 756e 640a 2020 2020   next round.    
+0001bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bdd0: 2320 7468 6520 6964 7320 7769 7468 2074  # the ids with t
+0001bde0: 6865 2073 616d 6520 6d65 6d62 6572 7320  he same members 
+0001bdf0: 6172 6520 6c69 6b65 6c79 2074 6f20 6861  are likely to ha
+0001be00: 7665 2074 6865 2073 616d 6520 6964 0a20  ve the same id. 
 0001be10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be20: 2020 2320 7472 616e 7366 6f72 6d4c 6179    # transformLay
-0001be30: 6572 2e63 6c75 7374 6572 6964 735b 776f  er.clusterids[wo
-0001be40: 7273 745d 203d 2074 7261 6e73 666f 726d  rst] = transform
-0001be50: 4c61 7965 722e 636c 7573 7465 7269 6473  Layer.clusterids
-0001be60: 5b66 6174 6865 725b 6962 5d5d 0a20 2020  [father[ib]].   
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 2023 2073 6f20 7765 206a 7573 7420 6d61   # so we just ma
-0001be90: 726b 2074 6865 2072 6570 6c61 6365 6420  rk the replaced 
-0001bea0: 6f6e 6573 2061 7320 2275 6e61 7373 6967  ones as "unassig
-0001beb0: 6e65 6422 0a20 2020 2020 2020 2020 2020  ned".           
-0001bec0: 2020 2020 2020 2020 2073 656c 662e 7472           self.tr
-0001bed0: 616e 7366 6f72 6d4c 6179 6572 2e63 6c75  ansformLayer.clu
-0001bee0: 7374 6572 6964 735b 776f 7273 745d 203d  sterids[worst] =
-0001bef0: 2030 0a0a 2020 2020 2020 2020 2020 2020   0..            
-0001bf00: 2020 2020 2020 2020 6e6f 6465 2e63 6869          node.chi
-0001bf10: 6c64 7265 6e2e 6170 7065 6e64 2863 6869  ldren.append(chi
-0001bf20: 6c64 290a 0a20 2020 2020 2020 2020 2020  ld)..           
-0001bf30: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0001bf40: 2e6c 6f67 2061 6e64 2028 7265 6769 6f6e  .log and (region
-0001bf50: 5f66 7265 7368 206f 7220 6974 2025 206c  _fresh or it % l
-0001bf60: 6f67 5f69 6e74 6572 7661 6c20 3d3d 2030  og_interval == 0
-0001bf70: 206f 7220 7469 6d65 2e74 696d 6528 2920   or time.time() 
-0001bf80: 3e20 6c61 7374 5f73 7461 7475 7320 2b20  > last_status + 
-0001bf90: 302e 3129 3a0a 2020 2020 2020 2020 2020  0.1):.          
-0001bfa0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0001bfb0: 7374 5f73 7461 7475 7320 3d20 7469 6d65  st_status = time
-0001bfc0: 2e74 696d 6528 290a 2020 2020 2020 2020  .time().        
-0001bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfe0: 2320 7468 6520 6e75 6d62 6572 206f 6620  # the number of 
-0001bff0: 7072 6f70 6f73 616c 7320 6173 6b65 6420  proposals asked 
-0001c000: 6672 6f6d 2072 6567 696f 6e0a 2020 2020  from region.    
-0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c020: 2020 2020 6e63 616c 6c5f 7265 6769 6f6e      ncall_region
-0001c030: 5f68 6572 6520 3d20 2873 656c 662e 6e63  _here = (self.nc
-0001c040: 616c 6c5f 7265 6769 6f6e 202d 206e 6361  all_region - nca
-0001c050: 6c6c 5f72 6567 696f 6e5f 6174 5f72 756e  ll_region_at_run
-0001c060: 5f73 7461 7274 290a 2020 2020 2020 2020  _start).        
-0001c070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c080: 2320 7468 6520 6e75 6d62 6572 206f 6620  # the number of 
-0001c090: 7072 6f70 6f73 616c 7320 7265 7475 726e  proposals return
-0001c0a0: 6564 2062 7920 7468 6520 7265 6769 6f6e  ed by the region
-0001c0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c0c0: 2020 2020 2020 2020 206e 6361 6c6c 5f68           ncall_h
-0001c0d0: 6572 6520 3d20 7365 6c66 2e6e 6361 6c6c  ere = self.ncall
-0001c0e0: 202d 206e 6361 6c6c 5f61 745f 7275 6e5f   - ncall_at_run_
-0001c0f0: 7374 6172 740a 2020 2020 2020 2020 2020  start.          
-0001c100: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001c110: 7468 6520 6e75 6d62 6572 206f 6620 6c69  the number of li
-0001c120: 6b65 6c69 686f 6f64 2065 7661 6c75 6174  kelihood evaluat
-0001c130: 696f 6e73 2061 626f 7665 2074 6872 6573  ions above thres
-0001c140: 686f 6c64 0a20 2020 2020 2020 2020 2020  hold.           
-0001c150: 2020 2020 2020 2020 2020 2020 2069 745f               it_
-0001c160: 6865 7265 203d 2069 7420 2d20 6974 5f61  here = it - it_a
-0001c170: 745f 6669 7273 745f 7265 6769 6f6e 0a0a  t_first_region..
-0001c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c190: 2020 2020 2020 2020 6966 2073 686f 775f          if show_
-0001c1a0: 7374 6174 7573 3a0a 2020 2020 2020 2020  status:.        
+0001be20: 2020 2023 2074 6869 7320 6973 2069 6d70     # this is imp
+0001be30: 6572 6665 6374 0a20 2020 2020 2020 2020  erfect.         
+0001be40: 2020 2020 2020 2020 2020 2023 2074 7261             # tra
+0001be50: 6e73 666f 726d 4c61 7965 722e 636c 7573  nsformLayer.clus
+0001be60: 7465 7269 6473 5b77 6f72 7374 5d20 3d20  terids[worst] = 
+0001be70: 7472 616e 7366 6f72 6d4c 6179 6572 2e63  transformLayer.c
+0001be80: 6c75 7374 6572 6964 735b 6661 7468 6572  lusterids[father
+0001be90: 5b69 625d 5d0a 2020 2020 2020 2020 2020  [ib]].          
+0001bea0: 2020 2020 2020 2020 2020 2320 736f 2077            # so w
+0001beb0: 6520 6a75 7374 206d 6172 6b20 7468 6520  e just mark the 
+0001bec0: 7265 706c 6163 6564 206f 6e65 7320 6173  replaced ones as
+0001bed0: 2022 756e 6173 7369 676e 6564 220a 2020   "unassigned".  
+0001bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bef0: 2020 7365 6c66 2e74 7261 6e73 666f 726d    self.transform
+0001bf00: 4c61 7965 722e 636c 7573 7465 7269 6473  Layer.clusterids
+0001bf10: 5b77 6f72 7374 5d20 3d20 300a 0a20 2020  [worst] = 0..   
+0001bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf30: 206e 6f64 652e 6368 696c 6472 656e 2e61   node.children.a
+0001bf40: 7070 656e 6428 6368 696c 6429 0a0a 2020  ppend(child)..  
+0001bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf60: 2020 6966 2073 656c 662e 6c6f 6720 616e    if self.log an
+0001bf70: 6420 2872 6567 696f 6e5f 6672 6573 6820  d (region_fresh 
+0001bf80: 6f72 2069 7420 2520 6c6f 675f 696e 7465  or it % log_inte
+0001bf90: 7276 616c 203d 3d20 3020 6f72 2074 696d  rval == 0 or tim
+0001bfa0: 652e 7469 6d65 2829 203e 206c 6173 745f  e.time() > last_
+0001bfb0: 7374 6174 7573 202b 2030 2e31 293a 0a20  status + 0.1):. 
+0001bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bfd0: 2020 2020 2020 206c 6173 745f 7374 6174         last_stat
+0001bfe0: 7573 203d 2074 696d 652e 7469 6d65 2829  us = time.time()
+0001bff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c000: 2020 2020 2020 2020 2023 2074 6865 206e           # the n
+0001c010: 756d 6265 7220 6f66 2070 726f 706f 7361  umber of proposa
+0001c020: 6c73 2061 736b 6564 2066 726f 6d20 7265  ls asked from re
+0001c030: 6769 6f6e 0a20 2020 2020 2020 2020 2020  gion.           
+0001c040: 2020 2020 2020 2020 2020 2020 206e 6361               nca
+0001c050: 6c6c 5f72 6567 696f 6e5f 6865 7265 203d  ll_region_here =
+0001c060: 2028 7365 6c66 2e6e 6361 6c6c 5f72 6567   (self.ncall_reg
+0001c070: 696f 6e20 2d20 6e63 616c 6c5f 7265 6769  ion - ncall_regi
+0001c080: 6f6e 5f61 745f 7275 6e5f 7374 6172 7429  on_at_run_start)
+0001c090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c0a0: 2020 2020 2020 2020 2023 2074 6865 206e           # the n
+0001c0b0: 756d 6265 7220 6f66 2070 726f 706f 7361  umber of proposa
+0001c0c0: 6c73 2072 6574 7572 6e65 6420 6279 2074  ls returned by t
+0001c0d0: 6865 2072 6567 696f 6e0a 2020 2020 2020  he region.      
+0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c0f0: 2020 6e63 616c 6c5f 6865 7265 203d 2073    ncall_here = s
+0001c100: 656c 662e 6e63 616c 6c20 2d20 6e63 616c  elf.ncall - ncal
+0001c110: 6c5f 6174 5f72 756e 5f73 7461 7274 0a20  l_at_run_start. 
+0001c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c130: 2020 2020 2020 2023 2074 6865 206e 756d         # the num
+0001c140: 6265 7220 6f66 206c 696b 656c 6968 6f6f  ber of likelihoo
+0001c150: 6420 6576 616c 7561 7469 6f6e 7320 6162  d evaluations ab
+0001c160: 6f76 6520 7468 7265 7368 6f6c 640a 2020  ove threshold.  
+0001c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c180: 2020 2020 2020 6974 5f68 6572 6520 3d20        it_here = 
+0001c190: 6974 202d 2069 745f 6174 5f66 6972 7374  it - it_at_first
+0001c1a0: 5f72 6567 696f 6e0a 0a20 2020 2020 2020  _region..       
 0001c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1c0: 2020 2020 6966 204c 6d69 6e20 3c20 2d31      if Lmin < -1
-0001c1d0: 6538 3a0a 2020 2020 2020 2020 2020 2020  e8:.            
-0001c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1f0: 2020 2020 7478 7420 3d20 275a 3d25 2e31      txt = 'Z=%.1
-0001c200: 6728 252e 3266 2525 2920 7c20 4c69 6b65  g(%.2f%%) | Like
-0001c210: 3d25 2e32 672e 2e25 2e32 6720 5b25 2e34  =%.2g..%.2g [%.4
-0001c220: 672e 2e25 2e34 675d 2573 7c20 6974 2f65  g..%.4g]%s| it/e
-0001c230: 7661 6c73 3d25 642f 2564 2065 6666 3d25  vals=%d/%d eff=%
-0001c240: 2e34 6625 2520 4e3d 2564 205c 7227 0a20  .4f%% N=%d \r'. 
-0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c260: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0001c270: 4c6c 6f20 3c20 2d31 6538 3a0a 2020 2020  Llo < -1e8:.    
+0001c1c0: 2069 6620 7368 6f77 5f73 7461 7475 733a   if show_status:
+0001c1d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c1e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001c1f0: 4c6d 696e 203c 202d 3165 383a 0a20 2020  Lmin < -1e8:.   
+0001c200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c210: 2020 2020 2020 2020 2020 2020 2074 7874               txt
+0001c220: 203d 2027 5a3d 252e 3167 2825 2e32 6625   = 'Z=%.1g(%.2f%
+0001c230: 2529 207c 204c 696b 653d 252e 3267 2e2e  %) | Like=%.2g..
+0001c240: 252e 3267 205b 252e 3467 2e2e 252e 3467  %.2g [%.4g..%.4g
+0001c250: 5d25 737c 2069 742f 6576 616c 733d 2564  ]%s| it/evals=%d
+0001c260: 2f25 6420 6566 663d 252e 3466 2525 204e  /%d eff=%.4f%% N
+0001c270: 3d25 6420 5c72 270a 2020 2020 2020 2020  =%d \r'.        
 0001c280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c290: 2020 2020 2020 2020 2020 2020 7478 7420              txt 
-0001c2a0: 3d20 275a 3d25 2e31 6628 252e 3266 2525  = 'Z=%.1f(%.2f%%
-0001c2b0: 2920 7c20 4c69 6b65 3d25 2e32 662e 2e25  ) | Like=%.2f..%
-0001c2c0: 2e32 6620 5b25 2e34 672e 2e25 2e34 675d  .2f [%.4g..%.4g]
-0001c2d0: 2573 7c20 6974 2f65 7661 6c73 3d25 642f  %s| it/evals=%d/
-0001c2e0: 2564 2065 6666 3d25 2e34 6625 2520 4e3d  %d eff=%.4f%% N=
-0001c2f0: 2564 205c 7227 0a20 2020 2020 2020 2020  %d \r'.         
-0001c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c310: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001c290: 2020 2020 656c 6966 204c 6c6f 203c 202d      elif Llo < -
+0001c2a0: 3165 383a 0a20 2020 2020 2020 2020 2020  1e8:.           
+0001c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2c0: 2020 2020 2074 7874 203d 2027 5a3d 252e       txt = 'Z=%.
+0001c2d0: 3166 2825 2e32 6625 2529 207c 204c 696b  1f(%.2f%%) | Lik
+0001c2e0: 653d 252e 3266 2e2e 252e 3266 205b 252e  e=%.2f..%.2f [%.
+0001c2f0: 3467 2e2e 252e 3467 5d25 737c 2069 742f  4g..%.4g]%s| it/
+0001c300: 6576 616c 733d 2564 2f25 6420 6566 663d  evals=%d/%d eff=
+0001c310: 252e 3466 2525 204e 3d25 6420 5c72 270a  %.4f%% N=%d \r'.
 0001c320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c330: 2020 2020 2020 2020 2074 7874 203d 2027           txt = '
-0001c340: 5a3d 252e 3166 2825 2e32 6625 2529 207c  Z=%.1f(%.2f%%) |
-0001c350: 204c 696b 653d 252e 3266 2e2e 252e 3266   Like=%.2f..%.2f
-0001c360: 205b 252e 3466 2e2e 252e 3466 5d25 737c   [%.4f..%.4f]%s|
-0001c370: 2069 742f 6576 616c 733d 2564 2f25 6420   it/evals=%d/%d 
-0001c380: 6566 663d 252e 3466 2525 204e 3d25 6420  eff=%.4f%% N=%d 
-0001c390: 5c72 270a 2020 2020 2020 2020 2020 2020  \r'.            
-0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3b0: 7379 732e 7374 646f 7574 2e77 7269 7465  sys.stdout.write
-0001c3c0: 2874 7874 2025 2028 0a20 2020 2020 2020  (txt % (.       
-0001c3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3e0: 2020 2020 2020 2020 206d 6169 6e5f 6974           main_it
-0001c3f0: 6572 6174 6f72 2e6c 6f67 5a2c 2031 3030  erator.logZ, 100
-0001c400: 202a 2028 3120 2d20 6d61 696e 5f69 7465   * (1 - main_ite
-0001c410: 7261 746f 722e 7265 6d61 696e 6465 725f  rator.remainder_
-0001c420: 6672 6163 7469 6f6e 292c 0a20 2020 2020  fraction),.     
-0001c430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c440: 2020 2020 2020 2020 2020 204c 6d69 6e2c             Lmin,
-0001c450: 206d 6169 6e5f 6974 6572 6174 6f72 2e4c   main_iterator.L
-0001c460: 6d61 782c 204c 6c6f 2c20 4c68 692c 2027  max, Llo, Lhi, '
-0001c470: 2a27 2069 6620 7374 7261 7465 6779 5f73  *' if strategy_s
-0001c480: 7461 6c65 2065 6c73 6520 2720 272c 2069  tale else ' ', i
-0001c490: 742c 2073 656c 662e 6e63 616c 6c2c 0a20  t, self.ncall,. 
-0001c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001c4c0: 702e 696e 6620 6966 206e 6361 6c6c 5f68  p.inf if ncall_h
-0001c4d0: 6572 6520 3d3d 2030 2065 6c73 6520 6974  ere == 0 else it
-0001c4e0: 5f68 6572 6520 2a20 3130 3020 2f20 6e63  _here * 100 / nc
-0001c4f0: 616c 6c5f 6865 7265 2c0a 2020 2020 2020  all_here,.      
-0001c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c510: 2020 2020 2020 2020 2020 6e6c 6976 6529            nlive)
-0001c520: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c530: 2020 2020 2020 2020 2020 2020 2020 7379                sy
-0001c540: 732e 7374 646f 7574 2e66 6c75 7368 2829  s.stdout.flush()
-0001c550: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c560: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-0001c570: 6767 6572 2e64 6562 7567 2827 6974 6572  gger.debug('iter
-0001c580: 6174 696f 6e3d 2564 2c20 6e63 616c 6c73  ation=%d, ncalls
-0001c590: 3d25 642c 2072 6567 696f 6e63 616c 6c73  =%d, regioncalls
-0001c5a0: 3d25 642c 206e 6472 6177 3d25 642c 206c  =%d, ndraw=%d, l
-0001c5b0: 6f67 7a3d 252e 3266 2c20 7265 6d61 696e  ogz=%.2f, remain
-0001c5c0: 6465 725f 6672 6163 7469 6f6e 3d25 2e34  der_fraction=%.4
-0001c5d0: 6625 252c 204c 6d69 6e3d 252e 3266 2c20  f%%, Lmin=%.2f, 
-0001c5e0: 4c6d 6178 3d25 2e32 6627 2025 2028 0a20  Lmax=%.2f' % (. 
-0001c5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c600: 2020 2020 2020 2020 2020 2069 742c 2073             it, s
-0001c610: 656c 662e 6e63 616c 6c2c 2073 656c 662e  elf.ncall, self.
-0001c620: 6e63 616c 6c5f 7265 6769 6f6e 2c20 6e64  ncall_region, nd
-0001c630: 7261 772c 206d 6169 6e5f 6974 6572 6174  raw, main_iterat
-0001c640: 6f72 2e6c 6f67 5a2c 0a20 2020 2020 2020  or.logZ,.       
-0001c650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c660: 2020 2020 2031 3030 202a 206d 6169 6e5f       100 * main_
-0001c670: 6974 6572 6174 6f72 2e72 656d 6169 6e64  iterator.remaind
-0001c680: 6572 5f66 7261 6374 696f 6e2c 204c 6d69  er_fraction, Lmi
-0001c690: 6e2c 206d 6169 6e5f 6974 6572 6174 6f72  n, main_iterator
-0001c6a0: 2e4c 6d61 7829 290a 0a20 2020 2020 2020  .Lmax))..       
-0001c6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6c0: 2023 2069 6620 6566 6669 6369 656e 6379   # if efficiency
-0001c6d0: 2062 6563 6f6d 6573 206c 6f77 2c20 6275   becomes low, bu
-0001c6e0: 6c6b 2d70 726f 6365 7373 206c 6172 6765  lk-process large
-0001c6f0: 7220 6172 7261 7973 0a20 2020 2020 2020  r arrays.       
-0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c710: 2069 6620 7365 6c66 2e64 7261 775f 6d75   if self.draw_mu
-0001c720: 6c74 6970 6c65 3a0a 2020 2020 2020 2020  ltiple:.        
-0001c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c740: 2020 2020 2320 696e 6566 6669 6369 656e      # inefficien
-0001c750: 6379 2069 7320 7468 6520 6e75 6d62 6572  cy is the number
-0001c760: 206f 6620 2872 6567 696f 6e29 2070 726f   of (region) pro
-0001c770: 706f 7361 6c73 2070 6572 2073 7563 6365  posals per succe
-0001c780: 7373 6675 6c20 6e75 6d62 6572 206f 6620  ssful number of 
-0001c790: 6974 6572 6174 696f 6e73 0a20 2020 2020  iterations.     
-0001c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7b0: 2020 2020 2020 2023 2062 7574 2069 6d70         # but imp
-0001c7c0: 726f 7665 7320 6279 2070 6172 616c 6c65  roves by paralle
-0001c7d0: 6c69 736d 2028 6265 6361 7573 6520 7765  lism (because we
-0001c7e0: 206e 6565 6420 6f6e 6c79 2074 6865 2070   need only the p
-0001c7f0: 6572 2d70 726f 6365 7373 2069 6e65 6666  er-process ineff
-0001c800: 6963 6965 6e63 7929 0a20 2020 2020 2020  iciency).       
-0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c820: 2020 2020 2023 2073 616d 706c 696e 675f       # sampling_
-0001c830: 696e 6566 6669 6369 656e 6379 203d 2028  inefficiency = (
-0001c840: 7365 6c66 2e6e 6361 6c6c 202d 206e 6361  self.ncall - nca
-0001c850: 6c6c 5f61 745f 7275 6e5f 7374 6172 7420  ll_at_run_start 
-0001c860: 2b20 3129 202f 2028 6974 202b 2031 2920  + 1) / (it + 1) 
-0001c870: 2f20 7365 6c66 2e6d 7069 5f73 697a 650a  / self.mpi_size.
-0001c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c890: 2020 2020 2020 2020 2020 2020 7361 6d70              samp
-0001c8a0: 6c69 6e67 5f69 6e65 6666 6963 6965 6e63  ling_inefficienc
-0001c8b0: 7920 3d20 286e 6361 6c6c 5f72 6567 696f  y = (ncall_regio
-0001c8c0: 6e5f 6865 7265 202b 2031 2920 2f20 2869  n_here + 1) / (i
-0001c8d0: 745f 6865 7265 202b 2031 2920 2f20 7365  t_here + 1) / se
-0001c8e0: 6c66 2e6d 7069 5f73 697a 650a 0a20 2020  lf.mpi_size..   
-0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c900: 2020 2020 2020 2020 2023 2073 6d6f 6f74           # smoot
-0001c910: 6820 7570 6461 7465 3a0a 2020 2020 2020  h update:.      
+0001c330: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001c340: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c360: 2020 7478 7420 3d20 275a 3d25 2e31 6628    txt = 'Z=%.1f(
+0001c370: 252e 3266 2525 2920 7c20 4c69 6b65 3d25  %.2f%%) | Like=%
+0001c380: 2e32 662e 2e25 2e32 6620 5b25 2e34 662e  .2f..%.2f [%.4f.
+0001c390: 2e25 2e34 665d 2573 7c20 6974 2f65 7661  .%.4f]%s| it/eva
+0001c3a0: 6c73 3d25 642f 2564 2065 6666 3d25 2e34  ls=%d/%d eff=%.4
+0001c3b0: 6625 2520 4e3d 2564 205c 7227 0a20 2020  f%% N=%d \r'.   
+0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3d0: 2020 2020 2020 2020 2073 7973 2e73 7464           sys.std
+0001c3e0: 6f75 742e 7772 6974 6528 7478 7420 2520  out.write(txt % 
+0001c3f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c410: 2020 6d61 696e 5f69 7465 7261 746f 722e    main_iterator.
+0001c420: 6c6f 675a 2c20 3130 3020 2a20 2831 202d  logZ, 100 * (1 -
+0001c430: 206d 6169 6e5f 6974 6572 6174 6f72 2e72   main_iterator.r
+0001c440: 656d 6169 6e64 6572 5f66 7261 6374 696f  emainder_fractio
+0001c450: 6e29 2c0a 2020 2020 2020 2020 2020 2020  n),.            
+0001c460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c470: 2020 2020 4c6d 696e 2c20 6d61 696e 5f69      Lmin, main_i
+0001c480: 7465 7261 746f 722e 4c6d 6178 2c20 4c6c  terator.Lmax, Ll
+0001c490: 6f2c 204c 6869 2c20 272a 2720 6966 2073  o, Lhi, '*' if s
+0001c4a0: 7472 6174 6567 795f 7374 616c 6520 656c  trategy_stale el
+0001c4b0: 7365 2027 2027 2c20 6974 2c20 7365 6c66  se ' ', it, self
+0001c4c0: 2e6e 6361 6c6c 2c0a 2020 2020 2020 2020  .ncall,.        
+0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4e0: 2020 2020 2020 2020 6e70 2e69 6e66 2069          np.inf i
+0001c4f0: 6620 6e63 616c 6c5f 6865 7265 203d 3d20  f ncall_here == 
+0001c500: 3020 656c 7365 2069 745f 6865 7265 202a  0 else it_here *
+0001c510: 2031 3030 202f 206e 6361 6c6c 5f68 6572   100 / ncall_her
+0001c520: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c540: 2020 206e 6c69 7665 2929 0a20 2020 2020     nlive)).     
+0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c560: 2020 2020 2020 2073 7973 2e73 7464 6f75         sys.stdou
+0001c570: 742e 666c 7573 6828 290a 2020 2020 2020  t.flush().      
+0001c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c590: 2020 7365 6c66 2e6c 6f67 6765 722e 6465    self.logger.de
+0001c5a0: 6275 6728 2769 7465 7261 7469 6f6e 3d25  bug('iteration=%
+0001c5b0: 642c 206e 6361 6c6c 733d 2564 2c20 7265  d, ncalls=%d, re
+0001c5c0: 6769 6f6e 6361 6c6c 733d 2564 2c20 6e64  gioncalls=%d, nd
+0001c5d0: 7261 773d 2564 2c20 6c6f 677a 3d25 2e32  raw=%d, logz=%.2
+0001c5e0: 662c 2072 656d 6169 6e64 6572 5f66 7261  f, remainder_fra
+0001c5f0: 6374 696f 6e3d 252e 3466 2525 2c20 4c6d  ction=%.4f%%, Lm
+0001c600: 696e 3d25 2e32 662c 204c 6d61 783d 252e  in=%.2f, Lmax=%.
+0001c610: 3266 2720 2520 280a 2020 2020 2020 2020  2f' % (.        
+0001c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c630: 2020 2020 6974 2c20 7365 6c66 2e6e 6361      it, self.nca
+0001c640: 6c6c 2c20 7365 6c66 2e6e 6361 6c6c 5f72  ll, self.ncall_r
+0001c650: 6567 696f 6e2c 206e 6472 6177 2c20 6d61  egion, ndraw, ma
+0001c660: 696e 5f69 7465 7261 746f 722e 6c6f 675a  in_iterator.logZ
+0001c670: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c680: 2020 2020 2020 2020 2020 2020 2020 3130                10
+0001c690: 3020 2a20 6d61 696e 5f69 7465 7261 746f  0 * main_iterato
+0001c6a0: 722e 7265 6d61 696e 6465 725f 6672 6163  r.remainder_frac
+0001c6b0: 7469 6f6e 2c20 4c6d 696e 2c20 6d61 696e  tion, Lmin, main
+0001c6c0: 5f69 7465 7261 746f 722e 4c6d 6178 2929  _iterator.Lmax))
+0001c6d0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001c6e0: 2020 2020 2020 2020 2020 2320 6966 2065            # if e
+0001c6f0: 6666 6963 6965 6e63 7920 6265 636f 6d65  fficiency become
+0001c700: 7320 6c6f 772c 2062 756c 6b2d 7072 6f63  s low, bulk-proc
+0001c710: 6573 7320 6c61 7267 6572 2061 7272 6179  ess larger array
+0001c720: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0001c730: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0001c740: 662e 6472 6177 5f6d 756c 7469 706c 653a  f.draw_multiple:
+0001c750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c760: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+0001c770: 6e65 6666 6963 6965 6e63 7920 6973 2074  nefficiency is t
+0001c780: 6865 206e 756d 6265 7220 6f66 2028 7265  he number of (re
+0001c790: 6769 6f6e 2920 7072 6f70 6f73 616c 7320  gion) proposals 
+0001c7a0: 7065 7220 7375 6363 6573 7366 756c 206e  per successful n
+0001c7b0: 756d 6265 7220 6f66 2069 7465 7261 7469  umber of iterati
+0001c7c0: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c7e0: 2320 6275 7420 696d 7072 6f76 6573 2062  # but improves b
+0001c7f0: 7920 7061 7261 6c6c 656c 6973 6d20 2862  y parallelism (b
+0001c800: 6563 6175 7365 2077 6520 6e65 6564 206f  ecause we need o
+0001c810: 6e6c 7920 7468 6520 7065 722d 7072 6f63  nly the per-proc
+0001c820: 6573 7320 696e 6566 6669 6369 656e 6379  ess inefficiency
+0001c830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c840: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001c850: 7361 6d70 6c69 6e67 5f69 6e65 6666 6963  sampling_ineffic
+0001c860: 6965 6e63 7920 3d20 2873 656c 662e 6e63  iency = (self.nc
+0001c870: 616c 6c20 2d20 6e63 616c 6c5f 6174 5f72  all - ncall_at_r
+0001c880: 756e 5f73 7461 7274 202b 2031 2920 2f20  un_start + 1) / 
+0001c890: 2869 7420 2b20 3129 202f 2073 656c 662e  (it + 1) / self.
+0001c8a0: 6d70 695f 7369 7a65 0a20 2020 2020 2020  mpi_size.       
+0001c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8c0: 2020 2020 2073 616d 706c 696e 675f 696e       sampling_in
+0001c8d0: 6566 6669 6369 656e 6379 203d 2028 6e63  efficiency = (nc
+0001c8e0: 616c 6c5f 7265 6769 6f6e 5f68 6572 6520  all_region_here 
+0001c8f0: 2b20 3129 202f 2028 6974 5f68 6572 6520  + 1) / (it_here 
+0001c900: 2b20 3129 202f 2073 656c 662e 6d70 695f  + 1) / self.mpi_
+0001c910: 7369 7a65 0a0a 2020 2020 2020 2020 2020  size..          
 0001c920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c930: 2020 2020 2020 6e64 7261 775f 6e65 7874        ndraw_next
-0001c940: 203d 2030 2e30 3420 2a20 7361 6d70 6c69   = 0.04 * sampli
-0001c950: 6e67 5f69 6e65 6666 6963 6965 6e63 7920  ng_inefficiency 
-0001c960: 2b20 6e64 7261 7720 2a20 302e 3936 0a20  + ndraw * 0.96. 
-0001c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c980: 2020 2020 2020 2020 2020 206e 6472 6177             ndraw
-0001c990: 203d 206d 6178 2873 656c 662e 6e64 7261   = max(self.ndra
-0001c9a0: 775f 6d69 6e2c 206d 696e 2873 656c 662e  w_min, min(self.
-0001c9b0: 6e64 7261 775f 6d61 782c 2072 6f75 6e64  ndraw_max, round
-0001c9c0: 286e 6472 6177 5f6e 6578 7429 2c20 6e64  (ndraw_next), nd
-0001c9d0: 7261 7720 2a20 3130 3029 290a 0a20 2020  raw * 100))..   
-0001c9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9f0: 2020 2020 2020 2020 2069 6620 7361 6d70           if samp
-0001ca00: 6c69 6e67 5f69 6e65 6666 6963 6965 6e63  ling_inefficienc
-0001ca10: 7920 3e20 3130 3030 3030 2061 6e64 2069  y > 100000 and i
-0001ca20: 7420 3e3d 2069 745f 6174 5f66 6972 7374  t >= it_at_first
-0001ca30: 5f72 6567 696f 6e20 2b20 3130 3a0a 2020  _region + 10:.  
-0001ca40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001ca60: 6966 2074 6865 2065 6666 6963 6965 6e63  if the efficienc
-0001ca70: 7920 6973 2070 6f6f 722c 2074 6865 7265  y is poor, there
-0001ca80: 2061 7265 2065 6e6f 7567 6820 7361 6d70   are enough samp
-0001ca90: 6c65 7320 696e 2065 6163 6820 6974 6572  les in each iter
-0001caa0: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cac0: 2020 2020 2020 2320 746f 2065 7374 696d        # to estim
-0001cad0: 6174 6520 7468 6520 696e 6566 6669 6369  ate the ineffici
-0001cae0: 656e 6379 0a20 2020 2020 2020 2020 2020  ency.           
-0001caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb00: 2020 2020 206e 6361 6c6c 5f61 745f 7275       ncall_at_ru
-0001cb10: 6e5f 7374 6172 7420 3d20 7365 6c66 2e6e  n_start = self.n
-0001cb20: 6361 6c6c 0a20 2020 2020 2020 2020 2020  call.           
-0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb40: 2020 2020 2069 745f 6174 5f66 6972 7374       it_at_first
-0001cb50: 5f72 6567 696f 6e20 3d20 6974 0a20 2020  _region = it.   
-0001cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb70: 2020 2020 2020 2020 2020 2020 206e 6361               nca
-0001cb80: 6c6c 5f72 6567 696f 6e5f 6174 5f72 756e  ll_region_at_run
-0001cb90: 5f73 7461 7274 203d 2073 656c 662e 6e63  _start = self.nc
-0001cba0: 616c 6c5f 7265 6769 6f6e 0a0a 2020 2020  all_region..    
-0001cbb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001cbc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001cbd0: 2020 2020 2020 2320 7765 2064 6f20 6e6f        # we do no
-0001cbe0: 7420 7761 6e74 2074 6f20 636f 756e 7420  t want to count 
-0001cbf0: 6974 6572 6174 696f 6e73 2077 6974 686f  iterations witho
-0001cc00: 7574 2077 6f72 6b0a 2020 2020 2020 2020  ut work.        
-0001cc10: 2020 2020 2020 2020 2020 2020 2320 6f74              # ot
-0001cc20: 6865 7277 6973 6520 6566 6669 6369 656e  herwise efficien
-0001cc30: 6379 2062 6563 6f6d 6573 203e 2031 0a20  cy becomes > 1. 
-0001cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc50: 2020 2069 745f 6174 5f66 6972 7374 5f72     it_at_first_r
-0001cc60: 6567 696f 6e20 2b3d 2031 0a0a 2020 2020  egion += 1..    
-0001cc70: 2020 2020 2020 2020 2020 2020 7361 7665              save
-0001cc80: 645f 6e6f 6465 6964 732e 6170 7065 6e64  d_nodeids.append
-0001cc90: 286e 6f64 652e 6964 290a 2020 2020 2020  (node.id).      
-0001cca0: 2020 2020 2020 2020 2020 7361 7665 645f            saved_
-0001ccb0: 6c6f 676c 2e61 7070 656e 6428 4c6d 696e  logl.append(Lmin
-0001ccc0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001ccd0: 2020 2023 2069 6e66 6f72 6d20 6974 6572     # inform iter
-0001cce0: 6174 6f72 7320 2869 6620 6974 2069 7320  ators (if it is 
-0001ccf0: 7468 6569 7220 6275 7369 6e65 7373 2920  their business) 
-0001cd00: 6162 6f75 7420 7468 6520 6172 630a 2020  about the arc.  
-0001cd10: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0001cd20: 696e 5f69 7465 7261 746f 722e 7061 7373  in_iterator.pass
-0001cd30: 696e 675f 6e6f 6465 2872 6f6f 7469 642c  ing_node(rootid,
-0001cd40: 206e 6f64 652c 2061 6374 6976 655f 726f   node, active_ro
-0001cd50: 6f74 6964 732c 2061 6374 6976 655f 7661  otids, active_va
-0001cd60: 6c75 6573 290a 2020 2020 2020 2020 2020  lues).          
-0001cd70: 2020 2020 2020 6966 206c 656e 286e 6f64        if len(nod
-0001cd80: 652e 6368 696c 6472 656e 2920 3d3d 2030  e.children) == 0
-0001cd90: 2061 6e64 2073 656c 662e 7265 6769 6f6e   and self.region
-0001cda0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0001cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdc0: 2020 2320 7468 6520 7265 6769 6f6e 2072    # the region r
-0001cdd0: 6164 6975 7320 6e65 6564 7320 746f 2069  adius needs to i
-0001cde0: 6e63 7265 6173 6520 6966 206e 6c69 7665  ncrease if nlive
-0001cdf0: 2064 6563 7265 6173 6573 0a20 2020 2020   decreases.     
-0001ce00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001ce10: 2072 6164 6975 7320 6973 206e 6f74 2072   radius is not r
-0001ce20: 656c 6961 626c 652c 2073 6f20 7365 7420  eliable, so set 
-0001ce30: 746f 2069 6e66 0a20 2020 2020 2020 2020  to inf.         
-0001ce40: 2020 2020 2020 2020 2020 2023 2028 6865             # (he
-0001ce50: 7572 6973 7469 6373 2064 6f20 6e6f 7420  uristics do not 
-0001ce60: 776f 726b 2069 6e20 7072 6163 7469 6365  work in practice
-0001ce70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001ce80: 2020 2020 2020 7365 6c66 2e72 6567 696f        self.regio
-0001ce90: 6e2e 6d61 7872 6164 6975 7373 7120 3d20  n.maxradiussq = 
-0001cea0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0001ceb0: 2020 2020 2020 2020 2023 2061 736b 2066           # ask f
-0001cec0: 6f72 2074 6865 2072 6567 696f 6e20 746f  or the region to
-0001ced0: 2062 6520 7265 6275 696c 740a 2020 2020   be rebuilt.    
-0001cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cef0: 6e65 7874 5f75 7064 6174 655f 696e 7465  next_update_inte
-0001cf00: 7276 616c 5f76 6f6c 756d 6520 3d20 310a  rval_volume = 1.
-0001cf10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cf20: 2069 7420 2b3d 2031 0a20 2020 2020 2020   it += 1.       
-0001cf30: 2020 2020 2020 2020 2065 7870 6c6f 7265           explore
-0001cf40: 722e 6578 7061 6e64 5f63 6869 6c64 7265  r.expand_childre
-0001cf50: 6e5f 6f66 2872 6f6f 7469 642c 206e 6f64  n_of(rootid, nod
-0001cf60: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
-0001cf70: 6966 2073 656c 662e 6c6f 673a 0a20 2020  if self.log:.   
-0001cf80: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001cf90: 662e 6c6f 6767 6572 2e69 6e66 6f28 2245  f.logger.info("E
-0001cfa0: 7870 6c6f 7265 6420 756e 7469 6c20 4c3d  xplored until L=
-0001cfb0: 252e 3167 2020 222c 206e 6f64 652e 7661  %.1g  ", node.va
-0001cfc0: 6c75 6529 0a20 2020 2020 2020 2020 2020  lue).           
-0001cfd0: 2023 2070 7269 6e74 5f74 7265 6528 726f   # print_tree(ro
-0001cfe0: 6f74 735b 3a3a 3130 5d29 0a0a 2020 2020  ots[::10])..    
-0001cff0: 2020 2020 2020 2020 7365 6c66 2e70 6f69          self.poi
-0001d000: 6e74 7374 6f72 652e 666c 7573 6828 290a  ntstore.flush().
-0001d010: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001d020: 2e5f 7570 6461 7465 5f72 6573 756c 7473  ._update_results
-0001d030: 286d 6169 6e5f 6974 6572 6174 6f72 2c20  (main_iterator, 
-0001d040: 7361 7665 645f 6c6f 676c 2c20 7361 7665  saved_logl, save
-0001d050: 645f 6e6f 6465 6964 7329 0a20 2020 2020  d_nodeids).     
-0001d060: 2020 2020 2020 2079 6965 6c64 2073 656c         yield sel
-0001d070: 662e 7265 7375 6c74 730a 0a20 2020 2020  f.results..     
-0001d080: 2020 2020 2020 2069 6620 6d61 785f 6e63         if max_nc
-0001d090: 616c 6c73 2069 7320 6e6f 7420 4e6f 6e65  alls is not None
-0001d0a0: 2061 6e64 2073 656c 662e 6e63 616c 6c20   and self.ncall 
-0001d0b0: 3e3d 206d 6178 5f6e 6361 6c6c 733a 0a20  >= max_ncalls:. 
-0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d0d0: 6620 7365 6c66 2e6c 6f67 3a0a 2020 2020  f self.log:.    
-0001d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0f0: 7365 6c66 2e6c 6f67 6765 722e 696e 666f  self.logger.info
-0001d100: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001d110: 2020 2020 2020 2020 2020 2752 6561 6368            'Reach
-0001d120: 6564 206d 6178 696d 756d 206e 756d 6265  ed maximum numbe
-0001d130: 7220 6f66 206c 696b 656c 6968 6f6f 6420  r of likelihood 
-0001d140: 6361 6c6c 7320 2825 6420 3e20 2564 292e  calls (%d > %d).
-0001d150: 2e2e 272c 0a20 2020 2020 2020 2020 2020  ..',.           
-0001d160: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001d170: 662e 6e63 616c 6c2c 206d 6178 5f6e 6361  f.ncall, max_nca
-0001d180: 6c6c 7329 0a20 2020 2020 2020 2020 2020  lls).           
-0001d190: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
-0001d1a0: 2020 2020 2020 2020 696d 7072 6f76 656d          improvem
-0001d1b0: 656e 745f 6974 202b 3d20 310a 2020 2020  ent_it += 1.    
-0001d1c0: 2020 2020 2020 2020 6966 206d 6178 5f6e          if max_n
-0001d1d0: 756d 5f69 6d70 726f 7665 6d65 6e74 5f6c  um_improvement_l
-0001d1e0: 6f6f 7073 203e 3d20 3020 616e 6420 696d  oops >= 0 and im
-0001d1f0: 7072 6f76 656d 656e 745f 6974 203e 206d  provement_it > m
-0001d200: 6178 5f6e 756d 5f69 6d70 726f 7665 6d65  ax_num_improveme
-0001d210: 6e74 5f6c 6f6f 7073 3a0a 2020 2020 2020  nt_loops:.      
-0001d220: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0001d230: 662e 6c6f 673a 0a20 2020 2020 2020 2020  f.log:.         
-0001d240: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001d250: 6c6f 6767 6572 2e69 6e66 6f28 2752 6561  logger.info('Rea
-0001d260: 6368 6564 206d 6178 696d 756d 206e 756d  ched maximum num
-0001d270: 6265 7220 6f66 2069 6d70 726f 7665 6d65  ber of improveme
-0001d280: 6e74 206c 6f6f 7073 2e27 290a 2020 2020  nt loops.').    
-0001d290: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0001d2a0: 6b0a 0a20 2020 2020 2020 2020 2020 2069  k..            i
-0001d2b0: 6620 6e63 616c 6c5f 6174 5f72 756e 5f73  f ncall_at_run_s
-0001d2c0: 7461 7274 203d 3d20 7365 6c66 2e6e 6361  tart == self.nca
-0001d2d0: 6c6c 2061 6e64 2069 6d70 726f 7665 6d65  ll and improveme
-0001d2e0: 6e74 5f69 7420 3e20 313a 0a20 2020 2020  nt_it > 1:.     
-0001d2f0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0001d300: 6c66 2e6c 6f67 3a0a 2020 2020 2020 2020  lf.log:.        
-0001d310: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001d320: 2e6c 6f67 6765 722e 696e 666f 280a 2020  .logger.info(.  
-0001d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d340: 2020 2020 2020 274e 6f20 6368 616e 6765        'No change
-0001d350: 7320 6d61 6465 2e20 270a 2020 2020 2020  s made. '.      
-0001d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d370: 2020 2750 726f 6261 626c 7920 7468 6520    'Probably the 
-0001d380: 7374 7261 7465 6779 2077 6173 2074 6f20  strategy was to 
-0001d390: 6578 706c 6f72 6520 696e 2074 6865 2072  explore in the r
-0001d3a0: 656d 6169 6e64 6572 2c20 270a 2020 2020  emainder, '.    
-0001d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3c0: 2020 2020 2762 7574 2069 7420 6973 2069      'but it is i
-0001d3d0: 7272 656c 6576 616e 7420 616c 7265 6164  rrelevant alread
-0001d3e0: 793b 2074 7279 2064 6563 7265 6173 696e  y; try decreasin
-0001d3f0: 6720 6672 6163 5f72 656d 6169 6e2e 2729  g frac_remain.')
-0001d400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d410: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
-0001d420: 2020 2020 4c6d 6178 203d 206d 6169 6e5f      Lmax = main_
-0001d430: 6974 6572 6174 6f72 2e4c 6d61 780a 2020  iterator.Lmax.  
-0001d440: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0001d450: 2872 6567 696f 6e5f 7365 7175 656e 6365  (region_sequence
-0001d460: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-0001d470: 2020 2020 2020 204c 6d69 6e2c 206e 6c69         Lmin, nli
-0001d480: 7665 2c20 6e63 6c75 7374 6572 732c 204c  ve, nclusters, L
-0001d490: 6869 203d 2072 6567 696f 6e5f 7365 7175  hi = region_sequ
-0001d4a0: 656e 6365 5b2d 315d 0a20 2020 2020 2020  ence[-1].       
-0001d4b0: 2020 2020 2020 2020 206e 6e6f 6465 735f           nnodes_
-0001d4c0: 6e65 6564 6564 203d 2063 6c75 7374 6572  needed = cluster
-0001d4d0: 5f6e 756d 5f6c 6976 655f 706f 696e 7473  _num_live_points
-0001d4e0: 202a 206e 636c 7573 7465 7273 0a20 2020   * nclusters.   
-0001d4f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001d500: 6e6c 6976 6520 3c20 6e6e 6f64 6573 5f6e  nlive < nnodes_n
-0001d510: 6565 6465 643a 0a20 2020 2020 2020 2020  eeded:.         
-0001d520: 2020 2020 2020 2020 2020 204c 6c6f 2c20             Llo, 
-0001d530: 5f2c 2074 6172 6765 745f 6d69 6e5f 6e75  _, target_min_nu
-0001d540: 6d5f 6368 696c 6472 656e 5f6e 6577 203d  m_children_new =
-0001d550: 2073 656c 662e 5f65 7870 616e 645f 6e6f   self._expand_no
-0001d560: 6465 735f 6265 666f 7265 284c 6d69 6e2c  des_before(Lmin,
-0001d570: 206e 6e6f 6465 735f 6e65 6564 6564 2c20   nnodes_needed, 
-0001d580: 7570 6461 7465 5f69 6e74 6572 7661 6c5f  update_interval_
-0001d590: 6e63 616c 6c20 6f72 206e 6c69 7665 290a  ncall or nlive).
-0001d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5b0: 2020 2020 7461 7267 6574 5f6d 696e 5f6e      target_min_n
-0001d5c0: 756d 5f63 6869 6c64 7265 6e2e 7570 6461  um_children.upda
-0001d5d0: 7465 2874 6172 6765 745f 6d69 6e5f 6e75  te(target_min_nu
-0001d5e0: 6d5f 6368 696c 6472 656e 5f6e 6577 290a  m_children_new).
-0001d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d600: 2020 2020 2320 6966 2073 656c 662e 6c6f      # if self.lo
-0001d610: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
-0001d620: 2020 2020 2020 2023 2020 2020 2070 7269         #     pri
-0001d630: 6e74 5f74 7265 6528 7365 6c66 2e72 6f6f  nt_tree(self.roo
-0001d640: 742e 6368 696c 6472 656e 5b3a 3a31 305d  t.children[::10]
-0001d650: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d660: 2020 2020 2020 6d69 6e69 6d61 6c5f 7769        minimal_wi
-0001d670: 6474 6873 2e61 7070 656e 6428 284c 6c6f  dths.append((Llo
-0001d680: 2c20 4c68 692c 206e 6e6f 6465 735f 6e65  , Lhi, nnodes_ne
-0001d690: 6564 6564 2929 0a20 2020 2020 2020 2020  eded)).         
-0001d6a0: 2020 2020 2020 2020 2020 204c 6c6f 2c20             Llo, 
-0001d6b0: 4c68 6920 3d20 2d6e 702e 696e 662c 206e  Lhi = -np.inf, n
-0001d6c0: 702e 696e 660a 2020 2020 2020 2020 2020  p.inf.          
-0001d6d0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001d6e0: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
-0001d6f0: 6966 2073 656c 662e 6c6f 673a 0a20 2020  if self.log:.   
-0001d700: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0001d710: 656c 662e 6c6f 6767 6572 2e69 6e66 6f28  elf.logger.info(
-0001d720: 2720 206c 6f67 5a20 3d20 252e 3466 202b  '  logZ = %.4f +
-0001d730: 2d20 252e 3466 2028 6d61 696e 2927 2025  - %.4f (main)' %
-0001d740: 2028 6d61 696e 5f69 7465 7261 746f 722e   (main_iterator.
-0001d750: 6c6f 675a 2c20 6d61 696e 5f69 7465 7261  logZ, main_itera
-0001d760: 746f 722e 6c6f 675a 6572 7229 290a 2020  tor.logZerr)).  
-0001d770: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001d780: 6c66 2e6c 6f67 6765 722e 696e 666f 2827  lf.logger.info('
-0001d790: 2020 6c6f 675a 203d 2025 2e34 6720 2b2d    logZ = %.4g +-
-0001d7a0: 2025 2e34 6727 2c20 6d61 696e 5f69 7465   %.4g', main_ite
-0001d7b0: 7261 746f 722e 6c6f 675a 5f62 732c 206d  rator.logZ_bs, m
-0001d7c0: 6169 6e5f 6974 6572 6174 6f72 2e6c 6f67  ain_iterator.log
-0001d7d0: 5a65 7272 5f62 7329 0a0a 2020 2020 2020  Zerr_bs)..      
-0001d7e0: 2020 2020 2020 7361 7665 645f 6c6f 676c        saved_logl
-0001d7f0: 203d 206e 702e 6173 6172 7261 7928 7361   = np.asarray(sa
-0001d800: 7665 645f 6c6f 676c 290a 2020 2020 2020  ved_logl).      
-0001d810: 2020 2020 2020 2320 7265 6163 7469 7665        # reactive
-0001d820: 206e 6573 7465 6420 7361 6d70 6c69 6e67   nested sampling
-0001d830: 3a20 7365 6520 7768 6572 6520 7765 2068  : see where we h
-0001d840: 6176 6520 746f 2069 6d70 726f 7665 0a20  ave to improve. 
-0001d850: 2020 2020 2020 2020 2020 2064 6c6f 677a             dlogz
-0001d860: 5f6d 696e 5f6e 756d 5f6c 6976 655f 706f  _min_num_live_po
-0001d870: 696e 7473 2c20 284c 6c6f 5f4b 4c2c 204c  ints, (Llo_KL, L
-0001d880: 6869 5f4b 4c29 2c20 284c 6c6f 5f65 7373  hi_KL), (Llo_ess
-0001d890: 2c20 4c68 695f 6573 7329 203d 2073 656c  , Lhi_ess) = sel
-0001d8a0: 662e 5f66 696e 645f 7374 7261 7465 6779  f._find_strategy
-0001d8b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001d8c0: 2020 7361 7665 645f 6c6f 676c 2c20 6d61    saved_logl, ma
-0001d8d0: 696e 5f69 7465 7261 746f 722c 2064 6c6f  in_iterator, dlo
-0001d8e0: 677a 3d64 6c6f 677a 2c20 644b 4c3d 644b  gz=dlogz, dKL=dK
-0001d8f0: 4c2c 206d 696e 5f65 7373 3d6d 696e 5f65  L, min_ess=min_e
-0001d900: 7373 290a 2020 2020 2020 2020 2020 2020  ss).            
-0001d910: 4c6c 6f20 3d20 6d69 6e28 4c6c 6f5f 6573  Llo = min(Llo_es
-0001d920: 732c 204c 6c6f 5f4b 4c29 0a20 2020 2020  s, Llo_KL).     
-0001d930: 2020 2020 2020 204c 6869 203d 206d 6178         Lhi = max
-0001d940: 284c 6869 5f65 7373 2c20 4c68 695f 4b4c  (Lhi_ess, Lhi_KL
-0001d950: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0001d960: 746f 2061 766f 6964 206e 756d 6572 6963  to avoid numeric
-0001d970: 616c 2069 7373 7565 7320 7768 656e 2061  al issues when a
-0001d980: 6c6c 206c 696b 656c 6968 6f6f 6420 7661  ll likelihood va
-0001d990: 6c75 6573 2061 7265 2074 6865 2073 616d  lues are the sam
-0001d9a0: 650a 2020 2020 2020 2020 2020 2020 4c68  e.            Lh
-0001d9b0: 6920 3d20 6d69 6e28 4c68 692c 2073 6176  i = min(Lhi, sav
-0001d9c0: 6564 5f6c 6f67 6c2e 6d61 7828 2920 2d20  ed_logl.max() - 
-0001d9d0: 302e 3030 3129 0a0a 2020 2020 2020 2020  0.001)..        
-0001d9e0: 2020 2020 6966 2073 656c 662e 7573 655f      if self.use_
-0001d9f0: 6d70 693a 0a20 2020 2020 2020 2020 2020  mpi:.           
-0001da00: 2020 2020 2072 6563 765f 4c6c 6f20 3d20       recv_Llo = 
-0001da10: 7365 6c66 2e63 6f6d 6d2e 6761 7468 6572  self.comm.gather
-0001da20: 284c 6c6f 2c20 726f 6f74 3d30 290a 2020  (Llo, root=0).  
-0001da30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0001da40: 6376 5f4c 6c6f 203d 2073 656c 662e 636f  cv_Llo = self.co
-0001da50: 6d6d 2e62 6361 7374 2872 6563 765f 4c6c  mm.bcast(recv_Ll
-0001da60: 6f2c 2072 6f6f 743d 3029 0a20 2020 2020  o, root=0).     
-0001da70: 2020 2020 2020 2020 2020 2072 6563 765f             recv_
-0001da80: 4c68 6920 3d20 7365 6c66 2e63 6f6d 6d2e  Lhi = self.comm.
-0001da90: 6761 7468 6572 284c 6869 2c20 726f 6f74  gather(Lhi, root
-0001daa0: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
-0001dab0: 2020 2020 7265 6376 5f4c 6869 203d 2073      recv_Lhi = s
-0001dac0: 656c 662e 636f 6d6d 2e62 6361 7374 2872  elf.comm.bcast(r
-0001dad0: 6563 765f 4c68 692c 2072 6f6f 743d 3029  ecv_Lhi, root=0)
-0001dae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001daf0: 2072 6563 765f 646c 6f67 7a5f 6d69 6e5f   recv_dlogz_min_
-0001db00: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7320  num_live_points 
-0001db10: 3d20 7365 6c66 2e63 6f6d 6d2e 6761 7468  = self.comm.gath
-0001db20: 6572 2864 6c6f 677a 5f6d 696e 5f6e 756d  er(dlogz_min_num
-0001db30: 5f6c 6976 655f 706f 696e 7473 2c20 726f  _live_points, ro
-0001db40: 6f74 3d30 290a 2020 2020 2020 2020 2020  ot=0).          
-0001db50: 2020 2020 2020 7265 6376 5f64 6c6f 677a        recv_dlogz
-0001db60: 5f6d 696e 5f6e 756d 5f6c 6976 655f 706f  _min_num_live_po
-0001db70: 696e 7473 203d 2073 656c 662e 636f 6d6d  ints = self.comm
-0001db80: 2e62 6361 7374 2872 6563 765f 646c 6f67  .bcast(recv_dlog
-0001db90: 7a5f 6d69 6e5f 6e75 6d5f 6c69 7665 5f70  z_min_num_live_p
-0001dba0: 6f69 6e74 732c 2072 6f6f 743d 3029 0a0a  oints, root=0)..
-0001dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbc0: 4c6c 6f20 3d20 6d69 6e28 7265 6376 5f4c  Llo = min(recv_L
-0001dbd0: 6c6f 290a 2020 2020 2020 2020 2020 2020  lo).            
-0001dbe0: 2020 2020 4c68 6920 3d20 6d61 7828 7265      Lhi = max(re
-0001dbf0: 6376 5f4c 6869 290a 2020 2020 2020 2020  cv_Lhi).        
-0001dc00: 2020 2020 2020 2020 646c 6f67 7a5f 6d69          dlogz_mi
-0001dc10: 6e5f 6e75 6d5f 6c69 7665 5f70 6f69 6e74  n_num_live_point
-0001dc20: 7320 3d20 6d61 7828 7265 6376 5f64 6c6f  s = max(recv_dlo
-0001dc30: 677a 5f6d 696e 5f6e 756d 5f6c 6976 655f  gz_min_num_live_
-0001dc40: 706f 696e 7473 290a 0a20 2020 2020 2020  points)..       
-0001dc50: 2020 2020 2069 6620 646c 6f67 7a5f 6d69       if dlogz_mi
-0001dc60: 6e5f 6e75 6d5f 6c69 7665 5f70 6f69 6e74  n_num_live_point
-0001dc70: 7320 3e20 7365 6c66 2e6d 696e 5f6e 756d  s > self.min_num
-0001dc80: 5f6c 6976 655f 706f 696e 7473 3a0a 2020  _live_points:.  
-0001dc90: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001dca0: 6d6f 7265 206c 6976 6520 706f 696e 7473  more live points
-0001dcb0: 206e 6565 6465 6420 7468 726f 7567 686f   needed througho
-0001dcc0: 7574 2074 6f20 7265 6163 6820 7461 7267  ut to reach targ
-0001dcd0: 6574 0a20 2020 2020 2020 2020 2020 2020  et.             
-0001dce0: 2020 2073 656c 662e 6d69 6e5f 6e75 6d5f     self.min_num_
-0001dcf0: 6c69 7665 5f70 6f69 6e74 7320 3d20 646c  live_points = dl
-0001dd00: 6f67 7a5f 6d69 6e5f 6e75 6d5f 6c69 7665  ogz_min_num_live
-0001dd10: 5f70 6f69 6e74 730a 2020 2020 2020 2020  _points.        
-0001dd20: 2020 2020 2020 2020 7365 6c66 2e5f 7769          self._wi
-0001dd30: 6465 6e5f 726f 6f74 735f 6265 796f 6e64  den_roots_beyond
-0001dd40: 5f69 6e69 7469 616c 5f70 6c61 7465 6175  _initial_plateau
-0001dd50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001dd60: 2020 2020 2020 7365 6c66 2e6d 696e 5f6e        self.min_n
-0001dd70: 756d 5f6c 6976 655f 706f 696e 7473 2c0a  um_live_points,.
-0001dd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd90: 2020 2020 7769 6465 6e5f 6265 666f 7265      widen_before
-0001dda0: 5f69 6e69 7469 616c 5f70 6c61 7465 6175  _initial_plateau
-0001ddb0: 5f6e 756d 5f77 6172 6e2c 0a20 2020 2020  _num_warn,.     
-0001ddc0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001ddd0: 6964 656e 5f62 6566 6f72 655f 696e 6974  iden_before_init
-0001dde0: 6961 6c5f 706c 6174 6561 755f 6e75 6d5f  ial_plateau_num_
-0001ddf0: 6d61 7829 0a0a 2020 2020 2020 2020 2020  max)..          
-0001de00: 2020 656c 6966 204c 6c6f 203c 3d20 4c68    elif Llo <= Lh
-0001de10: 693a 0a20 2020 2020 2020 2020 2020 2020  i:.             
-0001de20: 2020 2023 2069 6620 7365 6c66 2e6c 6f67     # if self.log
-0001de30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001de40: 2020 2320 2020 2020 7072 696e 745f 7472    #     print_tr
-0001de50: 6565 2872 6f6f 7473 2c20 7469 746c 653d  ee(roots, title=
-0001de60: 2254 7265 6520 6265 666f 7265 2066 6f72  "Tree before for
-0001de70: 6b69 6e67 3a22 290a 2020 2020 2020 2020  king:").        
-0001de80: 2020 2020 2020 2020 7061 7265 6e74 732c          parents,
-0001de90: 2070 6172 656e 745f 7765 6967 6874 7320   parent_weights 
-0001dea0: 3d20 6669 6e64 5f6e 6f64 6573 5f62 6566  = find_nodes_bef
-0001deb0: 6f72 6528 7365 6c66 2e72 6f6f 742c 204c  ore(self.root, L
-0001dec0: 6c6f 290a 2020 2020 2020 2020 2020 2020  lo).            
-0001ded0: 2020 2020 2320 646f 7562 6c65 2074 6865      # double the
-0001dee0: 2077 6964 7468 202f 206c 6976 6520 706f   width / live po
-0001def0: 696e 7473 3a0a 2020 2020 2020 2020 2020  ints:.          
-0001df00: 2020 2020 2020 5f2c 2077 6964 7468 203d        _, width =
-0001df10: 2063 6f75 6e74 5f74 7265 655f 6265 7477   count_tree_betw
-0001df20: 6565 6e28 7365 6c66 2e72 6f6f 742e 6368  een(self.root.ch
-0001df30: 696c 6472 656e 2c20 4c6c 6f2c 204c 6869  ildren, Llo, Lhi
-0001df40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001df50: 2020 6e6e 6f64 6573 5f6e 6565 6465 6420    nnodes_needed 
-0001df60: 3d20 7769 6474 6820 2a20 320a 2020 2020  = width * 2.    
-0001df70: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001df80: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
-0001df90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001dfa0: 662e 6c6f 6767 6572 2e69 6e66 6f28 0a20  f.logger.info(. 
-0001dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfc0: 2020 2020 2020 2027 5769 6465 6e69 6e67         'Widening
-0001dfd0: 2066 726f 6d20 2564 2074 6f20 2564 206c   from %d to %d l
-0001dfe0: 6976 6520 706f 696e 7473 2062 6566 6f72  ive points befor
-0001dff0: 6520 4c3d 252e 3167 2e2e 2e27 2c0a 2020  e L=%.1g...',.  
-0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e010: 2020 2020 2020 6c65 6e28 7061 7265 6e74        len(parent
-0001e020: 7329 2c20 6e6e 6f64 6573 5f6e 6565 6465  s), nnodes_neede
-0001e030: 642c 204c 6c6f 290a 0a20 2020 2020 2020  d, Llo)..       
-0001e040: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0001e050: 7061 7265 6e74 7329 203d 3d20 303a 0a20  parents) == 0:. 
-0001e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e070: 2020 204c 6c6f 203d 202d 6e70 2e69 6e66     Llo = -np.inf
-0001e080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e090: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001e0a0: 2020 2020 2020 2020 2020 204c 6c6f 203d             Llo =
-0001e0b0: 206d 696e 286e 2e76 616c 7565 2066 6f72   min(n.value for
-0001e0c0: 206e 2069 6e20 7061 7265 6e74 7329 0a20   n in parents). 
-0001e0d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001e0e0: 656c 662e 706f 696e 7473 746f 7265 2e72  elf.pointstore.r
-0001e0f0: 6573 6574 2829 0a20 2020 2020 2020 2020  eset().         
-0001e100: 2020 2020 2020 2074 6172 6765 745f 6d69         target_mi
-0001e110: 6e5f 6e75 6d5f 6368 696c 6472 656e 2e75  n_num_children.u
-0001e120: 7064 6174 6528 7365 6c66 2e5f 7769 6465  pdate(self._wide
-0001e130: 6e5f 6e6f 6465 7328 7061 7265 6e74 732c  n_nodes(parents,
-0001e140: 2070 6172 656e 745f 7765 6967 6874 732c   parent_weights,
-0001e150: 206e 6e6f 6465 735f 6e65 6564 6564 2c20   nnodes_needed, 
-0001e160: 7570 6461 7465 5f69 6e74 6572 7661 6c5f  update_interval_
-0001e170: 6e63 616c 6c29 290a 2020 2020 2020 2020  ncall)).        
-0001e180: 2020 2020 2020 2020 6d69 6e69 6d61 6c5f          minimal_
-0001e190: 7769 6474 6873 2e61 7070 656e 6428 284c  widths.append((L
-0001e1a0: 6c6f 2c20 4c68 692c 206e 6e6f 6465 735f  lo, Lhi, nnodes_
-0001e1b0: 6e65 6564 6564 2929 0a20 2020 2020 2020  needed)).       
-0001e1c0: 2020 2020 2020 2020 2023 2069 6620 7365           # if se
-0001e1d0: 6c66 2e6c 6f67 3a0a 2020 2020 2020 2020  lf.log:.        
-0001e1e0: 2020 2020 2020 2020 2320 2020 2020 7072          #     pr
-0001e1f0: 696e 745f 7472 6565 2872 6f6f 7473 2c20  int_tree(roots, 
-0001e200: 7469 746c 653d 2254 7265 6520 6166 7465  title="Tree afte
-0001e210: 7220 666f 726b 696e 673a 2229 0a20 2020  r forking:").   
-0001e220: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-0001e230: 7269 6e74 2827 7472 6565 2073 697a 653a  rint('tree size:
-0001e240: 272c 2063 6f75 6e74 5f74 7265 6528 726f  ', count_tree(ro
-0001e250: 6f74 7329 290a 2020 2020 2020 2020 2020  ots)).          
-0001e260: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001e270: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
-0001e280: 2020 2064 6566 205f 7570 6461 7465 5f72     def _update_r
-0001e290: 6573 756c 7473 2873 656c 662c 206d 6169  esults(self, mai
-0001e2a0: 6e5f 6974 6572 6174 6f72 2c20 7361 7665  n_iterator, save
-0001e2b0: 645f 6c6f 676c 2c20 7361 7665 645f 6e6f  d_logl, saved_no
-0001e2c0: 6465 6964 7329 3a0a 2020 2020 2020 2020  deids):.        
-0001e2d0: 6966 2073 656c 662e 6c6f 673a 0a20 2020  if self.log:.   
-0001e2e0: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-0001e2f0: 6767 6572 2e69 6e66 6f28 274c 696b 656c  gger.info('Likel
-0001e300: 6968 6f6f 6420 6675 6e63 7469 6f6e 2065  ihood function e
-0001e310: 7661 6c75 6174 696f 6e73 3a20 2564 272c  valuations: %d',
-0001e320: 2073 656c 662e 6e63 616c 6c29 0a0a 2020   self.ncall)..  
-0001e330: 2020 2020 2020 7265 7375 6c74 7320 3d20        results = 
-0001e340: 636f 6d62 696e 655f 7265 7375 6c74 7328  combine_results(
-0001e350: 0a20 2020 2020 2020 2020 2020 2073 6176  .            sav
-0001e360: 6564 5f6c 6f67 6c2c 2073 6176 6564 5f6e  ed_logl, saved_n
-0001e370: 6f64 6569 6473 2c20 7365 6c66 2e70 6f69  odeids, self.poi
-0001e380: 6e74 7069 6c65 2c0a 2020 2020 2020 2020  ntpile,.        
-0001e390: 2020 2020 6d61 696e 5f69 7465 7261 746f      main_iterato
-0001e3a0: 722c 206d 7069 5f63 6f6d 6d3d 7365 6c66  r, mpi_comm=self
-0001e3b0: 2e63 6f6d 6d20 6966 2073 656c 662e 7573  .comm if self.us
-0001e3c0: 655f 6d70 6920 656c 7365 204e 6f6e 6529  e_mpi else None)
-0001e3d0: 0a0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-0001e3e0: 735b 276e 6361 6c6c 275d 203d 2069 6e74  s['ncall'] = int
-0001e3f0: 2873 656c 662e 6e63 616c 6c29 0a20 2020  (self.ncall).   
-0001e400: 2020 2020 2072 6573 756c 7473 5b27 7061       results['pa
-0001e410: 7261 6d6e 616d 6573 275d 203d 2073 656c  ramnames'] = sel
-0001e420: 662e 7061 7261 6d6e 616d 6573 202b 2073  f.paramnames + s
-0001e430: 656c 662e 6465 7269 7665 6470 6172 616d  elf.derivedparam
-0001e440: 6e61 6d65 730a 2020 2020 2020 2020 7265  names.        re
-0001e450: 7375 6c74 735b 276c 6f67 7a65 7272 5f73  sults['logzerr_s
-0001e460: 696e 676c 6527 5d20 3d20 286d 6169 6e5f  ingle'] = (main_
-0001e470: 6974 6572 6174 6f72 2e61 6c6c 5f48 5b30  iterator.all_H[0
-0001e480: 5d20 2f20 7365 6c66 2e6d 696e 5f6e 756d  ] / self.min_num
-0001e490: 5f6c 6976 655f 706f 696e 7473 292a 2a30  _live_points)**0
-0001e4a0: 2e35 0a0a 2020 2020 2020 2020 7365 7175  .5..        sequ
-0001e4b0: 656e 6365 2c20 7265 7375 6c74 7332 203d  ence, results2 =
-0001e4c0: 206c 6f67 7a5f 7365 7175 656e 6365 2873   logz_sequence(s
-0001e4d0: 656c 662e 726f 6f74 2c20 7365 6c66 2e70  elf.root, self.p
-0001e4e0: 6f69 6e74 7069 6c65 2c20 7261 6e64 6f6d  ointpile, random
-0001e4f0: 3d54 7275 652c 2063 6865 636b 5f69 6e73  =True, check_ins
-0001e500: 6572 7469 6f6e 5f6f 7264 6572 3d54 7275  ertion_order=Tru
-0001e510: 6529 0a20 2020 2020 2020 2072 6573 756c  e).        resul
-0001e520: 7473 5b27 696e 7365 7274 696f 6e5f 6f72  ts['insertion_or
-0001e530: 6465 725f 4d57 575f 7465 7374 275d 203d  der_MWW_test'] =
-0001e540: 2072 6573 756c 7473 325b 2769 6e73 6572   results2['inser
-0001e550: 7469 6f6e 5f6f 7264 6572 5f4d 5757 5f74  tion_order_MWW_t
-0001e560: 6573 7427 5d0a 0a20 2020 2020 2020 2072  est']..        r
-0001e570: 6573 756c 7473 5f73 696d 706c 6520 3d20  esults_simple = 
-0001e580: 6469 6374 2872 6573 756c 7473 290a 2020  dict(results).  
-0001e590: 2020 2020 2020 7765 6967 6874 6564 5f73        weighted_s
-0001e5a0: 616d 706c 6573 203d 2072 6573 756c 7473  amples = results
-0001e5b0: 5f73 696d 706c 652e 706f 7028 2777 6569  _simple.pop('wei
-0001e5c0: 6768 7465 645f 7361 6d70 6c65 7327 290a  ghted_samples').
-0001e5d0: 2020 2020 2020 2020 7361 6d70 6c65 7320          samples 
-0001e5e0: 3d20 7265 7375 6c74 735f 7369 6d70 6c65  = results_simple
-0001e5f0: 2e70 6f70 2827 7361 6d70 6c65 7327 290a  .pop('samples').
-0001e600: 2020 2020 2020 2020 7361 7665 645f 7774          saved_wt
-0001e610: 3020 3d20 7765 6967 6874 6564 5f73 616d  0 = weighted_sam
-0001e620: 706c 6573 5b27 7765 6967 6874 7327 5d0a  ples['weights'].
-0001e630: 2020 2020 2020 2020 7361 7665 645f 7520          saved_u 
-0001e640: 3d20 7765 6967 6874 6564 5f73 616d 706c  = weighted_sampl
-0001e650: 6573 5b27 7570 6f69 6e74 7327 5d0a 2020  es['upoints'].  
-0001e660: 2020 2020 2020 7361 7665 645f 7620 3d20        saved_v = 
-0001e670: 7765 6967 6874 6564 5f73 616d 706c 6573  weighted_samples
-0001e680: 5b27 706f 696e 7473 275d 0a0a 2020 2020  ['points']..    
-0001e690: 2020 2020 6966 2073 656c 662e 6c6f 675f      if self.log_
-0001e6a0: 746f 5f64 6973 6b3a 0a20 2020 2020 2020  to_disk:.       
-0001e6b0: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
-0001e6c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001e6d0: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
-0001e6e0: 666f 2822 5772 6974 696e 6720 7361 6d70  fo("Writing samp
-0001e6f0: 6c65 7320 616e 6420 7265 7375 6c74 7320  les and results 
-0001e700: 746f 2064 6973 6b20 2e2e 2e22 290a 2020  to disk ...").  
-0001e710: 2020 2020 2020 2020 2020 6e70 2e73 6176            np.sav
-0001e720: 6574 7874 286f 732e 7061 7468 2e6a 6f69  etxt(os.path.joi
-0001e730: 6e28 7365 6c66 2e6c 6f67 735b 2763 6861  n(self.logs['cha
-0001e740: 696e 7327 5d2c 2027 6571 7561 6c5f 7765  ins'], 'equal_we
-0001e750: 6967 6874 6564 5f70 6f73 742e 7478 7427  ighted_post.txt'
-0001e760: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001e770: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
-0001e780: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001e790: 2020 2020 2020 2020 2020 6865 6164 6572            header
-0001e7a0: 3d27 2027 2e6a 6f69 6e28 7365 6c66 2e70  =' '.join(self.p
-0001e7b0: 6172 616d 6e61 6d65 7320 2b20 7365 6c66  aramnames + self
-0001e7c0: 2e64 6572 6976 6564 7061 7261 6d6e 616d  .derivedparamnam
-0001e7d0: 6573 292c 0a20 2020 2020 2020 2020 2020  es),.           
-0001e7e0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
-0001e7f0: 656e 7473 3d27 2729 0a20 2020 2020 2020  ents='').       
-0001e800: 2020 2020 206e 702e 7361 7665 7478 7428       np.savetxt(
-0001e810: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
-0001e820: 662e 6c6f 6773 5b27 6368 6169 6e73 275d  f.logs['chains']
-0001e830: 2c20 2777 6569 6768 7465 645f 706f 7374  , 'weighted_post
-0001e840: 2e74 7874 2729 2c0a 2020 2020 2020 2020  .txt'),.        
-0001e850: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001e860: 702e 6873 7461 636b 2828 7361 7665 645f  p.hstack((saved_
-0001e870: 7774 302e 7265 7368 6170 6528 282d 312c  wt0.reshape((-1,
-0001e880: 2031 2929 2c20 6e70 2e72 6573 6861 7065   1)), np.reshape
-0001e890: 2873 6176 6564 5f6c 6f67 6c2c 2028 2d31  (saved_logl, (-1
-0001e8a0: 2c20 3129 292c 2073 6176 6564 5f76 2929  , 1)), saved_v))
-0001e8b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001e8c0: 2020 2020 2020 2020 2068 6561 6465 723d           header=
-0001e8d0: 2720 272e 6a6f 696e 285b 2777 6569 6768  ' '.join(['weigh
-0001e8e0: 7427 2c20 276c 6f67 6c27 5d20 2b20 7365  t', 'logl'] + se
-0001e8f0: 6c66 2e70 6172 616d 6e61 6d65 7320 2b20  lf.paramnames + 
-0001e900: 7365 6c66 2e64 6572 6976 6564 7061 7261  self.derivedpara
-0001e910: 6d6e 616d 6573 292c 0a20 2020 2020 2020  mnames),.       
-0001e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e930: 636f 6d6d 656e 7473 3d27 2729 0a20 2020  comments='').   
-0001e940: 2020 2020 2020 2020 206e 702e 7361 7665           np.save
-0001e950: 7478 7428 6f73 2e70 6174 682e 6a6f 696e  txt(os.path.join
-0001e960: 2873 656c 662e 6c6f 6773 5b27 6368 6169  (self.logs['chai
-0001e970: 6e73 275d 2c20 2777 6569 6768 7465 645f  ns'], 'weighted_
-0001e980: 706f 7374 5f75 6e74 7261 6e73 666f 726d  post_untransform
-0001e990: 6564 2e74 7874 2729 2c0a 2020 2020 2020  ed.txt'),.      
-0001e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e9b0: 206e 702e 6873 7461 636b 2828 7361 7665   np.hstack((save
-0001e9c0: 645f 7774 302e 7265 7368 6170 6528 282d  d_wt0.reshape((-
-0001e9d0: 312c 2031 2929 2c20 6e70 2e72 6573 6861  1, 1)), np.resha
-0001e9e0: 7065 2873 6176 6564 5f6c 6f67 6c2c 2028  pe(saved_logl, (
-0001e9f0: 2d31 2c20 3129 292c 2073 6176 6564 5f75  -1, 1)), saved_u
-0001ea00: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-0001ea10: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-0001ea20: 723d 2720 272e 6a6f 696e 285b 2777 6569  r=' '.join(['wei
-0001ea30: 6768 7427 2c20 276c 6f67 6c27 5d20 2b20  ght', 'logl'] + 
-0001ea40: 7365 6c66 2e70 6172 616d 6e61 6d65 7320  self.paramnames 
-0001ea50: 2b20 7365 6c66 2e64 6572 6976 6564 7061  + self.derivedpa
-0001ea60: 7261 6d6e 616d 6573 292c 0a20 2020 2020  ramnames),.     
-0001ea70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea80: 2020 636f 6d6d 656e 7473 3d27 2729 0a0a    comments='')..
-0001ea90: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001eaa0: 206f 7065 6e28 6f73 2e70 6174 682e 6a6f   open(os.path.jo
-0001eab0: 696e 2873 656c 662e 6c6f 6773 5b27 696e  in(self.logs['in
-0001eac0: 666f 275d 2c20 2772 6573 756c 7473 2e6a  fo'], 'results.j
-0001ead0: 736f 6e27 292c 2027 7727 2920 6173 2066  son'), 'w') as f
-0001eae0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001eaf0: 2020 6a73 6f6e 2e64 756d 7028 7265 7375    json.dump(resu
-0001eb00: 6c74 735f 7369 6d70 6c65 2c20 662c 2069  lts_simple, f, i
-0001eb10: 6e64 656e 743d 3429 0a0a 2020 2020 2020  ndent=4)..      
-0001eb20: 2020 2020 2020 6e70 2e73 6176 6574 7874        np.savetxt
-0001eb30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001eb40: 2020 6f73 2e70 6174 682e 6a6f 696e 2873    os.path.join(s
-0001eb50: 656c 662e 6c6f 6773 5b27 696e 666f 275d  elf.logs['info']
-0001eb60: 2c20 2770 6f73 745f 7375 6d6d 6172 792e  , 'post_summary.
-0001eb70: 6373 7627 292c 0a20 2020 2020 2020 2020  csv'),.         
-0001eb80: 2020 2020 2020 205b 5b72 6573 756c 7473         [[results
-0001eb90: 5b27 706f 7374 6572 696f 7227 5d5b 6b5d  ['posterior'][k]
-0001eba0: 5b69 5d20 666f 7220 6920 696e 2072 616e  [i] for i in ran
-0001ebb0: 6765 2873 656c 662e 6e75 6d5f 7061 7261  ge(self.num_para
-0001ebc0: 6d73 2920 666f 7220 6b20 696e 2028 276d  ms) for k in ('m
-0001ebd0: 6561 6e27 2c20 2773 7464 6576 272c 2027  ean', 'stdev', '
-0001ebe0: 6d65 6469 616e 272c 2027 6572 726c 6f27  median', 'errlo'
-0001ebf0: 2c20 2765 7272 7570 2729 5d5d 2c0a 2020  , 'errup')]],.  
-0001ec00: 2020 2020 2020 2020 2020 2020 2020 6865                he
-0001ec10: 6164 6572 3d27 2c27 2e6a 6f69 6e28 5b27  ader=','.join(['
-0001ec20: 227b 307d 5f6d 6561 6e22 2c22 7b30 7d5f  "{0}_mean","{0}_
-0001ec30: 7374 6465 7622 2c22 7b30 7d5f 6d65 6469  stdev","{0}_medi
-0001ec40: 616e 222c 227b 307d 5f65 7272 6c6f 222c  an","{0}_errlo",
-0001ec50: 227b 307d 5f65 7272 7570 2227 2e66 6f72  "{0}_errup"'.for
-0001ec60: 6d61 7428 6b29 0a20 2020 2020 2020 2020  mat(k).         
-0001ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec80: 2020 2020 2020 2020 666f 7220 6b20 696e          for k in
-0001ec90: 2073 656c 662e 7061 7261 6d6e 616d 6573   self.paramnames
-0001eca0: 202b 2073 656c 662e 6465 7269 7665 6470   + self.derivedp
-0001ecb0: 6172 616d 6e61 6d65 735d 292c 0a20 2020  aramnames]),.   
-0001ecc0: 2020 2020 2020 2020 2020 2020 2064 656c               del
-0001ecd0: 696d 6974 6572 3d27 2c27 2c20 636f 6d6d  imiter=',', comm
-0001ece0: 656e 7473 3d27 272c 0a20 2020 2020 2020  ents='',.       
-0001ecf0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0001ed00: 6966 2073 656c 662e 6c6f 675f 746f 5f64  if self.log_to_d
-0001ed10: 6973 6b3a 0a20 2020 2020 2020 2020 2020  isk:.           
-0001ed20: 206b 6579 7320 3d20 276c 6f67 7a27 2c20   keys = 'logz', 
-0001ed30: 276c 6f67 7a65 7272 272c 2027 6c6f 6776  'logzerr', 'logv
-0001ed40: 6f6c 272c 2027 6e6c 6976 6527 2c20 276c  ol', 'nlive', 'l
-0001ed50: 6f67 6c27 2c20 276c 6f67 7774 272c 2027  ogl', 'logwt', '
-0001ed60: 696e 7365 7274 5f6f 7264 6572 270a 2020  insert_order'.  
-0001ed70: 2020 2020 2020 2020 2020 6e70 2e73 6176            np.sav
-0001ed80: 6574 7874 286f 732e 7061 7468 2e6a 6f69  etxt(os.path.joi
-0001ed90: 6e28 7365 6c66 2e6c 6f67 735b 2763 6861  n(self.logs['cha
-0001eda0: 696e 7327 5d2c 2027 7275 6e2e 7478 7427  ins'], 'run.txt'
-0001edb0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001edc0: 2020 2020 2020 2020 2020 6e70 2e68 7374            np.hst
-0001edd0: 6163 6b28 7475 706c 6528 5b6e 702e 7265  ack(tuple([np.re
-0001ede0: 7368 6170 6528 7365 7175 656e 6365 5b6b  shape(sequence[k
-0001edf0: 5d2c 2028 2d31 2c20 3129 2920 666f 7220  ], (-1, 1)) for 
-0001ee00: 6b20 696e 206b 6579 735d 2929 2c0a 2020  k in keys])),.  
-0001ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee20: 2020 2020 2068 6561 6465 723d 2720 272e       header=' '.
-0001ee30: 6a6f 696e 286b 6579 7329 2c0a 2020 2020  join(keys),.    
-0001ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee50: 2020 2063 6f6d 6d65 6e74 733d 2727 290a     comments='').
-0001ee60: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001ee70: 656c 662e 6c6f 673a 0a20 2020 2020 2020  elf.log:.       
-0001ee80: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
-0001ee90: 6767 6572 2e69 6e66 6f28 2257 7269 7469  gger.info("Writi
-0001eea0: 6e67 2073 616d 706c 6573 2061 6e64 2072  ng samples and r
-0001eeb0: 6573 756c 7473 2074 6f20 6469 736b 202e  esults to disk .
-0001eec0: 2e2e 2064 6f6e 6522 290a 0a20 2020 2020  .. done")..     
-0001eed0: 2020 2073 656c 662e 7265 7375 6c74 7320     self.results 
-0001eee0: 3d20 7265 7375 6c74 730a 2020 2020 2020  = results.      
-0001eef0: 2020 7365 6c66 2e72 756e 5f73 6571 7565    self.run_seque
-0001ef00: 6e63 6520 3d20 7365 7175 656e 6365 0a0a  nce = sequence..
-0001ef10: 2020 2020 6465 6620 7374 6f72 655f 7472      def store_tr
-0001ef20: 6565 2873 656c 6629 3a0a 2020 2020 2020  ee(self):.      
-0001ef30: 2020 2222 2253 746f 7265 2074 7265 6520    """Store tree 
-0001ef40: 746f 2064 6973 6b20 2872 6573 756c 7473  to disk (results
-0001ef50: 2f74 7265 652e 6864 6635 292e 2222 220a  /tree.hdf5).""".
-0001ef60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001ef70: 6c6f 675f 746f 5f64 6973 6b3a 0a20 2020  log_to_disk:.   
-0001ef80: 2020 2020 2020 2020 2064 756d 705f 7472           dump_tr
-0001ef90: 6565 286f 732e 7061 7468 2e6a 6f69 6e28  ee(os.path.join(
-0001efa0: 7365 6c66 2e6c 6f67 735b 2772 6573 756c  self.logs['resul
-0001efb0: 7473 275d 2c20 2774 7265 652e 6864 6635  ts'], 'tree.hdf5
-0001efc0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-0001efd0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-0001efe0: 6f6f 742e 6368 696c 6472 656e 2c20 7365  oot.children, se
-0001eff0: 6c66 2e70 6f69 6e74 7069 6c65 290a 0a20  lf.pointpile).. 
-0001f000: 2020 2064 6566 2070 7269 6e74 5f72 6573     def print_res
-0001f010: 756c 7473 2873 656c 662c 2075 7365 5f75  ults(self, use_u
-0001f020: 6e69 636f 6465 3d54 7275 6529 3a0a 2020  nicode=True):.  
-0001f030: 2020 2020 2020 2222 2247 6976 6520 7375        """Give su
-0001f040: 6d6d 6172 7920 6f66 206d 6172 6769 6e61  mmary of margina
-0001f050: 6c20 6c69 6b65 6c69 686f 6f64 2061 6e64  l likelihood and
-0001f060: 2070 6172 616d 6574 6572 2070 6f73 7465   parameter poste
-0001f070: 7269 6f72 732e 0a0a 2020 2020 2020 2020  riors...        
-0001f080: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
-0001f090: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-0001f0a0: 2020 2020 2020 7573 655f 756e 6963 6f64        use_unicod
-0001f0b0: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
-0001f0c0: 2020 2020 5768 6574 6865 7220 746f 2070      Whether to p
-0001f0d0: 7269 6e74 2061 2075 6e69 636f 6465 2070  rint a unicode p
-0001f0e0: 6c6f 7420 6f66 2074 6865 2070 6f73 7465  lot of the poste
-0001f0f0: 7269 6f72 2064 6973 7472 6962 7574 696f  rior distributio
-0001f100: 6e73 0a0a 2020 2020 2020 2020 2222 220a  ns..        """.
-0001f110: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001f120: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
-0001f130: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
-0001f140: 2020 2020 2070 7269 6e74 2827 6c6f 675a       print('logZ
-0001f150: 203d 2025 286c 6f67 7a29 2e33 6620 2b2d   = %(logz).3f +-
-0001f160: 2025 286c 6f67 7a65 7272 292e 3366 2720   %(logzerr).3f' 
-0001f170: 2520 7365 6c66 2e72 6573 756c 7473 290a  % self.results).
-0001f180: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0001f190: 7428 2720 2073 696e 676c 6520 696e 7374  t('  single inst
-0001f1a0: 616e 6365 3a20 6c6f 675a 203d 2025 286c  ance: logZ = %(l
-0001f1b0: 6f67 7a5f 7369 6e67 6c65 292e 3366 202b  ogz_single).3f +
-0001f1c0: 2d20 2528 6c6f 677a 6572 725f 7369 6e67  - %(logzerr_sing
-0001f1d0: 6c65 292e 3366 2720 2520 7365 6c66 2e72  le).3f' % self.r
-0001f1e0: 6573 756c 7473 290a 2020 2020 2020 2020  esults).        
-0001f1f0: 2020 2020 7072 696e 7428 2720 2062 6f6f      print('  boo
-0001f200: 7473 7472 6170 7065 6420 2020 3a20 6c6f  tstrapped   : lo
-0001f210: 675a 203d 2025 286c 6f67 7a5f 6273 292e  gZ = %(logz_bs).
-0001f220: 3366 202b 2d20 2528 6c6f 677a 6572 725f  3f +- %(logzerr_
-0001f230: 6273 292e 3366 2720 2520 7365 6c66 2e72  bs).3f' % self.r
-0001f240: 6573 756c 7473 290a 2020 2020 2020 2020  esults).        
-0001f250: 2020 2020 7072 696e 7428 2720 2074 6169      print('  tai
-0001f260: 6c20 2020 2020 2020 2020 2020 3a20 6c6f  l           : lo
-0001f270: 675a 203d 202b 2d20 2528 6c6f 677a 6572  gZ = +- %(logzer
-0001f280: 725f 7461 696c 292e 3366 2720 2520 7365  r_tail).3f' % se
-0001f290: 6c66 2e72 6573 756c 7473 290a 2020 2020  lf.results).    
-0001f2a0: 2020 2020 2020 2020 7072 696e 7428 2769          print('i
-0001f2b0: 6e73 6572 7420 6f72 6465 7220 5520 7465  nsert order U te
-0001f2c0: 7374 203a 2063 6f6e 7665 7267 6564 3a20  st : converged: 
-0001f2d0: 2528 636f 6e76 6572 6765 6429 7320 636f  %(converged)s co
-0001f2e0: 7272 656c 6174 696f 6e3a 2025 2869 6e64  rrelation: %(ind
-0001f2f0: 6570 656e 6465 6e74 5f69 7465 7261 7469  ependent_iterati
-0001f300: 6f6e 7329 7320 6974 6572 6174 696f 6e73  ons)s iterations
-0001f310: 2720 2520 280a 2020 2020 2020 2020 2020  ' % (.          
-0001f320: 2020 2020 2020 7365 6c66 2e72 6573 756c        self.resul
-0001f330: 7473 5b27 696e 7365 7274 696f 6e5f 6f72  ts['insertion_or
-0001f340: 6465 725f 4d57 575f 7465 7374 275d 2929  der_MWW_test']))
-0001f350: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001f360: 7365 6c66 2e73 7465 7073 616d 706c 6572  self.stepsampler
-0001f370: 2061 6e64 2068 6173 6174 7472 2873 656c   and hasattr(sel
-0001f380: 662e 7374 6570 7361 6d70 6c65 722c 2027  f.stepsampler, '
-0001f390: 7072 696e 745f 6469 6167 6e6f 7374 6963  print_diagnostic
-0001f3a0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-0001f3b0: 2020 2020 7365 6c66 2e73 7465 7073 616d      self.stepsam
-0001f3c0: 706c 6572 2e70 7269 6e74 5f64 6961 676e  pler.print_diagn
-0001f3d0: 6f73 7469 6328 290a 0a20 2020 2020 2020  ostic()..       
-0001f3e0: 2020 2020 2070 7269 6e74 2829 0a20 2020       print().   
-0001f3f0: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-0001f400: 7020 696e 2065 6e75 6d65 7261 7465 2873  p in enumerate(s
-0001f410: 656c 662e 7061 7261 6d6e 616d 6573 202b  elf.paramnames +
-0001f420: 2073 656c 662e 6465 7269 7665 6470 6172   self.derivedpar
-0001f430: 616d 6e61 6d65 7329 3a0a 2020 2020 2020  amnames):.      
-0001f440: 2020 2020 2020 2020 2020 7620 3d20 7365            v = se
-0001f450: 6c66 2e72 6573 756c 7473 5b27 7361 6d70  lf.results['samp
-0001f460: 6c65 7327 5d5b 3a2c 695d 0a20 2020 2020  les'][:,i].     
-0001f470: 2020 2020 2020 2020 2020 2073 6967 6d61             sigma
-0001f480: 203d 2076 2e73 7464 2829 0a20 2020 2020   = v.std().     
-0001f490: 2020 2020 2020 2020 2020 206d 6564 203d             med =
-0001f4a0: 2076 2e6d 6561 6e28 290a 2020 2020 2020   v.mean().      
-0001f4b0: 2020 2020 2020 2020 2020 6966 2073 6967            if sig
-0001f4c0: 6d61 203d 3d20 303a 0a20 2020 2020 2020  ma == 0:.       
-0001f4d0: 2020 2020 2020 2020 2020 2020 206a 203d               j =
-0001f4e0: 2033 0a20 2020 2020 2020 2020 2020 2020   3.             
-0001f4f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001f500: 2020 2020 2020 2020 2020 2020 206a 203d               j =
-0001f510: 206d 6178 2830 2c20 696e 7428 2d6e 702e   max(0, int(-np.
-0001f520: 666c 6f6f 7228 6e70 2e6c 6f67 3130 2873  floor(np.log10(s
-0001f530: 6967 6d61 2929 2920 2b20 3129 0a20 2020  igma))) + 1).   
-0001f540: 2020 2020 2020 2020 2020 2020 2066 6d74               fmt
-0001f550: 203d 2027 2525 2e25 6466 2720 2520 6a0a   = '%%.%df' % j.
-0001f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f570: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001f580: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001f590: 7573 655f 756e 6963 6f64 653a 0a20 2020  use_unicode:.   
+0001c930: 2020 2320 736d 6f6f 7468 2075 7064 6174    # smooth updat
+0001c940: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001c950: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001c960: 6472 6177 5f6e 6578 7420 3d20 302e 3034  draw_next = 0.04
+0001c970: 202a 2073 616d 706c 696e 675f 696e 6566   * sampling_inef
+0001c980: 6669 6369 656e 6379 202b 206e 6472 6177  ficiency + ndraw
+0001c990: 202a 2030 2e39 360a 2020 2020 2020 2020   * 0.96.        
+0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c9b0: 2020 2020 6e64 7261 7720 3d20 6d61 7828      ndraw = max(
+0001c9c0: 7365 6c66 2e6e 6472 6177 5f6d 696e 2c20  self.ndraw_min, 
+0001c9d0: 6d69 6e28 7365 6c66 2e6e 6472 6177 5f6d  min(self.ndraw_m
+0001c9e0: 6178 2c20 726f 756e 6428 6e64 7261 775f  ax, round(ndraw_
+0001c9f0: 6e65 7874 292c 206e 6472 6177 202a 2031  next), ndraw * 1
+0001ca00: 3030 2929 0a0a 2020 2020 2020 2020 2020  00))..          
+0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca20: 2020 6966 2073 616d 706c 696e 675f 696e    if sampling_in
+0001ca30: 6566 6669 6369 656e 6379 203e 2031 3030  efficiency > 100
+0001ca40: 3030 3020 616e 6420 6974 203e 3d20 6974  000 and it >= it
+0001ca50: 5f61 745f 6669 7273 745f 7265 6769 6f6e  _at_first_region
+0001ca60: 202b 2031 303a 0a20 2020 2020 2020 2020   + 10:.         
+0001ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ca80: 2020 2020 2020 2023 2069 6620 7468 6520         # if the 
+0001ca90: 6566 6669 6369 656e 6379 2069 7320 706f  efficiency is po
+0001caa0: 6f72 2c20 7468 6572 6520 6172 6520 656e  or, there are en
+0001cab0: 6f75 6768 2073 616d 706c 6573 2069 6e20  ough samples in 
+0001cac0: 6561 6368 2069 7465 7261 7469 6f6e 0a20  each iteration. 
+0001cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cae0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001caf0: 2074 6f20 6573 7469 6d61 7465 2074 6865   to estimate the
+0001cb00: 2069 6e65 6666 6963 6965 6e63 790a 2020   inefficiency.  
+0001cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb20: 2020 2020 2020 2020 2020 2020 2020 6e63                nc
+0001cb30: 616c 6c5f 6174 5f72 756e 5f73 7461 7274  all_at_run_start
+0001cb40: 203d 2073 656c 662e 6e63 616c 6c0a 2020   = self.ncall.  
+0001cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb60: 2020 2020 2020 2020 2020 2020 2020 6974                it
+0001cb70: 5f61 745f 6669 7273 745f 7265 6769 6f6e  _at_first_region
+0001cb80: 203d 2069 740a 2020 2020 2020 2020 2020   = it.          
+0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cba0: 2020 2020 2020 6e63 616c 6c5f 7265 6769        ncall_regi
+0001cbb0: 6f6e 5f61 745f 7275 6e5f 7374 6172 7420  on_at_run_start 
+0001cbc0: 3d20 7365 6c66 2e6e 6361 6c6c 5f72 6567  = self.ncall_reg
+0001cbd0: 696f 6e0a 0a20 2020 2020 2020 2020 2020  ion..           
+0001cbe0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001cbf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001cc00: 2077 6520 646f 206e 6f74 2077 616e 7420   we do not want 
+0001cc10: 746f 2063 6f75 6e74 2069 7465 7261 7469  to count iterati
+0001cc20: 6f6e 7320 7769 7468 6f75 7420 776f 726b  ons without work
+0001cc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cc40: 2020 2020 2023 206f 7468 6572 7769 7365       # otherwise
+0001cc50: 2065 6666 6963 6965 6e63 7920 6265 636f   efficiency beco
+0001cc60: 6d65 7320 3e20 310a 2020 2020 2020 2020  mes > 1.        
+0001cc70: 2020 2020 2020 2020 2020 2020 6974 5f61              it_a
+0001cc80: 745f 6669 7273 745f 7265 6769 6f6e 202b  t_first_region +
+0001cc90: 3d20 310a 0a20 2020 2020 2020 2020 2020  = 1..           
+0001cca0: 2020 2020 2073 6176 6564 5f6e 6f64 6569       saved_nodei
+0001ccb0: 6473 2e61 7070 656e 6428 6e6f 6465 2e69  ds.append(node.i
+0001ccc0: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+0001ccd0: 2020 2073 6176 6564 5f6c 6f67 6c2e 6170     saved_logl.ap
+0001cce0: 7065 6e64 284c 6d69 6e29 0a0a 2020 2020  pend(Lmin)..    
+0001ccf0: 2020 2020 2020 2020 2020 2020 2320 696e              # in
+0001cd00: 666f 726d 2069 7465 7261 746f 7273 2028  form iterators (
+0001cd10: 6966 2069 7420 6973 2074 6865 6972 2062  if it is their b
+0001cd20: 7573 696e 6573 7329 2061 626f 7574 2074  usiness) about t
+0001cd30: 6865 2061 7263 0a20 2020 2020 2020 2020  he arc.         
+0001cd40: 2020 2020 2020 206d 6169 6e5f 6974 6572         main_iter
+0001cd50: 6174 6f72 2e70 6173 7369 6e67 5f6e 6f64  ator.passing_nod
+0001cd60: 6528 726f 6f74 6964 2c20 6e6f 6465 2c20  e(rootid, node, 
+0001cd70: 6163 7469 7665 5f72 6f6f 7469 6473 2c20  active_rootids, 
+0001cd80: 6163 7469 7665 5f76 616c 7565 7329 0a20  active_values). 
+0001cd90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001cda0: 6620 6c65 6e28 6e6f 6465 2e63 6869 6c64  f len(node.child
+0001cdb0: 7265 6e29 203d 3d20 3020 616e 6420 7365  ren) == 0 and se
+0001cdc0: 6c66 2e72 6567 696f 6e20 6973 206e 6f74  lf.region is not
+0001cdd0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001cde0: 2020 2020 2020 2020 2020 2023 2074 6865             # the
+0001cdf0: 2072 6567 696f 6e20 7261 6469 7573 206e   region radius n
+0001ce00: 6565 6473 2074 6f20 696e 6372 6561 7365  eeds to increase
+0001ce10: 2069 6620 6e6c 6976 6520 6465 6372 6561   if nlive decrea
+0001ce20: 7365 730a 2020 2020 2020 2020 2020 2020  ses.            
+0001ce30: 2020 2020 2020 2020 2320 7261 6469 7573          # radius
+0001ce40: 2069 7320 6e6f 7420 7265 6c69 6162 6c65   is not reliable
+0001ce50: 2c20 736f 2073 6574 2074 6f20 696e 660a  , so set to inf.
+0001ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce70: 2020 2020 2320 2868 6575 7269 7374 6963      # (heuristic
+0001ce80: 7320 646f 206e 6f74 2077 6f72 6b20 696e  s do not work in
+0001ce90: 2070 7261 6374 6963 6529 0a20 2020 2020   practice).     
+0001cea0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001ceb0: 656c 662e 7265 6769 6f6e 2e6d 6178 7261  elf.region.maxra
+0001cec0: 6469 7573 7371 203d 204e 6f6e 650a 2020  diussq = None.  
+0001ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cee0: 2020 2320 6173 6b20 666f 7220 7468 6520    # ask for the 
+0001cef0: 7265 6769 6f6e 2074 6f20 6265 2072 6562  region to be reb
+0001cf00: 7569 6c74 0a20 2020 2020 2020 2020 2020  uilt.           
+0001cf10: 2020 2020 2020 2020 206e 6578 745f 7570           next_up
+0001cf20: 6461 7465 5f69 6e74 6572 7661 6c5f 766f  date_interval_vo
+0001cf30: 6c75 6d65 203d 2031 0a0a 2020 2020 2020  lume = 1..      
+0001cf40: 2020 2020 2020 2020 2020 6974 202b 3d20            it += 
+0001cf50: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+0001cf60: 2020 6578 706c 6f72 6572 2e65 7870 616e    explorer.expan
+0001cf70: 645f 6368 696c 6472 656e 5f6f 6628 726f  d_children_of(ro
+0001cf80: 6f74 6964 2c20 6e6f 6465 290a 0a20 2020  otid, node)..   
+0001cf90: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0001cfa0: 2e6c 6f67 3a0a 2020 2020 2020 2020 2020  .log:.          
+0001cfb0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0001cfc0: 722e 696e 666f 2822 4578 706c 6f72 6564  r.info("Explored
+0001cfd0: 2075 6e74 696c 204c 3d25 2e31 6720 2022   until L=%.1g  "
+0001cfe0: 2c20 6e6f 6465 2e76 616c 7565 290a 2020  , node.value).  
+0001cff0: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
+0001d000: 745f 7472 6565 2872 6f6f 7473 5b3a 3a31  t_tree(roots[::1
+0001d010: 305d 290a 0a20 2020 2020 2020 2020 2020  0])..           
+0001d020: 2073 656c 662e 706f 696e 7473 746f 7265   self.pointstore
+0001d030: 2e66 6c75 7368 2829 0a20 2020 2020 2020  .flush().       
+0001d040: 2020 2020 2073 656c 662e 5f75 7064 6174       self._updat
+0001d050: 655f 7265 7375 6c74 7328 6d61 696e 5f69  e_results(main_i
+0001d060: 7465 7261 746f 722c 2073 6176 6564 5f6c  terator, saved_l
+0001d070: 6f67 6c2c 2073 6176 6564 5f6e 6f64 6569  ogl, saved_nodei
+0001d080: 6473 290a 2020 2020 2020 2020 2020 2020  ds).            
+0001d090: 7969 656c 6420 7365 6c66 2e72 6573 756c  yield self.resul
+0001d0a0: 7473 0a0a 2020 2020 2020 2020 2020 2020  ts..            
+0001d0b0: 6966 206d 6178 5f6e 6361 6c6c 7320 6973  if max_ncalls is
+0001d0c0: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
+0001d0d0: 6c66 2e6e 6361 6c6c 203e 3d20 6d61 785f  lf.ncall >= max_
+0001d0e0: 6e63 616c 6c73 3a0a 2020 2020 2020 2020  ncalls:.        
+0001d0f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001d100: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
+0001d110: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+0001d120: 6767 6572 2e69 6e66 6f28 0a20 2020 2020  gger.info(.     
+0001d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d140: 2020 2027 5265 6163 6865 6420 6d61 7869     'Reached maxi
+0001d150: 6d75 6d20 6e75 6d62 6572 206f 6620 6c69  mum number of li
+0001d160: 6b65 6c69 686f 6f64 2063 616c 6c73 2028  kelihood calls (
+0001d170: 2564 203e 2025 6429 2e2e 2e27 2c0a 2020  %d > %d)...',.  
+0001d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d190: 2020 2020 2020 7365 6c66 2e6e 6361 6c6c        self.ncall
+0001d1a0: 2c20 6d61 785f 6e63 616c 6c73 290a 2020  , max_ncalls).  
+0001d1b0: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0001d1c0: 6561 6b0a 0a20 2020 2020 2020 2020 2020  eak..           
+0001d1d0: 2069 6d70 726f 7665 6d65 6e74 5f69 7420   improvement_it 
+0001d1e0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+0001d1f0: 2069 6620 6d61 785f 6e75 6d5f 696d 7072   if max_num_impr
+0001d200: 6f76 656d 656e 745f 6c6f 6f70 7320 3e3d  ovement_loops >=
+0001d210: 2030 2061 6e64 2069 6d70 726f 7665 6d65   0 and improveme
+0001d220: 6e74 5f69 7420 3e20 6d61 785f 6e75 6d5f  nt_it > max_num_
+0001d230: 696d 7072 6f76 656d 656e 745f 6c6f 6f70  improvement_loop
+0001d240: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001d250: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
+0001d260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d270: 2020 2020 7365 6c66 2e6c 6f67 6765 722e      self.logger.
+0001d280: 696e 666f 2827 5265 6163 6865 6420 6d61  info('Reached ma
+0001d290: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
+0001d2a0: 696d 7072 6f76 656d 656e 7420 6c6f 6f70  improvement loop
+0001d2b0: 732e 2729 0a20 2020 2020 2020 2020 2020  s.').           
+0001d2c0: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
+0001d2d0: 2020 2020 2020 2020 6966 206e 6361 6c6c          if ncall
+0001d2e0: 5f61 745f 7275 6e5f 7374 6172 7420 3d3d  _at_run_start ==
+0001d2f0: 2073 656c 662e 6e63 616c 6c20 616e 6420   self.ncall and 
+0001d300: 696d 7072 6f76 656d 656e 745f 6974 203e  improvement_it >
+0001d310: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0001d320: 2020 2020 6966 2073 656c 662e 6c6f 673a      if self.log:
+0001d330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d340: 2020 2020 2073 656c 662e 6c6f 6767 6572       self.logger
+0001d350: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+0001d360: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001d370: 4e6f 2063 6861 6e67 6573 206d 6164 652e  No changes made.
+0001d380: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+0001d390: 2020 2020 2020 2020 2020 2027 5072 6f62             'Prob
+0001d3a0: 6162 6c79 2074 6865 2073 7472 6174 6567  ably the strateg
+0001d3b0: 7920 7761 7320 746f 2065 7870 6c6f 7265  y was to explore
+0001d3c0: 2069 6e20 7468 6520 7265 6d61 696e 6465   in the remainde
+0001d3d0: 722c 2027 0a20 2020 2020 2020 2020 2020  r, '.           
+0001d3e0: 2020 2020 2020 2020 2020 2020 2027 6275               'bu
+0001d3f0: 7420 6974 2069 7320 6972 7265 6c65 7661  t it is irreleva
+0001d400: 6e74 2061 6c72 6561 6479 3b20 7472 7920  nt already; try 
+0001d410: 6465 6372 6561 7369 6e67 2066 7261 635f  decreasing frac_
+0001d420: 7265 6d61 696e 2e27 290a 2020 2020 2020  remain.').      
+0001d430: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0001d440: 0a20 2020 2020 2020 2020 2020 204c 6d61  .            Lma
+0001d450: 7820 3d20 6d61 696e 5f69 7465 7261 746f  x = main_iterato
+0001d460: 722e 4c6d 6178 0a20 2020 2020 2020 2020  r.Lmax.         
+0001d470: 2020 2069 6620 6c65 6e28 7265 6769 6f6e     if len(region
+0001d480: 5f73 6571 7565 6e63 6529 203e 2030 3a0a  _sequence) > 0:.
+0001d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4a0: 4c6d 696e 2c20 6e6c 6976 652c 206e 636c  Lmin, nlive, ncl
+0001d4b0: 7573 7465 7273 2c20 4c68 6920 3d20 7265  usters, Lhi = re
+0001d4c0: 6769 6f6e 5f73 6571 7565 6e63 655b 2d31  gion_sequence[-1
+0001d4d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0001d4e0: 2020 6e6e 6f64 6573 5f6e 6565 6465 6420    nnodes_needed 
+0001d4f0: 3d20 636c 7573 7465 725f 6e75 6d5f 6c69  = cluster_num_li
+0001d500: 7665 5f70 6f69 6e74 7320 2a20 6e63 6c75  ve_points * nclu
+0001d510: 7374 6572 730a 2020 2020 2020 2020 2020  sters.          
+0001d520: 2020 2020 2020 6966 206e 6c69 7665 203c        if nlive <
+0001d530: 206e 6e6f 6465 735f 6e65 6564 6564 3a0a   nnodes_needed:.
+0001d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d550: 2020 2020 4c6c 6f2c 205f 2c20 7461 7267      Llo, _, targ
+0001d560: 6574 5f6d 696e 5f6e 756d 5f63 6869 6c64  et_min_num_child
+0001d570: 7265 6e5f 6e65 7720 3d20 7365 6c66 2e5f  ren_new = self._
+0001d580: 6578 7061 6e64 5f6e 6f64 6573 5f62 6566  expand_nodes_bef
+0001d590: 6f72 6528 4c6d 696e 2c20 6e6e 6f64 6573  ore(Lmin, nnodes
+0001d5a0: 5f6e 6565 6465 642c 2075 7064 6174 655f  _needed, update_
+0001d5b0: 696e 7465 7276 616c 5f6e 6361 6c6c 206f  interval_ncall o
+0001d5c0: 7220 6e6c 6976 6529 0a20 2020 2020 2020  r nlive).       
+0001d5d0: 2020 2020 2020 2020 2020 2020 2074 6172               tar
+0001d5e0: 6765 745f 6d69 6e5f 6e75 6d5f 6368 696c  get_min_num_chil
+0001d5f0: 6472 656e 2e75 7064 6174 6528 7461 7267  dren.update(targ
+0001d600: 6574 5f6d 696e 5f6e 756d 5f63 6869 6c64  et_min_num_child
+0001d610: 7265 6e5f 6e65 7729 0a20 2020 2020 2020  ren_new).       
+0001d620: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+0001d630: 6620 7365 6c66 2e6c 6f67 3a0a 2020 2020  f self.log:.    
+0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d650: 2320 2020 2020 7072 696e 745f 7472 6565  #     print_tree
+0001d660: 2873 656c 662e 726f 6f74 2e63 6869 6c64  (self.root.child
+0001d670: 7265 6e5b 3a3a 3130 5d29 0a20 2020 2020  ren[::10]).     
+0001d680: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001d690: 696e 696d 616c 5f77 6964 7468 732e 6170  inimal_widths.ap
+0001d6a0: 7065 6e64 2828 4c6c 6f2c 204c 6869 2c20  pend((Llo, Lhi, 
+0001d6b0: 6e6e 6f64 6573 5f6e 6565 6465 6429 290a  nnodes_needed)).
+0001d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6d0: 2020 2020 4c6c 6f2c 204c 6869 203d 202d      Llo, Lhi = -
+0001d6e0: 6e70 2e69 6e66 2c20 6e70 2e69 6e66 0a20  np.inf, np.inf. 
+0001d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d700: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+0001d710: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0001d720: 2e6c 6f67 3a0a 2020 2020 2020 2020 2020  .log:.          
+0001d730: 2020 2020 2020 2320 7365 6c66 2e6c 6f67        # self.log
+0001d740: 6765 722e 696e 666f 2827 2020 6c6f 675a  ger.info('  logZ
+0001d750: 203d 2025 2e34 6620 2b2d 2025 2e34 6620   = %.4f +- %.4f 
+0001d760: 286d 6169 6e29 2720 2520 286d 6169 6e5f  (main)' % (main_
+0001d770: 6974 6572 6174 6f72 2e6c 6f67 5a2c 206d  iterator.logZ, m
+0001d780: 6169 6e5f 6974 6572 6174 6f72 2e6c 6f67  ain_iterator.log
+0001d790: 5a65 7272 2929 0a20 2020 2020 2020 2020  Zerr)).         
+0001d7a0: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+0001d7b0: 6572 2e69 6e66 6f28 2720 206c 6f67 5a20  er.info('  logZ 
+0001d7c0: 3d20 252e 3467 202b 2d20 252e 3467 272c  = %.4g +- %.4g',
+0001d7d0: 206d 6169 6e5f 6974 6572 6174 6f72 2e6c   main_iterator.l
+0001d7e0: 6f67 5a5f 6273 2c20 6d61 696e 5f69 7465  ogZ_bs, main_ite
+0001d7f0: 7261 746f 722e 6c6f 675a 6572 725f 6273  rator.logZerr_bs
+0001d800: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
+0001d810: 6176 6564 5f6c 6f67 6c20 3d20 6e70 2e61  aved_logl = np.a
+0001d820: 7361 7272 6179 2873 6176 6564 5f6c 6f67  sarray(saved_log
+0001d830: 6c29 0a20 2020 2020 2020 2020 2020 2023  l).            #
+0001d840: 2072 6561 6374 6976 6520 6e65 7374 6564   reactive nested
+0001d850: 2073 616d 706c 696e 673a 2073 6565 2077   sampling: see w
+0001d860: 6865 7265 2077 6520 6861 7665 2074 6f20  here we have to 
+0001d870: 696d 7072 6f76 650a 2020 2020 2020 2020  improve.        
+0001d880: 2020 2020 646c 6f67 7a5f 6d69 6e5f 6e75      dlogz_min_nu
+0001d890: 6d5f 6c69 7665 5f70 6f69 6e74 732c 2028  m_live_points, (
+0001d8a0: 4c6c 6f5f 4b4c 2c20 4c68 695f 4b4c 292c  Llo_KL, Lhi_KL),
+0001d8b0: 2028 4c6c 6f5f 6573 732c 204c 6869 5f65   (Llo_ess, Lhi_e
+0001d8c0: 7373 2920 3d20 7365 6c66 2e5f 6669 6e64  ss) = self._find
+0001d8d0: 5f73 7472 6174 6567 7928 0a20 2020 2020  _strategy(.     
+0001d8e0: 2020 2020 2020 2020 2020 2073 6176 6564             saved
+0001d8f0: 5f6c 6f67 6c2c 206d 6169 6e5f 6974 6572  _logl, main_iter
+0001d900: 6174 6f72 2c20 646c 6f67 7a3d 646c 6f67  ator, dlogz=dlog
+0001d910: 7a2c 2064 4b4c 3d64 4b4c 2c20 6d69 6e5f  z, dKL=dKL, min_
+0001d920: 6573 733d 6d69 6e5f 6573 7329 0a20 2020  ess=min_ess).   
+0001d930: 2020 2020 2020 2020 204c 6c6f 203d 206d           Llo = m
+0001d940: 696e 284c 6c6f 5f65 7373 2c20 4c6c 6f5f  in(Llo_ess, Llo_
+0001d950: 4b4c 290a 2020 2020 2020 2020 2020 2020  KL).            
+0001d960: 4c68 6920 3d20 6d61 7828 4c68 695f 6573  Lhi = max(Lhi_es
+0001d970: 732c 204c 6869 5f4b 4c29 0a20 2020 2020  s, Lhi_KL).     
+0001d980: 2020 2020 2020 2023 2074 6f20 6176 6f69         # to avoi
+0001d990: 6420 6e75 6d65 7269 6361 6c20 6973 7375  d numerical issu
+0001d9a0: 6573 2077 6865 6e20 616c 6c20 6c69 6b65  es when all like
+0001d9b0: 6c69 686f 6f64 2076 616c 7565 7320 6172  lihood values ar
+0001d9c0: 6520 7468 6520 7361 6d65 0a20 2020 2020  e the same.     
+0001d9d0: 2020 2020 2020 204c 6869 203d 206d 696e         Lhi = min
+0001d9e0: 284c 6869 2c20 7361 7665 645f 6c6f 676c  (Lhi, saved_logl
+0001d9f0: 2e6d 6178 2829 202d 2030 2e30 3031 290a  .max() - 0.001).
+0001da00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001da10: 7365 6c66 2e75 7365 5f6d 7069 3a0a 2020  self.use_mpi:.  
+0001da20: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001da30: 6376 5f4c 6c6f 203d 2073 656c 662e 636f  cv_Llo = self.co
+0001da40: 6d6d 2e67 6174 6865 7228 4c6c 6f2c 2072  mm.gather(Llo, r
+0001da50: 6f6f 743d 3029 0a20 2020 2020 2020 2020  oot=0).         
+0001da60: 2020 2020 2020 2072 6563 765f 4c6c 6f20         recv_Llo 
+0001da70: 3d20 7365 6c66 2e63 6f6d 6d2e 6263 6173  = self.comm.bcas
+0001da80: 7428 7265 6376 5f4c 6c6f 2c20 726f 6f74  t(recv_Llo, root
+0001da90: 3d30 290a 2020 2020 2020 2020 2020 2020  =0).            
+0001daa0: 2020 2020 7265 6376 5f4c 6869 203d 2073      recv_Lhi = s
+0001dab0: 656c 662e 636f 6d6d 2e67 6174 6865 7228  elf.comm.gather(
+0001dac0: 4c68 692c 2072 6f6f 743d 3029 0a20 2020  Lhi, root=0).   
+0001dad0: 2020 2020 2020 2020 2020 2020 2072 6563               rec
+0001dae0: 765f 4c68 6920 3d20 7365 6c66 2e63 6f6d  v_Lhi = self.com
+0001daf0: 6d2e 6263 6173 7428 7265 6376 5f4c 6869  m.bcast(recv_Lhi
+0001db00: 2c20 726f 6f74 3d30 290a 2020 2020 2020  , root=0).      
+0001db10: 2020 2020 2020 2020 2020 7265 6376 5f64            recv_d
+0001db20: 6c6f 677a 5f6d 696e 5f6e 756d 5f6c 6976  logz_min_num_liv
+0001db30: 655f 706f 696e 7473 203d 2073 656c 662e  e_points = self.
+0001db40: 636f 6d6d 2e67 6174 6865 7228 646c 6f67  comm.gather(dlog
+0001db50: 7a5f 6d69 6e5f 6e75 6d5f 6c69 7665 5f70  z_min_num_live_p
+0001db60: 6f69 6e74 732c 2072 6f6f 743d 3029 0a20  oints, root=0). 
+0001db70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001db80: 6563 765f 646c 6f67 7a5f 6d69 6e5f 6e75  ecv_dlogz_min_nu
+0001db90: 6d5f 6c69 7665 5f70 6f69 6e74 7320 3d20  m_live_points = 
+0001dba0: 7365 6c66 2e63 6f6d 6d2e 6263 6173 7428  self.comm.bcast(
+0001dbb0: 7265 6376 5f64 6c6f 677a 5f6d 696e 5f6e  recv_dlogz_min_n
+0001dbc0: 756d 5f6c 6976 655f 706f 696e 7473 2c20  um_live_points, 
+0001dbd0: 726f 6f74 3d30 290a 0a20 2020 2020 2020  root=0)..       
+0001dbe0: 2020 2020 2020 2020 204c 6c6f 203d 206d           Llo = m
+0001dbf0: 696e 2872 6563 765f 4c6c 6f29 0a20 2020  in(recv_Llo).   
+0001dc00: 2020 2020 2020 2020 2020 2020 204c 6869               Lhi
+0001dc10: 203d 206d 6178 2872 6563 765f 4c68 6929   = max(recv_Lhi)
+0001dc20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dc30: 2064 6c6f 677a 5f6d 696e 5f6e 756d 5f6c   dlogz_min_num_l
+0001dc40: 6976 655f 706f 696e 7473 203d 206d 6178  ive_points = max
+0001dc50: 2872 6563 765f 646c 6f67 7a5f 6d69 6e5f  (recv_dlogz_min_
+0001dc60: 6e75 6d5f 6c69 7665 5f70 6f69 6e74 7329  num_live_points)
+0001dc70: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001dc80: 2064 6c6f 677a 5f6d 696e 5f6e 756d 5f6c   dlogz_min_num_l
+0001dc90: 6976 655f 706f 696e 7473 203e 2073 656c  ive_points > sel
+0001dca0: 662e 6d69 6e5f 6e75 6d5f 6c69 7665 5f70  f.min_num_live_p
+0001dcb0: 6f69 6e74 733a 0a20 2020 2020 2020 2020  oints:.         
+0001dcc0: 2020 2020 2020 2023 206d 6f72 6520 6c69         # more li
+0001dcd0: 7665 2070 6f69 6e74 7320 6e65 6564 6564  ve points needed
+0001dce0: 2074 6872 6f75 6768 6f75 7420 746f 2072   throughout to r
+0001dcf0: 6561 6368 2074 6172 6765 740a 2020 2020  each target.    
+0001dd00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001dd10: 2e6d 696e 5f6e 756d 5f6c 6976 655f 706f  .min_num_live_po
+0001dd20: 696e 7473 203d 2064 6c6f 677a 5f6d 696e  ints = dlogz_min
+0001dd30: 5f6e 756d 5f6c 6976 655f 706f 696e 7473  _num_live_points
+0001dd40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dd50: 2073 656c 662e 5f77 6964 656e 5f72 6f6f   self._widen_roo
+0001dd60: 7473 5f62 6579 6f6e 645f 696e 6974 6961  ts_beyond_initia
+0001dd70: 6c5f 706c 6174 6561 7528 0a20 2020 2020  l_plateau(.     
+0001dd80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001dd90: 656c 662e 6d69 6e5f 6e75 6d5f 6c69 7665  elf.min_num_live
+0001dda0: 5f70 6f69 6e74 732c 0a20 2020 2020 2020  _points,.       
+0001ddb0: 2020 2020 2020 2020 2020 2020 2077 6964               wid
+0001ddc0: 656e 5f62 6566 6f72 655f 696e 6974 6961  en_before_initia
+0001ddd0: 6c5f 706c 6174 6561 755f 6e75 6d5f 7761  l_plateau_num_wa
+0001dde0: 726e 2c0a 2020 2020 2020 2020 2020 2020  rn,.            
+0001ddf0: 2020 2020 2020 2020 7769 6465 6e5f 6265          widen_be
+0001de00: 666f 7265 5f69 6e69 7469 616c 5f70 6c61  fore_initial_pla
+0001de10: 7465 6175 5f6e 756d 5f6d 6178 290a 0a20  teau_num_max).. 
+0001de20: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0001de30: 4c6c 6f20 3c3d 204c 6869 3a0a 2020 2020  Llo <= Lhi:.    
+0001de40: 2020 2020 2020 2020 2020 2020 2320 6966              # if
+0001de50: 2073 656c 662e 6c6f 673a 0a20 2020 2020   self.log:.     
+0001de60: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0001de70: 2070 7269 6e74 5f74 7265 6528 726f 6f74   print_tree(root
+0001de80: 732c 2074 6974 6c65 3d22 5472 6565 2062  s, title="Tree b
+0001de90: 6566 6f72 6520 666f 726b 696e 673a 2229  efore forking:")
+0001dea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001deb0: 2070 6172 656e 7473 2c20 7061 7265 6e74   parents, parent
+0001dec0: 5f77 6569 6768 7473 203d 2066 696e 645f  _weights = find_
+0001ded0: 6e6f 6465 735f 6265 666f 7265 2873 656c  nodes_before(sel
+0001dee0: 662e 726f 6f74 2c20 4c6c 6f29 0a20 2020  f.root, Llo).   
+0001def0: 2020 2020 2020 2020 2020 2020 2023 2064               # d
+0001df00: 6f75 626c 6520 7468 6520 7769 6474 6820  ouble the width 
+0001df10: 2f20 6c69 7665 2070 6f69 6e74 733a 0a20  / live points:. 
+0001df20: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0001df30: 2c20 7769 6474 6820 3d20 636f 756e 745f  , width = count_
+0001df40: 7472 6565 5f62 6574 7765 656e 2873 656c  tree_between(sel
+0001df50: 662e 726f 6f74 2e63 6869 6c64 7265 6e2c  f.root.children,
+0001df60: 204c 6c6f 2c20 4c68 6929 0a20 2020 2020   Llo, Lhi).     
+0001df70: 2020 2020 2020 2020 2020 206e 6e6f 6465             nnode
+0001df80: 735f 6e65 6564 6564 203d 2077 6964 7468  s_needed = width
+0001df90: 202a 2032 0a20 2020 2020 2020 2020 2020   * 2.           
+0001dfa0: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
+0001dfb0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001dfc0: 2020 2020 2020 7365 6c66 2e6c 6f67 6765        self.logge
+0001dfd0: 722e 696e 666f 280a 2020 2020 2020 2020  r.info(.        
+0001dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dff0: 2757 6964 656e 696e 6720 6672 6f6d 2025  'Widening from %
+0001e000: 6420 746f 2025 6420 6c69 7665 2070 6f69  d to %d live poi
+0001e010: 6e74 7320 6265 666f 7265 204c 3d25 2e31  nts before L=%.1
+0001e020: 672e 2e2e 272c 0a20 2020 2020 2020 2020  g...',.         
+0001e030: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001e040: 656e 2870 6172 656e 7473 292c 206e 6e6f  en(parents), nno
+0001e050: 6465 735f 6e65 6564 6564 2c20 4c6c 6f29  des_needed, Llo)
+0001e060: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001e070: 2020 6966 206c 656e 2870 6172 656e 7473    if len(parents
+0001e080: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+0001e090: 2020 2020 2020 2020 2020 2020 4c6c 6f20              Llo 
+0001e0a0: 3d20 2d6e 702e 696e 660a 2020 2020 2020  = -np.inf.      
+0001e0b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0d0: 2020 2020 4c6c 6f20 3d20 6d69 6e28 6e2e      Llo = min(n.
+0001e0e0: 7661 6c75 6520 666f 7220 6e20 696e 2070  value for n in p
+0001e0f0: 6172 656e 7473 290a 2020 2020 2020 2020  arents).        
+0001e100: 2020 2020 2020 2020 7365 6c66 2e70 6f69          self.poi
+0001e110: 6e74 7374 6f72 652e 7265 7365 7428 290a  ntstore.reset().
+0001e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e130: 7461 7267 6574 5f6d 696e 5f6e 756d 5f63  target_min_num_c
+0001e140: 6869 6c64 7265 6e2e 7570 6461 7465 2873  hildren.update(s
+0001e150: 656c 662e 5f77 6964 656e 5f6e 6f64 6573  elf._widen_nodes
+0001e160: 2870 6172 656e 7473 2c20 7061 7265 6e74  (parents, parent
+0001e170: 5f77 6569 6768 7473 2c20 6e6e 6f64 6573  _weights, nnodes
+0001e180: 5f6e 6565 6465 642c 2075 7064 6174 655f  _needed, update_
+0001e190: 696e 7465 7276 616c 5f6e 6361 6c6c 2929  interval_ncall))
+0001e1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e1b0: 206d 696e 696d 616c 5f77 6964 7468 732e   minimal_widths.
+0001e1c0: 6170 7065 6e64 2828 4c6c 6f2c 204c 6869  append((Llo, Lhi
+0001e1d0: 2c20 6e6e 6f64 6573 5f6e 6565 6465 6429  , nnodes_needed)
+0001e1e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e1f0: 2020 2320 6966 2073 656c 662e 6c6f 673a    # if self.log:
+0001e200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e210: 2023 2020 2020 2070 7269 6e74 5f74 7265   #     print_tre
+0001e220: 6528 726f 6f74 732c 2074 6974 6c65 3d22  e(roots, title="
+0001e230: 5472 6565 2061 6674 6572 2066 6f72 6b69  Tree after forki
+0001e240: 6e67 3a22 290a 2020 2020 2020 2020 2020  ng:").          
+0001e250: 2020 2020 2020 2320 7072 696e 7428 2774        # print('t
+0001e260: 7265 6520 7369 7a65 3a27 2c20 636f 756e  ree size:', coun
+0001e270: 745f 7472 6565 2872 6f6f 7473 2929 0a20  t_tree(roots)). 
+0001e280: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0001e290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e2a0: 2062 7265 616b 0a0a 2020 2020 6465 6620   break..    def 
+0001e2b0: 5f75 7064 6174 655f 7265 7375 6c74 7328  _update_results(
+0001e2c0: 7365 6c66 2c20 6d61 696e 5f69 7465 7261  self, main_itera
+0001e2d0: 746f 722c 2073 6176 6564 5f6c 6f67 6c2c  tor, saved_logl,
+0001e2e0: 2073 6176 6564 5f6e 6f64 6569 6473 293a   saved_nodeids):
+0001e2f0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001e300: 2e6c 6f67 3a0a 2020 2020 2020 2020 2020  .log:.          
+0001e310: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
+0001e320: 666f 2827 4c69 6b65 6c69 686f 6f64 2066  fo('Likelihood f
+0001e330: 756e 6374 696f 6e20 6576 616c 7561 7469  unction evaluati
+0001e340: 6f6e 733a 2025 6427 2c20 7365 6c66 2e6e  ons: %d', self.n
+0001e350: 6361 6c6c 290a 0a20 2020 2020 2020 2072  call)..        r
+0001e360: 6573 756c 7473 203d 2063 6f6d 6269 6e65  esults = combine
+0001e370: 5f72 6573 756c 7473 280a 2020 2020 2020  _results(.      
+0001e380: 2020 2020 2020 7361 7665 645f 6c6f 676c        saved_logl
+0001e390: 2c20 7361 7665 645f 6e6f 6465 6964 732c  , saved_nodeids,
+0001e3a0: 2073 656c 662e 706f 696e 7470 696c 652c   self.pointpile,
+0001e3b0: 0a20 2020 2020 2020 2020 2020 206d 6169  .            mai
+0001e3c0: 6e5f 6974 6572 6174 6f72 2c20 6d70 695f  n_iterator, mpi_
+0001e3d0: 636f 6d6d 3d73 656c 662e 636f 6d6d 2069  comm=self.comm i
+0001e3e0: 6620 7365 6c66 2e75 7365 5f6d 7069 2065  f self.use_mpi e
+0001e3f0: 6c73 6520 4e6f 6e65 290a 0a20 2020 2020  lse None)..     
+0001e400: 2020 2072 6573 756c 7473 5b27 6e63 616c     results['ncal
+0001e410: 6c27 5d20 3d20 696e 7428 7365 6c66 2e6e  l'] = int(self.n
+0001e420: 6361 6c6c 290a 2020 2020 2020 2020 7265  call).        re
+0001e430: 7375 6c74 735b 2770 6172 616d 6e61 6d65  sults['paramname
+0001e440: 7327 5d20 3d20 7365 6c66 2e70 6172 616d  s'] = self.param
+0001e450: 6e61 6d65 7320 2b20 7365 6c66 2e64 6572  names + self.der
+0001e460: 6976 6564 7061 7261 6d6e 616d 6573 0a20  ivedparamnames. 
+0001e470: 2020 2020 2020 2072 6573 756c 7473 5b27         results['
+0001e480: 6c6f 677a 6572 725f 7369 6e67 6c65 275d  logzerr_single']
+0001e490: 203d 2028 6d61 696e 5f69 7465 7261 746f   = (main_iterato
+0001e4a0: 722e 616c 6c5f 485b 305d 202f 2073 656c  r.all_H[0] / sel
+0001e4b0: 662e 6d69 6e5f 6e75 6d5f 6c69 7665 5f70  f.min_num_live_p
+0001e4c0: 6f69 6e74 7329 2a2a 302e 350a 0a20 2020  oints)**0.5..   
+0001e4d0: 2020 2020 2073 6571 7565 6e63 652c 2072       sequence, r
+0001e4e0: 6573 756c 7473 3220 3d20 6c6f 677a 5f73  esults2 = logz_s
+0001e4f0: 6571 7565 6e63 6528 7365 6c66 2e72 6f6f  equence(self.roo
+0001e500: 742c 2073 656c 662e 706f 696e 7470 696c  t, self.pointpil
+0001e510: 652c 2072 616e 646f 6d3d 5472 7565 2c20  e, random=True, 
+0001e520: 6368 6563 6b5f 696e 7365 7274 696f 6e5f  check_insertion_
+0001e530: 6f72 6465 723d 5472 7565 290a 2020 2020  order=True).    
+0001e540: 2020 2020 7265 7375 6c74 735b 2769 6e73      results['ins
+0001e550: 6572 7469 6f6e 5f6f 7264 6572 5f4d 5757  ertion_order_MWW
+0001e560: 5f74 6573 7427 5d20 3d20 7265 7375 6c74  _test'] = result
+0001e570: 7332 5b27 696e 7365 7274 696f 6e5f 6f72  s2['insertion_or
+0001e580: 6465 725f 4d57 575f 7465 7374 275d 0a0a  der_MWW_test']..
+0001e590: 2020 2020 2020 2020 7265 7375 6c74 735f          results_
+0001e5a0: 7369 6d70 6c65 203d 2064 6963 7428 7265  simple = dict(re
+0001e5b0: 7375 6c74 7329 0a20 2020 2020 2020 2077  sults).        w
+0001e5c0: 6569 6768 7465 645f 7361 6d70 6c65 7320  eighted_samples 
+0001e5d0: 3d20 7265 7375 6c74 735f 7369 6d70 6c65  = results_simple
+0001e5e0: 2e70 6f70 2827 7765 6967 6874 6564 5f73  .pop('weighted_s
+0001e5f0: 616d 706c 6573 2729 0a20 2020 2020 2020  amples').       
+0001e600: 2073 616d 706c 6573 203d 2072 6573 756c   samples = resul
+0001e610: 7473 5f73 696d 706c 652e 706f 7028 2773  ts_simple.pop('s
+0001e620: 616d 706c 6573 2729 0a20 2020 2020 2020  amples').       
+0001e630: 2073 6176 6564 5f77 7430 203d 2077 6569   saved_wt0 = wei
+0001e640: 6768 7465 645f 7361 6d70 6c65 735b 2777  ghted_samples['w
+0001e650: 6569 6768 7473 275d 0a20 2020 2020 2020  eights'].       
+0001e660: 2073 6176 6564 5f75 203d 2077 6569 6768   saved_u = weigh
+0001e670: 7465 645f 7361 6d70 6c65 735b 2775 706f  ted_samples['upo
+0001e680: 696e 7473 275d 0a20 2020 2020 2020 2073  ints'].        s
+0001e690: 6176 6564 5f76 203d 2077 6569 6768 7465  aved_v = weighte
+0001e6a0: 645f 7361 6d70 6c65 735b 2770 6f69 6e74  d_samples['point
+0001e6b0: 7327 5d0a 0a20 2020 2020 2020 2069 6620  s']..        if 
+0001e6c0: 7365 6c66 2e6c 6f67 5f74 6f5f 6469 736b  self.log_to_disk
+0001e6d0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001e6e0: 2073 656c 662e 6c6f 673a 0a20 2020 2020   self.log:.     
+0001e6f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001e700: 6c6f 6767 6572 2e69 6e66 6f28 2257 7269  logger.info("Wri
+0001e710: 7469 6e67 2073 616d 706c 6573 2061 6e64  ting samples and
+0001e720: 2072 6573 756c 7473 2074 6f20 6469 736b   results to disk
+0001e730: 202e 2e2e 2229 0a20 2020 2020 2020 2020   ...").         
+0001e740: 2020 206e 702e 7361 7665 7478 7428 6f73     np.savetxt(os
+0001e750: 2e70 6174 682e 6a6f 696e 2873 656c 662e  .path.join(self.
+0001e760: 6c6f 6773 5b27 6368 6169 6e73 275d 2c20  logs['chains'], 
+0001e770: 2765 7175 616c 5f77 6569 6768 7465 645f  'equal_weighted_
+0001e780: 706f 7374 2e74 7874 2729 2c0a 2020 2020  post.txt'),.    
+0001e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7a0: 2020 2073 616d 706c 6573 2c0a 2020 2020     samples,.    
+0001e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e7c0: 2020 2068 6561 6465 723d 2720 272e 6a6f     header=' '.jo
+0001e7d0: 696e 2873 656c 662e 7061 7261 6d6e 616d  in(self.paramnam
+0001e7e0: 6573 202b 2073 656c 662e 6465 7269 7665  es + self.derive
+0001e7f0: 6470 6172 616d 6e61 6d65 7329 2c0a 2020  dparamnames),.  
+0001e800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e810: 2020 2020 2063 6f6d 6d65 6e74 733d 2727       comments=''
+0001e820: 290a 2020 2020 2020 2020 2020 2020 6e70  ).            np
+0001e830: 2e73 6176 6574 7874 286f 732e 7061 7468  .savetxt(os.path
+0001e840: 2e6a 6f69 6e28 7365 6c66 2e6c 6f67 735b  .join(self.logs[
+0001e850: 2763 6861 696e 7327 5d2c 2027 7765 6967  'chains'], 'weig
+0001e860: 6874 6564 5f70 6f73 742e 7478 7427 292c  hted_post.txt'),
+0001e870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e880: 2020 2020 2020 2020 6e70 2e68 7374 6163          np.hstac
+0001e890: 6b28 2873 6176 6564 5f77 7430 2e72 6573  k((saved_wt0.res
+0001e8a0: 6861 7065 2828 2d31 2c20 3129 292c 206e  hape((-1, 1)), n
+0001e8b0: 702e 7265 7368 6170 6528 7361 7665 645f  p.reshape(saved_
+0001e8c0: 6c6f 676c 2c20 282d 312c 2031 2929 2c20  logl, (-1, 1)), 
+0001e8d0: 7361 7665 645f 7629 292c 0a20 2020 2020  saved_v)),.     
+0001e8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8f0: 2020 6865 6164 6572 3d27 2027 2e6a 6f69    header=' '.joi
+0001e900: 6e28 5b27 7765 6967 6874 272c 2027 6c6f  n(['weight', 'lo
+0001e910: 676c 275d 202b 2073 656c 662e 7061 7261  gl'] + self.para
+0001e920: 6d6e 616d 6573 202b 2073 656c 662e 6465  mnames + self.de
+0001e930: 7269 7665 6470 6172 616d 6e61 6d65 7329  rivedparamnames)
+0001e940: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e950: 2020 2020 2020 2020 2063 6f6d 6d65 6e74           comment
+0001e960: 733d 2727 290a 2020 2020 2020 2020 2020  s='').          
+0001e970: 2020 6e70 2e73 6176 6574 7874 286f 732e    np.savetxt(os.
+0001e980: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e6c  path.join(self.l
+0001e990: 6f67 735b 2763 6861 696e 7327 5d2c 2027  ogs['chains'], '
+0001e9a0: 7765 6967 6874 6564 5f70 6f73 745f 756e  weighted_post_un
+0001e9b0: 7472 616e 7366 6f72 6d65 642e 7478 7427  transformed.txt'
+0001e9c0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001e9d0: 2020 2020 2020 2020 2020 6e70 2e68 7374            np.hst
+0001e9e0: 6163 6b28 2873 6176 6564 5f77 7430 2e72  ack((saved_wt0.r
+0001e9f0: 6573 6861 7065 2828 2d31 2c20 3129 292c  eshape((-1, 1)),
+0001ea00: 206e 702e 7265 7368 6170 6528 7361 7665   np.reshape(save
+0001ea10: 645f 6c6f 676c 2c20 282d 312c 2031 2929  d_logl, (-1, 1))
+0001ea20: 2c20 7361 7665 645f 7529 292c 0a20 2020  , saved_u)),.   
+0001ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ea40: 2020 2020 6865 6164 6572 3d27 2027 2e6a      header=' '.j
+0001ea50: 6f69 6e28 5b27 7765 6967 6874 272c 2027  oin(['weight', '
+0001ea60: 6c6f 676c 275d 202b 2073 656c 662e 7061  logl'] + self.pa
+0001ea70: 7261 6d6e 616d 6573 202b 2073 656c 662e  ramnames + self.
+0001ea80: 6465 7269 7665 6470 6172 616d 6e61 6d65  derivedparamname
+0001ea90: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+0001eaa0: 2020 2020 2020 2020 2020 2063 6f6d 6d65             comme
+0001eab0: 6e74 733d 2727 290a 0a20 2020 2020 2020  nts='')..       
+0001eac0: 2020 2020 2077 6974 6820 6f70 656e 286f       with open(o
+0001ead0: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
+0001eae0: 2e6c 6f67 735b 2769 6e66 6f27 5d2c 2027  .logs['info'], '
+0001eaf0: 7265 7375 6c74 732e 6a73 6f6e 2729 2c20  results.json'), 
+0001eb00: 2777 2729 2061 7320 663a 0a20 2020 2020  'w') as f:.     
+0001eb10: 2020 2020 2020 2020 2020 206a 736f 6e2e             json.
+0001eb20: 6475 6d70 2872 6573 756c 7473 5f73 696d  dump(results_sim
+0001eb30: 706c 652c 2066 2c20 696e 6465 6e74 3d34  ple, f, indent=4
+0001eb40: 290a 0a20 2020 2020 2020 2020 2020 206e  )..            n
+0001eb50: 702e 7361 7665 7478 7428 0a20 2020 2020  p.savetxt(.     
+0001eb60: 2020 2020 2020 2020 2020 206f 732e 7061             os.pa
+0001eb70: 7468 2e6a 6f69 6e28 7365 6c66 2e6c 6f67  th.join(self.log
+0001eb80: 735b 2769 6e66 6f27 5d2c 2027 706f 7374  s['info'], 'post
+0001eb90: 5f73 756d 6d61 7279 2e63 7376 2729 2c0a  _summary.csv'),.
+0001eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ebb0: 5b5b 7265 7375 6c74 735b 2770 6f73 7465  [[results['poste
+0001ebc0: 7269 6f72 275d 5b6b 5d5b 695d 2066 6f72  rior'][k][i] for
+0001ebd0: 2069 2069 6e20 7261 6e67 6528 7365 6c66   i in range(self
+0001ebe0: 2e6e 756d 5f70 6172 616d 7329 2066 6f72  .num_params) for
+0001ebf0: 206b 2069 6e20 2827 6d65 616e 272c 2027   k in ('mean', '
+0001ec00: 7374 6465 7627 2c20 276d 6564 6961 6e27  stdev', 'median'
+0001ec10: 2c20 2765 7272 6c6f 272c 2027 6572 7275  , 'errlo', 'erru
+0001ec20: 7027 295d 5d2c 0a20 2020 2020 2020 2020  p')]],.         
+0001ec30: 2020 2020 2020 2068 6561 6465 723d 272c         header=',
+0001ec40: 272e 6a6f 696e 285b 2722 7b30 7d5f 6d65  '.join(['"{0}_me
+0001ec50: 616e 222c 227b 307d 5f73 7464 6576 222c  an","{0}_stdev",
+0001ec60: 227b 307d 5f6d 6564 6961 6e22 2c22 7b30  "{0}_median","{0
+0001ec70: 7d5f 6572 726c 6f22 2c22 7b30 7d5f 6572  }_errlo","{0}_er
+0001ec80: 7275 7022 272e 666f 726d 6174 286b 290a  rup"'.format(k).
+0001ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ecb0: 2066 6f72 206b 2069 6e20 7365 6c66 2e70   for k in self.p
+0001ecc0: 6172 616d 6e61 6d65 7320 2b20 7365 6c66  aramnames + self
+0001ecd0: 2e64 6572 6976 6564 7061 7261 6d6e 616d  .derivedparamnam
+0001ece0: 6573 5d29 2c0a 2020 2020 2020 2020 2020  es]),.          
+0001ecf0: 2020 2020 2020 6465 6c69 6d69 7465 723d        delimiter=
+0001ed00: 272c 272c 2063 6f6d 6d65 6e74 733d 2727  ',', comments=''
+0001ed10: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0001ed20: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001ed30: 2e6c 6f67 5f74 6f5f 6469 736b 3a0a 2020  .log_to_disk:.  
+0001ed40: 2020 2020 2020 2020 2020 6b65 7973 203d            keys =
+0001ed50: 2027 6c6f 677a 272c 2027 6c6f 677a 6572   'logz', 'logzer
+0001ed60: 7227 2c20 276c 6f67 766f 6c27 2c20 276e  r', 'logvol', 'n
+0001ed70: 6c69 7665 272c 2027 6c6f 676c 272c 2027  live', 'logl', '
+0001ed80: 6c6f 6777 7427 2c20 2769 6e73 6572 745f  logwt', 'insert_
+0001ed90: 6f72 6465 7227 0a20 2020 2020 2020 2020  order'.         
+0001eda0: 2020 206e 702e 7361 7665 7478 7428 6f73     np.savetxt(os
+0001edb0: 2e70 6174 682e 6a6f 696e 2873 656c 662e  .path.join(self.
+0001edc0: 6c6f 6773 5b27 6368 6169 6e73 275d 2c20  logs['chains'], 
+0001edd0: 2772 756e 2e74 7874 2729 2c0a 2020 2020  'run.txt'),.    
+0001ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edf0: 2020 206e 702e 6873 7461 636b 2874 7570     np.hstack(tup
+0001ee00: 6c65 285b 6e70 2e72 6573 6861 7065 2873  le([np.reshape(s
+0001ee10: 6571 7565 6e63 655b 6b5d 2c20 282d 312c  equence[k], (-1,
+0001ee20: 2031 2929 2066 6f72 206b 2069 6e20 6b65   1)) for k in ke
+0001ee30: 7973 5d29 292c 0a20 2020 2020 2020 2020  ys])),.         
+0001ee40: 2020 2020 2020 2020 2020 2020 2020 6865                he
+0001ee50: 6164 6572 3d27 2027 2e6a 6f69 6e28 6b65  ader=' '.join(ke
+0001ee60: 7973 292c 0a20 2020 2020 2020 2020 2020  ys),.           
+0001ee70: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+0001ee80: 656e 7473 3d27 2729 0a20 2020 2020 2020  ents='').       
+0001ee90: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
+0001eea0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001eeb0: 2020 7365 6c66 2e6c 6f67 6765 722e 696e    self.logger.in
+0001eec0: 666f 2822 5772 6974 696e 6720 7361 6d70  fo("Writing samp
+0001eed0: 6c65 7320 616e 6420 7265 7375 6c74 7320  les and results 
+0001eee0: 746f 2064 6973 6b20 2e2e 2e20 646f 6e65  to disk ... done
+0001eef0: 2229 0a0a 2020 2020 2020 2020 7365 6c66  ")..        self
+0001ef00: 2e72 6573 756c 7473 203d 2072 6573 756c  .results = resul
+0001ef10: 7473 0a20 2020 2020 2020 2073 656c 662e  ts.        self.
+0001ef20: 7275 6e5f 7365 7175 656e 6365 203d 2073  run_sequence = s
+0001ef30: 6571 7565 6e63 650a 0a20 2020 2064 6566  equence..    def
+0001ef40: 2073 746f 7265 5f74 7265 6528 7365 6c66   store_tree(self
+0001ef50: 293a 0a20 2020 2020 2020 2022 2222 5374  ):.        """St
+0001ef60: 6f72 6520 7472 6565 2074 6f20 6469 736b  ore tree to disk
+0001ef70: 2028 7265 7375 6c74 732f 7472 6565 2e68   (results/tree.h
+0001ef80: 6466 3529 2e22 2222 0a20 2020 2020 2020  df5).""".       
+0001ef90: 2069 6620 7365 6c66 2e6c 6f67 5f74 6f5f   if self.log_to_
+0001efa0: 6469 736b 3a0a 2020 2020 2020 2020 2020  disk:.          
+0001efb0: 2020 6475 6d70 5f74 7265 6528 6f73 2e70    dump_tree(os.p
+0001efc0: 6174 682e 6a6f 696e 2873 656c 662e 6c6f  ath.join(self.lo
+0001efd0: 6773 5b27 7265 7375 6c74 7327 5d2c 2027  gs['results'], '
+0001efe0: 7472 6565 2e68 6466 3527 292c 0a20 2020  tree.hdf5'),.   
+0001eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f000: 2020 2073 656c 662e 726f 6f74 2e63 6869     self.root.chi
+0001f010: 6c64 7265 6e2c 2073 656c 662e 706f 696e  ldren, self.poin
+0001f020: 7470 696c 6529 0a0a 2020 2020 6465 6620  tpile)..    def 
+0001f030: 7072 696e 745f 7265 7375 6c74 7328 7365  print_results(se
+0001f040: 6c66 2c20 7573 655f 756e 6963 6f64 653d  lf, use_unicode=
+0001f050: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
+0001f060: 2222 4769 7665 2073 756d 6d61 7279 206f  ""Give summary o
+0001f070: 6620 6d61 7267 696e 616c 206c 696b 656c  f marginal likel
+0001f080: 6968 6f6f 6420 616e 6420 7061 7261 6d65  ihood and parame
+0001f090: 7465 7220 706f 7374 6572 696f 7273 2e0a  ter posteriors..
+0001f0a0: 0a20 2020 2020 2020 2050 6172 616d 6574  .        Paramet
+0001f0b0: 6572 730a 2020 2020 2020 2020 2d2d 2d2d  ers.        ----
+0001f0c0: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2075  ------.        u
+0001f0d0: 7365 5f75 6e69 636f 6465 3a20 626f 6f6c  se_unicode: bool
+0001f0e0: 0a20 2020 2020 2020 2020 2020 2057 6865  .            Whe
+0001f0f0: 7468 6572 2074 6f20 7072 696e 7420 6120  ther to print a 
+0001f100: 756e 6963 6f64 6520 706c 6f74 206f 6620  unicode plot of 
+0001f110: 7468 6520 706f 7374 6572 696f 7220 6469  the posterior di
+0001f120: 7374 7269 6275 7469 6f6e 730a 0a20 2020  stributions..   
+0001f130: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001f140: 2069 6620 7365 6c66 2e6c 6f67 3a0a 2020   if self.log:.  
+0001f150: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0001f160: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+0001f170: 696e 7428 276c 6f67 5a20 3d20 2528 6c6f  int('logZ = %(lo
+0001f180: 677a 292e 3366 202b 2d20 2528 6c6f 677a  gz).3f +- %(logz
+0001f190: 6572 7229 2e33 6627 2025 2073 656c 662e  err).3f' % self.
+0001f1a0: 7265 7375 6c74 7329 0a20 2020 2020 2020  results).       
+0001f1b0: 2020 2020 2070 7269 6e74 2827 2020 7369       print('  si
+0001f1c0: 6e67 6c65 2069 6e73 7461 6e63 653a 206c  ngle instance: l
+0001f1d0: 6f67 5a20 3d20 2528 6c6f 677a 5f73 696e  ogZ = %(logz_sin
+0001f1e0: 676c 6529 2e33 6620 2b2d 2025 286c 6f67  gle).3f +- %(log
+0001f1f0: 7a65 7272 5f73 696e 676c 6529 2e33 6627  zerr_single).3f'
+0001f200: 2025 2073 656c 662e 7265 7375 6c74 7329   % self.results)
+0001f210: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001f220: 6e74 2827 2020 626f 6f74 7374 7261 7070  nt('  bootstrapp
+0001f230: 6564 2020 203a 206c 6f67 5a20 3d20 2528  ed   : logZ = %(
+0001f240: 6c6f 677a 5f62 7329 2e33 6620 2b2d 2025  logz_bs).3f +- %
+0001f250: 286c 6f67 7a65 7272 5f62 7329 2e33 6627  (logzerr_bs).3f'
+0001f260: 2025 2073 656c 662e 7265 7375 6c74 7329   % self.results)
+0001f270: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001f280: 6e74 2827 2020 7461 696c 2020 2020 2020  nt('  tail      
+0001f290: 2020 2020 203a 206c 6f67 5a20 3d20 2b2d       : logZ = +-
+0001f2a0: 2025 286c 6f67 7a65 7272 5f74 6169 6c29   %(logzerr_tail)
+0001f2b0: 2e33 6627 2025 2073 656c 662e 7265 7375  .3f' % self.resu
+0001f2c0: 6c74 7329 0a20 2020 2020 2020 2020 2020  lts).           
+0001f2d0: 2070 7269 6e74 2827 696e 7365 7274 206f   print('insert o
+0001f2e0: 7264 6572 2055 2074 6573 7420 3a20 636f  rder U test : co
+0001f2f0: 6e76 6572 6765 643a 2025 2863 6f6e 7665  nverged: %(conve
+0001f300: 7267 6564 2973 2063 6f72 7265 6c61 7469  rged)s correlati
+0001f310: 6f6e 3a20 2528 696e 6465 7065 6e64 656e  on: %(independen
+0001f320: 745f 6974 6572 6174 696f 6e73 2973 2069  t_iterations)s i
+0001f330: 7465 7261 7469 6f6e 7327 2025 2028 0a20  terations' % (. 
+0001f340: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001f350: 656c 662e 7265 7375 6c74 735b 2769 6e73  elf.results['ins
+0001f360: 6572 7469 6f6e 5f6f 7264 6572 5f4d 5757  ertion_order_MWW
+0001f370: 5f74 6573 7427 5d29 290a 2020 2020 2020  _test'])).      
+0001f380: 2020 2020 2020 6966 2073 656c 662e 7374        if self.st
+0001f390: 6570 7361 6d70 6c65 7220 616e 6420 6861  epsampler and ha
+0001f3a0: 7361 7474 7228 7365 6c66 2e73 7465 7073  sattr(self.steps
+0001f3b0: 616d 706c 6572 2c20 2770 7269 6e74 5f64  ampler, 'print_d
+0001f3c0: 6961 676e 6f73 7469 6327 293a 0a20 2020  iagnostic'):.   
+0001f3d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0001f3e0: 662e 7374 6570 7361 6d70 6c65 722e 7072  f.stepsampler.pr
+0001f3f0: 696e 745f 6469 6167 6e6f 7374 6963 2829  int_diagnostic()
+0001f400: 0a0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
+0001f410: 696e 7428 290a 2020 2020 2020 2020 2020  int().          
+0001f420: 2020 666f 7220 692c 2070 2069 6e20 656e    for i, p in en
+0001f430: 756d 6572 6174 6528 7365 6c66 2e70 6172  umerate(self.par
+0001f440: 616d 6e61 6d65 7320 2b20 7365 6c66 2e64  amnames + self.d
+0001f450: 6572 6976 6564 7061 7261 6d6e 616d 6573  erivedparamnames
+0001f460: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001f470: 2020 2076 203d 2073 656c 662e 7265 7375     v = self.resu
+0001f480: 6c74 735b 2773 616d 706c 6573 275d 5b3a  lts['samples'][:
+0001f490: 2c69 5d0a 2020 2020 2020 2020 2020 2020  ,i].            
+0001f4a0: 2020 2020 7369 676d 6120 3d20 762e 7374      sigma = v.st
+0001f4b0: 6428 290a 2020 2020 2020 2020 2020 2020  d().            
+0001f4c0: 2020 2020 6d65 6420 3d20 762e 6d65 616e      med = v.mean
+0001f4d0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0001f4e0: 2020 2069 6620 7369 676d 6120 3d3d 2030     if sigma == 0
+0001f4f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f500: 2020 2020 2020 6a20 3d20 330a 2020 2020        j = 3.    
+0001f510: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001f520: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f530: 2020 2020 2020 6a20 3d20 6d61 7828 302c        j = max(0,
+0001f540: 2069 6e74 282d 6e70 2e66 6c6f 6f72 286e   int(-np.floor(n
+0001f550: 702e 6c6f 6731 3028 7369 676d 6129 2929  p.log10(sigma)))
+0001f560: 202b 2031 290a 2020 2020 2020 2020 2020   + 1).          
+0001f570: 2020 2020 2020 666d 7420 3d20 2725 252e        fmt = '%%.
+0001f580: 2564 6627 2025 206a 0a20 2020 2020 2020  %df' % j.       
+0001f590: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
 0001f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5b0: 2020 2020 2072 6169 7365 2055 6e69 636f       raise Unico
-0001f5c0: 6465 456e 636f 6465 4572 726f 7228 2222  deEncodeError(""
-0001f5d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001f5e0: 2020 2020 2020 2320 6d61 6b65 2066 616e        # make fan
-0001f5f0: 6379 2074 6572 6d69 6e61 6c20 7669 7375  cy terminal visu
-0001f600: 616c 6973 6174 696f 6e20 6f6e 2061 2062  alisation on a b
-0001f610: 6573 742d 6566 666f 7274 2062 6173 6973  est-effort basis
-0001f620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f630: 2020 2020 2027 20e2 9681 e296 82e2 9683       ' .........
-0001f640: e296 84e2 9685 e296 86e2 9687 e296 88e2  ................
-0001f650: 9688 272e 656e 636f 6465 2873 7973 2e73  ..'.encode(sys.s
-0001f660: 7464 6f75 742e 656e 636f 6469 6e67 290a  tdout.encoding).
-0001f670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f680: 2020 2020 482c 2065 6467 6573 203d 206e      H, edges = n
-0001f690: 702e 6869 7374 6f67 7261 6d28 762c 2062  p.histogram(v, b
-0001f6a0: 696e 733d 3430 290a 2020 2020 2020 2020  ins=40).        
-0001f6b0: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
-0001f6c0: 6420 6120 6269 7420 6f66 2070 6164 6469  d a bit of paddi
-0001f6d0: 6e67 2c20 6275 7420 6e6f 7420 6f75 7473  ng, but not outs
-0001f6e0: 6964 6520 7061 7261 6d65 7465 7220 6c69  ide parameter li
-0001f6f0: 6d69 7473 0a20 2020 2020 2020 2020 2020  mits.           
-0001f700: 2020 2020 2020 2020 206c 6f2c 2068 6920           lo, hi 
-0001f710: 3d20 6564 6765 735b 305d 2c20 6564 6765  = edges[0], edge
-0001f720: 735b 2d31 5d0a 2020 2020 2020 2020 2020  s[-1].          
-0001f730: 2020 2020 2020 2020 2020 7374 6570 203d            step =
-0001f740: 2065 6467 6573 5b31 5d20 2d20 6c6f 0a20   edges[1] - lo. 
+0001f5b0: 2020 6966 206e 6f74 2075 7365 5f75 6e69    if not use_uni
+0001f5c0: 636f 6465 3a0a 2020 2020 2020 2020 2020  code:.          
+0001f5d0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0001f5e0: 6973 6520 556e 6963 6f64 6545 6e63 6f64  ise UnicodeEncod
+0001f5f0: 6545 7272 6f72 2822 2229 0a20 2020 2020  eError("").     
+0001f600: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001f610: 206d 616b 6520 6661 6e63 7920 7465 726d   make fancy term
+0001f620: 696e 616c 2076 6973 7561 6c69 7361 7469  inal visualisati
+0001f630: 6f6e 206f 6e20 6120 6265 7374 2d65 6666  on on a best-eff
+0001f640: 6f72 7420 6261 7369 730a 2020 2020 2020  ort basis.      
+0001f650: 2020 2020 2020 2020 2020 2020 2020 2720                ' 
+0001f660: e296 81e2 9682 e296 83e2 9684 e296 85e2  ................
+0001f670: 9686 e296 87e2 9688 e296 8827 2e65 6e63  ...........'.enc
+0001f680: 6f64 6528 7379 732e 7374 646f 7574 2e65  ode(sys.stdout.e
+0001f690: 6e63 6f64 696e 6729 0a20 2020 2020 2020  ncoding).       
+0001f6a0: 2020 2020 2020 2020 2020 2020 2048 2c20               H, 
+0001f6b0: 6564 6765 7320 3d20 6e70 2e68 6973 746f  edges = np.histo
+0001f6c0: 6772 616d 2876 2c20 6269 6e73 3d34 3029  gram(v, bins=40)
+0001f6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f6e0: 2020 2020 2023 2061 6464 2061 2062 6974       # add a bit
+0001f6f0: 206f 6620 7061 6464 696e 672c 2062 7574   of padding, but
+0001f700: 206e 6f74 206f 7574 7369 6465 2070 6172   not outside par
+0001f710: 616d 6574 6572 206c 696d 6974 730a 2020  ameter limits.  
+0001f720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f730: 2020 6c6f 2c20 6869 203d 2065 6467 6573    lo, hi = edges
+0001f740: 5b30 5d2c 2065 6467 6573 5b2d 315d 0a20  [0], edges[-1]. 
 0001f750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f760: 2020 206c 6f20 3d20 6d61 7828 7365 6c66     lo = max(self
-0001f770: 2e74 7261 6e73 666f 726d 5f6c 696d 6974  .transform_limit
-0001f780: 735b 692c 305d 2c20 6c6f 202d 2032 202a  s[i,0], lo - 2 *
-0001f790: 2073 7465 7029 0a20 2020 2020 2020 2020   step).         
-0001f7a0: 2020 2020 2020 2020 2020 2068 6920 3d20             hi = 
-0001f7b0: 6d69 6e28 7365 6c66 2e74 7261 6e73 666f  min(self.transfo
-0001f7c0: 726d 5f6c 696d 6974 735b 692c 315d 2c20  rm_limits[i,1], 
-0001f7d0: 6869 202b 2032 202a 2073 7465 7029 0a20  hi + 2 * step). 
-0001f7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f7f0: 2020 2048 2c20 6564 6765 7320 3d20 6e70     H, edges = np
-0001f800: 2e68 6973 746f 6772 616d 2876 2c20 6269  .histogram(v, bi
-0001f810: 6e73 3d6e 702e 6c69 6e73 7061 6365 286c  ns=np.linspace(l
-0001f820: 6f2c 2068 692c 2034 3029 290a 2020 2020  o, hi, 40)).    
-0001f830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f840: 6c6f 2c20 6869 203d 2065 6467 6573 5b30  lo, hi = edges[0
-0001f850: 5d2c 2065 6467 6573 5b2d 315d 0a0a 2020  ], edges[-1]..  
-0001f860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f870: 2020 6469 7374 203d 2027 272e 6a6f 696e    dist = ''.join
-0001f880: 285b 2720 e296 81e2 9682 e296 83e2 9684  ([' ............
-0001f890: e296 85e2 9686 e296 87e2 9688 e296 8827  ...............'
-0001f8a0: 5b69 5d20 666f 7220 6920 696e 206e 702e  [i] for i in np.
-0001f8b0: 6365 696c 2848 202a 2037 202f 2048 2e6d  ceil(H * 7 / H.m
-0001f8c0: 6178 2829 292e 6173 7479 7065 2869 6e74  ax()).astype(int
-0001f8d0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
-0001f8e0: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
-0001f8f0: 2020 2025 2d32 3073 3a20 252d 3673 e294     %-20s: %-6s..
-0001f900: 8225 73e2 9482 252d 3673 2020 2020 2573  .%s...%-6s    %s
-0001f910: 202b 2d20 2573 2720 2520 2870 2c20 666d   +- %s' % (p, fm
-0001f920: 7420 2520 6c6f 2c20 6469 7374 2c20 666d  t % lo, dist, fm
-0001f930: 7420 2520 6869 2c20 666d 7420 2520 6d65  t % hi, fmt % me
-0001f940: 642c 2066 6d74 2025 2073 6967 6d61 2929  d, fmt % sigma))
-0001f950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f960: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0001f970: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
-0001f980: 2020 2020 2020 2066 6d74 7320 3d20 2720         fmts = ' 
-0001f990: 2020 2025 2d32 3073 2720 2b20 666d 7420     %-20s' + fmt 
-0001f9a0: 2b20 2220 2b2d 2022 202b 2066 6d74 0a20  + " +- " + fmt. 
-0001f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f9c0: 2020 2070 7269 6e74 2866 6d74 7320 2520     print(fmts % 
-0001f9d0: 2870 2c20 6d65 642c 2073 6967 6d61 2929  (p, med, sigma))
-0001f9e0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0001f9f0: 6e74 2829 0a0a 2020 2020 6465 6620 706c  nt()..    def pl
-0001fa00: 6f74 2873 656c 6629 3a0a 2020 2020 2020  ot(self):.      
-0001fa10: 2020 2222 224d 616b 6520 636f 726e 6572    """Make corner
-0001fa20: 2c20 7275 6e20 616e 6420 7472 6163 6520  , run and trace 
-0001fa30: 706c 6f74 732e 0a0a 2020 2020 2020 2020  plots...        
-0001fa40: 6361 6c6c 733a 0a0a 2020 2020 2020 2020  calls:..        
-0001fa50: 2a20 706c 6f74 5f63 6f72 6e65 7228 290a  * plot_corner().
-0001fa60: 2020 2020 2020 2020 2a20 706c 6f74 5f72          * plot_r
-0001fa70: 756e 2829 0a20 2020 2020 2020 202a 2070  un().        * p
-0001fa80: 6c6f 745f 7472 6163 6528 290a 2020 2020  lot_trace().    
-0001fa90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001faa0: 7365 6c66 2e70 6c6f 745f 636f 726e 6572  self.plot_corner
-0001fab0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-0001fac0: 706c 6f74 5f72 756e 2829 0a20 2020 2020  plot_run().     
-0001fad0: 2020 2073 656c 662e 706c 6f74 5f74 7261     self.plot_tra
-0001fae0: 6365 2829 0a0a 2020 2020 6465 6620 706c  ce()..    def pl
-0001faf0: 6f74 5f63 6f72 6e65 7228 7365 6c66 293a  ot_corner(self):
-0001fb00: 0a20 2020 2020 2020 2022 2222 4d61 6b65  .        """Make
-0001fb10: 2063 6f72 6e65 7220 706c 6f74 2e0a 0a20   corner plot... 
-0001fb20: 2020 2020 2020 2057 7269 7465 7320 636f         Writes co
-0001fb30: 726e 6572 2070 6c6f 7420 746f 2070 6c6f  rner plot to plo
-0001fb40: 7473 2f20 6469 7265 6374 6f72 7920 6966  ts/ directory if
-0001fb50: 206c 6f67 2064 6972 6563 746f 7279 2077   log directory w
-0001fb60: 6173 0a20 2020 2020 2020 2073 7065 6369  as.        speci
-0001fb70: 6669 6564 2c20 6f74 6865 7277 6973 6520  fied, otherwise 
-0001fb80: 7368 6f77 2069 6e74 6572 6163 7469 7665  show interactive
-0001fb90: 6c79 2e0a 0a20 2020 2020 2020 2054 6869  ly...        Thi
-0001fba0: 7320 646f 6573 2065 7373 656e 7469 616c  s does essential
-0001fbb0: 6c79 3a3a 0a0a 2020 2020 2020 2020 2020  ly::..          
-0001fbc0: 2020 6672 6f6d 2075 6c74 7261 6e65 7374    from ultranest
-0001fbd0: 2e70 6c6f 7420 696d 706f 7274 2063 6f72  .plot import cor
-0001fbe0: 6e65 7270 6c6f 740a 2020 2020 2020 2020  nerplot.        
-0001fbf0: 2020 2020 636f 726e 6572 706c 6f74 2872      cornerplot(r
-0001fc00: 6573 756c 7473 290a 0a20 2020 2020 2020  esults)..       
-0001fc10: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-0001fc20: 6d20 2e70 6c6f 7420 696d 706f 7274 2063  m .plot import c
-0001fc30: 6f72 6e65 7270 6c6f 740a 2020 2020 2020  ornerplot.      
-0001fc40: 2020 696d 706f 7274 206d 6174 706c 6f74    import matplot
-0001fc50: 6c69 622e 7079 706c 6f74 2061 7320 706c  lib.pyplot as pl
-0001fc60: 740a 2020 2020 2020 2020 6966 2073 656c  t.        if sel
-0001fc70: 662e 6c6f 673a 0a20 2020 2020 2020 2020  f.log:.         
-0001fc80: 2020 2073 656c 662e 6c6f 6767 6572 2e64     self.logger.d
-0001fc90: 6562 7567 2827 4d61 6b69 6e67 2063 6f72  ebug('Making cor
-0001fca0: 6e65 7220 706c 6f74 202e 2e2e 2729 0a20  ner plot ...'). 
-0001fcb0: 2020 2020 2020 2063 6f72 6e65 7270 6c6f         cornerplo
-0001fcc0: 7428 7365 6c66 2e72 6573 756c 7473 2c20  t(self.results, 
-0001fcd0: 6c6f 6767 6572 3d73 656c 662e 6c6f 6767  logger=self.logg
-0001fce0: 6572 2069 6620 7365 6c66 2e6c 6f67 2065  er if self.log e
-0001fcf0: 6c73 6520 4e6f 6e65 290a 2020 2020 2020  lse None).      
-0001fd00: 2020 6966 2073 656c 662e 6c6f 675f 746f    if self.log_to
-0001fd10: 5f64 6973 6b3a 0a20 2020 2020 2020 2020  _disk:.         
-0001fd20: 2020 2070 6c74 2e73 6176 6566 6967 286f     plt.savefig(o
-0001fd30: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-0001fd40: 2e6c 6f67 735b 2770 6c6f 7473 275d 2c20  .logs['plots'], 
-0001fd50: 2763 6f72 6e65 722e 7064 6627 292c 2062  'corner.pdf'), b
-0001fd60: 626f 785f 696e 6368 6573 3d27 7469 6768  box_inches='tigh
-0001fd70: 7427 290a 2020 2020 2020 2020 2020 2020  t').            
-0001fd80: 706c 742e 636c 6f73 6528 290a 2020 2020  plt.close().    
-0001fd90: 2020 2020 2020 2020 7365 6c66 2e6c 6f67          self.log
-0001fda0: 6765 722e 6465 6275 6728 274d 616b 696e  ger.debug('Makin
-0001fdb0: 6720 636f 726e 6572 2070 6c6f 7420 2e2e  g corner plot ..
-0001fdc0: 2e20 646f 6e65 2729 0a0a 2020 2020 6465  . done')..    de
-0001fdd0: 6620 706c 6f74 5f74 7261 6365 2873 656c  f plot_trace(sel
-0001fde0: 6629 3a0a 2020 2020 2020 2020 2222 224d  f):.        """M
-0001fdf0: 616b 6520 7472 6163 6520 706c 6f74 2e0a  ake trace plot..
-0001fe00: 0a20 2020 2020 2020 2057 7269 7465 2070  .        Write p
-0001fe10: 6172 616d 6574 6572 2074 7261 6365 2064  arameter trace d
-0001fe20: 6961 676e 6f73 7469 6320 706c 6f74 7320  iagnostic plots 
-0001fe30: 746f 2070 6c6f 7473 2f20 6469 7265 6374  to plots/ direct
-0001fe40: 6f72 790a 2020 2020 2020 2020 6966 206c  ory.        if l
-0001fe50: 6f67 2064 6972 6563 746f 7279 2073 7065  og directory spe
-0001fe60: 6369 6669 6564 2c20 6f74 6865 7277 6973  cified, otherwis
-0001fe70: 6520 7368 6f77 2069 6e74 6572 6163 7469  e show interacti
-0001fe80: 7665 6c79 2e0a 0a20 2020 2020 2020 2054  vely...        T
-0001fe90: 6869 7320 646f 6573 2065 7373 656e 7469  his does essenti
-0001fea0: 616c 6c79 3a3a 0a0a 2020 2020 2020 2020  ally::..        
-0001feb0: 2020 2020 6672 6f6d 2075 6c74 7261 6e65      from ultrane
-0001fec0: 7374 2e70 6c6f 7420 696d 706f 7274 2074  st.plot import t
-0001fed0: 7261 6365 706c 6f74 0a20 2020 2020 2020  raceplot.       
-0001fee0: 2020 2020 2074 7261 6365 706c 6f74 2872       traceplot(r
-0001fef0: 6573 756c 7473 3d72 6573 756c 7473 2c20  esults=results, 
-0001ff00: 6c61 6265 6c73 3d70 6172 616d 6e61 6d65  labels=paramname
-0001ff10: 7320 2b20 6465 7269 7665 6470 6172 616d  s + derivedparam
-0001ff20: 6e61 6d65 7329 0a0a 2020 2020 2020 2020  names)..        
-0001ff30: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-0001ff40: 202e 706c 6f74 2069 6d70 6f72 7420 7472   .plot import tr
-0001ff50: 6163 6570 6c6f 740a 2020 2020 2020 2020  aceplot.        
-0001ff60: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
-0001ff70: 622e 7079 706c 6f74 2061 7320 706c 740a  b.pyplot as plt.
-0001ff80: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001ff90: 6c6f 673a 0a20 2020 2020 2020 2020 2020  log:.           
-0001ffa0: 2073 656c 662e 6c6f 6767 6572 2e64 6562   self.logger.deb
-0001ffb0: 7567 2827 4d61 6b69 6e67 2074 7261 6365  ug('Making trace
-0001ffc0: 2070 6c6f 7420 2e2e 2e20 2729 0a20 2020   plot ... ').   
-0001ffd0: 2020 2020 2070 6172 616d 6e61 6d65 7320       paramnames 
-0001ffe0: 3d20 7365 6c66 2e70 6172 616d 6e61 6d65  = self.paramname
-0001fff0: 7320 2b20 7365 6c66 2e64 6572 6976 6564  s + self.derived
-00020000: 7061 7261 6d6e 616d 6573 0a20 2020 2020  paramnames.     
-00020010: 2020 2023 2067 6574 2064 796e 6573 7479     # get dynesty
-00020020: 2d63 6f6d 7061 7469 626c 6520 7365 7175  -compatible sequ
-00020030: 656e 6365 730a 2020 2020 2020 2020 7472  ences.        tr
-00020040: 6163 6570 6c6f 7428 7265 7375 6c74 733d  aceplot(results=
-00020050: 7365 6c66 2e72 756e 5f73 6571 7565 6e63  self.run_sequenc
-00020060: 652c 206c 6162 656c 733d 7061 7261 6d6e  e, labels=paramn
-00020070: 616d 6573 290a 2020 2020 2020 2020 6966  ames).        if
-00020080: 2073 656c 662e 6c6f 675f 746f 5f64 6973   self.log_to_dis
-00020090: 6b3a 0a20 2020 2020 2020 2020 2020 2070  k:.            p
-000200a0: 6c74 2e73 6176 6566 6967 286f 732e 7061  lt.savefig(os.pa
-000200b0: 7468 2e6a 6f69 6e28 7365 6c66 2e6c 6f67  th.join(self.log
-000200c0: 735b 2770 6c6f 7473 275d 2c20 2774 7261  s['plots'], 'tra
-000200d0: 6365 2e70 6466 2729 2c20 6262 6f78 5f69  ce.pdf'), bbox_i
-000200e0: 6e63 6865 733d 2774 6967 6874 2729 0a20  nches='tight'). 
-000200f0: 2020 2020 2020 2020 2020 2070 6c74 2e63             plt.c
-00020100: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
-00020110: 2020 2073 656c 662e 6c6f 6767 6572 2e64     self.logger.d
-00020120: 6562 7567 2827 4d61 6b69 6e67 2074 7261  ebug('Making tra
-00020130: 6365 2070 6c6f 7420 2e2e 2e20 646f 6e65  ce plot ... done
-00020140: 2729 0a0a 2020 2020 6465 6620 706c 6f74  ')..    def plot
-00020150: 5f72 756e 2873 656c 6629 3a0a 2020 2020  _run(self):.    
-00020160: 2020 2020 2222 224d 616b 6520 7275 6e20      """Make run 
-00020170: 706c 6f74 2e0a 0a20 2020 2020 2020 2057  plot...        W
-00020180: 7269 7465 2072 756e 2064 6961 676e 6f73  rite run diagnos
-00020190: 7469 6320 706c 6f74 7320 746f 2070 6c6f  tic plots to plo
-000201a0: 7473 2f20 6469 7265 6374 6f72 790a 2020  ts/ directory.  
-000201b0: 2020 2020 2020 6966 206c 6f67 2064 6972        if log dir
-000201c0: 6563 746f 7279 2073 7065 6369 6669 6564  ectory specified
-000201d0: 2c20 6f74 6865 7277 6973 6520 7368 6f77  , otherwise show
-000201e0: 2069 6e74 6572 6163 7469 7665 6c79 2e0a   interactively..
-000201f0: 0a20 2020 2020 2020 2054 6869 7320 646f  .        This do
-00020200: 6573 2065 7373 656e 7469 616c 6c79 3a3a  es essentially::
-00020210: 0a0a 2020 2020 2020 2020 2020 2020 6672  ..            fr
-00020220: 6f6d 2075 6c74 7261 6e65 7374 2e70 6c6f  om ultranest.plo
-00020230: 7420 696d 706f 7274 2072 756e 706c 6f74  t import runplot
-00020240: 0a20 2020 2020 2020 2020 2020 2072 756e  .            run
-00020250: 706c 6f74 2872 6573 756c 7473 3d72 6573  plot(results=res
-00020260: 756c 7473 290a 0a20 2020 2020 2020 2022  ults)..        "
-00020270: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00020280: 2e70 6c6f 7420 696d 706f 7274 2072 756e  .plot import run
-00020290: 706c 6f74 0a20 2020 2020 2020 2069 6d70  plot.        imp
-000202a0: 6f72 7420 6d61 7470 6c6f 746c 6962 2e70  ort matplotlib.p
-000202b0: 7970 6c6f 7420 6173 2070 6c74 0a20 2020  yplot as plt.   
-000202c0: 2020 2020 2069 6620 7365 6c66 2e6c 6f67       if self.log
-000202d0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-000202e0: 6c66 2e6c 6f67 6765 722e 6465 6275 6728  lf.logger.debug(
-000202f0: 274d 616b 696e 6720 7275 6e20 706c 6f74  'Making run plot
-00020300: 202e 2e2e 2027 290a 2020 2020 2020 2020   ... ').        
-00020310: 2320 6765 7420 6479 6e65 7374 792d 636f  # get dynesty-co
-00020320: 6d70 6174 6962 6c65 2073 6571 7565 6e63  mpatible sequenc
-00020330: 6573 0a20 2020 2020 2020 2072 756e 706c  es.        runpl
-00020340: 6f74 2872 6573 756c 7473 3d73 656c 662e  ot(results=self.
-00020350: 7275 6e5f 7365 7175 656e 6365 2c20 6c6f  run_sequence, lo
-00020360: 6770 6c6f 743d 5472 7565 290a 2020 2020  gplot=True).    
-00020370: 2020 2020 6966 2073 656c 662e 6c6f 675f      if self.log_
-00020380: 746f 5f64 6973 6b3a 0a20 2020 2020 2020  to_disk:.       
-00020390: 2020 2020 2070 6c74 2e73 6176 6566 6967       plt.savefig
-000203a0: 286f 732e 7061 7468 2e6a 6f69 6e28 7365  (os.path.join(se
-000203b0: 6c66 2e6c 6f67 735b 2770 6c6f 7473 275d  lf.logs['plots']
-000203c0: 2c20 2772 756e 2e70 6466 2729 2c20 6262  , 'run.pdf'), bb
-000203d0: 6f78 5f69 6e63 6865 733d 2774 6967 6874  ox_inches='tight
-000203e0: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
-000203f0: 6c74 2e63 6c6f 7365 2829 0a20 2020 2020  lt.close().     
-00020400: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
-00020410: 6572 2e64 6562 7567 2827 4d61 6b69 6e67  er.debug('Making
-00020420: 2072 756e 2070 6c6f 7420 2e2e 2e20 646f   run plot ... do
-00020430: 6e65 2729 0a0a 0a64 6566 2072 6561 645f  ne')...def read_
-00020440: 6669 6c65 286c 6f67 5f64 6972 2c20 785f  file(log_dir, x_
-00020450: 6469 6d2c 206e 756d 5f62 6f6f 7473 7472  dim, num_bootstr
-00020460: 6170 733d 3230 2c20 7261 6e64 6f6d 3d54  aps=20, random=T
-00020470: 7275 652c 2076 6572 626f 7365 3d46 616c  rue, verbose=Fal
-00020480: 7365 2c20 6368 6563 6b5f 696e 7365 7274  se, check_insert
-00020490: 696f 6e5f 6f72 6465 723d 5472 7565 293a  ion_order=True):
-000204a0: 0a20 2020 2022 2222 0a20 2020 2052 6561  .    """.    Rea
-000204b0: 6420 7468 6520 6f75 7470 7574 2048 4446  d the output HDF
-000204c0: 3520 6669 6c65 206f 6620 556c 7472 614e  5 file of UltraN
-000204d0: 6573 742e 0a0a 2020 2020 5061 7261 6d65  est...    Parame
-000204e0: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-000204f0: 2d2d 2d0a 2020 2020 6c6f 675f 6469 723a  ---.    log_dir:
-00020500: 2073 7472 0a20 2020 2020 2020 2046 6f6c   str.        Fol
-00020510: 6465 7220 636f 6e74 6169 6e69 6e67 2072  der containing r
-00020520: 6573 756c 7473 0a20 2020 2078 5f64 696d  esults.    x_dim
-00020530: 3a20 696e 740a 2020 2020 2020 2020 6e75  : int.        nu
-00020540: 6d62 6572 206f 6620 6469 6d65 6e73 696f  mber of dimensio
-00020550: 6e73 0a20 2020 206e 756d 5f62 6f6f 7473  ns.    num_boots
-00020560: 7472 6170 733a 2069 6e74 0a20 2020 2020  traps: int.     
-00020570: 2020 206e 756d 6265 7220 6f66 2062 6f6f     number of boo
-00020580: 7473 7472 6170 7320 746f 2075 7365 2066  tstraps to use f
-00020590: 6f72 2065 7374 696d 6174 696e 6720 6c6f  or estimating lo
-000205a0: 675a 2e0a 2020 2020 7261 6e64 6f6d 3a20  gZ..    random: 
-000205b0: 626f 6f6c 0a20 2020 2020 2020 2075 7365  bool.        use
-000205c0: 2072 616e 646f 6d69 7a61 7469 6f6e 2066   randomization f
-000205d0: 6f72 2076 6f6c 756d 6520 6573 7469 6d61  or volume estima
-000205e0: 7469 6f6e 2e0a 2020 2020 7665 7262 6f73  tion..    verbos
-000205f0: 653a 2062 6f6f 6c0a 2020 2020 2020 2020  e: bool.        
-00020600: 7368 6f77 2070 726f 6772 6573 730a 2020  show progress.  
-00020610: 2020 6368 6563 6b5f 696e 7365 7274 696f    check_insertio
-00020620: 6e5f 6f72 6465 723a 2062 6f6f 6c0a 2020  n_order: bool.  
-00020630: 2020 2020 2020 7768 6574 6865 7220 746f        whether to
-00020640: 2070 6572 666f 726d 204d 5757 2069 6e73   perform MWW ins
-00020650: 6572 7469 6f6e 206f 7264 6572 2074 6573  ertion order tes
-00020660: 7420 666f 7220 6173 7365 7373 696e 6720  t for assessing 
-00020670: 636f 6e76 6572 6765 6e63 650a 0a20 2020  convergence..   
-00020680: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-00020690: 2d2d 2d2d 2d2d 2d0a 2020 2020 7365 7175  -------.    sequ
-000206a0: 656e 6365 3a20 6469 6374 0a20 2020 2020  ence: dict.     
-000206b0: 2020 2063 6f6e 7461 696e 7320 6172 7261     contains arra
-000206c0: 7973 2073 746f 7269 6e67 2066 6f72 2065  ys storing for e
-000206d0: 6163 6820 6974 6572 6174 696f 6e20 6573  ach iteration es
-000206e0: 7469 6d61 7465 7320 6f66 3a0a 0a20 2020  timates of:..   
-000206f0: 2020 2020 2020 2020 202a 206c 6f67 7a3a           * logz:
-00020700: 206c 6f67 2065 7669 6465 6e63 6520 6573   log evidence es
-00020710: 7469 6d61 7465 0a20 2020 2020 2020 2020  timate.         
-00020720: 2020 202a 206c 6f67 7a65 7272 3a20 6c6f     * logzerr: lo
-00020730: 6720 6576 6964 656e 6365 2075 6e63 6572  g evidence uncer
-00020740: 7461 696e 7479 2065 7374 696d 6174 650a  tainty estimate.
-00020750: 2020 2020 2020 2020 2020 2020 2a20 6c6f              * lo
-00020760: 6776 6f6c 3a20 6c6f 6720 766f 6c75 6d65  gvol: log volume
-00020770: 2065 7374 696d 6174 650a 2020 2020 2020   estimate.      
-00020780: 2020 2020 2020 2a20 7361 6d70 6c65 735f        * samples_
-00020790: 6e3a 206e 756d 6265 7220 6f66 206c 6976  n: number of liv
-000207a0: 6520 706f 696e 7473 0a20 2020 2020 2020  e points.       
-000207b0: 2020 2020 202a 206c 6f67 7774 3a20 6c6f       * logwt: lo
-000207c0: 6720 7765 6967 6874 0a20 2020 2020 2020  g weight.       
-000207d0: 2020 2020 202a 206c 6f67 6c3a 206c 6f67       * logl: log
-000207e0: 206c 696b 656c 6968 6f6f 640a 0a20 2020   likelihood..   
-000207f0: 2066 696e 616c 3a20 6469 6374 0a20 2020   final: dict.   
-00020800: 2020 2020 2073 616d 6520 6173 2052 6561       same as Rea
-00020810: 6374 6976 654e 6573 7465 6453 616d 706c  ctiveNestedSampl
-00020820: 6572 2e72 6573 756c 7473 2061 6e64 0a20  er.results and. 
-00020830: 2020 2020 2020 2052 6561 6374 6976 654e         ReactiveN
-00020840: 6573 7465 6453 616d 706c 6572 2e72 756e  estedSampler.run
-00020850: 2072 6574 7572 6e20 7661 6c75 6573 0a0a   return values..
-00020860: 2020 2020 2222 220a 2020 2020 696d 706f      """.    impo
-00020870: 7274 2068 3570 790a 2020 2020 6669 6c65  rt h5py.    file
-00020880: 7061 7468 203d 206f 732e 7061 7468 2e6a  path = os.path.j
-00020890: 6f69 6e28 6c6f 675f 6469 722c 2027 7265  oin(log_dir, 're
-000208a0: 7375 6c74 7327 2c20 2770 6f69 6e74 732e  sults', 'points.
-000208b0: 6864 6635 2729 0a20 2020 2066 696c 656f  hdf5').    fileo
-000208c0: 626a 203d 2068 3570 792e 4669 6c65 2866  bj = h5py.File(f
-000208d0: 696c 6570 6174 682c 2027 7227 290a 2020  ilepath, 'r').  
-000208e0: 2020 5f2c 206e 636f 6c73 203d 2066 696c    _, ncols = fil
-000208f0: 656f 626a 5b27 706f 696e 7473 275d 2e73  eobj['points'].s
-00020900: 6861 7065 0a20 2020 206e 756d 5f70 6172  hape.    num_par
-00020910: 616d 7320 3d20 6e63 6f6c 7320 2d20 3320  ams = ncols - 3 
-00020920: 2d20 785f 6469 6d0a 0a20 2020 2070 6f69  - x_dim..    poi
-00020930: 6e74 7320 3d20 6669 6c65 6f62 6a5b 2770  nts = fileobj['p
-00020940: 6f69 6e74 7327 5d5b 3a5d 0a20 2020 2066  oints'][:].    f
-00020950: 696c 656f 626a 2e63 6c6f 7365 2829 0a20  ileobj.close(). 
-00020960: 2020 2064 656c 2066 696c 656f 626a 0a20     del fileobj. 
-00020970: 2020 2073 7461 636b 203d 206c 6973 7428     stack = list(
-00020980: 656e 756d 6572 6174 6528 706f 696e 7473  enumerate(points
-00020990: 2929 0a0a 2020 2020 706f 696e 7470 696c  ))..    pointpil
-000209a0: 6520 3d20 506f 696e 7450 696c 6528 785f  e = PointPile(x_
-000209b0: 6469 6d2c 206e 756d 5f70 6172 616d 7329  dim, num_params)
-000209c0: 0a0a 2020 2020 6465 6620 706f 7028 4c6d  ..    def pop(Lm
-000209d0: 696e 293a 0a20 2020 2020 2020 2022 2222  in):.        """
-000209e0: 4669 6e64 206d 6174 6368 696e 6720 7361  Find matching sa
-000209f0: 6d70 6c65 2066 726f 6d20 706f 696e 7473  mple from points
-00020a00: 2066 696c 652e 2222 220a 2020 2020 2020   file.""".      
-00020a10: 2020 2320 6c6f 6f6b 2066 6f72 7761 7264    # look forward
-00020a20: 2074 6f20 7365 6520 6966 2074 6865 7265   to see if there
-00020a30: 2069 7320 616e 2065 7861 6374 206d 6174   is an exact mat
-00020a40: 6368 0a20 2020 2020 2020 2023 2069 6620  ch.        # if 
-00020a50: 7765 2064 6f20 6e6f 7420 7573 6520 7468  we do not use th
-00020a60: 6520 6578 6163 7420 6d61 7463 6865 730a  e exact matches.
-00020a70: 2020 2020 2020 2020 2320 2020 7468 6973          #   this
-00020a80: 2063 6175 7365 7320 6120 7368 6966 7420   causes a shift 
-00020a90: 696e 2074 6865 206c 6f67 6c69 6b65 6c69  in the loglikeli
-00020aa0: 686f 6f64 730a 2020 2020 2020 2020 666f  hoods.        fo
-00020ab0: 7220 692c 2028 6964 782c 206e 6578 745f  r i, (idx, next_
-00020ac0: 726f 7729 2069 6e20 656e 756d 6572 6174  row) in enumerat
-00020ad0: 6528 7374 6163 6b29 3a0a 2020 2020 2020  e(stack):.      
-00020ae0: 2020 2020 2020 726f 775f 4c6d 696e 203d        row_Lmin =
-00020af0: 206e 6578 745f 726f 775b 305d 0a20 2020   next_row[0].   
-00020b00: 2020 2020 2020 2020 204c 203d 206e 6578           L = nex
-00020b10: 745f 726f 775b 315d 0a20 2020 2020 2020  t_row[1].       
-00020b20: 2020 2020 2069 6620 726f 775f 4c6d 696e       if row_Lmin
-00020b30: 203c 3d20 4c6d 696e 2061 6e64 204c 203e   <= Lmin and L >
-00020b40: 204c 6d69 6e3a 0a20 2020 2020 2020 2020   Lmin:.         
-00020b50: 2020 2020 2020 2069 6478 2c20 726f 7720         idx, row 
-00020b60: 3d20 7374 6163 6b2e 706f 7028 6929 0a20  = stack.pop(i). 
-00020b70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00020b80: 6574 7572 6e20 6964 782c 2072 6f77 0a20  eturn idx, row. 
-00020b90: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00020ba0: 6e65 2c20 4e6f 6e65 0a0a 2020 2020 726f  ne, None..    ro
-00020bb0: 6f74 7320 3d20 5b5d 0a20 2020 2077 6869  ots = [].    whi
-00020bc0: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-00020bd0: 205f 2c20 726f 7720 3d20 706f 7028 2d6e   _, row = pop(-n
-00020be0: 702e 696e 6629 0a20 2020 2020 2020 2069  p.inf).        i
-00020bf0: 6620 726f 7720 6973 204e 6f6e 653a 0a20  f row is None:. 
-00020c00: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00020c10: 0a20 2020 2020 2020 206c 6f67 6c20 3d20  .        logl = 
-00020c20: 726f 775b 315d 0a20 2020 2020 2020 2075  row[1].        u
-00020c30: 203d 2072 6f77 5b33 3a33 202b 2078 5f64   = row[3:3 + x_d
-00020c40: 696d 5d0a 2020 2020 2020 2020 7620 3d20  im].        v = 
-00020c50: 726f 775b 3320 2b20 785f 6469 6d3a 3320  row[3 + x_dim:3 
-00020c60: 2b20 785f 6469 6d20 2b20 6e75 6d5f 7061  + x_dim + num_pa
-00020c70: 7261 6d73 5d0a 2020 2020 2020 2020 726f  rams].        ro
-00020c80: 6f74 732e 6170 7065 6e64 2870 6f69 6e74  ots.append(point
-00020c90: 7069 6c65 2e6d 616b 655f 6e6f 6465 286c  pile.make_node(l
-00020ca0: 6f67 6c2c 2075 2c20 7629 290a 0a20 2020  ogl, u, v))..   
-00020cb0: 2072 6f6f 7420 3d20 5472 6565 4e6f 6465   root = TreeNode
-00020cc0: 2869 643d 2d31 2c20 7661 6c75 653d 2d6e  (id=-1, value=-n
-00020cd0: 702e 696e 662c 2063 6869 6c64 7265 6e3d  p.inf, children=
-00020ce0: 726f 6f74 7329 0a0a 2020 2020 6465 6620  roots)..    def 
-00020cf0: 6f6e 4e6f 6465 286e 6f64 652c 206d 6169  onNode(node, mai
-00020d00: 6e5f 6974 6572 6174 6f72 293a 0a20 2020  n_iterator):.   
-00020d10: 2020 2020 2022 2222 496e 7365 7274 2028       """Insert (
-00020d20: 7369 6e67 6c65 2920 6368 696c 6420 6f66  single) child of
-00020d30: 206e 6f64 6520 6966 2061 7661 696c 6162   node if availab
-00020d40: 6c65 2e22 2222 0a20 2020 2020 2020 2077  le.""".        w
-00020d50: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
-00020d60: 2020 2020 2020 205f 2c20 726f 7720 3d20         _, row = 
-00020d70: 706f 7028 6e6f 6465 2e76 616c 7565 290a  pop(node.value).
-00020d80: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00020d90: 6f77 2069 7320 4e6f 6e65 3a0a 2020 2020  ow is None:.    
-00020da0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00020db0: 6b0a 2020 2020 2020 2020 2020 2020 6966  k.            if
-00020dc0: 2072 6f77 2069 7320 6e6f 7420 4e6f 6e65   row is not None
-00020dd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020de0: 2020 6c6f 676c 203d 2072 6f77 5b31 5d0a    logl = row[1].
-00020df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e00: 7520 3d20 726f 775b 333a 3320 2b20 785f  u = row[3:3 + x_
-00020e10: 6469 6d5d 0a20 2020 2020 2020 2020 2020  dim].           
-00020e20: 2020 2020 2076 203d 2072 6f77 5b33 202b       v = row[3 +
-00020e30: 2078 5f64 696d 3a33 202b 2078 5f64 696d   x_dim:3 + x_dim
-00020e40: 202b 206e 756d 5f70 6172 616d 735d 0a20   + num_params]. 
-00020e50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00020e60: 6869 6c64 203d 2070 6f69 6e74 7069 6c65  hild = pointpile
-00020e70: 2e6d 616b 655f 6e6f 6465 286c 6f67 6c2c  .make_node(logl,
-00020e80: 2075 2c20 7629 0a20 2020 2020 2020 2020   u, v).         
-00020e90: 2020 2020 2020 2061 7373 6572 7420 6c6f         assert lo
-00020ea0: 676c 203e 206e 6f64 652e 7661 6c75 652c  gl > node.value,
-00020eb0: 2028 6c6f 676c 2c20 6e6f 6465 2e76 616c   (logl, node.val
-00020ec0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00020ed0: 2020 2020 6d61 696e 5f69 7465 7261 746f      main_iterato
-00020ee0: 722e 4c6d 6178 203d 206d 6178 286d 6169  r.Lmax = max(mai
-00020ef0: 6e5f 6974 6572 6174 6f72 2e4c 6d61 782c  n_iterator.Lmax,
-00020f00: 206c 6f67 6c29 0a20 2020 2020 2020 2020   logl).         
-00020f10: 2020 2020 2020 206e 6f64 652e 6368 696c         node.chil
-00020f20: 6472 656e 2e61 7070 656e 6428 6368 696c  dren.append(chil
-00020f30: 6429 0a0a 2020 2020 7265 7475 726e 206c  d)..    return l
-00020f40: 6f67 7a5f 7365 7175 656e 6365 2872 6f6f  ogz_sequence(roo
-00020f50: 742c 2070 6f69 6e74 7069 6c65 2c20 6e62  t, pointpile, nb
-00020f60: 6f6f 7473 7472 6170 733d 6e75 6d5f 626f  ootstraps=num_bo
-00020f70: 6f74 7374 7261 7073 2c0a 2020 2020 2020  otstraps,.      
-00020f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020f90: 2020 2072 616e 646f 6d3d 7261 6e64 6f6d     random=random
-00020fa0: 2c20 6f6e 4e6f 6465 3d6f 6e4e 6f64 652c  , onNode=onNode,
-00020fb0: 2076 6572 626f 7365 3d76 6572 626f 7365   verbose=verbose
-00020fc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00020fd0: 2020 2020 2020 2020 2020 2063 6865 636b             check
-00020fe0: 5f69 6e73 6572 7469 6f6e 5f6f 7264 6572  _insertion_order
-00020ff0: 3d63 6865 636b 5f69 6e73 6572 7469 6f6e  =check_insertion
-00021000: 5f6f 7264 6572 290a                      _order).
+0001f760: 2020 2073 7465 7020 3d20 6564 6765 735b     step = edges[
+0001f770: 315d 202d 206c 6f0a 2020 2020 2020 2020  1] - lo.        
+0001f780: 2020 2020 2020 2020 2020 2020 6c6f 203d              lo =
+0001f790: 206d 6178 2873 656c 662e 7472 616e 7366   max(self.transf
+0001f7a0: 6f72 6d5f 6c69 6d69 7473 5b69 2c30 5d2c  orm_limits[i,0],
+0001f7b0: 206c 6f20 2d20 3220 2a20 7374 6570 290a   lo - 2 * step).
+0001f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f7d0: 2020 2020 6869 203d 206d 696e 2873 656c      hi = min(sel
+0001f7e0: 662e 7472 616e 7366 6f72 6d5f 6c69 6d69  f.transform_limi
+0001f7f0: 7473 5b69 2c31 5d2c 2068 6920 2b20 3220  ts[i,1], hi + 2 
+0001f800: 2a20 7374 6570 290a 2020 2020 2020 2020  * step).        
+0001f810: 2020 2020 2020 2020 2020 2020 482c 2065              H, e
+0001f820: 6467 6573 203d 206e 702e 6869 7374 6f67  dges = np.histog
+0001f830: 7261 6d28 762c 2062 696e 733d 6e70 2e6c  ram(v, bins=np.l
+0001f840: 696e 7370 6163 6528 6c6f 2c20 6869 2c20  inspace(lo, hi, 
+0001f850: 3430 2929 0a20 2020 2020 2020 2020 2020  40)).           
+0001f860: 2020 2020 2020 2020 206c 6f2c 2068 6920           lo, hi 
+0001f870: 3d20 6564 6765 735b 305d 2c20 6564 6765  = edges[0], edge
+0001f880: 735b 2d31 5d0a 0a20 2020 2020 2020 2020  s[-1]..         
+0001f890: 2020 2020 2020 2020 2020 2064 6973 7420             dist 
+0001f8a0: 3d20 2727 2e6a 6f69 6e28 5b27 20e2 9681  = ''.join([' ...
+0001f8b0: e296 82e2 9683 e296 84e2 9685 e296 86e2  ................
+0001f8c0: 9687 e296 88e2 9688 275b 695d 2066 6f72  ........'[i] for
+0001f8d0: 2069 2069 6e20 6e70 2e63 6569 6c28 4820   i in np.ceil(H 
+0001f8e0: 2a20 3720 2f20 482e 6d61 7828 2929 2e61  * 7 / H.max()).a
+0001f8f0: 7374 7970 6528 696e 7429 5d29 0a20 2020  stype(int)]).   
+0001f900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f910: 2070 7269 6e74 2827 2020 2020 252d 3230   print('    %-20
+0001f920: 733a 2025 2d36 73e2 9482 2573 e294 8225  s: %-6s...%s...%
+0001f930: 2d36 7320 2020 2025 7320 2b2d 2025 7327  -6s    %s +- %s'
+0001f940: 2025 2028 702c 2066 6d74 2025 206c 6f2c   % (p, fmt % lo,
+0001f950: 2064 6973 742c 2066 6d74 2025 2068 692c   dist, fmt % hi,
+0001f960: 2066 6d74 2025 206d 6564 2c20 666d 7420   fmt % med, fmt 
+0001f970: 2520 7369 676d 6129 290a 2020 2020 2020  % sigma)).      
+0001f980: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0001f990: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+0001f9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9b0: 666d 7473 203d 2027 2020 2020 252d 3230  fmts = '    %-20
+0001f9c0: 7327 202b 2066 6d74 202b 2022 202b 2d20  s' + fmt + " +- 
+0001f9d0: 2220 2b20 666d 740a 2020 2020 2020 2020  " + fmt.        
+0001f9e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001f9f0: 7428 666d 7473 2025 2028 702c 206d 6564  t(fmts % (p, med
+0001fa00: 2c20 7369 676d 6129 290a 2020 2020 2020  , sigma)).      
+0001fa10: 2020 2020 2020 7072 696e 7428 290a 0a20        print().. 
+0001fa20: 2020 2064 6566 2070 6c6f 7428 7365 6c66     def plot(self
+0001fa30: 293a 0a20 2020 2020 2020 2022 2222 4d61  ):.        """Ma
+0001fa40: 6b65 2063 6f72 6e65 722c 2072 756e 2061  ke corner, run a
+0001fa50: 6e64 2074 7261 6365 2070 6c6f 7473 2e0a  nd trace plots..
+0001fa60: 0a20 2020 2020 2020 2063 616c 6c73 3a0a  .        calls:.
+0001fa70: 0a20 2020 2020 2020 202a 2070 6c6f 745f  .        * plot_
+0001fa80: 636f 726e 6572 2829 0a20 2020 2020 2020  corner().       
+0001fa90: 202a 2070 6c6f 745f 7275 6e28 290a 2020   * plot_run().  
+0001faa0: 2020 2020 2020 2a20 706c 6f74 5f74 7261        * plot_tra
+0001fab0: 6365 2829 0a20 2020 2020 2020 2022 2222  ce().        """
+0001fac0: 0a20 2020 2020 2020 2073 656c 662e 706c  .        self.pl
+0001fad0: 6f74 5f63 6f72 6e65 7228 290a 2020 2020  ot_corner().    
+0001fae0: 2020 2020 7365 6c66 2e70 6c6f 745f 7275      self.plot_ru
+0001faf0: 6e28 290a 2020 2020 2020 2020 7365 6c66  n().        self
+0001fb00: 2e70 6c6f 745f 7472 6163 6528 290a 0a20  .plot_trace().. 
+0001fb10: 2020 2064 6566 2070 6c6f 745f 636f 726e     def plot_corn
+0001fb20: 6572 2873 656c 6629 3a0a 2020 2020 2020  er(self):.      
+0001fb30: 2020 2222 224d 616b 6520 636f 726e 6572    """Make corner
+0001fb40: 2070 6c6f 742e 0a0a 2020 2020 2020 2020   plot...        
+0001fb50: 5772 6974 6573 2063 6f72 6e65 7220 706c  Writes corner pl
+0001fb60: 6f74 2074 6f20 706c 6f74 732f 2064 6972  ot to plots/ dir
+0001fb70: 6563 746f 7279 2069 6620 6c6f 6720 6469  ectory if log di
+0001fb80: 7265 6374 6f72 7920 7761 730a 2020 2020  rectory was.    
+0001fb90: 2020 2020 7370 6563 6966 6965 642c 206f      specified, o
+0001fba0: 7468 6572 7769 7365 2073 686f 7720 696e  therwise show in
+0001fbb0: 7465 7261 6374 6976 656c 792e 0a0a 2020  teractively...  
+0001fbc0: 2020 2020 2020 5468 6973 2064 6f65 7320        This does 
+0001fbd0: 6573 7365 6e74 6961 6c6c 793a 3a0a 0a20  essentially::.. 
+0001fbe0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+0001fbf0: 756c 7472 616e 6573 742e 706c 6f74 2069  ultranest.plot i
+0001fc00: 6d70 6f72 7420 636f 726e 6572 706c 6f74  mport cornerplot
+0001fc10: 0a20 2020 2020 2020 2020 2020 2063 6f72  .            cor
+0001fc20: 6e65 7270 6c6f 7428 7265 7375 6c74 7329  nerplot(results)
+0001fc30: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001fc40: 2020 2020 2020 6672 6f6d 202e 706c 6f74        from .plot
+0001fc50: 2069 6d70 6f72 7420 636f 726e 6572 706c   import cornerpl
+0001fc60: 6f74 0a20 2020 2020 2020 2069 6d70 6f72  ot.        impor
+0001fc70: 7420 6d61 7470 6c6f 746c 6962 2e70 7970  t matplotlib.pyp
+0001fc80: 6c6f 7420 6173 2070 6c74 0a20 2020 2020  lot as plt.     
+0001fc90: 2020 2069 6620 7365 6c66 2e6c 6f67 3a0a     if self.log:.
+0001fca0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001fcb0: 2e6c 6f67 6765 722e 6465 6275 6728 274d  .logger.debug('M
+0001fcc0: 616b 696e 6720 636f 726e 6572 2070 6c6f  aking corner plo
+0001fcd0: 7420 2e2e 2e27 290a 2020 2020 2020 2020  t ...').        
+0001fce0: 636f 726e 6572 706c 6f74 2873 656c 662e  cornerplot(self.
+0001fcf0: 7265 7375 6c74 732c 206c 6f67 6765 723d  results, logger=
+0001fd00: 7365 6c66 2e6c 6f67 6765 7220 6966 2073  self.logger if s
+0001fd10: 656c 662e 6c6f 6720 656c 7365 204e 6f6e  elf.log else Non
+0001fd20: 6529 0a20 2020 2020 2020 2069 6620 7365  e).        if se
+0001fd30: 6c66 2e6c 6f67 5f74 6f5f 6469 736b 3a0a  lf.log_to_disk:.
+0001fd40: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
+0001fd50: 7361 7665 6669 6728 6f73 2e70 6174 682e  savefig(os.path.
+0001fd60: 6a6f 696e 2873 656c 662e 6c6f 6773 5b27  join(self.logs['
+0001fd70: 706c 6f74 7327 5d2c 2027 636f 726e 6572  plots'], 'corner
+0001fd80: 2e70 6466 2729 2c20 6262 6f78 5f69 6e63  .pdf'), bbox_inc
+0001fd90: 6865 733d 2774 6967 6874 2729 0a20 2020  hes='tight').   
+0001fda0: 2020 2020 2020 2020 2070 6c74 2e63 6c6f           plt.clo
+0001fdb0: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
+0001fdc0: 2073 656c 662e 6c6f 6767 6572 2e64 6562   self.logger.deb
+0001fdd0: 7567 2827 4d61 6b69 6e67 2063 6f72 6e65  ug('Making corne
+0001fde0: 7220 706c 6f74 202e 2e2e 2064 6f6e 6527  r plot ... done'
+0001fdf0: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
+0001fe00: 7472 6163 6528 7365 6c66 293a 0a20 2020  trace(self):.   
+0001fe10: 2020 2020 2022 2222 4d61 6b65 2074 7261       """Make tra
+0001fe20: 6365 2070 6c6f 742e 0a0a 2020 2020 2020  ce plot...      
+0001fe30: 2020 5772 6974 6520 7061 7261 6d65 7465    Write paramete
+0001fe40: 7220 7472 6163 6520 6469 6167 6e6f 7374  r trace diagnost
+0001fe50: 6963 2070 6c6f 7473 2074 6f20 706c 6f74  ic plots to plot
+0001fe60: 732f 2064 6972 6563 746f 7279 0a20 2020  s/ directory.   
+0001fe70: 2020 2020 2069 6620 6c6f 6720 6469 7265       if log dire
+0001fe80: 6374 6f72 7920 7370 6563 6966 6965 642c  ctory specified,
+0001fe90: 206f 7468 6572 7769 7365 2073 686f 7720   otherwise show 
+0001fea0: 696e 7465 7261 6374 6976 656c 792e 0a0a  interactively...
+0001feb0: 2020 2020 2020 2020 5468 6973 2064 6f65          This doe
+0001fec0: 7320 6573 7365 6e74 6961 6c6c 793a 3a0a  s essentially::.
+0001fed0: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+0001fee0: 6d20 756c 7472 616e 6573 742e 706c 6f74  m ultranest.plot
+0001fef0: 2069 6d70 6f72 7420 7472 6163 6570 6c6f   import traceplo
+0001ff00: 740a 2020 2020 2020 2020 2020 2020 7472  t.            tr
+0001ff10: 6163 6570 6c6f 7428 7265 7375 6c74 733d  aceplot(results=
+0001ff20: 7265 7375 6c74 732c 206c 6162 656c 733d  results, labels=
+0001ff30: 7061 7261 6d6e 616d 6573 202b 2064 6572  paramnames + der
+0001ff40: 6976 6564 7061 7261 6d6e 616d 6573 290a  ivedparamnames).
+0001ff50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001ff60: 2020 2020 2066 726f 6d20 2e70 6c6f 7420       from .plot 
+0001ff70: 696d 706f 7274 2074 7261 6365 706c 6f74  import traceplot
+0001ff80: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
+0001ff90: 6d61 7470 6c6f 746c 6962 2e70 7970 6c6f  matplotlib.pyplo
+0001ffa0: 7420 6173 2070 6c74 0a20 2020 2020 2020  t as plt.       
+0001ffb0: 2069 6620 7365 6c66 2e6c 6f67 3a0a 2020   if self.log:.  
+0001ffc0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0001ffd0: 6f67 6765 722e 6465 6275 6728 274d 616b  ogger.debug('Mak
+0001ffe0: 696e 6720 7472 6163 6520 706c 6f74 202e  ing trace plot .
+0001fff0: 2e2e 2027 290a 2020 2020 2020 2020 7061  .. ').        pa
+00020000: 7261 6d6e 616d 6573 203d 2073 656c 662e  ramnames = self.
+00020010: 7061 7261 6d6e 616d 6573 202b 2073 656c  paramnames + sel
+00020020: 662e 6465 7269 7665 6470 6172 616d 6e61  f.derivedparamna
+00020030: 6d65 730a 2020 2020 2020 2020 2320 6765  mes.        # ge
+00020040: 7420 6479 6e65 7374 792d 636f 6d70 6174  t dynesty-compat
+00020050: 6962 6c65 2073 6571 7565 6e63 6573 0a20  ible sequences. 
+00020060: 2020 2020 2020 2074 7261 6365 706c 6f74         traceplot
+00020070: 2872 6573 756c 7473 3d73 656c 662e 7275  (results=self.ru
+00020080: 6e5f 7365 7175 656e 6365 2c20 6c61 6265  n_sequence, labe
+00020090: 6c73 3d70 6172 616d 6e61 6d65 7329 0a20  ls=paramnames). 
+000200a0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
+000200b0: 6f67 5f74 6f5f 6469 736b 3a0a 2020 2020  og_to_disk:.    
+000200c0: 2020 2020 2020 2020 706c 742e 7361 7665          plt.save
+000200d0: 6669 6728 6f73 2e70 6174 682e 6a6f 696e  fig(os.path.join
+000200e0: 2873 656c 662e 6c6f 6773 5b27 706c 6f74  (self.logs['plot
+000200f0: 7327 5d2c 2027 7472 6163 652e 7064 6627  s'], 'trace.pdf'
+00020100: 292c 2062 626f 785f 696e 6368 6573 3d27  ), bbox_inches='
+00020110: 7469 6768 7427 290a 2020 2020 2020 2020  tight').        
+00020120: 2020 2020 706c 742e 636c 6f73 6528 290a      plt.close().
+00020130: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00020140: 2e6c 6f67 6765 722e 6465 6275 6728 274d  .logger.debug('M
+00020150: 616b 696e 6720 7472 6163 6520 706c 6f74  aking trace plot
+00020160: 202e 2e2e 2064 6f6e 6527 290a 0a20 2020   ... done')..   
+00020170: 2064 6566 2070 6c6f 745f 7275 6e28 7365   def plot_run(se
+00020180: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00020190: 4d61 6b65 2072 756e 2070 6c6f 742e 0a0a  Make run plot...
+000201a0: 2020 2020 2020 2020 5772 6974 6520 7275          Write ru
+000201b0: 6e20 6469 6167 6e6f 7374 6963 2070 6c6f  n diagnostic plo
+000201c0: 7473 2074 6f20 706c 6f74 732f 2064 6972  ts to plots/ dir
+000201d0: 6563 746f 7279 0a20 2020 2020 2020 2069  ectory.        i
+000201e0: 6620 6c6f 6720 6469 7265 6374 6f72 7920  f log directory 
+000201f0: 7370 6563 6966 6965 642c 206f 7468 6572  specified, other
+00020200: 7769 7365 2073 686f 7720 696e 7465 7261  wise show intera
+00020210: 6374 6976 656c 792e 0a0a 2020 2020 2020  ctively...      
+00020220: 2020 5468 6973 2064 6f65 7320 6573 7365    This does esse
+00020230: 6e74 6961 6c6c 793a 3a0a 0a20 2020 2020  ntially::..     
+00020240: 2020 2020 2020 2066 726f 6d20 756c 7472         from ultr
+00020250: 616e 6573 742e 706c 6f74 2069 6d70 6f72  anest.plot impor
+00020260: 7420 7275 6e70 6c6f 740a 2020 2020 2020  t runplot.      
+00020270: 2020 2020 2020 7275 6e70 6c6f 7428 7265        runplot(re
+00020280: 7375 6c74 733d 7265 7375 6c74 7329 0a0a  sults=results)..
+00020290: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000202a0: 2020 2020 6672 6f6d 202e 706c 6f74 2069      from .plot i
+000202b0: 6d70 6f72 7420 7275 6e70 6c6f 740a 2020  mport runplot.  
+000202c0: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
+000202d0: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
+000202e0: 7320 706c 740a 2020 2020 2020 2020 6966  s plt.        if
+000202f0: 2073 656c 662e 6c6f 673a 0a20 2020 2020   self.log:.     
+00020300: 2020 2020 2020 2073 656c 662e 6c6f 6767         self.logg
+00020310: 6572 2e64 6562 7567 2827 4d61 6b69 6e67  er.debug('Making
+00020320: 2072 756e 2070 6c6f 7420 2e2e 2e20 2729   run plot ... ')
+00020330: 0a20 2020 2020 2020 2023 2067 6574 2064  .        # get d
+00020340: 796e 6573 7479 2d63 6f6d 7061 7469 626c  ynesty-compatibl
+00020350: 6520 7365 7175 656e 6365 730a 2020 2020  e sequences.    
+00020360: 2020 2020 7275 6e70 6c6f 7428 7265 7375      runplot(resu
+00020370: 6c74 733d 7365 6c66 2e72 756e 5f73 6571  lts=self.run_seq
+00020380: 7565 6e63 652c 206c 6f67 706c 6f74 3d54  uence, logplot=T
+00020390: 7275 6529 0a20 2020 2020 2020 2069 6620  rue).        if 
+000203a0: 7365 6c66 2e6c 6f67 5f74 6f5f 6469 736b  self.log_to_disk
+000203b0: 3a0a 2020 2020 2020 2020 2020 2020 706c  :.            pl
+000203c0: 742e 7361 7665 6669 6728 6f73 2e70 6174  t.savefig(os.pat
+000203d0: 682e 6a6f 696e 2873 656c 662e 6c6f 6773  h.join(self.logs
+000203e0: 5b27 706c 6f74 7327 5d2c 2027 7275 6e2e  ['plots'], 'run.
+000203f0: 7064 6627 292c 2062 626f 785f 696e 6368  pdf'), bbox_inch
+00020400: 6573 3d27 7469 6768 7427 290a 2020 2020  es='tight').    
+00020410: 2020 2020 2020 2020 706c 742e 636c 6f73          plt.clos
+00020420: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+00020430: 7365 6c66 2e6c 6f67 6765 722e 6465 6275  self.logger.debu
+00020440: 6728 274d 616b 696e 6720 7275 6e20 706c  g('Making run pl
+00020450: 6f74 202e 2e2e 2064 6f6e 6527 290a 0a0a  ot ... done')...
+00020460: 6465 6620 7265 6164 5f66 696c 6528 6c6f  def read_file(lo
+00020470: 675f 6469 722c 2078 5f64 696d 2c20 6e75  g_dir, x_dim, nu
+00020480: 6d5f 626f 6f74 7374 7261 7073 3d32 302c  m_bootstraps=20,
+00020490: 2072 616e 646f 6d3d 5472 7565 2c20 7665   random=True, ve
+000204a0: 7262 6f73 653d 4661 6c73 652c 2063 6865  rbose=False, che
+000204b0: 636b 5f69 6e73 6572 7469 6f6e 5f6f 7264  ck_insertion_ord
+000204c0: 6572 3d54 7275 6529 3a0a 2020 2020 2222  er=True):.    ""
+000204d0: 220a 2020 2020 5265 6164 2074 6865 206f  ".    Read the o
+000204e0: 7574 7075 7420 4844 4635 2066 696c 6520  utput HDF5 file 
+000204f0: 6f66 2055 6c74 7261 4e65 7374 2e0a 0a20  of UltraNest... 
+00020500: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00020510: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00020520: 206c 6f67 5f64 6972 3a20 7374 720a 2020   log_dir: str.  
+00020530: 2020 2020 2020 466f 6c64 6572 2063 6f6e        Folder con
+00020540: 7461 696e 696e 6720 7265 7375 6c74 730a  taining results.
+00020550: 2020 2020 785f 6469 6d3a 2069 6e74 0a20      x_dim: int. 
+00020560: 2020 2020 2020 206e 756d 6265 7220 6f66         number of
+00020570: 2064 696d 656e 7369 6f6e 730a 2020 2020   dimensions.    
+00020580: 6e75 6d5f 626f 6f74 7374 7261 7073 3a20  num_bootstraps: 
+00020590: 696e 740a 2020 2020 2020 2020 6e75 6d62  int.        numb
+000205a0: 6572 206f 6620 626f 6f74 7374 7261 7073  er of bootstraps
+000205b0: 2074 6f20 7573 6520 666f 7220 6573 7469   to use for esti
+000205c0: 6d61 7469 6e67 206c 6f67 5a2e 0a20 2020  mating logZ..   
+000205d0: 2072 616e 646f 6d3a 2062 6f6f 6c0a 2020   random: bool.  
+000205e0: 2020 2020 2020 7573 6520 7261 6e64 6f6d        use random
+000205f0: 697a 6174 696f 6e20 666f 7220 766f 6c75  ization for volu
+00020600: 6d65 2065 7374 696d 6174 696f 6e2e 0a20  me estimation.. 
+00020610: 2020 2076 6572 626f 7365 3a20 626f 6f6c     verbose: bool
+00020620: 0a20 2020 2020 2020 2073 686f 7720 7072  .        show pr
+00020630: 6f67 7265 7373 0a20 2020 2063 6865 636b  ogress.    check
+00020640: 5f69 6e73 6572 7469 6f6e 5f6f 7264 6572  _insertion_order
+00020650: 3a20 626f 6f6c 0a20 2020 2020 2020 2077  : bool.        w
+00020660: 6865 7468 6572 2074 6f20 7065 7266 6f72  hether to perfor
+00020670: 6d20 4d57 5720 696e 7365 7274 696f 6e20  m MWW insertion 
+00020680: 6f72 6465 7220 7465 7374 2066 6f72 2061  order test for a
+00020690: 7373 6573 7369 6e67 2063 6f6e 7665 7267  ssessing converg
+000206a0: 656e 6365 0a0a 2020 2020 5265 7475 726e  ence..    Return
+000206b0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+000206c0: 0a20 2020 2073 6571 7565 6e63 653a 2064  .    sequence: d
+000206d0: 6963 740a 2020 2020 2020 2020 636f 6e74  ict.        cont
+000206e0: 6169 6e73 2061 7272 6179 7320 7374 6f72  ains arrays stor
+000206f0: 696e 6720 666f 7220 6561 6368 2069 7465  ing for each ite
+00020700: 7261 7469 6f6e 2065 7374 696d 6174 6573  ration estimates
+00020710: 206f 663a 0a0a 2020 2020 2020 2020 2020   of:..          
+00020720: 2020 2a20 6c6f 677a 3a20 6c6f 6720 6576    * logz: log ev
+00020730: 6964 656e 6365 2065 7374 696d 6174 650a  idence estimate.
+00020740: 2020 2020 2020 2020 2020 2020 2a20 6c6f              * lo
+00020750: 677a 6572 723a 206c 6f67 2065 7669 6465  gzerr: log evide
+00020760: 6e63 6520 756e 6365 7274 6169 6e74 7920  nce uncertainty 
+00020770: 6573 7469 6d61 7465 0a20 2020 2020 2020  estimate.       
+00020780: 2020 2020 202a 206c 6f67 766f 6c3a 206c       * logvol: l
+00020790: 6f67 2076 6f6c 756d 6520 6573 7469 6d61  og volume estima
+000207a0: 7465 0a20 2020 2020 2020 2020 2020 202a  te.            *
+000207b0: 2073 616d 706c 6573 5f6e 3a20 6e75 6d62   samples_n: numb
+000207c0: 6572 206f 6620 6c69 7665 2070 6f69 6e74  er of live point
+000207d0: 730a 2020 2020 2020 2020 2020 2020 2a20  s.            * 
+000207e0: 6c6f 6777 743a 206c 6f67 2077 6569 6768  logwt: log weigh
+000207f0: 740a 2020 2020 2020 2020 2020 2020 2a20  t.            * 
+00020800: 6c6f 676c 3a20 6c6f 6720 6c69 6b65 6c69  logl: log likeli
+00020810: 686f 6f64 0a0a 2020 2020 6669 6e61 6c3a  hood..    final:
+00020820: 2064 6963 740a 2020 2020 2020 2020 7361   dict.        sa
+00020830: 6d65 2061 7320 5265 6163 7469 7665 4e65  me as ReactiveNe
+00020840: 7374 6564 5361 6d70 6c65 722e 7265 7375  stedSampler.resu
+00020850: 6c74 7320 616e 640a 2020 2020 2020 2020  lts and.        
+00020860: 5265 6163 7469 7665 4e65 7374 6564 5361  ReactiveNestedSa
+00020870: 6d70 6c65 722e 7275 6e20 7265 7475 726e  mpler.run return
+00020880: 2076 616c 7565 730a 0a20 2020 2022 2222   values..    """
+00020890: 0a20 2020 2069 6d70 6f72 7420 6835 7079  .    import h5py
+000208a0: 0a20 2020 2066 696c 6570 6174 6820 3d20  .    filepath = 
+000208b0: 6f73 2e70 6174 682e 6a6f 696e 286c 6f67  os.path.join(log
+000208c0: 5f64 6972 2c20 2772 6573 756c 7473 272c  _dir, 'results',
+000208d0: 2027 706f 696e 7473 2e68 6466 3527 290a   'points.hdf5').
+000208e0: 2020 2020 6669 6c65 6f62 6a20 3d20 6835      fileobj = h5
+000208f0: 7079 2e46 696c 6528 6669 6c65 7061 7468  py.File(filepath
+00020900: 2c20 2772 2729 0a20 2020 205f 2c20 6e63  , 'r').    _, nc
+00020910: 6f6c 7320 3d20 6669 6c65 6f62 6a5b 2770  ols = fileobj['p
+00020920: 6f69 6e74 7327 5d2e 7368 6170 650a 2020  oints'].shape.  
+00020930: 2020 6e75 6d5f 7061 7261 6d73 203d 206e    num_params = n
+00020940: 636f 6c73 202d 2033 202d 2078 5f64 696d  cols - 3 - x_dim
+00020950: 0a0a 2020 2020 706f 696e 7473 203d 2066  ..    points = f
+00020960: 696c 656f 626a 5b27 706f 696e 7473 275d  ileobj['points']
+00020970: 5b3a 5d0a 2020 2020 6669 6c65 6f62 6a2e  [:].    fileobj.
+00020980: 636c 6f73 6528 290a 2020 2020 6465 6c20  close().    del 
+00020990: 6669 6c65 6f62 6a0a 2020 2020 7374 6163  fileobj.    stac
+000209a0: 6b20 3d20 6c69 7374 2865 6e75 6d65 7261  k = list(enumera
+000209b0: 7465 2870 6f69 6e74 7329 290a 0a20 2020  te(points))..   
+000209c0: 2070 6f69 6e74 7069 6c65 203d 2050 6f69   pointpile = Poi
+000209d0: 6e74 5069 6c65 2878 5f64 696d 2c20 6e75  ntPile(x_dim, nu
+000209e0: 6d5f 7061 7261 6d73 290a 0a20 2020 2064  m_params)..    d
+000209f0: 6566 2070 6f70 284c 6d69 6e29 3a0a 2020  ef pop(Lmin):.  
+00020a00: 2020 2020 2020 2222 2246 696e 6420 6d61        """Find ma
+00020a10: 7463 6869 6e67 2073 616d 706c 6520 6672  tching sample fr
+00020a20: 6f6d 2070 6f69 6e74 7320 6669 6c65 2e22  om points file."
+00020a30: 2222 0a20 2020 2020 2020 2023 206c 6f6f  "".        # loo
+00020a40: 6b20 666f 7277 6172 6420 746f 2073 6565  k forward to see
+00020a50: 2069 6620 7468 6572 6520 6973 2061 6e20   if there is an 
+00020a60: 6578 6163 7420 6d61 7463 680a 2020 2020  exact match.    
+00020a70: 2020 2020 2320 6966 2077 6520 646f 206e      # if we do n
+00020a80: 6f74 2075 7365 2074 6865 2065 7861 6374  ot use the exact
+00020a90: 206d 6174 6368 6573 0a20 2020 2020 2020   matches.       
+00020aa0: 2023 2020 2074 6869 7320 6361 7573 6573   #   this causes
+00020ab0: 2061 2073 6869 6674 2069 6e20 7468 6520   a shift in the 
+00020ac0: 6c6f 676c 696b 656c 6968 6f6f 6473 0a20  loglikelihoods. 
+00020ad0: 2020 2020 2020 2066 6f72 2069 2c20 2869         for i, (i
+00020ae0: 6478 2c20 6e65 7874 5f72 6f77 2920 696e  dx, next_row) in
+00020af0: 2065 6e75 6d65 7261 7465 2873 7461 636b   enumerate(stack
+00020b00: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00020b10: 6f77 5f4c 6d69 6e20 3d20 6e65 7874 5f72  ow_Lmin = next_r
+00020b20: 6f77 5b30 5d0a 2020 2020 2020 2020 2020  ow[0].          
+00020b30: 2020 4c20 3d20 6e65 7874 5f72 6f77 5b31    L = next_row[1
+00020b40: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00020b50: 2072 6f77 5f4c 6d69 6e20 3c3d 204c 6d69   row_Lmin <= Lmi
+00020b60: 6e20 616e 6420 4c20 3e20 4c6d 696e 3a0a  n and L > Lmin:.
+00020b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020b80: 6964 782c 2072 6f77 203d 2073 7461 636b  idx, row = stack
+00020b90: 2e70 6f70 2869 290a 2020 2020 2020 2020  .pop(i).        
+00020ba0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+00020bb0: 6478 2c20 726f 770a 2020 2020 2020 2020  dx, row.        
+00020bc0: 7265 7475 726e 204e 6f6e 652c 204e 6f6e  return None, Non
+00020bd0: 650a 0a20 2020 2072 6f6f 7473 203d 205b  e..    roots = [
+00020be0: 5d0a 2020 2020 7768 696c 6520 5472 7565  ].    while True
+00020bf0: 3a0a 2020 2020 2020 2020 5f2c 2072 6f77  :.        _, row
+00020c00: 203d 2070 6f70 282d 6e70 2e69 6e66 290a   = pop(-np.inf).
+00020c10: 2020 2020 2020 2020 6966 2072 6f77 2069          if row i
+00020c20: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00020c30: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+00020c40: 2020 6c6f 676c 203d 2072 6f77 5b31 5d0a    logl = row[1].
+00020c50: 2020 2020 2020 2020 7520 3d20 726f 775b          u = row[
+00020c60: 333a 3320 2b20 785f 6469 6d5d 0a20 2020  3:3 + x_dim].   
+00020c70: 2020 2020 2076 203d 2072 6f77 5b33 202b       v = row[3 +
+00020c80: 2078 5f64 696d 3a33 202b 2078 5f64 696d   x_dim:3 + x_dim
+00020c90: 202b 206e 756d 5f70 6172 616d 735d 0a20   + num_params]. 
+00020ca0: 2020 2020 2020 2072 6f6f 7473 2e61 7070         roots.app
+00020cb0: 656e 6428 706f 696e 7470 696c 652e 6d61  end(pointpile.ma
+00020cc0: 6b65 5f6e 6f64 6528 6c6f 676c 2c20 752c  ke_node(logl, u,
+00020cd0: 2076 2929 0a0a 2020 2020 726f 6f74 203d   v))..    root =
+00020ce0: 2054 7265 654e 6f64 6528 6964 3d2d 312c   TreeNode(id=-1,
+00020cf0: 2076 616c 7565 3d2d 6e70 2e69 6e66 2c20   value=-np.inf, 
+00020d00: 6368 696c 6472 656e 3d72 6f6f 7473 290a  children=roots).
+00020d10: 0a20 2020 2064 6566 206f 6e4e 6f64 6528  .    def onNode(
+00020d20: 6e6f 6465 2c20 6d61 696e 5f69 7465 7261  node, main_itera
+00020d30: 746f 7229 3a0a 2020 2020 2020 2020 2222  tor):.        ""
+00020d40: 2249 6e73 6572 7420 2873 696e 676c 6529  "Insert (single)
+00020d50: 2063 6869 6c64 206f 6620 6e6f 6465 2069   child of node i
+00020d60: 6620 6176 6169 6c61 626c 652e 2222 220a  f available.""".
+00020d70: 2020 2020 2020 2020 7768 696c 6520 5472          while Tr
+00020d80: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+00020d90: 5f2c 2072 6f77 203d 2070 6f70 286e 6f64  _, row = pop(nod
+00020da0: 652e 7661 6c75 6529 0a20 2020 2020 2020  e.value).       
+00020db0: 2020 2020 2069 6620 726f 7720 6973 204e       if row is N
+00020dc0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00020dd0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
+00020de0: 2020 2020 2020 2069 6620 726f 7720 6973         if row is
+00020df0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00020e00: 2020 2020 2020 2020 2020 206c 6f67 6c20             logl 
+00020e10: 3d20 726f 775b 315d 0a20 2020 2020 2020  = row[1].       
+00020e20: 2020 2020 2020 2020 2075 203d 2072 6f77           u = row
+00020e30: 5b33 3a33 202b 2078 5f64 696d 5d0a 2020  [3:3 + x_dim].  
+00020e40: 2020 2020 2020 2020 2020 2020 2020 7620                v 
+00020e50: 3d20 726f 775b 3320 2b20 785f 6469 6d3a  = row[3 + x_dim:
+00020e60: 3320 2b20 785f 6469 6d20 2b20 6e75 6d5f  3 + x_dim + num_
+00020e70: 7061 7261 6d73 5d0a 2020 2020 2020 2020  params].        
+00020e80: 2020 2020 2020 2020 6368 696c 6420 3d20          child = 
+00020e90: 706f 696e 7470 696c 652e 6d61 6b65 5f6e  pointpile.make_n
+00020ea0: 6f64 6528 6c6f 676c 2c20 752c 2076 290a  ode(logl, u, v).
+00020eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ec0: 6173 7365 7274 206c 6f67 6c20 3e20 6e6f  assert logl > no
+00020ed0: 6465 2e76 616c 7565 2c20 286c 6f67 6c2c  de.value, (logl,
+00020ee0: 206e 6f64 652e 7661 6c75 6529 0a20 2020   node.value).   
+00020ef0: 2020 2020 2020 2020 2020 2020 206d 6169               mai
+00020f00: 6e5f 6974 6572 6174 6f72 2e4c 6d61 7820  n_iterator.Lmax 
+00020f10: 3d20 6d61 7828 6d61 696e 5f69 7465 7261  = max(main_itera
+00020f20: 746f 722e 4c6d 6178 2c20 6c6f 676c 290a  tor.Lmax, logl).
+00020f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f40: 6e6f 6465 2e63 6869 6c64 7265 6e2e 6170  node.children.ap
+00020f50: 7065 6e64 2863 6869 6c64 290a 0a20 2020  pend(child)..   
+00020f60: 2072 6574 7572 6e20 6c6f 677a 5f73 6571   return logz_seq
+00020f70: 7565 6e63 6528 726f 6f74 2c20 706f 696e  uence(root, poin
+00020f80: 7470 696c 652c 206e 626f 6f74 7374 7261  tpile, nbootstra
+00020f90: 7073 3d6e 756d 5f62 6f6f 7473 7472 6170  ps=num_bootstrap
+00020fa0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00020fb0: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
+00020fc0: 6f6d 3d72 616e 646f 6d2c 206f 6e4e 6f64  om=random, onNod
+00020fd0: 653d 6f6e 4e6f 6465 2c20 7665 7262 6f73  e=onNode, verbos
+00020fe0: 653d 7665 7262 6f73 652c 0a20 2020 2020  e=verbose,.     
+00020ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021000: 2020 2020 6368 6563 6b5f 696e 7365 7274      check_insert
+00021010: 696f 6e5f 6f72 6465 723d 6368 6563 6b5f  ion_order=check_
+00021020: 696e 7365 7274 696f 6e5f 6f72 6465 7229  insertion_order)
+00021030: 0a                                       .
```

### Comparing `ultranest-4.2.0/ultranest/mlfriends.pyx` & `ultranest-4.3.1/ultranest/mlfriends.pyx`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/ultranest/netiter.py` & `ultranest-4.3.1/ultranest/netiter.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,9 @@
-#!/usr/bin/env python
-# -*- coding: utf-8 -*-
-__doc__ = """
+# noqa: D400 D205
+"""
 Graph-based nested sampling
 ---------------------------
 
 A formulation of nested sampling exploration as a tree, presented in
 section 3.4 of Buchner (2023, https://arxiv.org/abs/2101.09675).
 
 The root represents the prior volume, branches and sub-branches split the volume.
@@ -16,16 +15,14 @@
 
 Most functions receive the argument "roots", which are the
 children of the tree root (main branches).
 
 The exploration is bootstrap-capable without requiring additional
 computational effort: The roots are indexed, and the bootstrap explorer
 can ignore the rootids it does not know about.
-
-
 """
 
 import numpy as np
 from numpy import log, log1p, exp, logaddexp
 import math
 import sys
 from .utils import resample_equal
```

### Comparing `ultranest-4.2.0/ultranest/ordertest.py` & `ultranest-4.3.1/ultranest/ordertest.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+# noqa: D400 D205
 """
 U test for a uniform distribution of integers
 ---------------------------------------------
 
 A test for biased nested sampling, presented in
 section 4.5.2 of Buchner (2023, https://arxiv.org/abs/2101.09675).
```

### Comparing `ultranest-4.2.0/ultranest/pathsampler.py` & `ultranest-4.3.1/ultranest/pathsampler.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/ultranest/plot.py` & `ultranest-4.3.1/ultranest/plot.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+# noqa: D400 D205
 """
 Plotting utilities
 ------------------
 
 """
 
 from __future__ import (print_function, division)
```

### Comparing `ultranest-4.2.0/ultranest/popstepsampler.py` & `ultranest-4.3.1/ultranest/popstepsampler.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,25 +1,28 @@
+# noqa: D400 D205
 """
 Vectorized step samplers
 ------------------------
 
 Likelihood based on GPUs (model emulators based on neural networks,
 or JAX implementations) can evaluate hundreds of points as efficiently
 as one point. The implementations in this module leverage this power,
 by providing random walks of populations of walkers.
 """
 
 import numpy as np
 from ultranest.utils import submasks
-from ultranest.stepfuncs import evolve, step_back
+from ultranest.stepfuncs import evolve, step_back, update_vectorised_slice_sampler
 from ultranest.stepfuncs import generate_cube_oriented_direction, generate_cube_oriented_direction_scaled
 from ultranest.stepfuncs import generate_random_direction, generate_region_oriented_direction, generate_region_random_direction
 from ultranest.stepfuncs import generate_differential_direction, generate_mixture_random_direction
 import scipy.stats
 
+int_t = int
+
 
 def unitcube_line_intersection(ray_origin, ray_direction):
     r"""Compute intersection of a line (ray) and a unit box (0:1 in all axes).
 
     Based on
     http://www.iquilezles.org/www/articles/intersectors/intersectors.htm
 
@@ -50,16 +53,17 @@
         k = np.abs(m) * 0.5
         # line coordinates of intersection
         # find first intersecting coordinate
         t1 = -n - k
         t2 = -n + k
         return np.nanmax(t1, axis=1), np.nanmin(t2, axis=1)
 
+
 def diagnose_move_distances(region, ustart, ufinal):
-    """Compares random walk travel distance to MLFriends radius.
+    """Compare random walk travel distance to MLFriends radius.
 
     Compares in whitened space (t-space), the L2 norm between final
     point and starting point to the MLFriends bootstrapped radius.
 
     Parameters
     ----------
     region: MLFriends
@@ -82,14 +86,15 @@
     tstart = region.transformLayer.transform(ustart)
     tfinal = region.transformLayer.transform(ufinal)
     d2 = ((tstart - tfinal)**2).sum(axis=1)
     far_enough = d2 > region.maxradiussq
 
     return far_enough, [d2**0.5, region.maxradiussq**0.5]
 
+
 class GenericPopulationSampler():
     def plot(self, filename):
         """Plot sampler statistics.
 
         Parameters
         -----------
         filename: str
@@ -146,15 +151,14 @@
             mean_scale=np.nanmean([entry[1] for entry in self.logstat]) if len(self.logstat) > 0 else np.nan,
             mean_nsteps=np.nanmean([entry[2] for entry in self.logstat]) if len(self.logstat) > 0 else np.nan,
             mean_distance=self.mean_jump_distance,
             frac_far_enough=self.far_enough_fraction,
             last_logstat=dict(zip(self.logstat_labels, self.logstat[-1] if len(self.logstat) > 1 else [np.nan] * len(self.logstat_labels)))
         )
 
-
     def print_diagnostic(self):
         """Print diagnostic of step sampler performance."""
         if len(self.logstat) == 0:
             print("diagnostic unavailable, no recorded steps found")
             return
         frac_farenough = self.far_enough_fraction
         average_distance = self.mean_jump_distance
@@ -419,15 +423,15 @@
 
     def _setup(self, ndim):
         """Allocate arrays."""
         self.allu = np.zeros((self.popsize, self.nsteps + 1, ndim)) + np.nan
         self.allL = np.zeros((self.popsize, self.nsteps + 1)) + np.nan
         self.currentt = np.zeros(self.popsize) + np.nan
         self.currentv = np.zeros((self.popsize, ndim)) + np.nan
-        self.generation = np.zeros(self.popsize, dtype=int) - 1
+        self.generation = np.zeros(self.popsize, dtype=int_t) - 1
         self.current_left = np.zeros(self.popsize)
         self.current_right = np.zeros(self.popsize)
         self.searching_left = np.zeros(self.popsize, dtype=bool)
         self.searching_right = np.zeros(self.popsize, dtype=bool)
 
     def setup_start(self, us, Ls, starting):
         """Initialize walker starting points.
@@ -684,11 +688,310 @@
 
             self.shift()
             return u, p, L, nc
         else:
             return None, None, None, nc
 
 
+def slice_limit_to_unitcube(tleft, tright):
+    """
+    Return the slice limits as of the intersection between the slice and the unit cube boundaries.
+
+    parameters
+    ----------
+        tleft: float
+                Intersection of the unit cube with the slice in the negative direction
+        tright: float
+                Intersection of the unit cube with the slice in the positive direction
+    Returns
+    -------
+        (tleft_new,tright_new): tuple
+                Positive and negative slice limits
+    """
+    tleft_new, tright_new = tleft.copy(), tright.copy()
+
+    return tleft_new, tright_new
+
+
+def slice_limit_to_scale(tleft, tright):
+    """Return -1..+1 or the intersection between slice and unit cube if that is shorter.
+
+    parameters
+    ----------
+        tleft: float
+                Intersection of the unit cube with the slice in the negative direction
+        tright: float
+                Intersection of the unit cube with the slice in the positive direction
+    Returns
+    -------
+        (tleft_new,tright_new): tuple
+                Positive and negative slice limits
+    """
+    tleft_new = np.fmax(tleft, -1. + np.zeros_like(tleft))
+    tright_new = np.fmin(tright, 1. + np.zeros_like(tright))
+
+    return tleft_new, tright_new
+
+
+class PopulationSimpleSliceSampler(GenericPopulationSampler):
+    """Vectorized Slice sampler without stepping out procedure for quick look fits.
+
+    Unlike `:py:class:PopulationSliceSampler`, in `:py:class:PopulationSimpleSliceSampler`,
+    the likelihood is always called with the same number of points.
+
+    Sliced are defined by the `:py:func:generate_direction` function on a interval defined
+    around the current point. The centred interval has the width of the scale parameter,
+    i.e, there is no stepping out procedure as in `:py:class:PopulationSliceSampler`.
+    Slices are then shrink towards the current point until a point is found with a
+    likelihood above the threshold.
+
+    In the default case, i.e. `scale=None`, the slice width is defined as the
+    intersection between itself and the unit cube. To improve the efficiency of the sampler,
+    the slice can be reduced to an interval of size `2*scale` centred on the point. `scale`
+    can be adapted with the `scale_adapt_factor` parameter based on the median distance
+    between the current and the next point in a chains among all the chains. If the median
+    distance is above `scale/adapt_slice_scale_target`, the scale is increased by `scale_adapt_factor`,
+    and decreased otherwise. The `scale` parameter can also be jittered by a user supplied
+    function `:py:func:scale_jitter_func` to counter balance the effect of a strong adaptation.
+
+    In the case `scale!=None`, the detailed balance is not guaranteed, so this sampler should
+    be use with caution.
+
+    Multiple (`popsize`) slice sampling chains are run independently and in parallel.
+    In that case, we read points as if they were the next selected each after the other.
+    For a points to update the slice, it needs to be still in the part of the slices
+    searched after the first point have been read. In that case, we update as normal,
+    otherwise we discard the point.
+    """
+
+    def __init__(
+        self, popsize, nsteps, generate_direction,
+        scale_adapt_factor=1.0, adapt_slice_scale_target=2.0,
+        scale=1.0, scale_jitter_func=None, slice_limit=slice_limit_to_unitcube,
+        max_it=100, shrink_factor=1.0
+    ):
+        """Initialise.
+
+        Parameters
+        ----------
+        popsize: int
+            number of walkers to maintain.
+        nsteps: int
+            number of steps to take until the found point is accepted as independent.
+            To calibrate, try several runs with increasing nsteps (doubling).
+            The ln(Z) should become stable at some value.
+        generate_direction: function
+            Function that gives proposal kernel shape, one of:
+            :py:func:`ultranest.popstepsampler.generate_random_direction`
+            :py:func:`ultranest.popstepsampler.generate_region_oriented_direction`
+            :py:func:`ultranest.popstepsampler.generate_region_random_direction`
+            :py:func:`ultranest.popstepsampler.generate_differential_direction`
+            :py:func:`ultranest.popstepsampler.generate_mixture_random_direction`
+            :py:func:`ultranest.popstepsampler.generate_cube_oriented_direction` -> no adaptation in that case
+            :py:func:`ultranest.popstepsampler.generate_cube_oriented_direction_scaled` -> no adaptation in that case
+        scale: float
+            initial guess for the slice width.
+        scale_jitter_func: function
+            User supplied function to multiply the `scale` by a random factor. For example,
+            :py:func:`lambda : scipy.stats.truncnorm.rvs(-0.5, 5., loc=0, scale=1)+1.`
+        scale_adapt_factor: float
+            adaptation of `scale`. If 1: no adaptation. if <1, the scale is increased/decreased by this factor if the
+            final slice length is shorter/longer than the `adapt_slice_scale_target*scale`.
+        adapt_slice_scale_target: float
+            Targeted ratio of the median distance between slice mid and final point among all chains of `scale`.
+            Default: 2.0. Higher values are more conservative, lower values are faster.
+        slice_limit: function
+            Function setting the initial slice upper and lower bound. The default is `:py:func:slice_limit_to_unitcube`
+            which defines  the slice limit as the intersection between the slice and the unit cube. An alternative
+            when the `scale` is used is `:py:func:slice_limit_to_scale` which defines the slice limit as an interval
+            of size `2*scale`. This function should either return a copy of the `tleft` and `tright` arguments or
+            new arrays of the same shape.
+        max_it: int
+            maximum number of iterations to find a point on the slice. If the maximum number of iterations is reached,
+            the current point is returned as the next one.
+        shrink_factor: float
+            For standard slice sampling shrinking, `shrink_factor=1`, the slice bound is updated to the last
+            rejected point. Setting `shrink_factor>1` aggressively accelerates the shrinkage, by updating the
+            new slice bound to `1/shrink_factor` of the distance between the current point and rejected point.
+        """
+        self.nsteps = nsteps
+
+        self.max_it = max_it
+        self.nrejects = 0
+        self.generate_direction = generate_direction
+        self.scale_adapt_factor = scale_adapt_factor
+        self.ncalls = 0
+        self.discarded = 0
+        self.shrink_factor = shrink_factor
+        assert shrink_factor >= 1.0, "The shrink factor should be greater than 1.0 to be efficient"
+
+        self.scale = float(scale)
+
+        self.adapt_slice_scale_target = adapt_slice_scale_target
+
+        if scale_jitter_func is None:
+            self.scale_jitter_func = lambda: 1.
+        else:
+            self.scale_jitter_func = scale_jitter_func
+        self.prepared_samples = []
+        self.popsize = popsize
+
+        self.slice_limit = slice_limit
+
+        self.logstat = []
+        self.logstat_labels = ['accept_rate', 'efficiency', 'scale', 'far_enough', 'mean_rel_jump']
+
+    def __str__(self):
+        """Return string representation."""
+        return 'PopulationSimpleSliceSampler(popsize=%d, nsteps=%d, generate_direction=%s, scale=%.g)' % (
+            self.popsize, self.nsteps, self.generate_direction, self.scale)
+
+    def region_changed(self, Ls, region):
+        """Act upon region changed. Currently unused."""
+        pass
+
+    def __next__(
+        self, region, Lmin, us, Ls, transform, loglike, ndraw=10,
+        plot=False, tregion=None, log=False, test=False
+    ):
+        """Sample a new live point.
+
+        Parameters
+        ----------
+        region: MLFriends object
+            Region
+        Lmin: float
+            current log-likelihood threshold
+        us: np.array((nlive, ndim))
+            live points
+        Ls: np.array(nlive)
+            loglikelihoods live points
+        transform: function
+            prior transform function
+        loglike: function
+            loglikelihood function
+        ndraw: int
+            not used
+        plot: bool
+            not used
+        tregion: bool
+            not used
+        log: bool
+            not used
+        test: bool
+            In case of test of the reversibility of the sampler, the points drawn
+            from the live points needs to be deterministic. This parameters is
+            ensuring that.
+
+        Returns
+        -------
+        u: np.array(ndim) or None
+            new point coordinates (None if not yet available)
+        p: np.array(nparams) or None
+            new point transformed coordinates (None if not yet available)
+        L: float or None
+            new point likelihood (None if not yet available)
+        nc: int
+
+        """
+        nlive, ndim = us.shape
+
+        # fill if empty:
+        if len(self.prepared_samples) == 0:
+            # choose live points
+            ilive = np.random.randint(0, nlive, size=self.popsize)
+            allu = np.array(us[ilive,:]) if not test else np.array(us)
+            allp = np.zeros((self.popsize, ndim)) * np.nan
+            allL = np.array(Ls[ilive])
+            nc = 0
+            n_discarded = 0
+
+            interval_final = 0.
+
+            for k in range(self.nsteps):
+                # Defining scale jitter
+                factor_scale = self.scale_jitter_func()
+                # Defining slice direction
+                v = self.generate_direction(allu, region, scale=1.0) * self.scale * factor_scale
+
+                # limite of the slice based on the unit cube boundaries
+                tleft_unitcube, tright_unitcube = unitcube_line_intersection(allu, v)
+
+                # Defining bound of the slice
+                # Bounds for each points and likelihood calls are identical initially
+
+                # Slice bounds for each likelihood call
+                tleft_worker, tright_worker = self.slice_limit(tleft_unitcube,tright_unitcube)
+
+                # Slice bounds for each points
+                tleft, tright = self.slice_limit(tleft_unitcube,tright_unitcube)
+                # Index of the workers working concurrently
+                worker_running = np.arange(0, self.popsize, 1, dtype=int_t)
+                # Status indicating if a points has already find its next position
+                status = np.zeros(self.popsize, dtype=int_t)  # one for success, zero for running
+
+                # Loop until each points has found its next position or we reached 100 iterations
+                for it in range(self.max_it):
+                    # Sampling points on the slices
+                    slice_position = np.random.uniform(size=(self.popsize,))
+                    t = tleft_worker + (tright_worker - tleft_worker) * slice_position
+
+                    points = allu[worker_running, :]
+                    v_worker = v[worker_running, :]
+                    proposed_u = points + t.reshape((-1,1)) * v_worker
+
+                    proposed_p = transform(proposed_u)
+                    proposed_L = loglike(proposed_p)
+                    nc += self.popsize
+
+                    # Updating the pool of points based on the newly sampled points
+                    tleft, tright, worker_running, status, allu, allL, allp, n_discarded_it = update_vectorised_slice_sampler(
+                        t, tleft, tright, proposed_L, proposed_u, proposed_p, worker_running, status, Lmin, self.shrink_factor,
+                        allu, allL, allp, self.popsize)
+                    n_discarded += n_discarded_it
+
+                    # Update of the limits of the slices
+                    tleft_worker = tleft[worker_running]
+                    tright_worker = tright[worker_running]
+
+                    if not np.any(status == 0):
+                        break
+
+                # Record of the final interval on theta for scale adaptation
+                interval_final += np.median(tright - tleft)
+
+            interval_final = interval_final / self.nsteps
+            self.discarded += n_discarded
+            self.ncalls += nc
+
+            assert np.isfinite(allp).all(), 'some walkers never moved! Double nsteps of PopulationSimpleSliceSampler.'
+            far_enough, (move_distance, reference_distance) = diagnose_move_distances(region, us[ilive,:], allu)
+            self.prepared_samples = list(zip(allu, allp, allL))
+
+            self.logstat.append([
+                self.popsize / nc,
+                self.scale,  # will always be 1. in the default case
+                self.nsteps,
+                np.mean(far_enough) if len(far_enough) > 0 else 0,
+                np.exp(np.mean(np.log(move_distance / reference_distance + 1e-10))) if len(far_enough) > 0 else 0
+            ])
+
+            # Scale adaptation such that the final interval is
+            # half the scale. There may be better things to do
+            # here, but it seems to work.
+            if interval_final >= 1. / self.adapt_slice_scale_target:
+                self.scale *= 1. / self.scale_adapt_factor
+            else:
+                self.scale *= self.scale_adapt_factor
+            # print("percentage of throws %.3f\n\n"%((self.throwed/self.ncalls)*100.))
+
+        else:
+            nc = 0
+
+        u, p, L = self.prepared_samples.pop(0)
+        return u, p, L, nc
+
+
 __all__ = [
     "generate_cube_oriented_direction", "generate_cube_oriented_direction_scaled",
     "generate_random_direction", "generate_region_oriented_direction", "generate_region_random_direction",
-    "PopulationRandomWalkSampler", "PopulationSliceSampler"]
+    "PopulationRandomWalkSampler", "PopulationSliceSampler","PopulationSimpleSliceSampler"]
```

### Comparing `ultranest-4.2.0/ultranest/samplingpath.py` & `ultranest-4.3.1/ultranest/samplingpath.py`

 * *Files identical despite different names*

### Comparing `ultranest-4.2.0/ultranest/solvecompat.py` & `ultranest-4.3.1/ultranest/solvecompat.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+# noqa: D400 D205
 """Drop-in replacement for pymultinest.solve.
 
 Example::
 
     from ultranest.solvecompat import pymultinest_solve_compat as solve
 
     # is a drop-in replacement for
```

### Comparing `ultranest-4.2.0/ultranest/stepfuncs.pyx` & `ultranest-4.3.1/ultranest/stepfuncs.pyx`

 * *Files 12% similar despite different names*

```diff
@@ -522,7 +522,96 @@
     v: array
         new direction vector
     """
     nsamples, ndim = ui.shape
     v_DE = generate_differential_direction(ui, region, scale=scale)
     v_axis = generate_region_oriented_direction(ui, region, scale=scale)
     return np.where(np.random.uniform(size=nsamples).reshape((-1, 1)) < 0.5, v_DE, v_axis)
+
+@cython.boundscheck(False)
+@cython.wraparound(False)
+cpdef tuple update_vectorised_slice_sampler(\
+                          np.ndarray[np.float_t, ndim=1] t, np.ndarray[np.float_t, ndim=1] tleft,\
+                          np.ndarray[np.float_t, ndim=1] tright, np.ndarray[np.float_t, ndim=1] proposed_L,\
+                          np.ndarray[np.float_t, ndim=2] proposed_u, np.ndarray[np.float_t, ndim=2] proposed_p,\
+                          np.ndarray[np.int_t, ndim=1] worker_running, np.ndarray[np.int_t, ndim=1] status,\
+                          np.float_t Likelihood_threshold,np.float_t shrink_factor, np.ndarray[np.float_t, ndim=2] allu,\
+                          np.ndarray[np.float_t, ndim=1] allL, np.ndarray[np.float_t, ndim=2] allp, int popsize):
+
+    """Update the slice sampler state of each walker in the populations.
+
+    Parameters
+    -----------
+    t: array
+        proposed slice coordinate
+    tleft: array
+        current slice negative end
+    tright: array
+        current slice positive end
+    proposed_L: array
+        log-likelihood of proposed point
+    proposed_u: array
+        proposed point in unit cube space
+    proposed_p: array
+        proposed point in transformed space
+    worker_running: array
+        index of the point associated with each worker
+    status: array
+        integer status of the point
+    Likelihood_threshold: float
+        current log-likelihood threshold
+    shrink_factor: float
+        factor by which to shrink the slice
+    allu: array
+        Accepted points in unit cube space
+    allL: array
+        log-likelihoods of accepted points
+    allp: array
+        Accepted points in transformed space
+    popsize: int
+        number of points
+
+    Returns
+    --------
+    tleft: array
+        updated current slice negative end
+    tright: array
+        updated current slice positive end
+    worker_running: array
+        updated index of the point associated with each worker
+    status: array
+        updated integer status of the point
+    allu: array
+        updated accepted points in unit cube space
+    allL: array
+        updated log-likelihoods of accepted points
+    allp: array
+        updated accepted points in transformed space
+    discarded: int
+        Point where the likelihood was evaluated but was not taken into account.
+    """
+                            
+    cdef int j, k
+    cdef discarded = 0
+    for l in range(popsize):
+        if t[l] > tright[worker_running[l]] or t[l] < tleft[worker_running[l]]:
+            if proposed_L[l]>Likelihood_threshold:
+                discarded+=1
+            continue
+        if 0 < t[l] < tright[worker_running[l]]:
+            tright[worker_running[l]] = t[l]/shrink_factor
+        if 0 > t[l] > tleft[worker_running[l]]:
+            tleft[worker_running[l]] = t[l]/shrink_factor
+        if proposed_L[l] > Likelihood_threshold and status[worker_running[l]] == 0:
+            status[worker_running[l]] = 1
+            allu[worker_running[l], :] = proposed_u[l, :]
+            allL[worker_running[l]] = proposed_L[l]
+            allp[worker_running[l], :] = proposed_p[l, :]
+
+    j = 0
+    while j < popsize and (status == 0).any():
+        for k in range(popsize):
+            if status[k] == 0 and j < popsize:
+                worker_running[j] = k
+                j += 1
+
+    return (tleft, tright, worker_running, status, allu, allL, allp,discarded)
```

### Comparing `ultranest-4.2.0/ultranest/stepsampler.py` & `ultranest-4.3.1/ultranest/stepsampler.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,21 +1,23 @@
+# noqa: D400 D205
 """
 MCMC-like step sampling
 -----------------------
 
 The classes implemented here are generators that, in each iteration,
 only make one likelihood call. This allows running in parallel a
 population of samplers that have the same execution time per call,
 even if they do not terminate at the same number of iterations.
 """
 
 from __future__ import print_function, division
 import numpy as np
 import matplotlib.pyplot as plt
 from .utils import listify as _listify
+from warnings import warn
 
 
 def generate_random_direction(ui, region, scale=1):
     """Sample uniform direction vector in unit cube space of length `scale`.
 
     Samples a direction from a unit multi-variate Gaussian.
 
@@ -322,55 +324,63 @@
         boolean whether point is inside the region
     """
     del uold
     return region.inside(unew)
 
 
 def adapt_proposal_total_distances(region, history, mean_pair_distance, ndim):
+    """Check jump distance (deprecated function)."""
     # compute mean vector of each proposed jump
     # compute total distance of all jumps
+    warn('adapt_proposal_total_distances is deprecated and will be removed in future versions of UltraNest.', DeprecationWarning, stacklevel=2)
     tproposed = region.transformLayer.transform(np.asarray([u for u, _ in history]))
     assert len(tproposed.sum(axis=1)) == len(tproposed)
     d2 = ((((tproposed[0] - tproposed)**2).sum(axis=1))**0.5).sum()
     far_enough = d2 > mean_pair_distance / ndim
 
     return far_enough, [d2, mean_pair_distance]
 
 
 def adapt_proposal_total_distances_NN(region, history, mean_pair_distance, ndim):
+    """Check jump distance (deprecated function)."""
     # compute mean vector of each proposed jump
     # compute total distance of all jumps
+    warn('adapt_proposal_total_distances_NN is deprecated and will be removed in future versions of UltraNest.', DeprecationWarning, stacklevel=2)
     tproposed = region.transformLayer.transform(np.asarray([u for u, _ in history]))
     assert len(tproposed.sum(axis=1)) == len(tproposed)
     d2 = ((((tproposed[0] - tproposed)**2).sum(axis=1))**0.5).sum()
     far_enough = d2 > region.maxradiussq**0.5
 
     return far_enough, [d2, region.maxradiussq**0.5]
 
 
 def adapt_proposal_summed_distances(region, history, mean_pair_distance, ndim):
+    """Check jump distance (deprecated function)."""
     # compute sum of distances from each jump
+    warn('adapt_proposal_summed_distances is deprecated and will be removed in future versions of UltraNest.', DeprecationWarning, stacklevel=2)
     tproposed = region.transformLayer.transform(np.asarray([u for u, _ in history]))
     d2 = (((tproposed[1:,:] - tproposed[:-1,:])**2).sum(axis=1)**0.5).sum()
     far_enough = d2 > mean_pair_distance / ndim
 
     return far_enough, [d2, mean_pair_distance]
 
 
 def adapt_proposal_summed_distances_NN(region, history, mean_pair_distance, ndim):
+    """Check jump distance (deprecated function)."""
     # compute sum of distances from each jump
+    warn('adapt_proposal_summed_distances_NN is deprecated and will be removed in future versions of UltraNest.', DeprecationWarning, stacklevel=2)
     tproposed = region.transformLayer.transform(np.asarray([u for u, _ in history]))
     d2 = (((tproposed[1:,:] - tproposed[:-1,:])**2).sum(axis=1)**0.5).sum()
     far_enough = d2 > region.maxradiussq**0.5
 
     return far_enough, [d2, region.maxradiussq**0.5]
 
 
 def adapt_proposal_move_distances(region, history, mean_pair_distance, ndim):
-    """Compares random walk travel distance to MLFriends radius.
+    """Compare random walk travel distance to MLFriends radius.
 
     Compares in whitened space (t-space), the L2 norm between final
     point and starting point to the MLFriends bootstrapped radius.
 
     Parameters
     ----------
     region: MLFriends
@@ -396,15 +406,15 @@
     d2 = ((tstart - tfinal)**2).sum()
     far_enough = d2 > region.maxradiussq
 
     return far_enough, [d2**0.5, region.maxradiussq**0.5]
 
 
 def adapt_proposal_move_distances_midway(region, history, mean_pair_distance, ndim):
-    """Compares first half of the travel distance to MLFriends radius.
+    """Compare first half of the travel distance to MLFriends radius.
 
     Compares in whitened space (t-space), the L2 norm between the
     middle point of the walk and the starting point,
     to the MLFriends bootstrapped radius.
 
     Parameters
     ----------
@@ -452,41 +462,44 @@
     i: int
         index of live point selected
     """
     return np.random.randint(len(Ls))
 
 
 class IslandPopulationRandomLivepointSelector(object):
+    """Mutually isolated live point subsets.
+
+    To replace dead points, chains are only started from the same
+    island as the dead point. Island refers to chunks of
+    live point indices (0,1,2,3 as stored, not sorted).
+    Each chunk has size ´island_size´.
+
+    If ´island_size´ is large, for example, the total number of live points,
+    then clumping can occur more easily. This is the observed behaviour
+    that a limited random walk is run from one live point, giving
+    two similar points, then the next dead point replacement is
+    likely run again from these, giving more and more similar live points.
+    This gives a run-away process leading to clumps of similar,
+    highly correlated points.
+
+    If ´island_size´ is small, for example, 1, then each dead point
+    is replaced by a chain started from it. This is a problem because
+    modes can never die out. Nested sampling can then not complete.
+
+    In a multi-modal run, within a given number of live points,
+    the number of live points per mode is proportional to the mode's
+    prior volume, but can fluctuate. If the number of live points
+    is small, a fluctuation can lead to mode die-out, which cannot
+    be reversed. Therefore, the number of island members should be
+    large enough to represent each mode.
+    """
+
     def __init__(self, island_size, exchange_probability=0):
         """Set up multiple isolated islands.
 
-        To replace dead points, chains are only started from the same
-        island as the dead point. Island refers to chunks of
-        live point indices (0,1,2,3 as stored, not sorted).
-        Each chunk has size ´island_size´.
-
-        If ´island_size´ is large, for example, the total number of live points,
-        then clumping can occur more easily. This is the observed behaviour
-        that a limited random walk is run from one live point, giving
-        two similar points, then the next dead point replacement is
-        likely run again from these, giving more and more similar live points.
-        This gives a run-away process leading to clumps of similar,
-        highly correlated points.
-
-        If ´island_size´ is small, for example, 1, then each dead point
-        is replaced by a chain started from it. This is a problem because
-        modes can never die out. Nested sampling can then not complete.
-
-        In a multi-modal run, within a given number of live points,
-        the number of live points per mode is proportional to the mode's
-        prior volume, but can fluctuate. If the number of live points
-        is small, a fluctuation can lead to mode die-out, which cannot
-        be reversed. Therefore, the number of island members should be
-        large enough to represent each mode.
-
         Parameters
         -----------
         island_size: int
             maximum number of members on each isolated live point
             population.
 
         exchange_probability: float
@@ -554,24 +567,34 @@
             To find the right value, see :py:class:`ultranest.calibrator.ReactiveNestedCalibrator`
 
         generate_direction: function
             direction proposal function.
 
             Available are:
 
-            * :py:func:`generate_cube_oriented_direction` (slice sampling, picking one random parameter to vary)
-            * :py:func:`generate_random_direction` (hit-and-run sampling, picking a random direction varying all parameters)
-            * :py:func:`generate_differential_direction` (differential evolution direction proposal)
-            * :py:func:`generate_region_oriented_direction` (slice sampling, but in the whitened parameter space)
-            * :py:func:`generate_region_random_direction` (hit-and-run sampling, but in the whitened parameter space)
-            * :py:class:`SequentialDirectionGenerator` (sequential slice sampling, i.e., iterate deterministically through the parameters)
-            * :py:class:`SequentialRegionDirectionGenerator` (sequential slice sampling in the whitened parameter space, i.e., iterate deterministically through the principle axes)
-            * :py:func:`generate_cube_oriented_differential_direction` (like generate_differential_direction, but along only one randomly chosen parameter)
-            * :py:func:`generate_partial_differential_direction` (differential evolution slice proposal on only 10% of the parameters)
-            * :py:func:`generate_mixture_random_direction` (combined proposal)
+            * :py:func:`generate_cube_oriented_direction`
+                (slice sampling, picking one random parameter to vary)
+            * :py:func:`generate_random_direction`
+                (hit-and-run sampling, picking a random direction varying all parameters)
+            * :py:func:`generate_differential_direction`
+                (differential evolution direction proposal)
+            * :py:func:`generate_region_oriented_direction`
+                (slice sampling, but in the whitened parameter space)
+            * :py:func:`generate_region_random_direction`
+                (hit-and-run sampling, but in the whitened parameter space)
+            * :py:class:`SequentialDirectionGenerator`
+                (sequential slice sampling, i.e., iterate deterministically through the parameters)
+            * :py:class:`SequentialRegionDirectionGenerator`
+                (sequential slice sampling in the whitened parameter space, i.e., iterate deterministically through the principle axes)
+            * :py:func:`generate_cube_oriented_differential_direction`
+                (like generate_differential_direction, but along only one randomly chosen parameter)
+            * :py:func:`generate_partial_differential_direction`
+                (differential evolution slice proposal on only 10% of the parameters)
+            * :py:func:`generate_mixture_random_direction`
+                (combined proposal)
 
             Additionally, :py:class:`OrthogonalDirectionGenerator`
             can be applied to any generate_direction function.
 
             When in doubt, try :py:func:`generate_mixture_random_direction`.
             It combines efficient moves along the live point distribution,
             with robustness against collapse to a subspace.
@@ -745,25 +768,38 @@
         i = self.logstat_labels.index('jump-distance')
         j = self.logstat_labels.index('reference-distance')
         jump_distances = np.array([entry[i] for entry in self.logstat])
         reference_distances = np.array([entry[j] for entry in self.logstat])
         return np.nanmean(jump_distances > reference_distances)
 
     def get_info_dict(self):
+        """Return diagnostics of the step sampler performance.
+
+        Returns
+        --------
+        v: dict
+            the keys are:
+                * num_logs: number of log entries being summarized
+                * rejection_rate: fraction of steps rejected
+                * mean_scale: average value of `scale`
+                * mean_nsteps: average `nsteps`
+                * mean_distance: mean jump distance (see `Buchner+24 <https://arxiv.org/abs/2402.11936>`_)
+                * frac_far_enough: fraction of jumps with sufficient distance (see `Buchner+24 <https://arxiv.org/abs/2402.11936>`_)
+                * last_logstat: content of the last log entry
+        """
         return dict(
             num_logs=len(self.logstat),
             rejection_rate=np.nanmean([entry[0] for entry in self.logstat]) if len(self.logstat) > 0 else np.nan,
             mean_scale=np.nanmean([entry[1] for entry in self.logstat]) if len(self.logstat) > 0 else np.nan,
             mean_nsteps=np.nanmean([entry[2] for entry in self.logstat]) if len(self.logstat) > 0 else np.nan,
             mean_distance=self.mean_jump_distance,
             frac_far_enough=self.far_enough_fraction,
             last_logstat=dict(zip(self.logstat_labels, self.logstat[-1] if len(self.logstat) > 1 else [np.nan] * len(self.logstat_labels)))
         )
 
-
     def print_diagnostic(self):
         """Print diagnostic of step sampler performance."""
         if len(self.logstat) == 0:
             print("diagnostic unavailable, no recorded steps found")
             return
         if 'jump-distance' not in self.logstat_labels or 'reference-distance' not in self.logstat_labels:
             print("turn on check_nsteps in the step sampler for diagnostics")
@@ -1173,15 +1209,14 @@
             if not self.region_filter or inside_region(region, xj.reshape((1, -1)), ui):
                 return xj.reshape((1, -1))
             else:
                 self.found_right = True
 
                 # adjust scale to final slice length
                 if -left > self.next_scale or right > self.next_scale:
-                #if right - left > self.next_scale:
                     self.next_scale *= 1.1
                 else:
                     self.next_scale /= 1.1
                 # print("adjusting scale...", self.next_scale)
 
         while True:
             u = np.random.uniform(left, right)
@@ -1216,14 +1251,15 @@
 def RegionBallSliceSampler(*args, **kwargs):
     """Hit & run sampler. Choose random directions according to region."""
     return SliceSampler(*args, **kwargs, generate_direction=generate_region_random_direction)
 
 
 class SequentialDirectionGenerator(object):
     """Sequentially proposes one parameter after the next."""
+
     def __init__(self):
         """Initialise."""
         self.axis_index = 0
 
     def __call__(self, ui, region, scale=1):
         """Choose the next axis in u-space.
 
@@ -1254,19 +1290,21 @@
                 i2 += 1
 
             v[j] = (region.u[i,j] - region.u[i2,j]) * scale
 
         return v
 
     def __str__(self):
+        """Create string representation."""
         return type(self).__name__ + '()'
 
 
 class SequentialRegionDirectionGenerator(object):
     """Sequentially proposes one region axes after the next."""
+
     def __init__(self):
         """Initialise."""
         self.axis_index = 0
 
     def __call__(self, ui, region, scale=1):
         """Choose the next axis in t-space.
 
@@ -1295,14 +1333,15 @@
         # convert back to unit cube space:
         uj = region.transformLayer.untransform(ti + tv * 1e-3)
         v = uj - ui
         v *= scale / (v**2).sum()**0.5
         return v
 
     def __str__(self):
+        """Create string representation."""
         return type(self).__name__ + '()'
 
 
 def RegionSequentialSliceSampler(*args, **kwargs):
     """Slice sampler, sequentially iterating region axes."""
     return SliceSampler(*args, **kwargs, generate_direction=SequentialRegionDirectionGenerator())
```

### Comparing `ultranest-4.2.0/ultranest/store.py` & `ultranest-4.3.1/ultranest/store.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+# noqa: D400 D205
 """
 Storage for nested sampling points
 -----------------------------------
 
 The information stored is a table with
 
 - the likelihood threshold drawn from
```

### Comparing `ultranest-4.2.0/ultranest/utils.py` & `ultranest-4.3.1/ultranest/utils.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+# noqa: D400 D205
 """
 Utility functions for logging and statistics
 --------------------------------------------
 """
 
 from __future__ import print_function, division
 import logging
@@ -194,15 +195,15 @@
         rstate = np.random
 
     N = len(weights)
 
     # make N subdivisions, and choose positions with a consistent random offset
     positions = (rstate.random() + np.arange(N)) / N
 
-    idx = np.zeros(N, dtype=int)
+    idx = np.zeros(N, dtype=np.int_)
     cumulative_sum = np.cumsum(weights)
     i, j = 0, 0
     while i < N:
         if positions[i] < cumulative_sum[j]:
             idx[i] = j
             i += 1
         else:
@@ -480,15 +481,15 @@
     mask : np.array(dtype=bool)
         selection of some array
     masks : list of np.array(dtype=bool)
         each further mask is a subselection
 
     Returns
     -------
-    indices : np.array(dtype=int)
+    indices : np.array(dtype=np.int_)
         indices which select the subselection in the original array
 
     """
     indices, = np.where(mask)
     for othermask in masks:
         indices = indices[othermask]
     return indices
```

### Comparing `ultranest-4.2.0/ultranest/viz.py` & `ultranest-4.3.1/ultranest/viz.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+# noqa: D400 D205
 """
 Live point visualisations
 -------------------------
 
 Gives a live impression of current exploration.
 This is powerful because the user can abort partial runs if the fit
 converges to unreasonable values.
@@ -136,20 +137,23 @@
         "Volume: ~exp(%.2f)" % region.estimate_volume(), '*' if region_fresh else ' ',
         "Expected Volume: exp(%.2f)" % info['logvol'],
         '' if 'order_test_correlation' not in info else
         ("Quality: correlation length: %d (%s)" % (info['order_test_correlation'], '+' if info['order_test_direction'] >= 0 else '-'))
         if np.isfinite(info['order_test_correlation']) else "Quality: ok",
     )
     if info.get('stepsampler_info', {}).get('num_logs', 0) > 0:
-        print(
-            ('Step sampler performance: %(rejection_rate).1f rej/step, %(mean_nsteps)d steps/it' % (info['stepsampler_info'])) +
-            (', rel jump distance: %.2f (should be >1), %.2f%% (should be >50%%)' % (
-                info['stepsampler_info']['mean_distance'], 100 * info['stepsampler_info']['frac_far_enough']
-            )) if 'mean_distance' in info['stepsampler_info'] else ''
-        )
+        stepsampler_info = dict(info['stepsampler_info'])
+        stepsampler_info['frac_far_enough'] *= 100
+        if 'mean_distance' in stepsampler_info:
+            print((
+                'Step sampler performance: %(rejection_rate).1f rej/step, %(mean_nsteps)d steps/it, '
+                'rel jump distance: %(mean_distance).2f (should be >1), %(frac_far_enough).2f%% (should be >50%%)') % stepsampler_info
+            )
+        else:
+            print()
 
     print()
     if ndim == 1:
         pass
     elif ndim == 2 and spearman is not None:
         rho, pval = spearman(p)
         if pval < 0.01 and abs(rho) > 0.75:
@@ -319,20 +323,22 @@
             (" | Volume: ~exp(%.2f) " % region.estimate_volume()) + ('*' if region_fresh else ' ') + \
             " | Expected Volume: exp(%.2f)" % info['logvol'] + \
             ('' if 'order_test_correlation' not in info else
              (" | Quality: correlation length: %d (%s)" % (info['order_test_correlation'], '+' if info['order_test_direction'] >= 0 else '-'))
              if np.isfinite(info['order_test_correlation']) else " | Quality: ok")
 
         if info.get('stepsampler_info', {}).get('num_logs', 0) > 0:
-            labeltext += ("<br/>" +
-                'Step sampler performance: %(rejection_rate).1f%% rej/step, %(mean_nsteps)d steps/it' % (info['stepsampler_info']) +
-                ('mean rel jump distance: %.2f (should be >1), %.2f%% (should be >50%%)' % (
-                    info['stepsampler_info']['mean_distance'], 100 * info['stepsampler_info']['frac_far_enough']
-                )) if 'mean_distance' in info['stepsampler_info'] else ''
-            )
+            stepsampler_info = dict(info['stepsampler_info'])
+            stepsampler_info['frac_far_enough'] *= 100
+            if 'mean_distance' in stepsampler_info:
+                labeltext += (
+                    "<br/>"
+                    'Step sampler performance: %(rejection_rate).1f%% rej/step, %(mean_nsteps)d steps/it'
+                    'mean rel jump distance: %(mean_distance).2f (should be >1), %(frac_far_enough).2f%% (should be >50%%)'
+                ) % stepsampler_info
 
         if ndim == 1:
             pass
         elif ndim == 2 and spearman is not None:
             rho, pval = spearman(p)
             if pval < 0.01 and abs(rho) > 0.75:
                 labeltext += ("<br/>   %s between %s and %s: rho=%.2f" % (
```

### Comparing `ultranest-4.2.0/ultranest.egg-info/PKG-INFO` & `ultranest-4.3.1/ultranest.egg-info/PKG-INFO`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: ultranest
-Version: 4.2.0
+Version: 4.3.1
 Summary: Fit and compare complex models reliably and rapidly. Advanced Nested Sampling.
 Home-page: https://github.com/JohannesBuchner/ultranest
 Author: Johannes Buchner
 Author-email: johannes.buchner.acad@gmx.com
 License: GNU General Public License v3
 Keywords: ultranest
 Classifier: Development Status :: 5 - Production/Stable
@@ -16,18 +16,14 @@
 Classifier: Programming Language :: Python :: 2.7
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.5
 Classifier: Programming Language :: Python :: 3.6
 Classifier: Programming Language :: Python :: 3.7
 Requires-Python: >=2.7, !=3.0.*, !=3.1.*, !=3.2.*, !=3.3.*, !=3.4.*
 License-File: LICENSE
-Requires-Dist: numpy
-Requires-Dist: cython
-Requires-Dist: matplotlib
-Requires-Dist: corner
 
 =========
 UltraNest
 =========
 
 Fit and compare complex models reliably and rapidly with advanced sampling techniques.
```

### Comparing `ultranest-4.2.0/ultranest.egg-info/SOURCES.txt` & `ultranest-4.3.1/ultranest.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -62,15 +62,14 @@
 ultranest/dychmc.py
 ultranest/dyhmc.py
 ultranest/flatnuts.py
 ultranest/hotstart.py
 ultranest/integrator.py
 ultranest/mlfriends.pyx
 ultranest/netiter.py
-ultranest/neuralbound.py
 ultranest/ordertest.py
 ultranest/pathsampler.py
 ultranest/plot.py
 ultranest/popstepsampler.py
 ultranest/samplingpath.py
 ultranest/solvecompat.py
 ultranest/stepfuncs.pyx
```

